<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patina Forge</title>
    <meta name="description" content="Interactive patina simulator where particles deposit, oxidize, and crystallize on virtual stone surfaces">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #1a1510; min-height: 100vh; font-family: 'Georgia', serif; color: #a08060; overflow: hidden; }
        #canvas { position: fixed; top: 0; left: 0; }
        #controls {
            position: fixed; top: 20px; left: 20px; background: rgba(30,25,20,0.95);
            padding: 20px; border-radius: 10px; border: 1px solid rgba(150,120,80,0.3);
            z-index: 100;
        }
        h3 { margin-bottom: 15px; color: #c0a070; font-weight: normal; }
        .control-row { margin: 10px 0; }
        label { display: block; font-size: 11px; margin-bottom: 5px; opacity: 0.8; }
        input[type="range"] { width: 140px; }
        .value { float: right; color: #d0a060; font-size: 12px; }
        button {
            display: block; width: 100%; padding: 10px; margin: 6px 0;
            background: rgba(100,80,50,0.4); border: 1px solid rgba(150,120,80,0.4);
            color: #b09070; cursor: pointer; border-radius: 6px; font-family: inherit;
        }
        #info { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); font-size: 12px; opacity: 0.5; z-index: 100; }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div id="controls">
        <h3>Patina Forge</h3>
        <div class="control-row">
            <label>Humidity <span class="value" id="humid-val">60%</span></label>
            <input type="range" id="humidity" min="10" max="100" value="60">
        </div>
        <div class="control-row">
            <label>Temperature <span class="value" id="temp-val">20C</span></label>
            <input type="range" id="temperature" min="-10" max="40" value="20">
        </div>
        <div class="control-row">
            <label>Salt Spray <span class="value" id="salt-val">30</span></label>
            <input type="range" id="salt" min="0" max="100" value="30">
        </div>
        <button id="rust-btn">Apply Rust</button>
        <button id="verdigris-btn">Apply Verdigris</button>
        <button id="clean-btn">Clean Stone</button>
    </div>
    <div id="info">Click to deposit minerals | Watch patina form over time</div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let W, H;
        function resize() { W = canvas.width = innerWidth; H = canvas.height = innerHeight; initStone(); }
        resize(); window.onresize = resize;
        
        let humidity = 0.6;
        let temperature = 20;
        let saltSpray = 0.3;
        let particles = [];
        let deposits = [];
        let cracks = [];
        let time = 0;
        
        const patinaTypes = {
            rust: { hue: 25, sat: 70, light: 40, spread: 1.5 },
            verdigris: { hue: 160, sat: 50, light: 45, spread: 1.2 },
            salt: { hue: 40, sat: 10, light: 85, spread: 0.8 },
            lichen: { hue: 80, sat: 40, light: 50, spread: 2 }
        };
        
        let currentPatina = 'rust';
        
        function initStone() {
            cracks = [];
            for (let i = 0; i < 15; i++) {
                const startX = Math.random() * W;
                const startY = Math.random() * H;
                const length = 50 + Math.random() * 150;
                const angle = Math.random() * Math.PI * 2;
                cracks.push({
                    x1: startX,
                    y1: startY,
                    x2: startX + Math.cos(angle) * length,
                    y2: startY + Math.sin(angle) * length,
                    width: 1 + Math.random() * 2
                });
            }
        }
        
        class Particle {
            constructor(x, y, type) {
                this.x = x;
                this.y = y;
                this.type = type;
                this.vx = (Math.random() - 0.5) * 0.5;
                this.vy = Math.random() * 0.5 + 0.2;
                this.size = 2 + Math.random() * 3;
                this.life = 1;
                this.deposited = false;
            }
            update() {
                if (this.deposited) return;
                
                this.x += this.vx;
                this.y += this.vy;
                this.vy += 0.01;
                
                this.life -= 0.005;
                
                if (this.life <= 0 || this.y > H + 10) {
                    return false;
                }
                
                if (Math.random() < 0.02 * humidity) {
                    this.deposited = true;
                    deposits.push({
                        x: this.x,
                        y: this.y,
                        type: this.type,
                        size: this.size,
                        age: 0,
                        maxAge: 500 + Math.random() * 500
                    });
                    return false;
                }
                
                return true;
            }
            draw() {
                const p = patinaTypes[this.type];
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size * this.life, 0, Math.PI * 2);
                ctx.fillStyle = "hsla(" + p.hue + ", " + p.sat + "%, " + p.light + "%, " + this.life + ")";
                ctx.fill();
            }
        }
        
        function drawStone() {
            const stoneGrad = ctx.createRadialGradient(W/2, H/2, 0, W/2, H/2, Math.max(W, H) * 0.7);
            stoneGrad.addColorStop(0, '#3a3530');
            stoneGrad.addColorStop(0.5, '#2a2520');
            stoneGrad.addColorStop(1, '#1a1510');
            ctx.fillStyle = stoneGrad;
            ctx.fillRect(0, 0, W, H);
            
            for (let i = 0; i < 200; i++) {
                const x = (i * 73) % W;
                const y = (i * 47) % H;
                ctx.beginPath();
                ctx.arc(x, y, 1 + Math.random() * 2, 0, Math.PI * 2);
                ctx.fillStyle = "rgba(60, 55, 45, 0.3)";
                ctx.fill();
            }
            
            cracks.forEach(crack => {
                ctx.beginPath();
                ctx.moveTo(crack.x1, crack.y1);
                ctx.lineTo(crack.x2, crack.y2);
                ctx.strokeStyle = 'rgba(20, 15, 10, 0.5)';
                ctx.lineWidth = crack.width;
                ctx.stroke();
            });
        }
        
        function drawDeposits() {
            deposits.forEach(dep => {
                const p = patinaTypes[dep.type];
                const ageRatio = Math.min(1, dep.age / dep.maxAge);
                const size = dep.size * (1 + ageRatio * p.spread);
                
                ctx.beginPath();
                ctx.arc(dep.x, dep.y, size * 2, 0, Math.PI * 2);
                ctx.fillStyle = "hsla(" + p.hue + ", " + (p.sat * 0.5) + "%, " + p.light + "%, " + (0.1 * ageRatio) + ")";
                ctx.fill();
                
                ctx.beginPath();
                ctx.arc(dep.x, dep.y, size, 0, Math.PI * 2);
                ctx.fillStyle = "hsla(" + p.hue + ", " + p.sat + "%, " + (p.light - ageRatio * 10) + "%, " + (0.3 + ageRatio * 0.5) + ")";
                ctx.fill();
                
                if (ageRatio > 0.5 && dep.type === 'rust') {
                    for (let i = 0; i < 3; i++) {
                        const angle = Math.random() * Math.PI * 2;
                        const dist = size * (0.5 + Math.random() * 0.5);
                        ctx.beginPath();
                        ctx.arc(dep.x + Math.cos(angle) * dist, dep.y + Math.sin(angle) * dist, 1, 0, Math.PI * 2);
                        ctx.fillStyle = "hsla(15, 80%, 30%, 0.5)";
                        ctx.fill();
                    }
                }
            });
        }
        
        function updateDeposits() {
            const reactionSpeed = (temperature + 20) / 60 * humidity;
            deposits.forEach(dep => {
                dep.age += reactionSpeed;
            });
            
            deposits = deposits.filter(dep => dep.age < dep.maxAge * 2);
        }
        
        function emitParticles(x, y, count = 10) {
            for (let i = 0; i < count; i++) {
                particles.push(new Particle(
                    x + (Math.random() - 0.5) * 30,
                    y + (Math.random() - 0.5) * 30,
                    currentPatina
                ));
            }
        }
        
        function animate() {
            time += 0.016;
            
            drawStone();
            drawDeposits();
            updateDeposits();
            
            particles = particles.filter(p => p.update());
            particles.forEach(p => p.draw());
            
            if (saltSpray > 0 && Math.random() < saltSpray * 0.01) {
                particles.push(new Particle(
                    Math.random() * W,
                    -10,
                    'salt'
                ));
            }
            
            requestAnimationFrame(animate);
        }
        
        canvas.onclick = e => {
            emitParticles(e.clientX, e.clientY, 15);
        };
        
        canvas.onmousemove = e => {
            if (e.buttons === 1) {
                emitParticles(e.clientX, e.clientY, 3);
            }
        };
        
        canvas.ontouchmove = e => {
            e.preventDefault();
            emitParticles(e.touches[0].clientX, e.touches[0].clientY, 3);
        };
        
        document.getElementById('humidity').oninput = e => {
            humidity = e.target.value / 100;
            document.getElementById('humid-val').textContent = e.target.value + '%';
        };
        
        document.getElementById('temperature').oninput = e => {
            temperature = parseInt(e.target.value);
            document.getElementById('temp-val').textContent = temperature + 'C';
        };
        
        document.getElementById('salt').oninput = e => {
            saltSpray = e.target.value / 100;
            document.getElementById('salt-val').textContent = e.target.value;
        };
        
        document.getElementById('rust-btn').onclick = () => { currentPatina = 'rust'; };
        document.getElementById('verdigris-btn').onclick = () => { currentPatina = 'verdigris'; };
        
        document.getElementById('clean-btn').onclick = () => {
            deposits = [];
            particles = [];
        };
        
        initStone();
        animate();
    </script>
</body>
</html>