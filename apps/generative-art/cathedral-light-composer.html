<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cathedral Light Composer</title>
    <meta name="description" content="Design stained glass windows and watch light rays refract through colored glass">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #1a1510; min-height: 100vh; font-family: 'Times New Roman', serif; color: #d4c4a0; overflow: hidden; }
        #canvas { position: fixed; top: 0; left: 0; }
        #controls {
            position: fixed; top: 20px; left: 20px; background: rgba(30,25,20,0.95);
            padding: 20px; border-radius: 10px; border: 1px solid rgba(200,180,140,0.3);
            z-index: 100;
        }
        h3 { margin-bottom: 15px; color: #e8d8b8; font-weight: normal; }
        .control-row { margin: 10px 0; }
        label { display: block; font-size: 12px; margin-bottom: 5px; opacity: 0.8; }
        input[type="range"] { width: 140px; }
        .value { float: right; color: #ffd080; font-size: 12px; }
        button {
            display: block; width: 100%; padding: 10px; margin: 6px 0;
            background: rgba(120,100,60,0.4); border: 1px solid rgba(200,180,140,0.4);
            color: #d4c4a0; cursor: pointer; border-radius: 6px; font-family: inherit;
        }
        .color-btn { display: inline-block; width: 28px; height: 28px; margin: 3px; border-radius: 4px; cursor: pointer; border: 2px solid transparent; box-shadow: inset 0 0 10px rgba(255,255,255,0.3); }
        .color-btn.active { border-color: #fff; }
        #time-display { position: fixed; top: 20px; right: 20px; background: rgba(30,25,20,0.95); padding: 15px 25px; border-radius: 10px; border: 1px solid rgba(200,180,140,0.3); z-index: 100; text-align: center; }
        #info { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); font-size: 12px; opacity: 0.5; z-index: 100; }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div id="controls">
        <h3>Cathedral Glass</h3>
        <div class="control-row">
            <label>Sun Position <span class="value" id="sun-val">12:00</span></label>
            <input type="range" id="sun" min="0" max="100" value="50">
        </div>
        <div class="control-row">
            <label>Light Intensity <span class="value" id="intensity-val">70%</span></label>
            <input type="range" id="intensity" min="20" max="100" value="70">
        </div>
        <div class="control-row">
            <label>Glass Color</label>
            <div>
                <span class="color-btn active" style="background:#c41e3a" data-color="#c41e3a"></span>
                <span class="color-btn" style="background:#1e90ff" data-color="#1e90ff"></span>
                <span class="color-btn" style="background:#ffd700" data-color="#ffd700"></span>
                <span class="color-btn" style="background:#228b22" data-color="#228b22"></span>
                <span class="color-btn" style="background:#9932cc" data-color="#9932cc"></span>
            </div>
        </div>
        <button id="clear-btn">Clear Window</button>
        <button id="rose-btn">Rose Window</button>
        <button id="gothic-btn">Gothic Pattern</button>
    </div>
    <div id="time-display">
        <div id="time-text" style="font-size:18px;color:#ffd080">Noon</div>
        <div style="font-size:11px;opacity:0.7">Light Angle</div>
    </div>
    <div id="info">Click to place glass tiles | Watch light rays pass through</div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let W, H;
        function resize() { W = canvas.width = innerWidth; H = canvas.height = innerHeight; }
        resize(); window.onresize = resize;
        
        let sunPosition = 0.5;
        let lightIntensity = 0.7;
        let currentColor = '#c41e3a';
        let tiles = [];
        let rays = [];
        
        class GlassTile {
            constructor(x, y, size, color) {
                this.x = x;
                this.y = y;
                this.size = size;
                this.color = color;
                this.shape = Math.floor(Math.random() * 3);
            }
            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                
                ctx.beginPath();
                if (this.shape === 0) {
                    ctx.arc(0, 0, this.size / 2, 0, Math.PI * 2);
                } else if (this.shape === 1) {
                    const s = this.size / 2;
                    ctx.moveTo(0, -s);
                    ctx.lineTo(s, 0);
                    ctx.lineTo(0, s);
                    ctx.lineTo(-s, 0);
                    ctx.closePath();
                } else {
                    ctx.rect(-this.size/2, -this.size/2, this.size, this.size);
                }
                
                const gradient = ctx.createRadialGradient(0, 0, 0, 0, 0, this.size);
                gradient.addColorStop(0, this.color);
                gradient.addColorStop(0.7, this.color);
                gradient.addColorStop(1, darkenColor(this.color, 0.5));
                ctx.fillStyle = gradient;
                ctx.fill();
                
                ctx.strokeStyle = '#2a2520';
                ctx.lineWidth = 3;
                ctx.stroke();
                
                ctx.beginPath();
                ctx.arc(-this.size * 0.2, -this.size * 0.2, this.size * 0.15, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(255,255,255,0.3)';
                ctx.fill();
                
                ctx.restore();
            }
        }
        
        function darkenColor(hex, factor) {
            const r = Math.floor(parseInt(hex.slice(1,3), 16) * factor);
            const g = Math.floor(parseInt(hex.slice(3,5), 16) * factor);
            const b = Math.floor(parseInt(hex.slice(5,7), 16) * factor);
            return "#" + r.toString(16).padStart(2,'0') + g.toString(16).padStart(2,'0') + b.toString(16).padStart(2,'0');
        }
        
        function hexToRgb(hex) {
            return {
                r: parseInt(hex.slice(1,3), 16),
                g: parseInt(hex.slice(3,5), 16),
                b: parseInt(hex.slice(5,7), 16)
            };
        }
        
        function drawWindow() {
            const cx = W / 2;
            const cy = H / 2;
            const windowW = Math.min(W * 0.6, 500);
            const windowH = Math.min(H * 0.8, 700);
            
            ctx.fillStyle = '#0a0805';
            ctx.fillRect(cx - windowW/2 - 30, cy - windowH/2 - 30, windowW + 60, windowH + 60);
            
            ctx.fillStyle = '#1a1510';
            ctx.fillRect(cx - windowW/2, cy - windowH/2, windowW, windowH);
            
            ctx.strokeStyle = '#3a3530';
            ctx.lineWidth = 20;
            ctx.strokeRect(cx - windowW/2, cy - windowH/2, windowW, windowH);
            
            ctx.beginPath();
            ctx.moveTo(cx - windowW/2, cy - windowH/4);
            ctx.lineTo(cx + windowW/2, cy - windowH/4);
            ctx.moveTo(cx - windowW/2, cy + windowH/4);
            ctx.lineTo(cx + windowW/2, cy + windowH/4);
            ctx.moveTo(cx, cy - windowH/2);
            ctx.lineTo(cx, cy + windowH/2);
            ctx.strokeStyle = '#2a2520';
            ctx.lineWidth = 8;
            ctx.stroke();
        }
        
        function drawLightRays() {
            const sunAngle = (sunPosition - 0.5) * Math.PI * 0.8;
            const sunX = W / 2 + Math.sin(sunAngle) * 500;
            const sunY = -100;
            
            tiles.forEach(tile => {
                const dx = tile.x - sunX;
                const dy = tile.y - sunY;
                const angle = Math.atan2(dy, dx);
                const length = 400 * lightIntensity;
                
                const c = hexToRgb(tile.color);
                
                for (let i = 0; i < 3; i++) {
                    const spread = (i - 1) * 0.1;
                    const endX = tile.x + Math.cos(angle + spread) * length;
                    const endY = tile.y + Math.sin(angle + spread) * length;
                    
                    const gradient = ctx.createLinearGradient(tile.x, tile.y, endX, endY);
                    gradient.addColorStop(0, "rgba(" + c.r + "," + c.g + "," + c.b + "," + (0.4 * lightIntensity) + ")");
                    gradient.addColorStop(0.3, "rgba(" + c.r + "," + c.g + "," + c.b + "," + (0.2 * lightIntensity) + ")");
                    gradient.addColorStop(1, "transparent");
                    
                    ctx.beginPath();
                    ctx.moveTo(tile.x, tile.y);
                    ctx.lineTo(endX, endY);
                    ctx.strokeStyle = gradient;
                    ctx.lineWidth = tile.size * 0.8;
                    ctx.lineCap = 'round';
                    ctx.stroke();
                }
            });
        }
        
        function drawFloorLight() {
            tiles.forEach(tile => {
                const floorY = H - 50;
                const spread = (tile.y / H) * 100 + 50;
                const c = hexToRgb(tile.color);
                
                ctx.beginPath();
                ctx.ellipse(tile.x + (sunPosition - 0.5) * 100, floorY, spread, 20, 0, 0, Math.PI * 2);
                ctx.fillStyle = "rgba(" + c.r + "," + c.g + "," + c.b + "," + (0.15 * lightIntensity) + ")";
                ctx.fill();
            });
        }
        
        function animate() {
            ctx.fillStyle = '#0a0805';
            ctx.fillRect(0, 0, W, H);
            
            const floorGrad = ctx.createLinearGradient(0, H - 150, 0, H);
            floorGrad.addColorStop(0, '#1a1510');
            floorGrad.addColorStop(1, '#252015');
            ctx.fillStyle = floorGrad;
            ctx.fillRect(0, H - 150, W, 150);
            
            drawWindow();
            drawLightRays();
            tiles.forEach(t => t.draw());
            drawFloorLight();
            
            requestAnimationFrame(animate);
        }
        
        canvas.onclick = e => {
            const cx = W / 2;
            const cy = H / 2;
            const windowW = Math.min(W * 0.6, 500);
            const windowH = Math.min(H * 0.8, 700);
            
            if (e.clientX > cx - windowW/2 && e.clientX < cx + windowW/2 &&
                e.clientY > cy - windowH/2 && e.clientY < cy + windowH/2) {
                tiles.push(new GlassTile(e.clientX, e.clientY, 40 + Math.random() * 30, currentColor));
            }
        };
        
        document.getElementById('sun').oninput = e => {
            sunPosition = e.target.value / 100;
            const hour = 6 + sunPosition * 12;
            const h = Math.floor(hour);
            const m = Math.floor((hour % 1) * 60);
            document.getElementById('sun-val').textContent = h + ':' + m.toString().padStart(2,'0');
            const times = ['Dawn', 'Morning', 'Noon', 'Afternoon', 'Dusk'];
            document.getElementById('time-text').textContent = times[Math.floor(sunPosition * 4.99)];
        };
        
        document.getElementById('intensity').oninput = e => {
            lightIntensity = e.target.value / 100;
            document.getElementById('intensity-val').textContent = e.target.value + '%';
        };
        
        document.querySelectorAll('.color-btn').forEach(btn => {
            btn.onclick = () => {
                document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentColor = btn.dataset.color;
            };
        });
        
        document.getElementById('clear-btn').onclick = () => tiles = [];
        
        document.getElementById('rose-btn').onclick = () => {
            tiles = [];
            const cx = W / 2;
            const cy = H / 2;
            const colors = ['#c41e3a', '#1e90ff', '#ffd700', '#228b22', '#9932cc'];
            
            for (let ring = 0; ring < 3; ring++) {
                const r = 80 + ring * 60;
                const count = 6 + ring * 4;
                for (let i = 0; i < count; i++) {
                    const angle = (i / count) * Math.PI * 2;
                    tiles.push(new GlassTile(
                        cx + Math.cos(angle) * r,
                        cy + Math.sin(angle) * r,
                        40 - ring * 5,
                        colors[(i + ring) % colors.length]
                    ));
                }
            }
            tiles.push(new GlassTile(cx, cy, 50, '#ffd700'));
        };
        
        document.getElementById('gothic-btn').onclick = () => {
            tiles = [];
            const cx = W / 2;
            const cy = H / 2;
            const colors = ['#c41e3a', '#1e90ff', '#ffd700'];
            
            for (let row = 0; row < 5; row++) {
                for (let col = 0; col < 4; col++) {
                    tiles.push(new GlassTile(
                        cx - 90 + col * 60,
                        cy - 150 + row * 75,
                        35,
                        colors[(row + col) % colors.length]
                    ));
                }
            }
        };
        
        animate();
    </script>
</body>
</html>