<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thought Lightning</title>
    <meta name="description" content="Place ideas on a canvas and watch them connect with branching fractal lightning when they resonate, illuminating hidden connections">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #0a0a18; min-height: 100vh; font-family: 'Georgia', serif; color: #9090c0; overflow: hidden; }
        #canvas { position: fixed; top: 0; left: 0; cursor: crosshair; }
        #controls {
            position: fixed; top: 20px; left: 20px; background: rgba(10,10,24,0.95);
            padding: 20px; border-radius: 10px; border: 1px solid rgba(120,100,180,0.3);
            z-index: 100;
        }
        h3 { margin-bottom: 15px; color: #b0a0d0; font-weight: normal; }
        input[type="text"] {
            width: 100%; padding: 8px; margin: 8px 0;
            background: rgba(60,50,80,0.4); border: 1px solid rgba(120,100,180,0.3);
            color: #c0b0e0; border-radius: 4px; font-family: inherit;
        }
        button {
            display: block; width: 100%; padding: 10px; margin: 6px 0;
            background: rgba(80,60,120,0.4); border: 1px solid rgba(120,100,180,0.4);
            color: #a090c0; cursor: pointer; border-radius: 6px; font-family: inherit;
        }
        #stats { position: fixed; top: 20px; right: 20px; font-size: 12px; color: #605080; z-index: 100; text-align: right; }
        #info { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); font-size: 12px; opacity: 0.5; z-index: 100; }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div id="controls">
        <h3>Thought Lightning</h3>
        <input type="text" id="idea-input" placeholder="Enter an idea...">
        <button id="add-btn">Add Idea</button>
        <button id="strike-btn">Trigger Lightning</button>
        <button id="clear-btn">Clear Mind</button>
    </div>
    <div id="stats">
        <div>Ideas: <span id="idea-count">0</span></div>
        <div>Connections: <span id="connection-count">0</span></div>
        <div>Energy: <span id="energy-state">Calm</span></div>
    </div>
    <div id="info">Click to place ideas | Watch lightning connect related thoughts</div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let W, H;
        function resize() { W = canvas.width = innerWidth; H = canvas.height = innerHeight; }
        resize(); window.onresize = resize;
        
        let time = 0;
        let pendingIdea = null;
        let connectionCount = 0;
        
        const ideas = [];
        const bolts = [];
        const sparks = [];
        
        const SAMPLE_IDEAS = [
            'creativity', 'innovation', 'future', 'memory', 'dream',
            'connection', 'pattern', 'growth', 'change', 'harmony',
            'chaos', 'order', 'flow', 'energy', 'light'
        ];
        
        class Idea {
            constructor(x, y, text) {
                this.x = x;
                this.y = y;
                this.text = text;
                this.charge = 0;
                this.pulsePhase = Math.random() * Math.PI * 2;
                this.hue = 260 + Math.random() * 40;
            }
            
            update() {
                this.pulsePhase += 0.03;
                if (this.charge > 0) {
                    this.charge *= 0.95;
                }
            }
            
            draw() {
                const pulse = Math.sin(this.pulsePhase) * 0.2 + 1;
                const radius = 20 + this.charge * 20;
                
                const glow = ctx.createRadialGradient(this.x, this.y, 0, this.x, this.y, radius * 2);
                glow.addColorStop(0, "hsla(" + this.hue + ", 60%, 50%, " + (0.3 + this.charge * 0.5) + ")");
                glow.addColorStop(1, "transparent");
                ctx.fillStyle = glow;
                ctx.fillRect(this.x - radius * 2, this.y - radius * 2, radius * 4, radius * 4);
                
                ctx.beginPath();
                ctx.arc(this.x, this.y, radius * pulse, 0, Math.PI * 2);
                ctx.fillStyle = "hsla(" + this.hue + ", 50%, 20%, 0.8)";
                ctx.fill();
                ctx.strokeStyle = "hsla(" + this.hue + ", 60%, 60%, " + (0.5 + this.charge * 0.5) + ")";
                ctx.lineWidth = 2;
                ctx.stroke();
                
                ctx.font = '12px Georgia';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillStyle = "hsla(" + this.hue + ", 40%, 80%, 0.9)";
                ctx.fillText(this.text, this.x, this.y);
            }
        }
        
        class LightningBolt {
            constructor(from, to) {
                this.from = from;
                this.to = to;
                this.segments = [];
                this.life = 1;
                this.hue = (from.hue + to.hue) / 2;
                this.generatePath();
            }
            
            generatePath() {
                this.segments = [];
                const dx = this.to.x - this.from.x;
                const dy = this.to.y - this.from.y;
                const dist = Math.hypot(dx, dy);
                const segmentCount = Math.floor(dist / 20);
                
                let x = this.from.x;
                let y = this.from.y;
                
                this.segments.push({ x, y });
                
                for (let i = 1; i < segmentCount; i++) {
                    const t = i / segmentCount;
                    x = this.from.x + dx * t + (Math.random() - 0.5) * 40;
                    y = this.from.y + dy * t + (Math.random() - 0.5) * 40;
                    this.segments.push({ x, y });
                    
                    if (Math.random() < 0.3) {
                        const branchLength = 20 + Math.random() * 30;
                        const branchAngle = Math.atan2(dy, dx) + (Math.random() - 0.5) * Math.PI;
                        this.segments.push({
                            x: x + Math.cos(branchAngle) * branchLength,
                            y: y + Math.sin(branchAngle) * branchLength,
                            isBranch: true
                        });
                        this.segments.push({ x, y, returnFromBranch: true });
                    }
                }
                
                this.segments.push({ x: this.to.x, y: this.to.y });
            }
            
            update() {
                this.life -= 0.03;
                
                if (this.life > 0.8 && Math.random() < 0.3) {
                    this.generatePath();
                }
                
                return this.life > 0;
            }
            
            draw() {
                ctx.beginPath();
                let inBranch = false;
                
                for (let i = 0; i < this.segments.length; i++) {
                    const seg = this.segments[i];
                    
                    if (seg.isBranch) {
                        ctx.stroke();
                        ctx.beginPath();
                        ctx.moveTo(this.segments[i-1].x, this.segments[i-1].y);
                        ctx.lineTo(seg.x, seg.y);
                        ctx.strokeStyle = "hsla(" + this.hue + ", 80%, 80%, " + (this.life * 0.5) + ")";
                        ctx.lineWidth = 1;
                        ctx.stroke();
                        ctx.beginPath();
                        ctx.moveTo(this.segments[i-1].x, this.segments[i-1].y);
                        inBranch = true;
                    } else if (seg.returnFromBranch) {
                        inBranch = false;
                    } else {
                        if (i === 0) {
                            ctx.moveTo(seg.x, seg.y);
                        } else {
                            ctx.lineTo(seg.x, seg.y);
                        }
                    }
                }
                
                ctx.strokeStyle = "hsla(" + this.hue + ", 80%, 90%, " + this.life + ")";
                ctx.lineWidth = 3 * this.life;
                ctx.stroke();
                
                ctx.strokeStyle = "hsla(" + this.hue + ", 60%, 100%, " + (this.life * 0.5) + ")";
                ctx.lineWidth = 6 * this.life;
                ctx.stroke();
                
                for (let i = 0; i < 3; i++) {
                    const seg = this.segments[Math.floor(Math.random() * this.segments.length)];
                    sparks.push({
                        x: seg.x,
                        y: seg.y,
                        vx: (Math.random() - 0.5) * 4,
                        vy: (Math.random() - 0.5) * 4,
                        life: 0.5,
                        hue: this.hue
                    });
                }
            }
        }
        
        function triggerLightning() {
            if (ideas.length < 2) return;
            
            const source = ideas[Math.floor(Math.random() * ideas.length)];
            source.charge = 1;
            
            const targets = ideas.filter(i => i !== source)
                .sort((a, b) => {
                    const distA = Math.hypot(a.x - source.x, a.y - source.y);
                    const distB = Math.hypot(b.x - source.x, b.y - source.y);
                    return distA - distB;
                })
                .slice(0, 2);
            
            targets.forEach(target => {
                target.charge = 0.8;
                bolts.push(new LightningBolt(source, target));
                connectionCount++;
            });
        }
        
        function drawBackground() {
            ctx.fillStyle = 'rgba(10, 10, 24, 0.2)';
            ctx.fillRect(0, 0, W, H);
        }
        
        function drawSparks() {
            for (let i = sparks.length - 1; i >= 0; i--) {
                const s = sparks[i];
                s.x += s.vx;
                s.y += s.vy;
                s.life -= 0.05;
                
                if (s.life <= 0) {
                    sparks.splice(i, 1);
                    continue;
                }
                
                ctx.beginPath();
                ctx.arc(s.x, s.y, 2 * s.life, 0, Math.PI * 2);
                ctx.fillStyle = "hsla(" + s.hue + ", 80%, 80%, " + s.life + ")";
                ctx.fill();
            }
        }
        
        function getEnergyState() {
            const activeCount = bolts.length;
            if (activeCount > 3) return 'Electrified';
            if (activeCount > 1) return 'Charged';
            if (activeCount > 0) return 'Sparking';
            return 'Calm';
        }
        
        function updateStats() {
            document.getElementById('idea-count').textContent = ideas.length;
            document.getElementById('connection-count').textContent = connectionCount;
            document.getElementById('energy-state').textContent = getEnergyState();
        }
        
        function animate() {
            time += 0.016;
            
            drawBackground();
            
            for (let i = bolts.length - 1; i >= 0; i--) {
                if (!bolts[i].update()) {
                    bolts.splice(i, 1);
                } else {
                    bolts[i].draw();
                }
            }
            
            drawSparks();
            
            ideas.forEach(idea => {
                idea.update();
                idea.draw();
            });
            
            updateStats();
            
            requestAnimationFrame(animate);
        }
        
        canvas.onclick = e => {
            if (e.clientX < 200 && e.clientY < 280) return;
            
            const text = pendingIdea || SAMPLE_IDEAS[Math.floor(Math.random() * SAMPLE_IDEAS.length)];
            ideas.push(new Idea(e.clientX, e.clientY, text));
            pendingIdea = null;
            document.getElementById('idea-input').value = '';
        };
        
        document.getElementById('idea-input').oninput = e => {
            pendingIdea = e.target.value.trim() || null;
        };
        
        document.getElementById('add-btn').onclick = () => {
            const text = pendingIdea || SAMPLE_IDEAS[Math.floor(Math.random() * SAMPLE_IDEAS.length)];
            ideas.push(new Idea(
                200 + Math.random() * (W - 300),
                100 + Math.random() * (H - 200),
                text
            ));
            pendingIdea = null;
            document.getElementById('idea-input').value = '';
        };
        
        document.getElementById('strike-btn').onclick = triggerLightning;
        
        document.getElementById('clear-btn').onclick = () => {
            ideas.length = 0;
            bolts.length = 0;
            sparks.length = 0;
            connectionCount = 0;
        };
        
        for (let i = 0; i < 4; i++) {
            ideas.push(new Idea(
                W/2 + (Math.random() - 0.5) * 300,
                H/2 + (Math.random() - 0.5) * 200,
                SAMPLE_IDEAS[Math.floor(Math.random() * SAMPLE_IDEAS.length)]
            ));
        }
        
        animate();
    </script>
</body>
</html>