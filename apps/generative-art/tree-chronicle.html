<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tree Chronicle</title>
    <meta name="description" content="Grow a tree through centuries, each ring recording drought, fire, and abundance - hover to read the story of each year">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #1a1510; min-height: 100vh; font-family: 'Georgia', serif; color: #a09080; overflow: hidden; }
        #canvas { position: fixed; top: 0; left: 0; cursor: crosshair; }
        #controls {
            position: fixed; top: 20px; left: 20px; background: rgba(25,20,15,0.95);
            padding: 20px; border-radius: 10px; border: 1px solid rgba(160,120,80,0.3);
            z-index: 100;
        }
        h3 { margin-bottom: 15px; color: #c0a080; font-weight: normal; }
        .control-row { margin: 10px 0; }
        label { display: block; font-size: 11px; margin-bottom: 5px; opacity: 0.8; }
        input[type="range"] { width: 140px; }
        .value { float: right; color: #d0b090; font-size: 12px; }
        button {
            display: block; width: 100%; padding: 10px; margin: 6px 0;
            background: rgba(100,80,50,0.4); border: 1px solid rgba(160,120,80,0.4);
            color: #a09070; cursor: pointer; border-radius: 6px; font-family: inherit;
        }
        #stats { position: fixed; top: 20px; right: 20px; font-size: 12px; color: #806050; z-index: 100; text-align: right; }
        #story-panel {
            position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%);
            background: rgba(25,20,15,0.95); padding: 15px 25px; border-radius: 10px;
            border: 1px solid rgba(160,120,80,0.3); z-index: 100;
            font-size: 13px; color: #c0a080; text-align: center;
            opacity: 0; transition: opacity 0.3s; max-width: 400px;
        }
        #info { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); font-size: 12px; opacity: 0.5; z-index: 100; }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div id="controls">
        <h3>Tree Chronicle</h3>
        <div class="control-row">
            <label>Growth Rate <span class="value" id="growth-val">50</span></label>
            <input type="range" id="growth" min="10" max="100" value="50">
        </div>
        <button id="year-btn">Add Year</button>
        <button id="auto-btn">Auto-Grow</button>
        <button id="reset-btn">Plant New Tree</button>
    </div>
    <div id="stats">
        <div>Age: <span id="tree-age">0</span> years</div>
        <div>Era: <span id="current-era">Sapling</span></div>
    </div>
    <div id="story-panel"></div>
    <div id="info">Click Add Year or hover over rings to read their stories</div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let W, H;
        function resize() { W = canvas.width = innerWidth; H = canvas.height = innerHeight; }
        resize(); window.onresize = resize;
        
        let growthRate = 0.5;
        let time = 0;
        let autoGrow = false;
        let autoTimer = 0;
        
        const rings = [];
        let baseYear = 1800 + Math.floor(Math.random() * 100);
        
        const EVENTS = [
            { type: 'normal', weight: 40, width: [3, 5], color: '#8B7355', story: year => 'Year ' + year + ': A balanced season of growth.' },
            { type: 'abundant', weight: 15, width: [5, 8], color: '#A08060', story: year => 'Year ' + year + ': Abundant rains blessed the forest.' },
            { type: 'drought', weight: 12, width: [1, 2], color: '#5C4033', story: year => 'Year ' + year + ': A harsh drought tested all living things.' },
            { type: 'fire', weight: 5, width: [2, 3], color: '#2C1810', story: year => 'Year ' + year + ': Fire swept through, leaving scars.' },
            { type: 'frost', weight: 8, width: [1, 3], color: '#6B5B4F', story: year => 'Year ' + year + ': Late frost damaged spring growth.' },
            { type: 'plague', weight: 5, width: [2, 3], color: '#4A3728', story: year => 'Year ' + year + ': Insects ravaged the canopy.' },
            { type: 'wet', weight: 10, width: [4, 6], color: '#7A6B5A', story: year => 'Year ' + year + ': Heavy monsoons swelled the rivers.' },
            { type: 'cold', weight: 5, width: [1, 2], color: '#5A4A3A', story: year => 'Year ' + year + ': The long winter lingered into spring.' }
        ];
        
        const ERAS = [
            { minAge: 0, name: 'Sapling' },
            { minAge: 20, name: 'Young Tree' },
            { minAge: 50, name: 'Mature' },
            { minAge: 100, name: 'Ancient' },
            { minAge: 200, name: 'Elder' },
            { minAge: 500, name: 'Primordial' }
        ];
        
        function getRandomEvent() {
            const totalWeight = EVENTS.reduce((sum, e) => sum + e.weight, 0);
            let random = Math.random() * totalWeight;
            
            for (const event of EVENTS) {
                random -= event.weight;
                if (random <= 0) return event;
            }
            return EVENTS[0];
        }
        
        function addYear() {
            const event = getRandomEvent();
            const width = event.width[0] + Math.random() * (event.width[1] - event.width[0]);
            const year = baseYear + rings.length;
            
            let innerRadius = 10;
            rings.forEach(r => innerRadius += r.width);
            
            rings.push({
                innerRadius: innerRadius,
                width: width,
                color: event.color,
                type: event.type,
                year: year,
                story: event.story(year),
                highlighted: false
            });
        }
        
        function getCurrentEra() {
            let era = ERAS[0];
            for (const e of ERAS) {
                if (rings.length >= e.minAge) era = e;
            }
            return era.name;
        }
        
        function drawBackground() {
            const gradient = ctx.createRadialGradient(W/2, H/2, 0, W/2, H/2, Math.max(W, H) * 0.7);
            gradient.addColorStop(0, '#2a2015');
            gradient.addColorStop(1, '#1a1510');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, W, H);
        }
        
        function drawTree() {
            const centerX = W / 2;
            const centerY = H / 2;
            
            ctx.beginPath();
            ctx.arc(centerX, centerY, 10, 0, Math.PI * 2);
            ctx.fillStyle = '#3a2a1a';
            ctx.fill();
            
            rings.forEach((ring, index) => {
                ctx.beginPath();
                ctx.arc(centerX, centerY, ring.innerRadius + ring.width / 2, 0, Math.PI * 2);
                
                let color = ring.color;
                if (ring.highlighted) {
                    const parts = color.match(/[0-9A-Fa-f]{2}/g);
                    if (parts) {
                        const r = Math.min(255, parseInt(parts[0], 16) + 40);
                        const g = Math.min(255, parseInt(parts[1], 16) + 40);
                        const b = Math.min(255, parseInt(parts[2], 16) + 30);
                        color = '#' + r.toString(16).padStart(2,'0') + g.toString(16).padStart(2,'0') + b.toString(16).padStart(2,'0');
                    }
                }
                
                ctx.strokeStyle = color;
                ctx.lineWidth = ring.width;
                ctx.stroke();
                
                if (ring.type === 'fire') {
                    const scarAngle = (index * 1.5) % (Math.PI * 2);
                    const scarX = centerX + Math.cos(scarAngle) * (ring.innerRadius + ring.width / 2);
                    const scarY = centerY + Math.sin(scarAngle) * (ring.innerRadius + ring.width / 2);
                    ctx.beginPath();
                    ctx.arc(scarX, scarY, ring.width, 0, Math.PI * 2);
                    ctx.fillStyle = '#1a0a00';
                    ctx.fill();
                }
            });
            
            if (rings.length > 0) {
                const outerRadius = rings[rings.length - 1].innerRadius + rings[rings.length - 1].width + 5;
                ctx.beginPath();
                ctx.arc(centerX, centerY, outerRadius, 0, Math.PI * 2);
                ctx.strokeStyle = '#5a4a35';
                ctx.lineWidth = 3;
                ctx.stroke();
            }
        }
        
        function getRingAtPosition(x, y) {
            const centerX = W / 2;
            const centerY = H / 2;
            const dist = Math.hypot(x - centerX, y - centerY);
            
            for (let i = rings.length - 1; i >= 0; i--) {
                const ring = rings[i];
                if (dist >= ring.innerRadius && dist <= ring.innerRadius + ring.width) {
                    return ring;
                }
            }
            return null;
        }
        
        function showStory(ring) {
            const panel = document.getElementById('story-panel');
            panel.innerHTML = '<div style="font-size:10px;opacity:0.6;margin-bottom:5px;">' + ring.type.toUpperCase() + '</div>' + ring.story;
            panel.style.opacity = 1;
        }
        
        function hideStory() {
            document.getElementById('story-panel').style.opacity = 0;
        }
        
        function updateStats() {
            document.getElementById('tree-age').textContent = rings.length;
            document.getElementById('current-era').textContent = getCurrentEra();
        }
        
        function animate() {
            time += 0.016;
            
            if (autoGrow) {
                autoTimer += 0.016;
                if (autoTimer > (1.5 - growthRate)) {
                    addYear();
                    autoTimer = 0;
                }
            }
            
            drawBackground();
            drawTree();
            updateStats();
            
            requestAnimationFrame(animate);
        }
        
        canvas.onmousemove = e => {
            rings.forEach(r => r.highlighted = false);
            
            const ring = getRingAtPosition(e.clientX, e.clientY);
            if (ring) {
                ring.highlighted = true;
                showStory(ring);
            } else {
                hideStory();
            }
        };
        
        canvas.onmouseleave = () => {
            rings.forEach(r => r.highlighted = false);
            hideStory();
        };
        
        document.getElementById('growth').oninput = e => {
            growthRate = e.target.value / 100;
            document.getElementById('growth-val').textContent = e.target.value;
        };
        
        document.getElementById('year-btn').onclick = () => {
            addYear();
        };
        
        document.getElementById('auto-btn').onclick = () => {
            autoGrow = !autoGrow;
            document.getElementById('auto-btn').textContent = autoGrow ? 'Stop Growing' : 'Auto-Grow';
        };
        
        document.getElementById('reset-btn').onclick = () => {
            rings.length = 0;
            baseYear = 1800 + Math.floor(Math.random() * 100);
            autoGrow = false;
            document.getElementById('auto-btn').textContent = 'Auto-Grow';
        };
        
        for (let i = 0; i < 10; i++) {
            addYear();
        }
        
        animate();
    </script>
</body>
</html>