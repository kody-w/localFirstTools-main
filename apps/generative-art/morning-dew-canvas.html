<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Morning Dew Canvas</title>
    <meta name="description" content="Paint invisible spider webs in the dark, then watch dewdrops reveal your creation at sunrise">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #000; overflow: hidden; font-family: monospace; }
        #canvas { position: fixed; top: 0; left: 0; cursor: crosshair; }
        #controls {
            position: fixed; top: 20px; left: 20px; background: rgba(20,30,40,0.9);
            padding: 20px; border-radius: 10px; border: 1px solid rgba(100,150,200,0.3);
            color: #8ab; z-index: 100;
        }
        h3 { margin-bottom: 15px; color: #ace; }
        button {
            display: block; width: 100%; padding: 10px; margin: 8px 0;
            background: rgba(50,80,120,0.4); border: 1px solid rgba(100,150,200,0.4);
            color: #8ab; cursor: pointer; border-radius: 8px;
        }
        #time-display {
            position: fixed; top: 20px; right: 20px; background: rgba(20,30,40,0.9);
            padding: 20px; border-radius: 10px; border: 1px solid rgba(100,150,200,0.3);
            color: #8ab; text-align: center;
        }
        #time { font-size: 28px; color: #ace; }
        #phase { font-size: 12px; opacity: 0.7; margin-top: 5px; }
        #info { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); color: rgba(100,150,200,0.5); font-size: 12px; }
        input[type="range"] { width: 100%; margin: 10px 0; }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div id="controls">
        <h3>Web Weaver</h3>
        <button id="draw-btn">Draw Web (Night)</button>
        <button id="sunrise-btn">Begin Sunrise</button>
        <button id="clear-btn">Clear Canvas</button>
        <label style="font-size:11px;display:block;margin-top:15px">Dew Intensity</label>
        <input type="range" id="dew-slider" min="1" max="100" value="50">
    </div>
    <div id="time-display">
        <div id="time">3:00 AM</div>
        <div id="phase">Night - Draw your web</div>
    </div>
    <div id="info">Click and drag to spin silk strands | Watch them appear with morning dew</div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let W, H;
        function resize() { W = canvas.width = innerWidth; H = canvas.height = innerHeight; redraw(); }
        resize(); window.onresize = resize;

        let strands = [];
        let dewDrops = [];
        let timeOfDay = 0;
        let sunrising = false;
        let dewIntensity = 50;
        let drawing = false;
        let lastPoint = null;

        class Strand {
            constructor(x1, y1, x2, y2) {
                this.x1 = x1; this.y1 = y1;
                this.x2 = x2; this.y2 = y2;
                this.tension = 1;
                this.dewPoints = [];
                this.generateDewPoints();
            }
            generateDewPoints() {
                const length = Math.hypot(this.x2 - this.x1, this.y2 - this.y1);
                const count = Math.floor(length / 15) + 1;
                for (let i = 0; i <= count; i++) {
                    const t = i / count;
                    this.dewPoints.push({
                        t: t,
                        size: 0,
                        maxSize: 2 + Math.random() * 4,
                        offset: Math.random() * 0.1 - 0.05,
                        revealed: false
                    });
                }
            }
            getPoint(t) {
                const sag = Math.sin(t * Math.PI) * 5 * (1 - this.tension);
                return {
                    x: this.x1 + (this.x2 - this.x1) * t,
                    y: this.y1 + (this.y2 - this.y1) * t + sag
                };
            }
            update(time) {
                this.dewPoints.forEach(dp => {
                    if (time > 0.3 && !dp.revealed) {
                        dp.revealed = true;
                    }
                    if (dp.revealed && dp.size < dp.maxSize) {
                        dp.size += 0.05 * (dewIntensity / 50);
                    }
                    if (dp.size > dp.maxSize * 0.8) {
                        this.tension = Math.max(0.7, this.tension - 0.0001 * dp.size);
                    }
                });
            }
            draw(visibility) {
                const alpha = 0.1 + visibility * 0.3;
                ctx.beginPath();
                ctx.moveTo(this.x1, this.y1);
                for (let t = 0; t <= 1; t += 0.05) {
                    const p = this.getPoint(t);
                    ctx.lineTo(p.x, p.y);
                }
                ctx.strokeStyle = "rgba(200, 220, 255, " + alpha + ")";
                ctx.lineWidth = 1;
                ctx.stroke();
                this.dewPoints.forEach(dp => {
                    if (dp.size > 0) {
                        const p = this.getPoint(dp.t + dp.offset);
                        const gradient = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, dp.size);
                        gradient.addColorStop(0, "rgba(255, 255, 255, 0.9)");
                        gradient.addColorStop(0.5, "rgba(200, 230, 255, 0.6)");
                        gradient.addColorStop(1, "rgba(150, 200, 255, 0)");
                        ctx.beginPath();
                        ctx.arc(p.x, p.y + dp.size * 0.3, dp.size, 0, Math.PI * 2);
                        ctx.fillStyle = gradient;
                        ctx.fill();
                        if (visibility > 0.5) {
                            ctx.beginPath();
                            ctx.arc(p.x - dp.size * 0.3, p.y, dp.size * 0.2, 0, Math.PI * 2);
                            ctx.fillStyle = "rgba(255, 255, 255, 0.8)";
                            ctx.fill();
                        }
                    }
                });
            }
        }

        function getSkyColor(time) {
            if (time < 0.2) return { r: 5, g: 10, b: 20 };
            if (time < 0.4) return { r: 30 + time * 100, g: 40 + time * 80, b: 60 + time * 50 };
            if (time < 0.6) return { r: 100 + time * 100, g: 120 + time * 80, b: 150 };
            return { r: 200, g: 180, b: 160 };
        }

        function redraw() {
            const sky = getSkyColor(timeOfDay);
            ctx.fillStyle = "rgb(" + sky.r + "," + sky.g + "," + sky.b + ")";
            ctx.fillRect(0, 0, W, H);
            if (timeOfDay > 0.4) {
                const sunY = H - (timeOfDay - 0.4) * H * 2;
                const gradient = ctx.createRadialGradient(W * 0.8, sunY, 0, W * 0.8, sunY, 200);
                gradient.addColorStop(0, "rgba(255, 200, 100, 0.8)");
                gradient.addColorStop(0.5, "rgba(255, 150, 50, 0.3)");
                gradient.addColorStop(1, "transparent");
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, W, H);
            }
            const visibility = Math.max(0, (timeOfDay - 0.2) / 0.5);
            strands.forEach(s => {
                s.update(timeOfDay);
                s.draw(visibility);
            });
        }

        function updateTime() {
            const hours = 3 + timeOfDay * 5;
            const h = Math.floor(hours);
            const m = Math.floor((hours - h) * 60);
            document.getElementById('time').textContent = h + ':' + (m < 10 ? '0' : '') + m + ' AM';
            if (timeOfDay < 0.2) document.getElementById('phase').textContent = 'Night - Draw your web';
            else if (timeOfDay < 0.4) document.getElementById('phase').textContent = 'Pre-dawn - Dew forming';
            else if (timeOfDay < 0.6) document.getElementById('phase').textContent = 'Sunrise - Revelation';
            else document.getElementById('phase').textContent = 'Morning - Web revealed';
        }

        function animate() {
            if (sunrising && timeOfDay < 1) {
                timeOfDay += 0.002;
                updateTime();
            }
            redraw();
            requestAnimationFrame(animate);
        }

        canvas.onmousedown = e => {
            drawing = true;
            lastPoint = { x: e.clientX, y: e.clientY };
        };
        canvas.onmouseup = () => { drawing = false; lastPoint = null; };
        canvas.onmousemove = e => {
            if (drawing && lastPoint) {
                const dist = Math.hypot(e.clientX - lastPoint.x, e.clientY - lastPoint.y);
                if (dist > 20) {
                    strands.push(new Strand(lastPoint.x, lastPoint.y, e.clientX, e.clientY));
                    lastPoint = { x: e.clientX, y: e.clientY };
                }
            }
        };

        document.getElementById('sunrise-btn').onclick = () => { sunrising = true; };
        document.getElementById('clear-btn').onclick = () => { strands = []; timeOfDay = 0; sunrising = false; updateTime(); };
        document.getElementById('dew-slider').oninput = e => dewIntensity = parseInt(e.target.value);

        updateTime();
        animate();
    </script>
</body>
</html>