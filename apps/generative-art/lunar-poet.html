<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lunar Poet</title>
    <meta name="description" content="Typography responds to lunar gravity and tidal forces, words ebbing and flowing across the canvas with celestial rhythm">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #0a0e1a; min-height: 100vh; font-family: 'Georgia', serif; color: #8090b0; overflow: hidden; }
        #canvas { position: fixed; top: 0; left: 0; }
        #controls {
            position: fixed; top: 20px; left: 20px; background: rgba(10,15,30,0.95);
            padding: 20px; border-radius: 10px; border: 1px solid rgba(100,140,200,0.3);
            z-index: 100; max-width: 200px;
        }
        h3 { margin-bottom: 15px; color: #a0c0e0; font-weight: normal; }
        .control-row { margin: 10px 0; }
        label { display: block; font-size: 11px; margin-bottom: 5px; opacity: 0.8; }
        input[type="range"] { width: 140px; }
        .value { float: right; color: #c0d0f0; font-size: 12px; }
        textarea {
            width: 100%; height: 60px; background: rgba(20,30,50,0.8);
            border: 1px solid rgba(100,140,200,0.3); color: #a0c0e0;
            padding: 8px; border-radius: 6px; resize: none; font-family: inherit;
        }
        button {
            display: block; width: 100%; padding: 10px; margin: 6px 0;
            background: rgba(60,80,140,0.4); border: 1px solid rgba(100,140,200,0.4);
            color: #90a0c0; cursor: pointer; border-radius: 6px; font-family: inherit;
        }
        #phase-display { position: fixed; top: 20px; right: 20px; font-size: 12px; color: #607090; z-index: 100; text-align: right; }
        #info { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); font-size: 12px; opacity: 0.5; z-index: 100; }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div id="controls">
        <h3>Lunar Poet</h3>
        <div class="control-row">
            <label>Your Words</label>
            <textarea id="text-input" placeholder="Enter poetry or thoughts...">the moon pulls at these words like tides upon the shore</textarea>
        </div>
        <div class="control-row">
            <label>Gravity Strength <span class="value" id="gravity-val">50</span></label>
            <input type="range" id="gravity" min="10" max="100" value="50">
        </div>
        <div class="control-row">
            <label>Orbital Speed <span class="value" id="speed-val">30</span></label>
            <input type="range" id="speed" min="10" max="100" value="30">
        </div>
        <button id="release-btn">Release Words</button>
        <button id="reset-btn">Reset Positions</button>
    </div>
    <div id="phase-display">
        <div id="moon-phase">New Moon</div>
        <div id="tide-state">Low Tide</div>
    </div>
    <div id="info">Words drift with lunar gravity | Watch typography ebb and flow</div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let W, H;
        function resize() { W = canvas.width = innerWidth; H = canvas.height = innerHeight; }
        resize(); window.onresize = resize;
        
        let gravityStrength = 0.5;
        let orbitalSpeed = 0.3;
        let time = 0;
        
        const characters = [];
        const trails = [];
        
        class MoonCharacter {
            constructor(char, index, total) {
                this.char = char;
                this.baseX = 100 + (index % 20) * 35;
                this.baseY = 200 + Math.floor(index / 20) * 50;
                this.x = this.baseX;
                this.y = this.baseY;
                this.vx = 0;
                this.vy = 0;
                this.mass = 1 + char.length * 0.5;
                this.size = 20 + Math.random() * 8;
                this.hue = 200 + Math.random() * 40;
                this.trail = [];
            }
            
            update(moonX, moonY, moonMass) {
                const dx = moonX - this.x;
                const dy = moonY - this.y;
                const dist = Math.max(50, Math.hypot(dx, dy));
                
                const force = (moonMass * gravityStrength * 500) / (dist * dist);
                
                this.vx += (dx / dist) * force * 0.001;
                this.vy += (dy / dist) * force * 0.001;
                
                const returnForce = 0.001;
                this.vx += (this.baseX - this.x) * returnForce;
                this.vy += (this.baseY - this.y) * returnForce;
                
                this.vx *= 0.98;
                this.vy *= 0.98;
                
                this.x += this.vx;
                this.y += this.vy;
                
                this.trail.push({ x: this.x, y: this.y, alpha: 0.5 });
                if (this.trail.length > 15) this.trail.shift();
            }
            
            draw(tideLevel) {
                const distortion = Math.sin(time * 2 + this.x * 0.01) * tideLevel * 5;
                
                if (this.trail.length > 1) {
                    ctx.beginPath();
                    ctx.moveTo(this.trail[0].x, this.trail[0].y);
                    for (let i = 1; i < this.trail.length; i++) {
                        ctx.lineTo(this.trail[i].x, this.trail[i].y);
                    }
                    ctx.strokeStyle = "hsla(" + this.hue + ", 50%, 50%, 0.1)";
                    ctx.lineWidth = 1;
                    ctx.stroke();
                }
                
                const stretch = 1 + Math.abs(this.vx) * 0.1;
                const squash = 1 / stretch;
                
                ctx.save();
                ctx.translate(this.x, this.y + distortion);
                ctx.scale(stretch, squash);
                
                const brightness = 50 + tideLevel * 20;
                ctx.fillStyle = "hsl(" + this.hue + ", 60%, " + brightness + "%)";
                ctx.font = this.size + "px Georgia";
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";
                ctx.fillText(this.char, 0, 0);
                
                ctx.restore();
            }
        }
        
        function parseText(text) {
            characters.length = 0;
            const chars = text.split('');
            chars.forEach((char, i) => {
                if (char !== ' ') {
                    characters.push(new MoonCharacter(char, i, chars.length));
                }
            });
        }
        
        function getMoonPosition() {
            const angle = time * orbitalSpeed * 0.1;
            const orbitRadius = Math.min(W, H) * 0.35;
            const centerX = W / 2;
            const centerY = H / 2;
            
            return {
                x: centerX + Math.cos(angle) * orbitRadius,
                y: centerY + Math.sin(angle) * orbitRadius * 0.3,
                phase: (Math.sin(angle) + 1) / 2,
                mass: 1 + Math.sin(angle * 2) * 0.5
            };
        }
        
        function drawMoon(moon) {
            const gradient = ctx.createRadialGradient(moon.x, moon.y, 0, moon.x, moon.y, 40);
            gradient.addColorStop(0, "rgba(240, 240, 255, 0.9)");
            gradient.addColorStop(0.5, "rgba(200, 210, 230, 0.5)");
            gradient.addColorStop(1, "transparent");
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(moon.x, moon.y, 40, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.beginPath();
            ctx.arc(moon.x, moon.y, 25, 0, Math.PI * 2);
            ctx.fillStyle = "rgba(230, 235, 250, 0.95)";
            ctx.fill();
            
            const shadowOffset = (moon.phase - 0.5) * 30;
            ctx.beginPath();
            ctx.arc(moon.x + shadowOffset, moon.y, 24, 0, Math.PI * 2);
            ctx.fillStyle = "rgba(20, 30, 50, 0.3)";
            ctx.fill();
        }
        
        function drawBackground() {
            const gradient = ctx.createRadialGradient(W/2, H/2, 0, W/2, H/2, Math.max(W, H));
            gradient.addColorStop(0, '#0f1525');
            gradient.addColorStop(1, '#050810');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, W, H);
            
            for (let i = 0; i < 80; i++) {
                const x = (i * 137) % W;
                const y = (i * 89) % H;
                const twinkle = Math.sin(time * 0.5 + i) * 0.5 + 0.5;
                ctx.beginPath();
                ctx.arc(x, y, 0.5 + twinkle * 0.3, 0, Math.PI * 2);
                ctx.fillStyle = "rgba(180, 200, 255, " + (0.2 + twinkle * 0.3) + ")";
                ctx.fill();
            }
        }
        
        function drawTidalWaves(tideLevel) {
            const waveY = H - 50 - tideLevel * 100;
            
            ctx.beginPath();
            ctx.moveTo(0, waveY);
            
            for (let x = 0; x <= W; x += 20) {
                const wave = Math.sin(x * 0.02 + time * 2) * 10 * tideLevel;
                const wave2 = Math.sin(x * 0.01 - time * 1.5) * 5 * tideLevel;
                ctx.lineTo(x, waveY + wave + wave2);
            }
            
            ctx.lineTo(W, H);
            ctx.lineTo(0, H);
            ctx.closePath();
            
            const gradient = ctx.createLinearGradient(0, waveY, 0, H);
            gradient.addColorStop(0, "rgba(30, 60, 100, 0.3)");
            gradient.addColorStop(1, "rgba(10, 30, 60, 0.5)");
            ctx.fillStyle = gradient;
            ctx.fill();
        }
        
        function updatePhaseDisplay(moon) {
            const phases = ['New Moon', 'Waxing Crescent', 'First Quarter', 'Waxing Gibbous', 
                           'Full Moon', 'Waning Gibbous', 'Last Quarter', 'Waning Crescent'];
            const phaseIndex = Math.floor(moon.phase * 8) % 8;
            document.getElementById('moon-phase').textContent = phases[phaseIndex];
            
            const tideState = moon.mass > 1 ? 'High Tide' : 'Low Tide';
            document.getElementById('tide-state').textContent = tideState;
        }
        
        function animate() {
            time += 0.016;
            
            drawBackground();
            
            const moon = getMoonPosition();
            const tideLevel = (moon.mass + 0.5) / 1.5;
            
            drawTidalWaves(tideLevel);
            drawMoon(moon);
            
            characters.forEach(char => {
                char.update(moon.x, moon.y, moon.mass);
                char.draw(tideLevel);
            });
            
            updatePhaseDisplay(moon);
            
            requestAnimationFrame(animate);
        }
        
        document.getElementById('text-input').oninput = e => {
            parseText(e.target.value);
        };
        
        document.getElementById('gravity').oninput = e => {
            gravityStrength = e.target.value / 100;
            document.getElementById('gravity-val').textContent = e.target.value;
        };
        
        document.getElementById('speed').oninput = e => {
            orbitalSpeed = e.target.value / 100;
            document.getElementById('speed-val').textContent = e.target.value;
        };
        
        document.getElementById('release-btn').onclick = () => {
            characters.forEach(char => {
                char.vx += (Math.random() - 0.5) * 5;
                char.vy += (Math.random() - 0.5) * 5;
            });
        };
        
        document.getElementById('reset-btn').onclick = () => {
            characters.forEach(char => {
                char.x = char.baseX;
                char.y = char.baseY;
                char.vx = 0;
                char.vy = 0;
                char.trail = [];
            });
        };
        
        parseText(document.getElementById('text-input').value);
        animate();
    </script>
</body>
</html>