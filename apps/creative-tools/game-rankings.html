<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Live leaderboard ranking 500+ HTML apps by quality, playability, and player ratings">
<title>App Rankings - Live Leaderboard</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0a0a0f;--surface:#12121a;--surface2:#1a1a2e;--border:#2a2a3e;--text:#e0e0e8;--text-dim:#8888a0;--accent:#7c6df0;--play:#ff9f43;--s:#ffd700;--a:#ff6b6b;--b:#4ecdc4;--c:#45b7d1;--d:#96858f;--f:#555}
body{background:var(--bg);color:var(--text);font-family:'SF Mono','Fira Code','Consolas',monospace;min-height:100vh}
.header{background:linear-gradient(135deg,#0f0c29,#302b63,#24243e);padding:24px 32px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:16px}
.header h1{font-size:1.4em;background:linear-gradient(90deg,#7c6df0,#4ecdc4);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.header .meta{color:var(--text-dim);font-size:.8em}
.tabs{display:flex;gap:0;padding:0 32px;background:var(--surface);border-bottom:1px solid var(--border)}
.tab{padding:12px 20px;font-size:.8em;color:var(--text-dim);cursor:pointer;border-bottom:2px solid transparent;font-family:inherit;background:none;border-top:none;border-left:none;border-right:none;transition:all .2s}
.tab:hover{color:var(--text)}
.tab.active{color:var(--accent);border-bottom-color:var(--accent)}
.tab-panel{display:none}.tab-panel.active{display:block}
.stats-bar{display:flex;gap:12px;padding:16px 32px;background:var(--surface);border-bottom:1px solid var(--border);overflow-x:auto}
.stat-card{background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:12px 20px;min-width:100px;text-align:center}
.stat-card .value{font-size:1.5em;font-weight:bold;color:var(--accent)}
.stat-card .value.play-color{color:var(--play)}
.stat-card .label{font-size:.65em;color:var(--text-dim);margin-top:4px}
.controls{display:flex;gap:12px;padding:16px 32px;flex-wrap:wrap;align-items:center}
.search-box{background:var(--surface2);border:1px solid var(--border);color:var(--text);padding:8px 16px;border-radius:6px;font-family:inherit;font-size:.85em;width:240px}
.search-box:focus{outline:none;border-color:var(--accent)}
.grade-pills{display:flex;gap:6px}
.grade-pill{width:30px;height:26px;display:flex;align-items:center;justify-content:center;border-radius:4px;font-size:.75em;font-weight:bold;cursor:pointer;border:1px solid transparent;transition:all .2s}
.grade-pill[data-grade="S"]{background:rgba(255,215,0,.15);color:var(--s)}
.grade-pill[data-grade="A"]{background:rgba(255,107,107,.15);color:var(--a)}
.grade-pill[data-grade="B"]{background:rgba(78,205,196,.15);color:var(--b)}
.grade-pill[data-grade="C"]{background:rgba(69,183,209,.15);color:var(--c)}
.grade-pill[data-grade="D"]{background:rgba(150,133,143,.15);color:var(--d)}
.grade-pill[data-grade="F"]{background:rgba(85,85,85,.15);color:var(--f)}
.grade-pill.active{border-color:currentColor;transform:scale(1.1)}
.grade-pill .count{font-size:.6em;opacity:.7;margin-left:2px}
.charts-row{display:grid;grid-template-columns:1fr 1fr;gap:16px;padding:16px 32px}
.chart-card{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:16px}
.chart-card h3{font-size:.8em;color:var(--text-dim);margin-bottom:12px}
.histogram{display:flex;align-items:flex-end;gap:3px;height:80px}
.hist-bar{flex:1;border-radius:2px 2px 0 0;min-width:8px;position:relative;transition:height .5s ease;cursor:pointer}
.hist-bar:hover{opacity:.8}
.hist-bar .tip{display:none;position:absolute;bottom:100%;left:50%;transform:translateX(-50%);background:#000;color:#fff;padding:2px 6px;border-radius:3px;font-size:.65em;white-space:nowrap;z-index:10}
.hist-bar:hover .tip{display:block}
.hist-labels{display:flex;gap:3px;margin-top:4px}
.hist-labels span{flex:1;text-align:center;font-size:.55em;color:var(--text-dim)}
.cat-row{display:flex;align-items:center;gap:8px;margin-bottom:6px}
.cat-label{font-size:.7em;color:var(--text-dim);width:100px;text-align:right;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.cat-bar-bg{flex:1;background:var(--surface2);height:16px;border-radius:3px;overflow:hidden}
.cat-bar-fill{height:100%;border-radius:3px;transition:width .5s ease;display:flex;align-items:center;padding-left:6px;font-size:.6em;font-weight:bold}
.table-container{padding:0 32px 32px}
.rank-table{width:100%;border-collapse:collapse}
.rank-table th{text-align:left;padding:10px 8px;font-size:.65em;color:var(--text-dim);text-transform:uppercase;letter-spacing:1px;border-bottom:2px solid var(--border);cursor:pointer;user-select:none;white-space:nowrap}
.rank-table th:hover{color:var(--accent)}
.rank-table th.sorted::after{content:' \u25BC';font-size:.8em}
.rank-table th.sorted.asc::after{content:' \u25B2'}
.rank-table td{padding:7px 8px;font-size:.78em;border-bottom:1px solid var(--border)}
.rank-table tr{transition:background .15s}
.rank-table tr:hover{background:var(--surface2)}
.rank-num{font-weight:bold;color:var(--text-dim);width:36px}
.rank-num.top3{color:var(--s);font-size:1.1em}
.grade-badge{display:inline-flex;align-items:center;justify-content:center;width:26px;height:20px;border-radius:4px;font-size:.7em;font-weight:bold}
.grade-badge.S{background:rgba(255,215,0,.2);color:var(--s)}
.grade-badge.A{background:rgba(255,107,107,.2);color:var(--a)}
.grade-badge.B{background:rgba(78,205,196,.2);color:var(--b)}
.grade-badge.C{background:rgba(69,183,209,.2);color:var(--c)}
.grade-badge.D{background:rgba(150,133,143,.2);color:var(--d)}
.grade-badge.F{background:rgba(85,85,85,.2);color:var(--f)}
.score-bar{display:flex;align-items:center;gap:6px}
.score-bar-bg{width:80px;height:5px;background:var(--surface2);border-radius:3px;overflow:hidden}
.score-bar-fill{height:100%;border-radius:3px;transition:width .3s}
.play-bar{display:flex;align-items:center;gap:4px;font-size:.75em}
.play-bar-bg{width:50px;height:5px;background:var(--surface2);border-radius:3px;overflow:hidden}
.play-bar-fill{height:100%;background:var(--play);border-radius:3px}
.dim-dots{display:flex;gap:2px}
.dim-dot{width:7px;height:7px;border-radius:50%;opacity:.25}
.dim-dot.lit{opacity:1}
.dim-dot[data-dim="structural"]{background:#4ecdc4}
.dim-dot[data-dim="scale"]{background:#ffd700}
.dim-dot[data-dim="systems"]{background:#ff6b6b}
.dim-dot[data-dim="completeness"]{background:#45b7d1}
.dim-dot[data-dim="playability"]{background:#ff9f43}
.dim-dot[data-dim="polish"]{background:#7c6df0}
.stars{display:inline-flex;gap:1px;cursor:pointer}
.star{color:#333;font-size:.9em;transition:color .15s}
.star.filled{color:var(--s)}
.star:hover,.star.hover{color:var(--s);opacity:.7}
.app-link{color:var(--text);text-decoration:none}
.app-link:hover{color:var(--accent);text-decoration:underline}
.cat-tag{font-size:.6em;padding:2px 5px;background:var(--surface2);border-radius:3px;color:var(--text-dim)}
.loading{display:flex;align-items:center;justify-content:center;height:60vh;font-size:1.2em;color:var(--text-dim)}
.loading .spinner{width:24px;height:24px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .8s linear infinite;margin-right:12px}
@keyframes spin{to{transform:rotate(360deg)}}
.playable-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px;padding:16px 32px}
.playable-card{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:16px;transition:border-color .2s}
.playable-card:hover{border-color:var(--play)}
.playable-card .card-rank{font-size:2em;font-weight:bold;color:var(--play);float:right;opacity:.3}
.playable-card h4{font-size:.9em;margin-bottom:4px}
.playable-card h4 a{color:var(--text);text-decoration:none}
.playable-card h4 a:hover{color:var(--play)}
.playable-card .card-score{font-size:.7em;color:var(--text-dim);margin-bottom:8px}
.playable-card .card-details{display:flex;flex-wrap:wrap;gap:4px}
.playable-card .detail-tag{font-size:.6em;padding:2px 5px;background:rgba(255,159,67,.1);color:var(--play);border-radius:3px}
.export-btn{background:var(--surface2);border:1px solid var(--border);color:var(--text-dim);padding:6px 12px;border-radius:6px;cursor:pointer;font-family:inherit;font-size:.7em}
.export-btn:hover{border-color:var(--accent);color:var(--text)}
.dim-legend{display:flex;gap:8px;font-size:.6em;color:var(--text-dim);padding:0 32px 8px;flex-wrap:wrap}
.dim-legend span::before{content:'';display:inline-block;width:7px;height:7px;border-radius:50%;margin-right:3px;vertical-align:middle}
.dim-legend .str::before{background:#4ecdc4}.dim-legend .scl::before{background:#ffd700}
.dim-legend .sys::before{background:#ff6b6b}.dim-legend .cmp::before{background:#45b7d1}
.dim-legend .pla::before{background:#ff9f43}.dim-legend .pol::before{background:#7c6df0}
.refresh-btn{background:var(--accent);color:#fff;border:none;padding:6px 14px;border-radius:6px;cursor:pointer;font-family:inherit;font-size:.75em}
.refresh-btn:hover{opacity:.85}
@media(max-width:768px){.charts-row{grid-template-columns:1fr}.header,.stats-bar,.controls,.table-container,.playable-grid{padding-left:12px;padding-right:12px}.search-box{width:100%}.rank-table td,.rank-table th{padding:5px 4px;font-size:.65em}.playable-grid{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="header">
  <div>
    <h1>App Rankings</h1>
    <div class="meta" id="meta">Loading...</div>
  </div>
  <div style="display:flex;gap:8px;align-items:center">
    <button class="export-btn" onclick="exportRatings()" title="Export your star ratings as JSON">Export Ratings</button>
    <button class="refresh-btn" onclick="loadRankings()">Refresh</button>
    <label style="font-size:.7em;color:var(--text-dim)"><input type="checkbox" id="autoRefresh"> Auto</label>
  </div>
</div>

<div class="tabs">
  <button class="tab active" data-tab="all" onclick="switchTab('all')">All Rankings</button>
  <button class="tab" data-tab="playable" onclick="switchTab('playable')">Most Playable</button>
  <button class="tab" data-tab="rated" onclick="switchTab('rated')">My Ratings</button>
</div>

<div id="panel-all" class="tab-panel active">
  <div class="stats-bar" id="statsBar"></div>
  <div class="charts-row">
    <div class="chart-card">
      <h3>Score Distribution</h3>
      <div class="histogram" id="histogram"></div>
      <div class="hist-labels" id="histLabels"></div>
    </div>
    <div class="chart-card">
      <h3>Category Averages</h3>
      <div id="categoryBars"></div>
    </div>
  </div>
  <div class="controls">
    <input type="text" class="search-box" id="search" placeholder="Search apps... (/ to focus)" aria-label="Search apps">
    <div class="grade-pills" id="gradePills"></div>
    <select class="search-box" id="catFilter" style="width:150px" aria-label="Category filter"><option value="">All Categories</option></select>
    <select class="search-box" id="sortMode" style="width:150px" aria-label="Sort mode">
      <option value="rank">Overall Rank</option>
      <option value="playability">Most Playable</option>
      <option value="player_stars">Player Rated</option>
      <option value="size_kb">Largest</option>
      <option value="lines">Most Code</option>
    </select>
    <span style="font-size:.7em;color:var(--text-dim)" id="resultCount"></span>
  </div>
  <div class="dim-legend">
    <span class="str">Structural</span><span class="scl">Scale</span><span class="sys">Systems</span>
    <span class="cmp">Complete</span><span class="pla">Playability</span><span class="pol">Polish</span>
  </div>
  <div class="table-container">
    <table class="rank-table">
      <thead><tr>
        <th data-sort="rank" class="sorted">#</th>
        <th data-sort="grade">Grd</th>
        <th data-sort="title">App</th>
        <th data-sort="score">Score</th>
        <th data-sort="playability_score">Play</th>
        <th>Dims</th>
        <th>Rating</th>
        <th data-sort="category">Cat</th>
      </tr></thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>
</div>

<div id="panel-playable" class="tab-panel">
  <div style="padding:16px 32px;color:var(--text-dim);font-size:.85em">
    Top 20 apps ranked by <span style="color:var(--play);font-weight:bold">Playability Score</span> â€” feedback, difficulty, variety, controls, replayability.
  </div>
  <div class="playable-grid" id="playableGrid"></div>
</div>

<div id="panel-rated" class="tab-panel">
  <div style="padding:16px 32px;color:var(--text-dim);font-size:.85em">
    Apps you've rated. Ratings are stored in your browser's localStorage.
  </div>
  <div class="table-container">
    <table class="rank-table">
      <thead><tr>
        <th>Your Rating</th><th>App</th><th>Score</th><th>Play</th><th>Cat</th>
      </tr></thead>
      <tbody id="ratedBody"></tbody>
    </table>
  </div>
</div>

<div class="loading" id="loading"><div class="spinner"></div>Loading rankings...</div>

<script>
const RANKINGS_URL = '../rankings.json';
const SITE_BASE = 'https://kody-w.github.io/localFirstTools-main/';
const RATINGS_KEY = 'app-rankings-player-ratings';

let data = null, filtered = [], sortKey = 'rank', sortAsc = true;
let gradeFilter = null, catFilter = '', searchQuery = '', refreshTimer = null;

// Player ratings (localStorage)
function getMyRatings() {
  try { return JSON.parse(localStorage.getItem(RATINGS_KEY)) || {}; } catch(e) { return {}; }
}
function setMyRating(file, stars) {
  const r = getMyRatings(); r[file] = { stars, date: new Date().toISOString() };
  localStorage.setItem(RATINGS_KEY, JSON.stringify(r));
  renderTable(); renderRatedTab();
}
function exportRatings() {
  const r = getMyRatings();
  const blob = new Blob([JSON.stringify(r, null, 2)], { type: 'application/json' });
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
  a.download = 'my-app-ratings.json'; a.click();
}

async function loadRankings() {
  const el = document.getElementById('loading');
  try {
    el.style.display = 'flex';
    const urls = [RANKINGS_URL, SITE_BASE + 'apps/rankings.json', './rankings.json'];
    let resp;
    for (const url of urls) { try { resp = await fetch(url+'?t='+Date.now()); if(resp.ok)break; } catch(e){} }
    if (!resp||!resp.ok) throw new Error('Could not load rankings.json');
    data = await resp.json();
    // Attach playability_score for sorting
    data.rankings.forEach(app => {
      app.playability_score = app.dimensions?.playability?.score || 0;
      const mr = getMyRatings()[app.file];
      app.player_stars = mr ? mr.stars : 0;
    });
    el.style.display = 'none';
    renderAll();
  } catch(err) {
    el.innerHTML = `<div style="color:var(--a);text-align:center;padding:40px">Failed: ${err.message}<br><button class="refresh-btn" onclick="loadRankings()" style="margin-top:12px">Retry</button></div>`;
  }
}

function renderAll() { renderMeta(); renderStats(); renderHistogram(); renderCategoryBars(); renderGradePills(); renderCatFilter(); applyFilters(); renderPlayableTab(); renderRatedTab(); }

function renderMeta() {
  const d = new Date(data.generated);
  document.getElementById('meta').textContent = `${data.total_apps} apps | ${d.toLocaleDateString()} | Avg ${data.summary.avg_score} | Playability ${data.summary.avg_playability}/25`;
}

function renderStats() {
  const s = data.summary;
  document.getElementById('statsBar').innerHTML = [
    {v:data.total_apps,l:'Total Apps'},{v:s.avg_score,l:'Avg Score'},{v:s.avg_playability+'/25',l:'Avg Playability',play:true},
    {v:s.top_10_avg,l:'Top 10 Avg'},{v:s.grade_distribution.S||0,l:'S-Tier'},{v:s.grade_distribution.A||0,l:'A-Tier'},
    {v:Object.keys(getMyRatings()).length,l:'My Ratings',play:true}
  ].map(c=>`<div class="stat-card"><div class="value ${c.play?'play-color':''}">${c.v}</div><div class="label">${c.l}</div></div>`).join('');
}

function renderHistogram() {
  const hist = data.summary.score_histogram;
  const buckets = ['0-9','10-19','20-29','30-39','40-49','50-59','60-69','70-79','80-89','90-99'];
  const vals = buckets.map(b=>hist[b]||0), max = Math.max(...vals,1);
  const colors = ['#555','#555','#96858f','#96858f','#45b7d1','#45b7d1','#4ecdc4','#4ecdc4','#ff6b6b','#ffd700'];
  document.getElementById('histogram').innerHTML = vals.map((v,i)=>`<div class="hist-bar" style="height:${(v/max)*100}%;background:${colors[i]}"><span class="tip">${buckets[i]}: ${v}</span></div>`).join('');
  document.getElementById('histLabels').innerHTML = buckets.map(b=>`<span>${b.split('-')[0]}</span>`).join('');
}

function renderCategoryBars() {
  const entries = Object.entries(data.categories).sort((a,b)=>b[1].avg_playability-a[1].avg_playability);
  document.getElementById('categoryBars').innerHTML = entries.map(([k,c])=>{
    const pct = (c.avg_score/100)*100, ppct = (c.avg_playability/25)*100;
    return `<div class="cat-row"><span class="cat-label">${c.title||k}</span><div class="cat-bar-bg">
      <div class="cat-bar-fill" style="width:${pct}%;background:linear-gradient(90deg,var(--accent) ${(ppct/pct)*100}%,var(--border) ${(ppct/pct)*100}%)">${c.avg_score} (P:${c.avg_playability})</div>
    </div></div>`;
  }).join('');
}

function renderGradePills() {
  const dist = data.summary.grade_distribution, grades = ['S','A','B','C','D','F'];
  document.getElementById('gradePills').innerHTML = grades.map(g=>
    `<div class="grade-pill ${gradeFilter===g?'active':''}" data-grade="${g}" onclick="toggleGrade('${g}')">${g}<span class="count">${dist[g]||0}</span></div>`).join('');
}
function renderCatFilter() {
  const s = document.getElementById('catFilter'), v = s.value;
  s.innerHTML = '<option value="">All</option>'+Object.entries(data.categories).map(([k,c])=>`<option value="${k}" ${k===v?'selected':''}>${c.title||k}</option>`).join('');
}
function toggleGrade(g) { gradeFilter = gradeFilter===g?null:g; renderGradePills(); applyFilters(); }

function applyFilters() {
  filtered = data.rankings.filter(app=>{
    if(gradeFilter&&app.grade!==gradeFilter)return false;
    if(catFilter&&app.category!==catFilter)return false;
    if(searchQuery){const q=searchQuery.toLowerCase();if(!app.title.toLowerCase().includes(q)&&!app.file.toLowerCase().includes(q))return false;}
    return true;
  });
  const mode = document.getElementById('sortMode').value;
  if(mode==='playability'){filtered.sort((a,b)=>b.playability_score-a.playability_score);}
  else if(mode==='player_stars'){filtered.sort((a,b)=>b.player_stars-a.player_stars);}
  else if(mode==='size_kb'){filtered.sort((a,b)=>b.size_kb-a.size_kb);}
  else if(mode==='lines'){filtered.sort((a,b)=>b.lines-a.lines);}
  else{filtered.sort((a,b)=>a.rank-b.rank);}
  renderTable();
  document.getElementById('resultCount').textContent = `${filtered.length} of ${data.total_apps}`;
}

function getScoreColor(s){if(s>=90)return'var(--s)';if(s>=80)return'var(--a)';if(s>=65)return'var(--b)';if(s>=50)return'var(--c)';if(s>=35)return'var(--d)';return'var(--f)'}
function dimLit(dims,n,t){const d=dims[n];return d&&(d.score/d.max)>=t}
function esc(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}

function starsHTML(file, current) {
  return `<span class="stars" data-file="${esc(file)}">${[1,2,3,4,5].map(i=>
    `<span class="star ${i<=current?'filled':''}" data-val="${i}" onmouseenter="hoverStars(this)" onmouseleave="unhoverStars(this)" onclick="clickStar(this)">\u2605</span>`
  ).join('')}</span>`;
}
function hoverStars(el){const v=+el.dataset.val;el.closest('.stars').querySelectorAll('.star').forEach(s=>{s.classList.toggle('hover',+s.dataset.val<=v)})}
function unhoverStars(el){el.closest('.stars').querySelectorAll('.star').forEach(s=>s.classList.remove('hover'))}
function clickStar(el){const f=el.closest('.stars').dataset.file,v=+el.dataset.val;setMyRating(f,v)}

function renderTable() {
  const myR = getMyRatings();
  document.getElementById('tbody').innerHTML = filtered.map(app=>{
    const dims=app.dimensions||{}, dimNames=['structural','scale','systems','completeness','playability','polish'];
    const ps = app.playability_score, myStars = myR[app.file]?.stars||0;
    return `<tr>
      <td class="rank-num ${app.rank<=3?'top3':''}">${app.rank}</td>
      <td><span class="grade-badge ${app.grade}">${app.grade}</span></td>
      <td><a href="${SITE_BASE}${app.path}" target="_blank" class="app-link">${esc(app.title)}</a></td>
      <td><div class="score-bar"><span>${app.score}</span><div class="score-bar-bg"><div class="score-bar-fill" style="width:${app.score}%;background:${getScoreColor(app.score)}"></div></div></div></td>
      <td><div class="play-bar"><span style="color:var(--play)">${ps}</span><div class="play-bar-bg"><div class="play-bar-fill" style="width:${(ps/25)*100}%"></div></div></div></td>
      <td><div class="dim-dots">${dimNames.map(d=>`<div class="dim-dot ${dimLit(dims,d,.5)?'lit':''}" data-dim="${d}" title="${d}: ${dims[d]?.score||0}/${dims[d]?.max||0}"></div>`).join('')}</div></td>
      <td>${starsHTML(app.file,myStars)}</td>
      <td><span class="cat-tag">${app.category_folder||app.category}</span></td>
    </tr>`;
  }).join('');
}

function renderPlayableTab() {
  const tp = data.top_playable || [];
  document.getElementById('playableGrid').innerHTML = tp.map((g,i)=>{
    const app = data.rankings.find(r=>r.file===g.file);
    const details = app?.dimensions?.playability?.details || [];
    return `<div class="playable-card">
      <span class="card-rank">#${i+1}</span>
      <h4><a href="${SITE_BASE}${g.path}" target="_blank">${esc(g.title)}</a></h4>
      <div class="card-score"><span class="grade-badge ${g.grade}" style="display:inline-flex;margin-right:4px">${g.grade}</span> Score: ${g.score} | Playability: <span style="color:var(--play)">${g.playability}/25</span></div>
      <div class="card-details">${details.map(d=>`<span class="detail-tag">${d}</span>`).join('')}</div>
    </div>`;
  }).join('');
}

function renderRatedTab() {
  const myR = getMyRatings(), entries = Object.entries(myR).sort((a,b)=>b[1].stars-a[1].stars);
  document.getElementById('ratedBody').innerHTML = entries.map(([file,r])=>{
    const app = data?.rankings?.find(a=>a.file===file);
    if(!app) return '';
    return `<tr>
      <td>${starsHTML(file,r.stars)}</td>
      <td><a href="${SITE_BASE}${app.path}" target="_blank" class="app-link">${esc(app.title)}</a></td>
      <td>${app.score}</td>
      <td style="color:var(--play)">${app.playability_score}/25</td>
      <td><span class="cat-tag">${app.category_folder}</span></td>
    </tr>`;
  }).join('') || '<tr><td colspan="5" style="text-align:center;color:var(--text-dim);padding:32px">No ratings yet. Click stars in the All Rankings tab to rate apps.</td></tr>';
}

function switchTab(name) {
  document.querySelectorAll('.tab').forEach(t=>t.classList.toggle('active',t.dataset.tab===name));
  document.querySelectorAll('.tab-panel').forEach(p=>p.classList.toggle('active',p.id==='panel-'+name));
}

// Event listeners
document.getElementById('search').addEventListener('input',e=>{searchQuery=e.target.value;applyFilters()});
document.getElementById('catFilter').addEventListener('change',e=>{catFilter=e.target.value;applyFilters()});
document.getElementById('sortMode').addEventListener('change',()=>applyFilters());
document.querySelectorAll('.rank-table th[data-sort]').forEach(th=>{
  th.addEventListener('click',()=>{
    const k=th.dataset.sort;
    if(sortKey===k){sortAsc=!sortAsc}else{sortKey=k;sortAsc=k==='rank'||k==='title'||k==='category'}
    document.querySelectorAll('.rank-table th').forEach(t=>t.classList.remove('sorted','asc'));
    th.classList.add('sorted');if(sortAsc)th.classList.add('asc');
    document.getElementById('sortMode').value='rank';applyFilters();
  });
});
document.addEventListener('keydown',e=>{if(e.key==='/'&&document.activeElement.tagName!=='INPUT'){e.preventDefault();document.getElementById('search').focus()}});
function startAutoRefresh(){if(refreshTimer)clearInterval(refreshTimer);if(document.getElementById('autoRefresh').checked)refreshTimer=setInterval(loadRankings,60000)}
document.getElementById('autoRefresh').addEventListener('change',startAutoRefresh);

loadRankings();
</script>
</body>
</html>
