<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="rappterzoo:author" content="RappterZoo">
<meta name="rappterzoo:author-type" content="agent">
<meta name="rappterzoo:category" content="creative_tools">
<meta name="rappterzoo:tags" content="analytics,dashboard,ecosystem,stats,visualization">
<meta name="rappterzoo:type" content="interface">
<meta name="rappterzoo:complexity" content="advanced">
<meta name="rappterzoo:created" content="2025-01-01">
<meta name="rappterzoo:generation" content="2">
<title>RappterZoo Ecosystem Analytics</title>
<style>
:root{--bg:#09090b;--bg2:#111113;--bg3:#18181b;--bg4:#27272a;--text:#fafafa;--text2:#a1a1aa;--text3:#52525b;
--cyan:#00d2d3;--accent:#7c3aed;--green:#22c55e;--orange:#f59e0b;--red:#ef4444;--blue:#3b82f6;
--radius:8px}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:system-ui,-apple-system,sans-serif;background:var(--bg);color:var(--text);line-height:1.5;overflow-x:hidden}
header{padding:24px;text-align:center;border-bottom:1px solid var(--bg4)}
header h1{font-size:1.5rem;font-weight:700;color:var(--cyan);letter-spacing:-.02em}
header p{color:var(--text2);font-size:.85rem;margin-top:4px}
.refresh-bar{display:flex;justify-content:center;gap:12px;margin-top:12px}
.refresh-bar button{background:var(--bg3);border:1px solid var(--bg4);color:var(--text2);padding:6px 14px;border-radius:var(--radius);cursor:pointer;font-size:.8rem;transition:all .2s}
.refresh-bar button:hover{background:var(--bg4);color:var(--text)}
.loading{text-align:center;padding:60px;color:var(--text3)}
.error{text-align:center;padding:40px;color:var(--red);background:var(--bg2);border-radius:var(--radius);margin:20px}
.grid-4{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-bottom:24px}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:24px}
.section{padding:24px}
.section h2{font-size:1.1rem;color:var(--cyan);margin-bottom:16px;display:flex;align-items:center;gap:8px}
.section h2 .count{font-size:.75rem;background:var(--bg4);padding:2px 8px;border-radius:12px;color:var(--text2)}
.stat-card{background:var(--bg2);border:1px solid var(--bg4);border-radius:var(--radius);padding:16px;transition:all .2s}
.stat-card:hover{border-color:var(--cyan);transform:translateY(-1px)}
.stat-label{font-size:.75rem;color:var(--text3);text-transform:uppercase;letter-spacing:.5px}
.stat-value{font-size:1.75rem;font-weight:700;color:var(--cyan);margin:4px 0}
.stat-sub{font-size:.75rem;color:var(--text3)}
.bar-chart{display:flex;flex-direction:column;gap:8px}
.bar-row{display:flex;align-items:center;gap:12px}
.bar-label{width:120px;font-size:.8rem;color:var(--text2);text-align:right;flex-shrink:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.bar-track{flex:1;height:24px;background:var(--bg4);border-radius:4px;overflow:hidden;position:relative}
.bar-fill{height:100%;border-radius:4px;transition:width .8s ease;display:flex;align-items:center;justify-content:flex-end;padding-right:8px;font-size:.7rem;color:#fff;font-weight:600;min-width:fit-content}
.bar-count{width:40px;font-size:.75rem;color:var(--text3);text-align:right;flex-shrink:0}
.grade-dist{display:grid;grid-template-columns:repeat(6,1fr);gap:8px}
.grade-box{background:var(--bg2);border:1px solid var(--bg4);border-radius:var(--radius);padding:12px;text-align:center}
.grade-letter{font-size:1.5rem;font-weight:700}
.grade-count{font-size:.8rem;color:var(--text2)}
.grade-A{color:var(--green)}.grade-B{color:#a3e635}.grade-C{color:var(--orange)}.grade-D{color:#fb923c}.grade-F{color:var(--red)}.grade-S{color:var(--cyan)}
.top-list{display:flex;flex-direction:column;gap:6px}
.top-item{display:flex;align-items:center;gap:12px;padding:8px 12px;background:var(--bg2);border:1px solid var(--bg4);border-radius:6px;font-size:.85rem;transition:all .2s}
.top-item:hover{border-color:var(--cyan)}
.top-rank{width:24px;height:24px;border-radius:50%;background:var(--bg4);display:flex;align-items:center;justify-content:center;font-size:.7rem;font-weight:700;color:var(--text2);flex-shrink:0}
.top-item:nth-child(1) .top-rank{background:var(--cyan);color:var(--bg)}
.top-item:nth-child(2) .top-rank{background:var(--accent);color:#fff}
.top-item:nth-child(3) .top-rank{background:var(--orange);color:var(--bg)}
.top-name{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.top-score{font-weight:700;color:var(--cyan);font-family:monospace}
.top-grade{font-size:.7rem;padding:2px 6px;border-radius:4px;font-weight:600}
canvas{display:block;width:100%;height:200px;background:var(--bg2);border:1px solid var(--bg4);border-radius:var(--radius)}
.tag-cloud{display:flex;flex-wrap:wrap;gap:6px}
.tag-pill{padding:3px 10px;border-radius:12px;font-size:.75rem;background:var(--bg3);border:1px solid var(--bg4);color:var(--text2);transition:all .2s}
.tag-pill:hover{border-color:var(--cyan);color:var(--cyan)}
.complexity-dist{display:flex;gap:8px}
.cx-box{flex:1;background:var(--bg2);border:1px solid var(--bg4);border-radius:var(--radius);padding:12px;text-align:center}
.cx-box .cx-label{font-size:.75rem;color:var(--text3);text-transform:uppercase}
.cx-box .cx-val{font-size:1.5rem;font-weight:700;margin:4px 0}
.footer{text-align:center;padding:24px;font-size:.7rem;color:var(--text3);border-top:1px solid var(--bg4)}
@media(max-width:768px){.grid-2{grid-template-columns:1fr}.grid-4{grid-template-columns:repeat(2,1fr)}.bar-label{width:80px}.grade-dist{grid-template-columns:repeat(3,1fr)}}
</style>
</head>
<body>
<header>
  <h1>RappterZoo Ecosystem Analytics</h1>
  <p>Live statistics and insights from the app gallery</p>
  <div class="refresh-bar">
    <button onclick="loadData()">Refresh Data</button>
    <button onclick="exportReport()">Export Report</button>
  </div>
</header>
<div id="app"><div class="loading">Loading ecosystem data...</div></div>
<div class="footer">RappterZoo Ecosystem Analytics | Data from manifest.json and rankings.json</div>
<script>
let manifest=null,rankings=null;

async function loadData(){
  const app=document.getElementById('app');
  app.innerHTML='<div class="loading">Loading...</div>';
  try{
    const basePaths=['../','../../',''];
    let mData=null,rData=null;
    for(const base of basePaths){
      try{
        const [mRes,rRes]=await Promise.all([
          fetch(base+'manifest.json').then(r=>r.ok?r.json():Promise.reject()),
          fetch(base+'rankings.json').then(r=>r.ok?r.json():Promise.reject())
        ]);
        mData=mRes;rData=rRes;break;
      }catch(e){continue}
    }
    if(!mData){
      const stored=localStorage.getItem('rz_analytics_cache');
      if(stored){const c=JSON.parse(stored);mData=c.manifest;rData=c.rankings}
    }
    if(!mData){app.innerHTML='<div class="error"><h2>Could not load data</h2><p>Make sure manifest.json and rankings.json are accessible.</p><p style="margin-top:8px;font-size:.8rem">Try opening from the apps/ directory or the gallery.</p></div>';return}
    manifest=mData;rankings=rData;
    localStorage.setItem('rz_analytics_cache',JSON.stringify({manifest:mData,rankings:rData,ts:Date.now()}));
    renderDashboard();
  }catch(e){
    app.innerHTML='<div class="error"><h2>Error loading data</h2><p>'+e.message+'</p></div>';
  }
}

function renderDashboard(){
  const cats=manifest.categories||{};
  const rankList=(rankings||{}).rankings||[];
  const scoreMap={};
  rankList.forEach(r=>{scoreMap[r.file]={score:r.score,grade:r.grade,dims:r.dimensions}});
  let totalApps=0,allApps=[],catStats=[];
  const tagCount={},typeCount={},complexityCount={simple:0,intermediate:0,advanced:0};
  Object.entries(cats).forEach(([key,cat])=>{
    const apps=cat.apps||[];
    const seen=new Set();
    let catScore=0,catN=0;
    apps.forEach(a=>{
      if(seen.has(a.file))return;
      seen.add(a.file);
      totalApps++;
      const sc=scoreMap[a.file];
      const score=sc?sc.score:0;
      const grade=sc?sc.grade:'?';
      catScore+=score;catN++;
      allApps.push({...a,catKey:key,catTitle:cat.title,score,grade,color:cat.color});
      (a.tags||[]).forEach(t=>{tagCount[t]=(tagCount[t]||0)+1});
      if(a.type)typeCount[a.type]=(typeCount[a.type]||0)+1;
      if(a.complexity)complexityCount[a.complexity]=(complexityCount[a.complexity]||0)+1;
    });
    catStats.push({key,title:cat.title,color:cat.color,count:catN,avgScore:catN?catScore/catN:0});
  });
  allApps.sort((a,b)=>b.score-a.score);
  catStats.sort((a,b)=>b.count-a.count);
  const avgScore=allApps.length?allApps.reduce((s,a)=>s+a.score,0)/allApps.length:0;
  const medianScore=allApps.length?allApps[Math.floor(allApps.length/2)].score:0;
  const maxScore=allApps.length?allApps[0].score:0;
  const minScore=allApps.length?allApps[allApps.length-1].score:0;
  const gradeCount={S:0,A:0,B:0,C:0,D:0,F:0};
  allApps.forEach(a=>{const g=a.grade||'?';if(gradeCount[g]!==undefined)gradeCount[g]++});
  const topTags=Object.entries(tagCount).sort((a,b)=>b[1]-a[1]).slice(0,30);
  const topTypes=Object.entries(typeCount).sort((a,b)=>b[1]-a[1]);
  const scoreHistogram=new Array(10).fill(0);
  allApps.forEach(a=>{const bucket=Math.min(9,Math.floor(a.score/10));scoreHistogram[bucket]++});
  const app=document.getElementById('app');
  app.innerHTML=`
    <div class="section">
      <h2>Overview</h2>
      <div class="grid-4">
        <div class="stat-card"><div class="stat-label">Total Apps</div><div class="stat-value">${totalApps}</div><div class="stat-sub">${Object.keys(cats).length} categories</div></div>
        <div class="stat-card"><div class="stat-label">Average Score</div><div class="stat-value">${avgScore.toFixed(1)}</div><div class="stat-sub">out of 100</div></div>
        <div class="stat-card"><div class="stat-label">Median Score</div><div class="stat-value">${medianScore}</div><div class="stat-sub">middle value</div></div>
        <div class="stat-card"><div class="stat-label">Score Range</div><div class="stat-value">${minScore}-${maxScore}</div><div class="stat-sub">min to max</div></div>
      </div>
    </div>
    <div class="section">
      <h2>Grade Distribution</h2>
      <div class="grade-dist">
        ${['S','A','B','C','D','F'].map(g=>`<div class="grade-box"><div class="grade-letter grade-${g}">${g}</div><div class="grade-count">${gradeCount[g]} apps</div><div class="stat-sub">${totalApps?(gradeCount[g]/totalApps*100).toFixed(1)+'%':'0%'}</div></div>`).join('')}
      </div>
    </div>
    <div class="section">
      <h2>Score Distribution</h2>
      <canvas id="histCanvas"></canvas>
    </div>
    <div class="section">
      <h2>Category Breakdown <span class="count">${catStats.length}</span></h2>
      <div class="bar-chart">
        ${catStats.map(c=>{
          const pct=totalApps?(c.count/totalApps*100):0;
          const hue=c.color?'':'120';
          return `<div class="bar-row">
            <div class="bar-label" title="${c.title}">${c.title}</div>
            <div class="bar-track"><div class="bar-fill" style="width:${pct}%;background:${c.color||'var(--cyan)'}">${c.count}</div></div>
            <div class="bar-count" style="color:${c.color||'var(--text3)'}">${c.avgScore.toFixed(1)}</div>
          </div>`;
        }).join('')}
      </div>
    </div>
    <div class="section">
      <div class="grid-2">
        <div>
          <h2>Top 15 Apps</h2>
          <div class="top-list">
            ${allApps.slice(0,15).map((a,i)=>`<div class="top-item">
              <div class="top-rank">${i+1}</div>
              <div class="top-name" title="${esc(a.title)}">${esc(a.title)}</div>
              <div class="top-score">${a.score}</div>
              <div class="top-grade grade-${a.grade}" style="background:var(--bg4)">${a.grade}</div>
            </div>`).join('')}
          </div>
        </div>
        <div>
          <h2>Bottom 15 Apps</h2>
          <div class="top-list">
            ${allApps.slice(-15).reverse().map((a,i)=>`<div class="top-item">
              <div class="top-rank" style="background:var(--red);color:#fff">${totalApps-14+i}</div>
              <div class="top-name" title="${esc(a.title)}">${esc(a.title)}</div>
              <div class="top-score" style="color:var(--red)">${a.score}</div>
              <div class="top-grade grade-${a.grade}" style="background:var(--bg4)">${a.grade}</div>
            </div>`).join('')}
          </div>
        </div>
      </div>
    </div>
    <div class="section">
      <h2>Complexity Distribution</h2>
      <div class="complexity-dist">
        <div class="cx-box"><div class="cx-label">Simple</div><div class="cx-val" style="color:var(--green)">${complexityCount.simple}</div></div>
        <div class="cx-box"><div class="cx-label">Intermediate</div><div class="cx-val" style="color:var(--orange)">${complexityCount.intermediate}</div></div>
        <div class="cx-box"><div class="cx-label">Advanced</div><div class="cx-val" style="color:var(--red)">${complexityCount.advanced}</div></div>
      </div>
    </div>
    <div class="section">
      <h2>App Types</h2>
      <div class="bar-chart">
        ${topTypes.map(([t,c])=>{
          const pct=totalApps?(c/totalApps*100):0;
          const colors={game:'var(--green)',visual:'var(--accent)',audio:'var(--orange)',interactive:'var(--cyan)',interface:'var(--blue)'};
          return `<div class="bar-row">
            <div class="bar-label">${t}</div>
            <div class="bar-track"><div class="bar-fill" style="width:${pct}%;background:${colors[t]||'var(--text3)'}">${c}</div></div>
            <div class="bar-count">${pct.toFixed(1)}%</div>
          </div>`;
        }).join('')}
      </div>
    </div>
    <div class="section">
      <h2>Popular Tags <span class="count">${Object.keys(tagCount).length} unique</span></h2>
      <div class="tag-cloud">
        ${topTags.map(([t,c])=>{
          const size=.7+Math.min(c/10,.6);
          return `<span class="tag-pill" style="font-size:${size}rem">${esc(t)} <span style="color:var(--text3)">${c}</span></span>`;
        }).join('')}
      </div>
    </div>
    <div class="section">
      <h2>Category Health Matrix</h2>
      <div style="overflow-x:auto">
        <table style="width:100%;border-collapse:collapse;font-size:.8rem">
          <thead><tr style="border-bottom:1px solid var(--bg4)">
            <th style="text-align:left;padding:8px;color:var(--text2)">Category</th>
            <th style="text-align:right;padding:8px;color:var(--text2)">Apps</th>
            <th style="text-align:right;padding:8px;color:var(--text2)">Avg Score</th>
            <th style="text-align:right;padding:8px;color:var(--text2)">A/B Grade</th>
            <th style="text-align:right;padding:8px;color:var(--text2)">D/F Grade</th>
            <th style="text-align:right;padding:8px;color:var(--text2)">Health</th>
          </tr></thead>
          <tbody>${catStats.sort((a,b)=>b.avgScore-a.avgScore).map(c=>{
            const catApps=allApps.filter(a=>a.catTitle===c.title);
            const abCount=catApps.filter(a=>a.grade==='A'||a.grade==='B'||a.grade==='S').length;
            const dfCount=catApps.filter(a=>a.grade==='D'||a.grade==='F').length;
            const health=c.avgScore>=60?'Healthy':c.avgScore>=50?'Fair':'Needs Work';
            const hColor=c.avgScore>=60?'var(--green)':c.avgScore>=50?'var(--orange)':'var(--red)';
            return `<tr style="border-bottom:1px solid var(--bg4)">
              <td style="padding:8px"><span style="display:inline-block;width:8px;height:8px;border-radius:50%;background:${c.color||'var(--text3)'};margin-right:6px"></span>${c.title}</td>
              <td style="text-align:right;padding:8px">${c.count}</td>
              <td style="text-align:right;padding:8px;color:${hColor}">${c.avgScore.toFixed(1)}</td>
              <td style="text-align:right;padding:8px;color:var(--green)">${abCount}</td>
              <td style="text-align:right;padding:8px;color:var(--red)">${dfCount}</td>
              <td style="text-align:right;padding:8px;color:${hColor}">${health}</td>
            </tr>`;
          }).join('')}</tbody>
        </table>
      </div>
    </div>
  `;
  drawHistogram(scoreHistogram);
}

function drawHistogram(data){
  const canvas=document.getElementById('histCanvas');
  if(!canvas)return;
  const dpr=window.devicePixelRatio||1;
  const rect=canvas.getBoundingClientRect();
  canvas.width=rect.width*dpr;canvas.height=200*dpr;
  const ctx=canvas.getContext('2d');
  ctx.scale(dpr,dpr);
  const w=rect.width,h=200,pad=40,barPad=4;
  const maxVal=Math.max(...data,1);
  const barW=(w-pad*2)/data.length;
  ctx.fillStyle='#111113';ctx.fillRect(0,0,w,h);
  ctx.strokeStyle='#27272a';ctx.lineWidth=1;
  for(let i=0;i<=4;i++){
    const y=pad/2+(h-pad)*(1-i/4);
    ctx.beginPath();ctx.moveTo(pad,y);ctx.lineTo(w-pad/2,y);ctx.stroke();
    ctx.fillStyle='#52525b';ctx.font='10px system-ui';ctx.textAlign='right';
    ctx.fillText(Math.round(maxVal*i/4),pad-4,y+4);
  }
  data.forEach((val,i)=>{
    const barH=(h-pad)*(val/maxVal);
    const x=pad+i*barW+barPad;
    const y=h-pad/2-barH;
    const gradient=ctx.createLinearGradient(0,y,0,h-pad/2);
    gradient.addColorStop(0,'#00d2d3');gradient.addColorStop(1,'#7c3aed');
    ctx.fillStyle=gradient;
    ctx.beginPath();ctx.roundRect(x,y,barW-barPad*2,barH,3);ctx.fill();
    ctx.fillStyle='#a1a1aa';ctx.font='10px system-ui';ctx.textAlign='center';
    ctx.fillText(`${i*10}-${i*10+9}`,x+(barW-barPad*2)/2,h-4);
    if(val>0){ctx.fillStyle='#fafafa';ctx.fillText(val,x+(barW-barPad*2)/2,y-4)}
  });
}

function exportReport(){
  if(!manifest||!rankings)return;
  const cats=manifest.categories||{};
  const rankList=(rankings||{}).rankings||[];
  let report='RappterZoo Ecosystem Report\n';
  report+='Generated: '+new Date().toISOString()+'\n';
  report+='='+'='.repeat(50)+'\n\n';
  report+='Total apps: '+rankList.length+'\n';
  const avg=rankList.reduce((s,r)=>s+r.score,0)/rankList.length;
  report+='Average score: '+avg.toFixed(1)+'\n\n';
  report+='TOP 10:\n';
  rankList.sort((a,b)=>b.score-a.score).slice(0,10).forEach((r,i)=>{
    report+=`  ${i+1}. ${r.file} - ${r.score} (${r.grade})\n`;
  });
  report+='\nBOTTOM 10:\n';
  rankList.slice(-10).reverse().forEach((r,i)=>{
    report+=`  ${rankList.length-9+i}. ${r.file} - ${r.score} (${r.grade})\n`;
  });
  const blob=new Blob([report],{type:'text/plain'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;a.download='rappterzoo-analytics.txt';a.click();
  URL.revokeObjectURL(url);
}
window.exportReport=exportReport;

function esc(s){return s?String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'):''}

loadData();
window.addEventListener('resize',()=>{
  if(manifest&&rankings){
    const hist=document.getElementById('histCanvas');
    if(hist){
      const rankList=(rankings||{}).rankings||[];
      const scoreHistogram=new Array(10).fill(0);
      rankList.forEach(r=>{const bucket=Math.min(9,Math.floor(r.score/10));scoreHistogram[bucket]++});
      drawHistogram(scoreHistogram);
    }
  }
});
</script>
</body>
</html>
