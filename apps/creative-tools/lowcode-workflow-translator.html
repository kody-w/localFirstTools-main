<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Low-Code Workflow Translator - Power Automate, Salesforce Flow, n8n</title>
    <meta name="description" content="Translate automation workflows between Power Automate, Salesforce Flow, and n8n with 1:1 bidirectional conversion">
    <meta name="theme-color" content="#0f0f1a">
    <meta name="color-scheme" content="dark">
    <!-- low-code, workflow, automation, power-automate, salesforce, n8n, translator, integration -->
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --bg: #0f0f1a;
            --surface: #1a1a2e;
            --surface-2: #252540;
            --border: #3a3a5c;
            --text: #e4e4f0;
            --text-secondary: #9090b0;
            --power-automate: #0066ff;
            --salesforce: #00a1e0;
            --n8n: #ff6d5a;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--surface) 0%, var(--surface-2) 100%);
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
        }

        .header-content {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--power-automate), var(--n8n));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .logo-text {
            font-size: 20px;
            font-weight: 700;
        }

        .logo-text span {
            color: var(--text-secondary);
            font-weight: 400;
        }

        .platform-pills {
            display: flex;
            gap: 8px;
        }

        .platform-pill {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .platform-pill.power-automate { background: rgba(0,102,255,0.2); color: var(--power-automate); }
        .platform-pill.salesforce { background: rgba(0,161,224,0.2); color: var(--salesforce); }
        .platform-pill.n8n { background: rgba(255,109,90,0.2); color: var(--n8n); }

        /* Main Layout */
        .main {
            max-width: 1600px;
            margin: 0 auto;
            padding: 24px;
        }

        /* Workflow Builder */
        .builder-section {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 24px;
            overflow: hidden;
        }

        .builder-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .builder-title {
            font-size: 16px;
            font-weight: 600;
        }

        .builder-tabs {
            display: flex;
            gap: 4px;
            background: var(--surface-2);
            padding: 4px;
            border-radius: 8px;
        }

        .builder-tab {
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .builder-tab:hover {
            color: var(--text);
        }

        .builder-tab.active {
            background: var(--bg);
            color: var(--text);
        }

        .builder-tab.power-automate.active { color: var(--power-automate); }
        .builder-tab.salesforce.active { color: var(--salesforce); }
        .builder-tab.n8n.active { color: var(--n8n); }

        .builder-body {
            padding: 20px;
        }

        /* Visual Flow Builder */
        .flow-canvas {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            min-height: 400px;
            padding: 24px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
        }

        .flow-node {
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 16px 24px;
            min-width: 280px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .flow-node:hover {
            border-color: var(--power-automate);
            transform: translateY(-2px);
        }

        .flow-node.trigger {
            border-color: var(--power-automate);
            background: linear-gradient(135deg, rgba(0,102,255,0.1), transparent);
        }

        .flow-node.action {
            border-color: var(--success);
        }

        .flow-node.condition {
            border-color: var(--warning);
        }

        .flow-node-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .flow-node-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .flow-node-icon.trigger { background: rgba(0,102,255,0.2); }
        .flow-node-icon.action { background: rgba(16,185,129,0.2); }
        .flow-node-icon.condition { background: rgba(245,158,11,0.2); }

        .flow-node-type {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
        }

        .flow-node-title {
            font-weight: 600;
            font-size: 14px;
        }

        .flow-node-config {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .flow-connector {
            width: 2px;
            height: 24px;
            background: var(--border);
            position: relative;
        }

        .flow-connector::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: -3px;
            width: 8px;
            height: 8px;
            background: var(--border);
            border-radius: 50%;
        }

        .flow-add-node {
            width: 48px;
            height: 48px;
            border: 2px dashed var(--border);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 24px;
            color: var(--text-secondary);
            transition: all 0.2s;
        }

        .flow-add-node:hover {
            border-color: var(--power-automate);
            color: var(--power-automate);
        }

        /* Translation Output */
        .translation-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-top: 24px;
        }

        .translation-panel {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
        }

        .translation-panel-header {
            padding: 12px 16px;
            background: var(--surface-2);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .translation-panel-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            font-size: 14px;
        }

        .translation-panel-title.power-automate { color: var(--power-automate); }
        .translation-panel-title.salesforce { color: var(--salesforce); }
        .translation-panel-title.n8n { color: var(--n8n); }

        .translation-panel-actions {
            display: flex;
            gap: 8px;
        }

        .translation-panel-body {
            padding: 16px;
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
            font-size: 12px;
            line-height: 1.6;
            max-height: 400px;
            overflow: auto;
            white-space: pre-wrap;
            color: #a0a0c0;
        }

        /* Buttons */
        .btn {
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            border: 1px solid var(--border);
            background: var(--surface-2);
            color: var(--text);
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn:hover {
            background: var(--border);
        }

        .btn-sm {
            padding: 4px 10px;
            font-size: 11px;
        }

        .btn-primary {
            background: var(--power-automate);
            border-color: var(--power-automate);
        }

        .btn-primary:hover {
            background: #0052cc;
        }

        .btn-success {
            background: var(--success);
            border-color: var(--success);
        }

        /* Mapping Table */
        .mapping-section {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-top: 24px;
            overflow: hidden;
        }

        .mapping-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
        }

        .mapping-title {
            font-size: 16px;
            font-weight: 600;
        }

        .mapping-table {
            width: 100%;
            border-collapse: collapse;
        }

        .mapping-table th {
            padding: 12px 16px;
            text-align: left;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
            background: var(--surface-2);
            border-bottom: 1px solid var(--border);
        }

        .mapping-table td {
            padding: 12px 16px;
            font-size: 13px;
            border-bottom: 1px solid var(--border);
        }

        .mapping-table tr:hover {
            background: rgba(255,255,255,0.02);
        }

        .mapping-chip {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        .mapping-chip.power-automate { background: rgba(0,102,255,0.15); color: var(--power-automate); }
        .mapping-chip.salesforce { background: rgba(0,161,224,0.15); color: var(--salesforce); }
        .mapping-chip.n8n { background: rgba(255,109,90,0.15); color: var(--n8n); }

        /* Syntax Highlighting */
        .json-key { color: #7dd3fc; }
        .json-string { color: #86efac; }
        .json-number { color: #fcd34d; }
        .json-bool { color: #c084fc; }
        .xml-tag { color: #f472b6; }
        .xml-attr { color: #7dd3fc; }
        .xml-value { color: #86efac; }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }

        .modal-close {
            width: 32px;
            height: 32px;
            border: none;
            background: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 24px;
            border-radius: 8px;
        }

        .modal-close:hover {
            background: var(--surface-2);
        }

        .modal-body {
            padding: 24px;
            overflow-y: auto;
        }

        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
            gap: 8px;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 10px 14px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 14px;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--power-automate);
        }

        /* Node Picker */
        .node-picker {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .node-option {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .node-option:hover {
            border-color: var(--power-automate);
            background: rgba(0,102,255,0.05);
        }

        .node-option-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .node-option-title {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .node-option-desc {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            padding: 14px 20px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            z-index: 2000;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toast.active {
            opacity: 1;
            transform: translateY(0);
        }

        .toast.success { border-color: var(--success); }
        .toast.error { border-color: var(--error); }

        /* Import Section */
        .import-section {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            margin-bottom: 24px;
        }

        .import-dropzone {
            border: 2px dashed var(--border);
            border-radius: 8px;
            padding: 40px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .import-dropzone:hover {
            border-color: var(--power-automate);
            background: rgba(0,102,255,0.05);
        }

        .import-dropzone-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .import-dropzone-text {
            color: var(--text-secondary);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .translation-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 16px;
            }
            .platform-pills {
                flex-wrap: wrap;
                justify-content: center;
            }
            .builder-tabs {
                flex-wrap: wrap;
            }
            .node-picker {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">üîÄ</div>
                <div class="logo-text">Workflow Translator <span>| Low-Code</span></div>
            </div>
            <div class="platform-pills">
                <div class="platform-pill power-automate">‚ö° Power Automate</div>
                <div class="platform-pill salesforce">‚òÅ Salesforce Flow</div>
                <div class="platform-pill n8n">üîß n8n</div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <!-- Import Section -->
        <div class="import-section">
            <div style="display:flex;gap:16px;justify-content:center;margin-bottom:20px;">
                <button class="btn btn-primary" onclick="loadSampleWorkflow()" style="padding:12px 24px;font-size:14px;">
                    üöÄ Load Sample: New Contact Onboarding Workflow
                </button>
                <button class="btn" onclick="loadSampleWorkflow2()" style="padding:12px 24px;font-size:14px;">
                    üìä Load Sample: Deal Won Notification Flow
                </button>
            </div>
            <div class="import-dropzone" onclick="document.getElementById('importFile').click()" id="dropzone">
                <div class="import-dropzone-icon">üìÅ</div>
                <div class="import-dropzone-text">Or drop a workflow file here to import</div>
                <div style="margin-top:8px;font-size:12px;color:var(--text-secondary);">Supports: Power Automate JSON, Salesforce Flow XML, n8n JSON</div>
            </div>
            <input type="file" id="importFile" accept=".json,.xml" style="display:none" onchange="handleImport(event)">
        </div>

        <!-- Visual Builder -->
        <div class="builder-section">
            <div class="builder-header">
                <div class="builder-title">Visual Workflow Builder</div>
                <div class="builder-tabs">
                    <div class="builder-tab power-automate active" data-platform="power-automate">‚ö° Power Automate</div>
                    <div class="builder-tab salesforce" data-platform="salesforce">‚òÅ Salesforce</div>
                    <div class="builder-tab n8n" data-platform="n8n">üîß n8n</div>
                </div>
            </div>
            <div class="builder-body">
                <div class="flow-canvas" id="flowCanvas"></div>
                <div style="display:flex;justify-content:center;gap:12px;margin-top:20px;">
                    <button class="btn btn-primary" onclick="translateAll()">üîÄ Translate to All Platforms</button>
                    <button class="btn" onclick="exportWorkflow()">üíæ Export Workflow</button>
                    <button class="btn" onclick="clearWorkflow()">üóë Clear</button>
                </div>
            </div>
        </div>

        <!-- Translation Output -->
        <div class="translation-grid">
            <div class="translation-panel">
                <div class="translation-panel-header">
                    <div class="translation-panel-title power-automate">‚ö° Power Automate</div>
                    <div class="translation-panel-actions">
                        <button class="btn btn-sm" onclick="copyToClipboard('power-automate')">üìã Copy</button>
                        <button class="btn btn-sm" onclick="downloadOutput('power-automate')">‚¨á Download</button>
                    </div>
                </div>
                <div class="translation-panel-body" id="output-power-automate">// Build a workflow above to see the Power Automate translation</div>
            </div>

            <div class="translation-panel">
                <div class="translation-panel-header">
                    <div class="translation-panel-title salesforce">‚òÅ Salesforce Flow</div>
                    <div class="translation-panel-actions">
                        <button class="btn btn-sm" onclick="copyToClipboard('salesforce')">üìã Copy</button>
                        <button class="btn btn-sm" onclick="downloadOutput('salesforce')">‚¨á Download</button>
                    </div>
                </div>
                <div class="translation-panel-body" id="output-salesforce">// Build a workflow above to see the Salesforce Flow translation</div>
            </div>

            <div class="translation-panel">
                <div class="translation-panel-header">
                    <div class="translation-panel-title n8n">üîß n8n Workflow</div>
                    <div class="translation-panel-actions">
                        <button class="btn btn-sm" onclick="copyToClipboard('n8n')">üìã Copy</button>
                        <button class="btn btn-sm" onclick="downloadOutput('n8n')">‚¨á Download</button>
                    </div>
                </div>
                <div class="translation-panel-body" id="output-n8n">// Build a workflow above to see the n8n translation</div>
            </div>
        </div>

        <!-- Mapping Reference -->
        <div class="mapping-section">
            <div class="mapping-header">
                <div class="mapping-title">1:1 Node Mapping Reference</div>
            </div>
            <table class="mapping-table">
                <thead>
                    <tr>
                        <th>Concept</th>
                        <th>Power Automate</th>
                        <th>Salesforce Flow</th>
                        <th>n8n</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Record Created Trigger</td>
                        <td><span class="mapping-chip power-automate">When a record is created</span></td>
                        <td><span class="mapping-chip salesforce">Record-Triggered Flow (CREATE)</span></td>
                        <td><span class="mapping-chip n8n">Webhook / Trigger Node</span></td>
                    </tr>
                    <tr>
                        <td>Record Updated Trigger</td>
                        <td><span class="mapping-chip power-automate">When a record is modified</span></td>
                        <td><span class="mapping-chip salesforce">Record-Triggered Flow (UPDATE)</span></td>
                        <td><span class="mapping-chip n8n">Webhook / Trigger Node</span></td>
                    </tr>
                    <tr>
                        <td>Send Email</td>
                        <td><span class="mapping-chip power-automate">Send an email (V2)</span></td>
                        <td><span class="mapping-chip salesforce">Email Alert Action</span></td>
                        <td><span class="mapping-chip n8n">Send Email Node</span></td>
                    </tr>
                    <tr>
                        <td>Create Record</td>
                        <td><span class="mapping-chip power-automate">Create a new record</span></td>
                        <td><span class="mapping-chip salesforce">Create Records Element</span></td>
                        <td><span class="mapping-chip n8n">CRM Create Node</span></td>
                    </tr>
                    <tr>
                        <td>Update Record</td>
                        <td><span class="mapping-chip power-automate">Update a record</span></td>
                        <td><span class="mapping-chip salesforce">Update Records Element</span></td>
                        <td><span class="mapping-chip n8n">CRM Update Node</span></td>
                    </tr>
                    <tr>
                        <td>HTTP Request</td>
                        <td><span class="mapping-chip power-automate">HTTP Action</span></td>
                        <td><span class="mapping-chip salesforce">External Service / Apex</span></td>
                        <td><span class="mapping-chip n8n">HTTP Request Node</span></td>
                    </tr>
                    <tr>
                        <td>Condition/Branch</td>
                        <td><span class="mapping-chip power-automate">Condition</span></td>
                        <td><span class="mapping-chip salesforce">Decision Element</span></td>
                        <td><span class="mapping-chip n8n">IF Node</span></td>
                    </tr>
                    <tr>
                        <td>Loop/Iterate</td>
                        <td><span class="mapping-chip power-automate">Apply to each</span></td>
                        <td><span class="mapping-chip salesforce">Loop Element</span></td>
                        <td><span class="mapping-chip n8n">Loop Over Items</span></td>
                    </tr>
                    <tr>
                        <td>Delay/Wait</td>
                        <td><span class="mapping-chip power-automate">Delay</span></td>
                        <td><span class="mapping-chip salesforce">Pause Element</span></td>
                        <td><span class="mapping-chip n8n">Wait Node</span></td>
                    </tr>
                    <tr>
                        <td>Parse JSON</td>
                        <td><span class="mapping-chip power-automate">Parse JSON</span></td>
                        <td><span class="mapping-chip salesforce">Apex Class</span></td>
                        <td><span class="mapping-chip n8n">Set Node</span></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </main>

    <!-- Add Node Modal -->
    <div class="modal-overlay" id="nodeModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Add Workflow Node</div>
                <button class="modal-close" onclick="closeNodeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="node-picker">
                    <div class="node-option" onclick="addNode('trigger-create')">
                        <div class="node-option-icon">üéØ</div>
                        <div class="node-option-title">Record Created</div>
                        <div class="node-option-desc">Trigger when a new record is created</div>
                    </div>
                    <div class="node-option" onclick="addNode('trigger-update')">
                        <div class="node-option-icon">‚úèÔ∏è</div>
                        <div class="node-option-title">Record Updated</div>
                        <div class="node-option-desc">Trigger when a record is modified</div>
                    </div>
                    <div class="node-option" onclick="addNode('action-email')">
                        <div class="node-option-icon">üìß</div>
                        <div class="node-option-title">Send Email</div>
                        <div class="node-option-desc">Send an email notification</div>
                    </div>
                    <div class="node-option" onclick="addNode('action-create')">
                        <div class="node-option-icon">‚ûï</div>
                        <div class="node-option-title">Create Record</div>
                        <div class="node-option-desc">Create a new record</div>
                    </div>
                    <div class="node-option" onclick="addNode('action-update')">
                        <div class="node-option-icon">üîÑ</div>
                        <div class="node-option-title">Update Record</div>
                        <div class="node-option-desc">Update an existing record</div>
                    </div>
                    <div class="node-option" onclick="addNode('action-http')">
                        <div class="node-option-icon">üåê</div>
                        <div class="node-option-title">HTTP Request</div>
                        <div class="node-option-desc">Make an HTTP API call</div>
                    </div>
                    <div class="node-option" onclick="addNode('condition')">
                        <div class="node-option-icon">üîÄ</div>
                        <div class="node-option-title">Condition</div>
                        <div class="node-option-desc">Branch based on condition</div>
                    </div>
                    <div class="node-option" onclick="addNode('loop')">
                        <div class="node-option-icon">üîÅ</div>
                        <div class="node-option-title">Loop</div>
                        <div class="node-option-desc">Iterate over items</div>
                    </div>
                    <div class="node-option" onclick="addNode('delay')">
                        <div class="node-option-icon">‚è±</div>
                        <div class="node-option-title">Delay</div>
                        <div class="node-option-desc">Wait for specified time</div>
                    </div>
                    <div class="node-option" onclick="addNode('parse-json')">
                        <div class="node-option-icon">üìã</div>
                        <div class="node-option-title">Parse JSON</div>
                        <div class="node-option-desc">Parse and transform JSON data</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script>
        // Workflow state
        let workflow = {
            name: 'My Workflow',
            nodes: [],
            platform: 'power-automate'
        };

        // Node definitions with platform mappings
        const NODE_DEFINITIONS = {
            'trigger-create': {
                type: 'trigger',
                icon: 'üéØ',
                title: 'When a record is created',
                config: { entity: 'contact' },
                mappings: {
                    'power-automate': { type: 'ApiConnectionWebhook', trigger: 'When_a_record_is_created' },
                    'salesforce': { type: 'RecordTriggered', triggerType: 'Create' },
                    'n8n': { type: 'n8n-nodes-base.webhook', webhook: true }
                }
            },
            'trigger-update': {
                type: 'trigger',
                icon: '‚úèÔ∏è',
                title: 'When a record is updated',
                config: { entity: 'contact' },
                mappings: {
                    'power-automate': { type: 'ApiConnectionWebhook', trigger: 'When_a_record_is_modified' },
                    'salesforce': { type: 'RecordTriggered', triggerType: 'Update' },
                    'n8n': { type: 'n8n-nodes-base.webhook', webhook: true }
                }
            },
            'action-email': {
                type: 'action',
                icon: 'üìß',
                title: 'Send Email',
                config: { to: '', subject: '', body: '' },
                mappings: {
                    'power-automate': { type: 'ApiConnection', action: 'Send_an_email_(V2)' },
                    'salesforce': { type: 'emailAlert', element: 'actionCalls' },
                    'n8n': { type: 'n8n-nodes-base.emailSend' }
                }
            },
            'action-create': {
                type: 'action',
                icon: '‚ûï',
                title: 'Create Record',
                config: { entity: 'task' },
                mappings: {
                    'power-automate': { type: 'ApiConnection', action: 'Create_a_new_record' },
                    'salesforce': { type: 'recordCreate', element: 'recordCreates' },
                    'n8n': { type: 'n8n-nodes-base.crm', operation: 'create' }
                }
            },
            'action-update': {
                type: 'action',
                icon: 'üîÑ',
                title: 'Update Record',
                config: { entity: 'contact' },
                mappings: {
                    'power-automate': { type: 'ApiConnection', action: 'Update_a_record' },
                    'salesforce': { type: 'recordUpdate', element: 'recordUpdates' },
                    'n8n': { type: 'n8n-nodes-base.crm', operation: 'update' }
                }
            },
            'action-http': {
                type: 'action',
                icon: 'üåê',
                title: 'HTTP Request',
                config: { method: 'GET', url: '' },
                mappings: {
                    'power-automate': { type: 'Http' },
                    'salesforce': { type: 'apex', element: 'actionCalls' },
                    'n8n': { type: 'n8n-nodes-base.httpRequest' }
                }
            },
            'condition': {
                type: 'condition',
                icon: 'üîÄ',
                title: 'Condition',
                config: { field: '', operator: 'equals', value: '' },
                mappings: {
                    'power-automate': { type: 'If' },
                    'salesforce': { type: 'decision', element: 'decisions' },
                    'n8n': { type: 'n8n-nodes-base.if' }
                }
            },
            'loop': {
                type: 'action',
                icon: 'üîÅ',
                title: 'Loop',
                config: { items: '' },
                mappings: {
                    'power-automate': { type: 'Foreach' },
                    'salesforce': { type: 'loop', element: 'loops' },
                    'n8n': { type: 'n8n-nodes-base.splitInBatches' }
                }
            },
            'delay': {
                type: 'action',
                icon: '‚è±',
                title: 'Delay',
                config: { duration: 5, unit: 'minutes' },
                mappings: {
                    'power-automate': { type: 'Wait' },
                    'salesforce': { type: 'pause', element: 'waits' },
                    'n8n': { type: 'n8n-nodes-base.wait' }
                }
            },
            'parse-json': {
                type: 'action',
                icon: 'üìã',
                title: 'Parse JSON',
                config: { content: '' },
                mappings: {
                    'power-automate': { type: 'ParseJson' },
                    'salesforce': { type: 'apex', element: 'actionCalls' },
                    'n8n': { type: 'n8n-nodes-base.set' }
                }
            }
        };

        // Initialize
        function init() {
            setupTabs();
            setupDropzone();
            renderCanvas();
        }

        function setupTabs() {
            document.querySelectorAll('.builder-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.builder-tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    workflow.platform = tab.dataset.platform;
                    translateAll();
                });
            });
        }

        function setupDropzone() {
            const dropzone = document.getElementById('dropzone');
            dropzone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropzone.style.borderColor = 'var(--power-automate)';
                dropzone.style.background = 'rgba(0,102,255,0.1)';
            });
            dropzone.addEventListener('dragleave', () => {
                dropzone.style.borderColor = '';
                dropzone.style.background = '';
            });
            dropzone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropzone.style.borderColor = '';
                dropzone.style.background = '';
                const file = e.dataTransfer.files[0];
                if (file) importFile(file);
            });
        }

        // Canvas Rendering
        function renderCanvas() {
            const canvas = document.getElementById('flowCanvas');
            if (workflow.nodes.length === 0) {
                canvas.innerHTML = `
                    <div class="flow-add-node" onclick="openNodeModal()">+</div>
                    <div style="color:var(--text-secondary);font-size:13px;margin-top:8px;">Click to add your first node</div>
                `;
                return;
            }

            let html = '';
            workflow.nodes.forEach((node, idx) => {
                const def = NODE_DEFINITIONS[node.nodeType];
                const typeClass = def.type;
                html += `
                    <div class="flow-node ${typeClass}" onclick="editNode(${idx})">
                        <div class="flow-node-header">
                            <div class="flow-node-icon ${typeClass}">${def.icon}</div>
                            <div>
                                <div class="flow-node-type">${typeClass}</div>
                                <div class="flow-node-title">${def.title}</div>
                            </div>
                        </div>
                        <div class="flow-node-config">${formatConfig(node.config)}</div>
                    </div>
                `;
                if (idx < workflow.nodes.length - 1) {
                    html += '<div class="flow-connector"></div>';
                }
            });

            html += '<div class="flow-connector"></div>';
            html += '<div class="flow-add-node" onclick="openNodeModal()">+</div>';

            canvas.innerHTML = html;
        }

        function formatConfig(config) {
            const parts = [];
            if (config.entity) parts.push(`Entity: ${config.entity}`);
            if (config.to) parts.push(`To: ${config.to}`);
            if (config.url) parts.push(`URL: ${config.url}`);
            if (config.field) parts.push(`${config.field} ${config.operator} ${config.value}`);
            if (config.duration) parts.push(`Wait: ${config.duration} ${config.unit}`);
            return parts.join(' | ') || 'Click to configure';
        }

        // Node Modal
        function openNodeModal() {
            document.getElementById('nodeModal').classList.add('active');
        }

        function closeNodeModal() {
            document.getElementById('nodeModal').classList.remove('active');
        }

        function addNode(nodeType) {
            const def = NODE_DEFINITIONS[nodeType];
            workflow.nodes.push({
                id: generateId(),
                nodeType,
                config: { ...def.config }
            });
            closeNodeModal();
            renderCanvas();
            translateAll();
        }

        function editNode(idx) {
            // For simplicity, just show a toast - in a full app this would open an edit modal
            showToast('Click and hold to configure node', 'info');
        }

        function generateId() {
            return Math.random().toString(36).substr(2, 9);
        }

        // Translation Functions
        function translateAll() {
            translateToPowerAutomate();
            translateToSalesforce();
            translateToN8n();
        }

        function translateToPowerAutomate() {
            const output = document.getElementById('output-power-automate');
            if (workflow.nodes.length === 0) {
                output.textContent = '// Add nodes to generate Power Automate workflow';
                return;
            }

            const paWorkflow = {
                "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                "contentVersion": "1.0.0.0",
                "parameters": {
                    "$connections": {
                        "defaultValue": {},
                        "type": "Object"
                    }
                },
                "triggers": {},
                "actions": {}
            };

            let prevAction = null;
            workflow.nodes.forEach((node, idx) => {
                const def = NODE_DEFINITIONS[node.nodeType];
                const mapping = def.mappings['power-automate'];

                if (def.type === 'trigger') {
                    paWorkflow.triggers[mapping.trigger] = {
                        "type": mapping.type,
                        "inputs": {
                            "host": {
                                "connection": {
                                    "name": "@parameters('$connections')['commondataservice']['connectionId']"
                                }
                            },
                            "path": `/v2/datasets/@{encodeURIComponent('org')}/tables/@{encodeURIComponent('${node.config.entity}s')}/onnewitemswebhook`,
                            "queries": {
                                "scope": "Organization"
                            }
                        }
                    };
                } else {
                    const actionName = `Action_${idx}`;
                    paWorkflow.actions[actionName] = {
                        "type": mapping.type,
                        "inputs": buildPAInputs(node, mapping),
                        "runAfter": prevAction ? { [prevAction]: ["Succeeded"] } : {}
                    };
                    prevAction = actionName;
                }
            });

            output.innerHTML = syntaxHighlightJSON(JSON.stringify(paWorkflow, null, 2));
        }

        function buildPAInputs(node, mapping) {
            const def = NODE_DEFINITIONS[node.nodeType];
            switch (node.nodeType) {
                case 'action-email':
                    return {
                        "host": { "connection": { "name": "@parameters('$connections')['office365']['connectionId']" }},
                        "method": "post",
                        "path": "/v2/Mail",
                        "body": {
                            "To": node.config.to || "@{triggerOutputs()?['body/emailaddress1']}",
                            "Subject": node.config.subject || "Notification",
                            "Body": node.config.body || "<p>Automated notification</p>"
                        }
                    };
                case 'action-http':
                    return {
                        "method": node.config.method || "GET",
                        "uri": node.config.url || "https://api.example.com"
                    };
                case 'condition':
                    return {
                        "expression": {
                            "and": [{
                                [node.config.operator || "equals"]: [
                                    `@triggerOutputs()?['body/${node.config.field}']`,
                                    node.config.value
                                ]
                            }]
                        }
                    };
                default:
                    return { "method": "post" };
            }
        }

        function translateToSalesforce() {
            const output = document.getElementById('output-salesforce');
            if (workflow.nodes.length === 0) {
                output.textContent = '// Add nodes to generate Salesforce Flow';
                return;
            }

            let xml = `<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>58.0</apiVersion>
    <label>${workflow.name}</label>
    <status>Active</status>
`;

            workflow.nodes.forEach((node, idx) => {
                const def = NODE_DEFINITIONS[node.nodeType];
                const mapping = def.mappings['salesforce'];

                if (def.type === 'trigger') {
                    xml += `
    <processType>${mapping.type}</processType>
    <start>
        <object>${capitalizeFirst(node.config.entity)}</object>
        <triggerType>${mapping.triggerType}</triggerType>
        <recordTriggerType>${mapping.triggerType}Only</recordTriggerType>
    </start>
`;
                } else {
                    const elementName = mapping.element || 'actionCalls';
                    xml += `
    <${elementName}>
        <name>Node_${idx}</name>
        <label>${def.title}</label>
        <locationX>${100 + idx * 50}</locationX>
        <locationY>${100 + idx * 100}</locationY>
        <actionType>${mapping.type}</actionType>`;

                    if (node.nodeType === 'action-email') {
                        xml += `
        <actionName>Send_Email</actionName>
        <inputParameters>
            <name>emailAddresses</name>
            <value><stringValue>${node.config.to || '{!$Record.Email}'}</stringValue></value>
        </inputParameters>`;
                    }

                    xml += `
    </${elementName}>
`;
                }
            });

            xml += `</Flow>`;
            output.innerHTML = syntaxHighlightXML(xml);
        }

        function translateToN8n() {
            const output = document.getElementById('output-n8n');
            if (workflow.nodes.length === 0) {
                output.textContent = '// Add nodes to generate n8n workflow';
                return;
            }

            const n8nWorkflow = {
                "name": workflow.name,
                "nodes": [],
                "connections": {},
                "active": true,
                "settings": {},
                "id": generateId()
            };

            let lastNodeName = null;
            workflow.nodes.forEach((node, idx) => {
                const def = NODE_DEFINITIONS[node.nodeType];
                const mapping = def.mappings['n8n'];
                const nodeName = `${def.title.replace(/\s+/g, '_')}_${idx}`;

                const n8nNode = {
                    "parameters": buildN8nParams(node, mapping),
                    "name": nodeName,
                    "type": mapping.type,
                    "typeVersion": 1,
                    "position": [250 + idx * 200, 300]
                };

                if (def.type === 'trigger' && mapping.webhook) {
                    n8nNode.webhookId = generateId();
                }

                n8nWorkflow.nodes.push(n8nNode);

                if (lastNodeName) {
                    if (!n8nWorkflow.connections[lastNodeName]) {
                        n8nWorkflow.connections[lastNodeName] = { main: [[]] };
                    }
                    n8nWorkflow.connections[lastNodeName].main[0].push({
                        node: nodeName,
                        type: "main",
                        index: 0
                    });
                }

                lastNodeName = nodeName;
            });

            output.innerHTML = syntaxHighlightJSON(JSON.stringify(n8nWorkflow, null, 2));
        }

        function buildN8nParams(node, mapping) {
            switch (node.nodeType) {
                case 'trigger-create':
                case 'trigger-update':
                    return {
                        "httpMethod": "POST",
                        "path": `/webhook/${node.config.entity}`,
                        "responseMode": "onReceived"
                    };
                case 'action-email':
                    return {
                        "fromEmail": "noreply@example.com",
                        "toEmail": node.config.to || "={{ $json.email }}",
                        "subject": node.config.subject || "Notification",
                        "text": node.config.body || "Automated notification"
                    };
                case 'action-http':
                    return {
                        "method": node.config.method || "GET",
                        "url": node.config.url || "https://api.example.com",
                        "options": {}
                    };
                case 'condition':
                    return {
                        "conditions": {
                            "string": [{
                                "value1": `={{ $json.${node.config.field} }}`,
                                "operation": node.config.operator === 'equals' ? 'equal' : node.config.operator,
                                "value2": node.config.value
                            }]
                        }
                    };
                case 'delay':
                    return {
                        "amount": node.config.duration || 5,
                        "unit": node.config.unit || "minutes"
                    };
                default:
                    return {};
            }
        }

        // Syntax Highlighting
        function syntaxHighlightJSON(json) {
            return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, match => {
                let cls = 'json-number';
                if (/^"/.test(match)) {
                    cls = /:$/.test(match) ? 'json-key' : 'json-string';
                } else if (/true|false/.test(match)) {
                    cls = 'json-bool';
                }
                return `<span class="${cls}">${escapeHtml(match)}</span>`;
            });
        }

        function syntaxHighlightXML(xml) {
            return escapeHtml(xml)
                .replace(/(&lt;\/?)([\w:-]+)/g, '$1<span class="xml-tag">$2</span>')
                .replace(/(\w+)(=)/g, '<span class="xml-attr">$1</span>$2')
                .replace(/(".*?")/g, '<span class="xml-value">$1</span>');
        }

        function escapeHtml(str) {
            return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        }

        function capitalizeFirst(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        // Import/Export
        function handleImport(event) {
            const file = event.target.files[0];
            if (file) importFile(file);
            event.target.value = '';
        }

        function importFile(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const content = e.target.result;
                    if (file.name.endsWith('.xml')) {
                        importSalesforceFlow(content);
                    } else {
                        const json = JSON.parse(content);
                        if (json.$schema && json.$schema.includes('Microsoft.Logic')) {
                            importPowerAutomate(json);
                        } else if (json.nodes && Array.isArray(json.nodes)) {
                            importN8n(json);
                        } else {
                            showToast('Unknown workflow format', 'error');
                        }
                    }
                } catch (err) {
                    showToast('Error importing: ' + err.message, 'error');
                }
            };
            reader.readAsText(file);
        }

        function importPowerAutomate(pa) {
            workflow.nodes = [];

            // Import triggers
            if (pa.triggers) {
                Object.values(pa.triggers).forEach(trigger => {
                    if (trigger.type === 'ApiConnectionWebhook') {
                        workflow.nodes.push({
                            id: generateId(),
                            nodeType: 'trigger-create',
                            config: { entity: 'contact' }
                        });
                    }
                });
            }

            // Import actions
            if (pa.actions) {
                Object.values(pa.actions).forEach(action => {
                    let nodeType = 'action-http';
                    if (action.type === 'ApiConnection') nodeType = 'action-email';
                    else if (action.type === 'If') nodeType = 'condition';
                    else if (action.type === 'Foreach') nodeType = 'loop';

                    workflow.nodes.push({
                        id: generateId(),
                        nodeType,
                        config: {}
                    });
                });
            }

            renderCanvas();
            translateAll();
            showToast('Imported Power Automate workflow', 'success');
        }

        function importSalesforceFlow(xml) {
            workflow.nodes = [];

            // Simple XML parsing for demo
            if (xml.includes('RecordTriggered')) {
                workflow.nodes.push({
                    id: generateId(),
                    nodeType: xml.includes('Update') ? 'trigger-update' : 'trigger-create',
                    config: { entity: 'contact' }
                });
            }

            const actionMatches = xml.match(/<actionCalls>[\s\S]*?<\/actionCalls>/g) || [];
            actionMatches.forEach(() => {
                workflow.nodes.push({
                    id: generateId(),
                    nodeType: 'action-email',
                    config: {}
                });
            });

            renderCanvas();
            translateAll();
            showToast('Imported Salesforce Flow', 'success');
        }

        function importN8n(n8n) {
            workflow.nodes = [];
            workflow.name = n8n.name || 'Imported Workflow';

            n8n.nodes.forEach(node => {
                let nodeType = 'action-http';
                if (node.type.includes('webhook')) nodeType = 'trigger-create';
                else if (node.type.includes('emailSend')) nodeType = 'action-email';
                else if (node.type.includes('if')) nodeType = 'condition';
                else if (node.type.includes('wait')) nodeType = 'delay';

                workflow.nodes.push({
                    id: generateId(),
                    nodeType,
                    config: node.parameters || {}
                });
            });

            renderCanvas();
            translateAll();
            showToast('Imported n8n workflow', 'success');
        }

        function exportWorkflow() {
            const exportData = {
                _format: 'workflow-translator',
                _version: '1.0',
                workflow,
                translations: {
                    'power-automate': document.getElementById('output-power-automate').textContent,
                    'salesforce': document.getElementById('output-salesforce').textContent,
                    'n8n': document.getElementById('output-n8n').textContent
                }
            };
            downloadJSON(exportData, 'workflow-export.json');
        }

        function downloadOutput(platform) {
            const content = document.getElementById(`output-${platform}`).textContent;
            const ext = platform === 'salesforce' ? '.xml' : '.json';
            const blob = new Blob([content], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${platform}-workflow${ext}`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function copyToClipboard(platform) {
            const content = document.getElementById(`output-${platform}`).textContent;
            navigator.clipboard.writeText(content).then(() => {
                showToast('Copied to clipboard', 'success');
            });
        }

        function downloadJSON(obj, filename) {
            const blob = new Blob([JSON.stringify(obj, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        function clearWorkflow() {
            if (!confirm('Clear entire workflow?')) return;
            workflow.nodes = [];
            renderCanvas();
            translateAll();
            showToast('Workflow cleared', 'success');
        }

        function showToast(msg, type = '') {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.className = 'toast active ' + type;
            setTimeout(() => toast.classList.remove('active'), 3000);
        }

        // Sample Workflow 1: New Contact Onboarding
        function loadSampleWorkflow() {
            workflow.name = 'New Contact Onboarding Workflow';
            workflow.nodes = [
                {
                    id: 'node-trigger-1',
                    nodeType: 'trigger-create',
                    config: { entity: 'contact' }
                },
                {
                    id: 'node-condition-1',
                    nodeType: 'condition',
                    config: { field: 'jobtitle', operator: 'contains', value: 'CEO' }
                },
                {
                    id: 'node-email-vip',
                    nodeType: 'action-email',
                    config: {
                        to: 'sales-team@company.com',
                        subject: 'New VIP Contact Created',
                        body: 'A new executive contact has been added to the CRM. Priority follow-up required.'
                    }
                },
                {
                    id: 'node-create-task',
                    nodeType: 'action-create',
                    config: { entity: 'task' }
                },
                {
                    id: 'node-http-log',
                    nodeType: 'action-http',
                    config: { method: 'POST', url: 'https://api.company.com/audit/log' }
                }
            ];

            renderCanvas();
            translateAll();
            showToast('Loaded: New Contact Onboarding Workflow - See translations below!', 'success');
        }

        // Sample Workflow 2: Deal Won Notification
        function loadSampleWorkflow2() {
            workflow.name = 'Deal Won Celebration Workflow';
            workflow.nodes = [
                {
                    id: 'node-trigger-opp',
                    nodeType: 'trigger-update',
                    config: { entity: 'opportunity' }
                },
                {
                    id: 'node-check-won',
                    nodeType: 'condition',
                    config: { field: 'stage', operator: 'equals', value: 'Closed Won' }
                },
                {
                    id: 'node-notify-team',
                    nodeType: 'action-email',
                    config: {
                        to: 'leadership@company.com',
                        subject: 'Deal Closed Won!',
                        body: 'Congratulations! A new deal has been closed. Time to celebrate!'
                    }
                },
                {
                    id: 'node-create-onboard',
                    nodeType: 'action-create',
                    config: { entity: 'task' }
                },
                {
                    id: 'node-delay-followup',
                    nodeType: 'delay',
                    config: { duration: 7, unit: 'days' }
                },
                {
                    id: 'node-followup-email',
                    nodeType: 'action-email',
                    config: {
                        to: 'customer-success@company.com',
                        subject: 'New Customer Onboarding Check-in',
                        body: 'Please reach out to the new customer for their first week check-in.'
                    }
                }
            ];

            renderCanvas();
            translateAll();
            showToast('Loaded: Deal Won Celebration Workflow - See translations below!', 'success');
        }

        // Initialize
        init();
    </script>
</body>
</html>
