<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Zone Meeting Planner</title>
    <meta name="description" content="Find the best meeting time across multiple time zones. Visual overlap finder for global teams with working hours consideration.">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            min-height: 100vh;
            color: #e2e8f0;
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .header h1 {
            font-size: 1.6rem;
            background: linear-gradient(135deg, #06b6d4, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 18px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #06b6d4, #3b82f6);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(6,182,212,0.3);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .btn-secondary:hover {
            background: rgba(255,255,255,0.15);
        }

        .current-time {
            text-align: center;
            margin-bottom: 25px;
            font-size: 0.9rem;
            color: rgba(255,255,255,0.6);
        }

        .current-time .time {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, #06b6d4, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .panel {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .panel-title {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .participants-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .participant-row {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 15px;
            background: rgba(255,255,255,0.03);
            border-radius: 10px;
            flex-wrap: wrap;
        }

        .participant-name {
            flex: 1;
            min-width: 120px;
        }

        .participant-name input {
            width: 100%;
            padding: 8px 12px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 6px;
            color: white;
            font-size: 0.9rem;
        }

        .participant-timezone {
            flex: 2;
            min-width: 200px;
        }

        .participant-timezone select {
            width: 100%;
            padding: 8px 12px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 6px;
            color: white;
            font-size: 0.9rem;
        }

        .participant-time {
            font-size: 1.2rem;
            font-weight: 600;
            min-width: 80px;
            text-align: center;
        }

        .participant-status {
            font-size: 0.8rem;
            padding: 4px 10px;
            border-radius: 4px;
        }

        .status-working {
            background: rgba(16,185,129,0.2);
            color: #10b981;
        }

        .status-early {
            background: rgba(245,158,11,0.2);
            color: #f59e0b;
        }

        .status-late {
            background: rgba(239,68,68,0.2);
            color: #ef4444;
        }

        .status-sleeping {
            background: rgba(107,114,128,0.2);
            color: #9ca3af;
        }

        .remove-btn {
            background: rgba(239,68,68,0.2);
            border: none;
            color: #ef4444;
            width: 32px;
            height: 32px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
        }

        .remove-btn:hover {
            background: rgba(239,68,68,0.3);
        }

        .time-grid {
            overflow-x: auto;
            margin-top: 20px;
        }

        .grid-header {
            display: flex;
            margin-bottom: 10px;
            padding-left: 150px;
        }

        .hour-label {
            width: 40px;
            text-align: center;
            font-size: 0.75rem;
            color: rgba(255,255,255,0.5);
            flex-shrink: 0;
        }

        .grid-row {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .row-label {
            width: 150px;
            font-size: 0.85rem;
            padding-right: 10px;
            flex-shrink: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .hour-blocks {
            display: flex;
        }

        .hour-block {
            width: 40px;
            height: 30px;
            border-radius: 4px;
            margin-right: 2px;
            flex-shrink: 0;
            cursor: pointer;
            transition: all 0.2s;
        }

        .hour-block:hover {
            transform: scaleY(1.2);
        }

        .hour-block.working {
            background: #10b981;
        }

        .hour-block.early-late {
            background: #f59e0b;
        }

        .hour-block.sleeping {
            background: rgba(107,114,128,0.3);
        }

        .hour-block.selected {
            border: 2px solid white;
            box-shadow: 0 0 10px rgba(6,182,212,0.5);
        }

        .overlap-row {
            background: rgba(6,182,212,0.1);
            padding: 10px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .overlap-row .row-label {
            color: #06b6d4;
            font-weight: 600;
        }

        .overlap-row .hour-block.overlap-good {
            background: linear-gradient(135deg, #06b6d4, #3b82f6);
        }

        .overlap-row .hour-block.overlap-ok {
            background: rgba(6,182,212,0.5);
        }

        .overlap-row .hour-block.overlap-bad {
            background: rgba(107,114,128,0.3);
        }

        .best-times {
            margin-top: 20px;
            padding: 15px;
            background: rgba(6,182,212,0.1);
            border-radius: 10px;
            border: 1px solid rgba(6,182,212,0.3);
        }

        .best-times-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: #06b6d4;
        }

        .best-time-slot {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: rgba(255,255,255,0.05);
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .best-time-slot:last-child {
            margin-bottom: 0;
        }

        .time-slot-range {
            font-weight: 500;
        }

        .time-slot-score {
            font-size: 0.85rem;
            color: rgba(255,255,255,0.6);
        }

        .working-hours {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .working-hours label {
            font-size: 0.9rem;
            color: rgba(255,255,255,0.7);
        }

        .working-hours input {
            padding: 8px 12px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 6px;
            color: white;
            font-size: 0.9rem;
            width: 100px;
        }

        .selected-meeting {
            margin-top: 20px;
            padding: 20px;
            background: rgba(16,185,129,0.1);
            border-radius: 12px;
            border: 1px solid rgba(16,185,129,0.3);
        }

        .selected-meeting-title {
            font-weight: 600;
            color: #10b981;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .meeting-times-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
        }

        .meeting-time-item {
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
        }

        .meeting-time-name {
            font-size: 0.85rem;
            color: rgba(255,255,255,0.6);
            margin-bottom: 3px;
        }

        .meeting-time-value {
            font-size: 1.1rem;
            font-weight: 500;
        }

        .legend {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.8rem;
            color: rgba(255,255,255,0.6);
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: rgba(255,255,255,0.4);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1>Time Zone Meeting Planner</h1>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="addYourTimezone()">+ Add Your Location</button>
                <button class="btn btn-primary" onclick="addParticipant()">+ Add Participant</button>
            </div>
        </div>

        <div class="current-time">
            Your local time: <span class="time" id="localTime">--:--</span>
        </div>

        <div class="panel">
            <div class="panel-header">
                <span class="panel-title">Working Hours</span>
            </div>
            <div class="working-hours">
                <label>Work starts:</label>
                <input type="time" id="workStart" value="09:00" onchange="renderGrid()">
                <label>Work ends:</label>
                <input type="time" id="workEnd" value="17:00" onchange="renderGrid()">
                <label>Flex hours: ±</label>
                <input type="number" id="flexHours" value="1" min="0" max="3" style="width: 60px;" onchange="renderGrid()"> hours
            </div>
        </div>

        <div class="panel">
            <div class="panel-header">
                <span class="panel-title">Participants</span>
            </div>
            <div class="participants-list" id="participantsList"></div>
        </div>

        <div class="panel" id="gridPanel" style="display: none;">
            <div class="panel-header">
                <span class="panel-title">Time Zone Comparison</span>
            </div>
            <div class="time-grid" id="timeGrid"></div>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #10b981;"></div>
                    <span>Working hours</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #f59e0b;"></div>
                    <span>Flexible hours</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: rgba(107,114,128,0.3);"></div>
                    <span>Outside working hours</span>
                </div>
            </div>

            <div class="best-times" id="bestTimes"></div>

            <div class="selected-meeting" id="selectedMeeting" style="display: none;"></div>
        </div>
    </div>

    <script>
        const TIMEZONES = [
            { id: 'Pacific/Honolulu', name: 'Honolulu (HST)', offset: -10 },
            { id: 'America/Anchorage', name: 'Alaska (AKST)', offset: -9 },
            { id: 'America/Los_Angeles', name: 'Los Angeles (PST)', offset: -8 },
            { id: 'America/Denver', name: 'Denver (MST)', offset: -7 },
            { id: 'America/Chicago', name: 'Chicago (CST)', offset: -6 },
            { id: 'America/New_York', name: 'New York (EST)', offset: -5 },
            { id: 'America/Sao_Paulo', name: 'São Paulo (BRT)', offset: -3 },
            { id: 'Atlantic/Reykjavik', name: 'Reykjavik (GMT)', offset: 0 },
            { id: 'Europe/London', name: 'London (GMT)', offset: 0 },
            { id: 'Europe/Paris', name: 'Paris (CET)', offset: 1 },
            { id: 'Europe/Berlin', name: 'Berlin (CET)', offset: 1 },
            { id: 'Europe/Helsinki', name: 'Helsinki (EET)', offset: 2 },
            { id: 'Europe/Moscow', name: 'Moscow (MSK)', offset: 3 },
            { id: 'Asia/Dubai', name: 'Dubai (GST)', offset: 4 },
            { id: 'Asia/Karachi', name: 'Karachi (PKT)', offset: 5 },
            { id: 'Asia/Kolkata', name: 'Mumbai (IST)', offset: 5.5 },
            { id: 'Asia/Dhaka', name: 'Dhaka (BST)', offset: 6 },
            { id: 'Asia/Bangkok', name: 'Bangkok (ICT)', offset: 7 },
            { id: 'Asia/Singapore', name: 'Singapore (SGT)', offset: 8 },
            { id: 'Asia/Shanghai', name: 'Shanghai (CST)', offset: 8 },
            { id: 'Asia/Tokyo', name: 'Tokyo (JST)', offset: 9 },
            { id: 'Australia/Sydney', name: 'Sydney (AEDT)', offset: 11 },
            { id: 'Pacific/Auckland', name: 'Auckland (NZDT)', offset: 13 }
        ];

        let participants = [];
        let selectedHour = null;

        function init() {
            loadData();
            updateLocalTime();
            setInterval(updateLocalTime, 1000);
            renderParticipants();
        }

        function loadData() {
            const saved = localStorage.getItem('timezonePlanner');
            if (saved) {
                participants = JSON.parse(saved);
            }
        }

        function saveData() {
            localStorage.setItem('timezonePlanner', JSON.stringify(participants));
        }

        function updateLocalTime() {
            const now = new Date();
            document.getElementById('localTime').textContent =
                now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
        }

        function addYourTimezone() {
            const localTz = Intl.DateTimeFormat().resolvedOptions().timeZone;
            const existing = TIMEZONES.find(tz => tz.id === localTz);

            if (existing) {
                participants.unshift({
                    id: generateId(),
                    name: 'You',
                    timezone: localTz
                });
            } else {
                // Fallback to a default
                participants.unshift({
                    id: generateId(),
                    name: 'You',
                    timezone: 'America/New_York'
                });
            }

            saveData();
            renderParticipants();
        }

        function addParticipant() {
            participants.push({
                id: generateId(),
                name: 'Participant ' + (participants.length + 1),
                timezone: 'Europe/London'
            });
            saveData();
            renderParticipants();
        }

        function removeParticipant(id) {
            participants = participants.filter(p => p.id !== id);
            saveData();
            renderParticipants();
        }

        function updateParticipant(id, field, value) {
            const p = participants.find(p => p.id === id);
            if (p) {
                p[field] = value;
                saveData();
                renderParticipants();
            }
        }

        function renderParticipants() {
            const list = document.getElementById('participantsList');

            if (participants.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <p>Add participants to find the best meeting time across time zones.</p>
                    </div>
                `;
                document.getElementById('gridPanel').style.display = 'none';
                return;
            }

            const now = new Date();

            list.innerHTML = participants.map(p => {
                const tz = TIMEZONES.find(t => t.id === p.timezone);
                const localTime = getTimeInTimezone(now, p.timezone);
                const hour = localTime.getHours();
                const status = getHourStatus(hour);

                return `
                    <div class="participant-row">
                        <div class="participant-name">
                            <input type="text" value="${escapeHtml(p.name)}"
                                   onchange="updateParticipant('${p.id}', 'name', this.value)"
                                   placeholder="Name">
                        </div>
                        <div class="participant-timezone">
                            <select onchange="updateParticipant('${p.id}', 'timezone', this.value)">
                                ${TIMEZONES.map(tz =>
                                    `<option value="${tz.id}" ${tz.id === p.timezone ? 'selected' : ''}>${tz.name}</option>`
                                ).join('')}
                            </select>
                        </div>
                        <div class="participant-time">${formatTime(localTime)}</div>
                        <span class="participant-status ${status.class}">${status.label}</span>
                        <button class="remove-btn" onclick="removeParticipant('${p.id}')">×</button>
                    </div>
                `;
            }).join('');

            document.getElementById('gridPanel').style.display = 'block';
            renderGrid();
        }

        function renderGrid() {
            if (participants.length === 0) return;

            const grid = document.getElementById('timeGrid');
            const workStart = parseInt(document.getElementById('workStart').value.split(':')[0]);
            const workEnd = parseInt(document.getElementById('workEnd').value.split(':')[0]);
            const flex = parseInt(document.getElementById('flexHours').value);

            // Header
            let html = '<div class="grid-header">';
            for (let h = 0; h < 24; h++) {
                html += `<div class="hour-label">${h.toString().padStart(2, '0')}</div>`;
            }
            html += '</div>';

            // Calculate overlap scores
            const overlapScores = new Array(24).fill(0);

            // Participant rows
            participants.forEach(p => {
                const offset = getTimezoneOffset(p.timezone);
                html += `<div class="grid-row">`;
                html += `<div class="row-label" title="${escapeHtml(p.name)}">${escapeHtml(p.name)}</div>`;
                html += '<div class="hour-blocks">';

                for (let h = 0; h < 24; h++) {
                    // Calculate local hour for this participant
                    const localHour = (h + offset + 24) % 24;
                    let blockClass = 'hour-block';

                    if (localHour >= workStart && localHour < workEnd) {
                        blockClass += ' working';
                        overlapScores[h] += 2;
                    } else if (localHour >= workStart - flex && localHour < workEnd + flex) {
                        blockClass += ' early-late';
                        overlapScores[h] += 1;
                    } else {
                        blockClass += ' sleeping';
                    }

                    if (h === selectedHour) {
                        blockClass += ' selected';
                    }

                    html += `<div class="${blockClass}" onclick="selectHour(${h})" title="${localHour}:00 local"></div>`;
                }

                html += '</div></div>';
            });

            // Overlap row
            const maxScore = participants.length * 2;
            html += `<div class="grid-row overlap-row">`;
            html += `<div class="row-label">Best Overlap</div>`;
            html += '<div class="hour-blocks">';

            for (let h = 0; h < 24; h++) {
                let blockClass = 'hour-block';
                const score = overlapScores[h];

                if (score >= maxScore * 0.9) {
                    blockClass += ' overlap-good';
                } else if (score >= maxScore * 0.5) {
                    blockClass += ' overlap-ok';
                } else {
                    blockClass += ' overlap-bad';
                }

                if (h === selectedHour) {
                    blockClass += ' selected';
                }

                html += `<div class="${blockClass}" onclick="selectHour(${h})"></div>`;
            }

            html += '</div></div>';
            grid.innerHTML = html;

            // Best times
            renderBestTimes(overlapScores, maxScore);
        }

        function renderBestTimes(scores, maxScore) {
            const bestTimes = document.getElementById('bestTimes');

            // Find best consecutive slots
            const slots = [];
            let currentSlot = null;

            for (let h = 0; h < 24; h++) {
                const isGood = scores[h] >= maxScore * 0.5;

                if (isGood) {
                    if (!currentSlot) {
                        currentSlot = { start: h, score: scores[h] };
                    } else {
                        currentSlot.score += scores[h];
                    }
                } else {
                    if (currentSlot) {
                        currentSlot.end = h;
                        slots.push(currentSlot);
                        currentSlot = null;
                    }
                }
            }

            if (currentSlot) {
                currentSlot.end = 24;
                slots.push(currentSlot);
            }

            // Sort by score
            slots.sort((a, b) => b.score - a.score);

            if (slots.length === 0) {
                bestTimes.innerHTML = `
                    <div class="best-times-title">No good meeting times found</div>
                    <p style="color: rgba(255,255,255,0.5); font-size: 0.9rem;">
                        The time zones are too far apart. Consider asynchronous communication or alternating early/late meetings.
                    </p>
                `;
                return;
            }

            bestTimes.innerHTML = `
                <div class="best-times-title">Recommended Meeting Times (Your Local Time)</div>
                ${slots.slice(0, 3).map(slot => {
                    const percentage = Math.round((slot.score / (maxScore * (slot.end - slot.start))) * 100);
                    return `
                        <div class="best-time-slot" onclick="selectHour(${slot.start})">
                            <span class="time-slot-range">${formatHour(slot.start)} - ${formatHour(slot.end)}</span>
                            <span class="time-slot-score">${percentage}% availability</span>
                        </div>
                    `;
                }).join('')}
            `;
        }

        function selectHour(hour) {
            selectedHour = hour;
            renderGrid();
            showSelectedMeeting(hour);
        }

        function showSelectedMeeting(hour) {
            const container = document.getElementById('selectedMeeting');

            if (participants.length === 0) {
                container.style.display = 'none';
                return;
            }

            const baseDate = new Date();
            baseDate.setHours(hour, 0, 0, 0);

            container.style.display = 'block';
            container.innerHTML = `
                <div class="selected-meeting-title">Meeting at ${formatHour(hour)} (Your Time)</div>
                <div class="meeting-times-list">
                    ${participants.map(p => {
                        const offset = getTimezoneOffset(p.timezone);
                        const localHour = (hour + offset + 24) % 24;
                        const status = getHourStatus(localHour);

                        return `
                            <div class="meeting-time-item">
                                <div class="meeting-time-name">${escapeHtml(p.name)}</div>
                                <div class="meeting-time-value">${formatHour(localHour)} <span class="participant-status ${status.class}" style="font-size: 0.75rem;">${status.label}</span></div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function getTimeInTimezone(date, timezone) {
            return new Date(date.toLocaleString('en-US', { timeZone: timezone }));
        }

        function getTimezoneOffset(timezone) {
            const now = new Date();
            const local = now.getTime();
            const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
            const target = new Date(now.toLocaleString('en-US', { timeZone: timezone }));
            const targetOffset = (target.getTime() - utc) / 3600000;
            const localOffset = -now.getTimezoneOffset() / 60;

            return Math.round(targetOffset - localOffset);
        }

        function getHourStatus(hour) {
            const workStart = parseInt(document.getElementById('workStart').value.split(':')[0]);
            const workEnd = parseInt(document.getElementById('workEnd').value.split(':')[0]);
            const flex = parseInt(document.getElementById('flexHours').value);

            if (hour >= workStart && hour < workEnd) {
                return { label: 'Working', class: 'status-working' };
            } else if (hour >= workStart - flex && hour < workStart) {
                return { label: 'Early', class: 'status-early' };
            } else if (hour >= workEnd && hour < workEnd + flex) {
                return { label: 'Late', class: 'status-late' };
            } else {
                return { label: 'Off hours', class: 'status-sleeping' };
            }
        }

        function formatTime(date) {
            return date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: false });
        }

        function formatHour(hour) {
            const h = hour % 24;
            const ampm = h >= 12 ? 'PM' : 'AM';
            const h12 = h % 12 || 12;
            return `${h12}:00 ${ampm}`;
        }

        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function escapeHtml(str) {
            return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
        }

        init();
    </script>
</body>
</html>
