<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Local First Tools</title>
<meta name="description" content="450+ self-contained HTML applications. No dependencies, no tracking, works offline.">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#09090b;--bg2:#111113;--bg3:#18181b;--bg4:#27272a;
  --text:#fafafa;--text2:#a1a1aa;--text3:#52525b;
  --accent:#7c3aed;--accent2:#a78bfa;--accent-glow:rgba(124,58,237,.2);
  --border:#27272a;--radius:10px;
}
html{scroll-behavior:smooth}
body{font-family:system-ui,-apple-system,sans-serif;background:var(--bg);color:var(--text);line-height:1.5;-webkit-font-smoothing:antialiased}

header{padding:3rem 1.5rem 1.5rem;text-align:center}
header h1{font-size:1.75rem;font-weight:700;letter-spacing:-.03em;margin-bottom:.25rem}
header p{color:var(--text2);font-size:.9rem}
.stats{display:flex;gap:1.5rem;justify-content:center;margin-top:1rem}
.stats span{font-size:.8rem;color:var(--text3)}
.stats strong{color:var(--accent2);font-weight:600}

.controls{max-width:1200px;margin:1.5rem auto;padding:0 1.5rem;display:flex;flex-wrap:wrap;gap:.75rem;align-items:center}
.search-box{flex:1;min-width:200px;position:relative}
.search-box input{width:100%;padding:.6rem 1rem .6rem 2.25rem;background:var(--bg2);border:1px solid var(--border);border-radius:var(--radius);color:var(--text);font-size:.85rem;outline:none;transition:border-color .15s}
.search-box input:focus{border-color:var(--accent)}
.search-box input::placeholder{color:var(--text3)}
.search-box svg{position:absolute;left:.75rem;top:50%;transform:translateY(-50%);color:var(--text3);width:14px;height:14px}
.filters{display:flex;gap:.375rem;overflow-x:auto;scrollbar-width:none;flex-shrink:0}
.filters::-webkit-scrollbar{display:none}
.pill{padding:.375rem .75rem;border-radius:50px;border:1px solid var(--border);background:transparent;color:var(--text2);font-size:.75rem;cursor:pointer;white-space:nowrap;transition:all .15s}
.pill:hover{border-color:var(--text3)}
.pill.on{background:var(--accent);border-color:var(--accent);color:#fff}
.sort-sel{padding:.375rem .5rem;background:var(--bg2);border:1px solid var(--border);border-radius:var(--radius);color:var(--text2);font-size:.75rem;cursor:pointer;outline:none}
.meta-bar{max-width:1200px;margin:0 auto .75rem;padding:0 1.5rem;font-size:.75rem;color:var(--text3)}

.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:.75rem;max-width:1200px;margin:0 auto;padding:0 1.5rem 3rem}

a.card{display:block;background:var(--bg2);border:1px solid var(--border);border-radius:var(--radius);padding:.875rem 1rem;text-decoration:none;color:inherit;transition:border-color .15s,transform .15s}
a.card:hover{border-color:var(--accent);transform:translateY(-2px)}
.card-top{display:flex;align-items:center;gap:.5rem;margin-bottom:.375rem}
.card-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.card h3{font-size:.85rem;font-weight:600;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex:1}
.card p{font-size:.75rem;color:var(--text2);display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;margin-bottom:.5rem}
.card-tags{display:flex;gap:.25rem;flex-wrap:wrap}
.card-tags span{font-size:.6rem;padding:1px 6px;border-radius:50px;background:var(--bg3);color:var(--text3)}

.empty{text-align:center;padding:3rem;color:var(--text3);font-size:.9rem}
.totop{position:fixed;bottom:1.5rem;right:1.5rem;width:36px;height:36px;border-radius:50%;background:var(--accent);color:#fff;border:none;cursor:pointer;opacity:0;transition:opacity .2s;font-size:1rem;display:flex;align-items:center;justify-content:center}
.totop.show{opacity:1}
footer{text-align:center;padding:2rem;font-size:.7rem;color:var(--text3);border-top:1px solid var(--border)}
footer a{color:var(--accent2);text-decoration:none}

/* Detail Modal */
.modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.65);z-index:100;display:none;align-items:center;justify-content:center;backdrop-filter:blur(6px)}
.modal-bg.open{display:flex}
.modal{background:var(--bg2);border:1px solid var(--border);border-radius:12px;max-width:520px;width:92%;max-height:85vh;overflow-y:auto;padding:1.5rem;position:relative;animation:fadeUp .2s ease}
@keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:none}}
.modal-close{position:absolute;top:.75rem;right:.75rem;background:none;border:none;color:var(--text3);font-size:1.25rem;cursor:pointer;width:28px;height:28px;display:flex;align-items:center;justify-content:center;border-radius:6px}
.modal-close:hover{background:var(--bg3);color:var(--text)}
.modal h2{font-size:1.1rem;font-weight:700;margin-bottom:.25rem;padding-right:2rem}
.modal .modal-desc{font-size:.8rem;color:var(--text2);margin-bottom:.75rem}
.modal .modal-tags{display:flex;gap:.25rem;flex-wrap:wrap;margin-bottom:1rem}
.modal .modal-tags span{font-size:.6rem;padding:1px 6px;border-radius:50px;background:var(--bg3);color:var(--text3)}
.modal .modal-meta{font-size:.7rem;color:var(--text3);display:flex;gap:1rem;margin-bottom:1rem}
.modal .gen-badge{display:inline-block;font-size:.65rem;padding:1px 7px;border-radius:50px;background:var(--accent-glow);color:var(--accent2);font-weight:600;border:1px solid rgba(124,58,237,.3)}
.modal-actions{display:flex;gap:.5rem;flex-wrap:wrap;margin-bottom:1rem}
.modal-btn{padding:.5rem 1rem;border-radius:8px;border:none;font-size:.8rem;font-weight:600;cursor:pointer;text-decoration:none;display:inline-flex;align-items:center;gap:.375rem;transition:all .15s}
.modal-btn.primary{background:var(--accent);color:#fff}
.modal-btn.primary:hover{filter:brightness(1.2)}
.modal-btn.secondary{background:var(--bg3);color:var(--text2);border:1px solid var(--border)}
.modal-btn.secondary:hover{border-color:var(--accent);color:var(--text)}
.version-history{margin-top:.75rem}
.version-history h3{font-size:.75rem;color:var(--text3);text-transform:uppercase;letter-spacing:.5px;margin-bottom:.5rem;display:flex;align-items:center;gap:.375rem}
.version-list{display:flex;flex-direction:column;gap:.375rem}
.version-item{display:flex;align-items:center;gap:.5rem;padding:.5rem .75rem;background:var(--bg3);border:1px solid var(--border);border-radius:8px;text-decoration:none;color:inherit;transition:border-color .15s}
.version-item:hover{border-color:var(--accent)}
.version-num{font-size:.75rem;font-weight:700;color:var(--accent2);min-width:28px}
.version-info{flex:1;font-size:.7rem;color:var(--text2)}
.version-size{font-size:.65rem;color:var(--text3);font-family:monospace}
.version-current{border-color:var(--accent);background:var(--accent-glow)}
.no-versions{font-size:.75rem;color:var(--text3);font-style:italic}

@media(max-width:640px){
  .controls{flex-direction:column}
  .search-box{min-width:100%}
  .grid{grid-template-columns:1fr}
}
</style>
</head>
<body>

<header>
  <h1>Local First Tools</h1>
  <p>Self-contained HTML applications. No dependencies. Works offline.</p>
  <div class="stats">
    <span><strong id="ct">--</strong> apps</span>
    <span><strong>9</strong> categories</span>
    <span><strong>0</strong> dependencies</span>
  </div>
</header>

<div class="controls">
  <div class="search-box">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
    <input id="q" type="text" placeholder="Search..." aria-label="Search">
  </div>
  <div class="filters" id="filters"></div>
  <select class="sort-sel" id="sort" aria-label="Sort">
    <option value="name">A-Z</option>
    <option value="newest">Newest</option>
    <option value="complexity">Complexity</option>
  </select>
</div>
<div class="meta-bar" id="meta"></div>

<main class="grid" id="grid"></main>
<div class="empty" id="empty" style="display:none">No apps match your search.</div>

<button class="totop" id="top" aria-label="Back to top">&#8593;</button>

<!-- App Detail Modal -->
<div class="modal-bg" id="modal-bg" role="dialog" aria-label="App details">
  <div class="modal" id="modal">
    <button class="modal-close" id="modal-close" aria-label="Close">&times;</button>
    <div id="modal-dot" class="card-dot" style="display:inline-block;margin-bottom:.5rem"></div>
    <h2 id="modal-title"></h2>
    <p class="modal-desc" id="modal-desc"></p>
    <div class="modal-tags" id="modal-tags"></div>
    <div class="modal-meta" id="modal-meta"></div>
    <div class="modal-actions" id="modal-actions"></div>
    <div class="version-history" id="version-history" style="display:none">
      <h3>ðŸ”„ Version History</h3>
      <div class="version-list" id="version-list"></div>
    </div>
  </div>
</div>

<footer>
  <a href="https://github.com/kody-w/localFirstTools-main">GitHub</a>
</footer>

<script>
(function(){
  var apps=[], filtered=[], cat='all', query='', sort='name', archiveData={};
  var CXORD={advanced:0,intermediate:1,simple:2};

  // Fetch both manifests
  Promise.all([
    fetch('apps/manifest.json').then(function(r){return r.json()}),
    fetch('apps/archive/manifest.json').then(function(r){return r.json()}).catch(function(){return {}})
  ]).then(function(results){
    var data=results[0];
    archiveData=results[1];
    var nav=document.getElementById('filters');
    var total=0;
    var html='<button class="pill on" data-c="all">All</button>';
    var cats=data.categories;
    for(var k in cats){
      if(!cats.hasOwnProperty(k))continue;
      var c=cats[k], seen={};
      for(var i=0;i<c.apps.length;i++){
        var a=c.apps[i];
        if(seen[a.file])continue;
        seen[a.file]=1;
        var stem=a.file.replace('.html','');
        apps.push({t:a.title,f:'apps/'+c.folder+'/'+a.file,d:a.description,tags:a.tags||[],cx:a.complexity,ft:a.featured,cr:a.created,cat:k,catTitle:c.title,color:c.color,gen:a.generation||0,lastMolted:a.lastMolted||'',stem:stem,type:a.type||''});
        total++;
      }
      html+='<button class="pill" data-c="'+k+'">'+esc(c.title)+'<\/button>';
    }
    nav.innerHTML=html;
    document.getElementById('ct').textContent=total;
    run();
    listen();
  });

  function run(){
    var q=query.toLowerCase();
    filtered=[];
    for(var i=0;i<apps.length;i++){
      var a=apps[i];
      if(cat!=='all'&&a.cat!==cat)continue;
      if(q){
        var h=(a.t+' '+a.d+' '+a.tags.join(' ')).toLowerCase();
        var ws=q.split(/\s+/), ok=true;
        for(var w=0;w<ws.length;w++){if(h.indexOf(ws[w])<0){ok=false;break}}
        if(!ok)continue;
      }
      filtered.push(a);
    }
    filtered.sort(function(a,b){
      if(sort==='name')return a.t.localeCompare(b.t);
      if(sort==='newest')return(b.cr||'').localeCompare(a.cr||'');
      return(CXORD[a.cx]!=null?CXORD[a.cx]:1)-(CXORD[b.cx]!=null?CXORD[b.cx]:1);
    });
    render();
  }

  function render(){
    var g=document.getElementById('grid');
    var e=document.getElementById('empty');
    document.getElementById('meta').textContent=filtered.length+' app'+(filtered.length!==1?'s':'');
    if(!filtered.length){g.innerHTML='';e.style.display='';return}
    e.style.display='none';
    var frag=document.createDocumentFragment();
    for(var i=0;i<filtered.length;i++){
      var a=filtered[i];
      var el=document.createElement('a');
      el.href='#';
      el.className='card';
      el.dataset.idx=i;
      var thtml='';
      for(var t=0;t<Math.min(a.tags.length,3);t++)thtml+='<span>'+esc(a.tags[t])+'<\/span>';
      thtml+='<span>'+esc(a.cx)+'<\/span>';
      var genBadge=a.gen?'<span class="gen-badge">Gen '+a.gen+'<\/span>':'';
      el.innerHTML='<div class="card-top"><span class="card-dot" style="background:'+a.color+'"><\/span><h3>'+esc(a.t)+'<\/h3>'+genBadge+'<\/div><p>'+esc(a.d)+'<\/p><div class="card-tags">'+thtml+'<\/div>';
      frag.appendChild(el);
    }
    g.innerHTML='';
    g.appendChild(frag);
  }

  function showModal(app){
    var bg=document.getElementById('modal-bg');
    document.getElementById('modal-dot').style.background=app.color;
    document.getElementById('modal-title').textContent=app.t;
    document.getElementById('modal-desc').textContent=app.d;

    var tagsHtml='';
    for(var i=0;i<app.tags.length;i++)tagsHtml+='<span>'+esc(app.tags[i])+'<\/span>';
    document.getElementById('modal-tags').innerHTML=tagsHtml;

    var metaHtml='';
    if(app.cx)metaHtml+='<span>'+esc(app.cx)+'<\/span>';
    if(app.type)metaHtml+='<span>'+esc(app.type)+'<\/span>';
    if(app.cr)metaHtml+='<span>'+esc(app.cr)+'<\/span>';
    if(app.gen)metaHtml+='<span class="gen-badge">Generation '+app.gen+'<\/span>';
    if(app.lastMolted)metaHtml+='<span>Last molted: '+esc(app.lastMolted)+'<\/span>';
    document.getElementById('modal-meta').innerHTML=metaHtml;

    document.getElementById('modal-actions').innerHTML=
      '<a class="modal-btn primary" href="'+esc(app.f)+'" target="_blank">â–¶ Open Current<\/a>'+
      '<a class="modal-btn secondary" href="'+esc(app.f)+'" download>â¬‡ Download<\/a>';

    // Version history
    var vh=document.getElementById('version-history');
    var vl=document.getElementById('version-list');
    var archive=archiveData[app.stem];
    if(archive&&archive.versions&&archive.versions.length>0){
      vh.style.display='';
      var vlHtml='';
      // Current version
      vlHtml+='<a class="version-item version-current" href="'+esc(app.f)+'" target="_blank">'+
        '<span class="version-num">v'+((archive.currentGeneration||app.gen||0)+1)+'<\/span>'+
        '<span class="version-info">Current â€” '+esc(app.t)+'<\/span>'+
        '<\/a>';
      // Archived versions (newest first)
      for(var v=archive.versions.length-1;v>=0;v--){
        var ver=archive.versions[v];
        var sizeKB=ver.size?Math.round(ver.size/1024)+'KB':'';
        vlHtml+='<a class="version-item" href="'+esc(ver.file)+'" target="_blank">'+
          '<span class="version-num">v'+ver.version+'<\/span>'+
          '<span class="version-info">Archived generation '+ver.version+'<\/span>'+
          '<span class="version-size">'+sizeKB+'<\/span>'+
          '<\/a>';
      }
      vl.innerHTML=vlHtml;
    }else{
      vh.style.display='none';
      vl.innerHTML='';
    }

    bg.classList.add('open');
  }

  function closeModal(){
    document.getElementById('modal-bg').classList.remove('open');
  }

  function esc(s){return s?s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'):''}

  function listen(){
    var timer;
    document.getElementById('q').addEventListener('input',function(e){
      clearTimeout(timer);
      timer=setTimeout(function(){query=e.target.value;run()},120);
    });
    document.getElementById('filters').addEventListener('click',function(e){
      var b=e.target.closest('.pill');
      if(!b)return;
      cat=b.dataset.c;
      var ps=document.querySelectorAll('.pill');
      for(var i=0;i<ps.length;i++)ps[i].classList.remove('on');
      b.classList.add('on');
      run();
    });
    document.getElementById('sort').addEventListener('change',function(e){sort=e.target.value;run()});
    var tb=document.getElementById('top');
    window.addEventListener('scroll',function(){tb.classList.toggle('show',scrollY>300)},{passive:true});
    tb.addEventListener('click',function(){scrollTo({top:0,behavior:'smooth'})});
    document.addEventListener('keydown',function(e){
      if(e.target.tagName==='INPUT')return;
      if(e.key==='/')e.preventDefault(),document.getElementById('q').focus();
      if(e.key==='Escape')closeModal();
    });

    // Card clicks â†’ open modal
    document.getElementById('grid').addEventListener('click',function(e){
      var card=e.target.closest('.card');
      if(!card)return;
      e.preventDefault();
      var idx=parseInt(card.dataset.idx,10);
      if(!isNaN(idx)&&filtered[idx])showModal(filtered[idx]);
    });

    // Close modal
    document.getElementById('modal-close').addEventListener('click',closeModal);
    document.getElementById('modal-bg').addEventListener('click',function(e){
      if(e.target===this)closeModal();
    });
  }
})();
</script>
</body>
</html>
