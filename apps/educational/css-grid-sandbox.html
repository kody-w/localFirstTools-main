<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="rappterzoo:author" content="RappterZoo">
<meta name="rappterzoo:author-type" content="agent">
<meta name="rappterzoo:category" content="educational">
<meta name="rappterzoo:tags" content="canvas,educational,css,grid,flexbox,interactive,audio">
<meta name="rappterzoo:type" content="interactive">
<meta name="rappterzoo:complexity" content="advanced">
<meta name="rappterzoo:created" content="2025-01-01">
<meta name="rappterzoo:generation" content="2">
<title>LayoutLab - CSS Grid & Flexbox Studio</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100%;overflow:hidden;background:#0e1113;font-family:'Segoe UI',system-ui,sans-serif;color:#e0e0e0}
.app{display:flex;height:100%;flex-direction:column}
header{background:#161a1e;padding:8px 16px;border-bottom:1px solid #2a2f35;display:flex;align-items:center;gap:12px;flex-shrink:0}
header h1{font-size:1.1rem;color:#00d2d3;letter-spacing:2px}
.tabs{display:flex;gap:2px;margin-left:16px}
.tab{padding:6px 14px;background:#1e2329;border:1px solid #2a2f35;border-bottom:none;border-radius:4px 4px 0 0;cursor:pointer;font-size:0.75rem;color:#aaa;transition:all 0.2s}
.tab:hover{color:#00d2d3}
.tab.active{background:#0e1113;color:#00d2d3;border-color:#2a2f35;border-bottom-color:#0e1113}
.toolbar{display:flex;gap:6px;margin-left:auto;flex-wrap:wrap}
.tb-btn{background:#1e2329;border:1px solid #2a2f35;color:#aaa;padding:4px 10px;border-radius:4px;cursor:pointer;font-size:0.72rem;transition:all 0.2s;font-family:inherit}
.tb-btn:hover{border-color:#00d2d3;color:#00d2d3}
.main{flex:1;display:flex;min-height:0}
.sidebar{width:300px;background:#161a1e;border-right:1px solid #2a2f35;overflow-y:auto;flex-shrink:0;padding:12px}
.sidebar h3{font-size:0.8rem;color:#00d2d3;margin-bottom:8px;padding-bottom:4px;border-bottom:1px solid #2a2f35}
.content{flex:1;display:flex;flex-direction:column;min-width:0}
.preview-area{flex:1;padding:20px;display:flex;align-items:center;justify-content:center;overflow:auto;background:#0e1113}
.code-panel{background:#0a0c0e;border-top:1px solid #2a2f35;max-height:220px;overflow:auto;display:flex}
.code-section{flex:1;padding:12px;border-right:1px solid #2a2f35}
.code-section:last-child{border-right:none}
.code-section h4{font-size:0.72rem;color:#00d2d3;margin-bottom:6px}
.code-section pre{font-family:'Courier New',monospace;font-size:0.75rem;color:#ccc;white-space:pre-wrap;line-height:1.4}
.code-section .kw{color:#c678dd}
.code-section .val{color:#e5c07b}
.code-section .prop{color:#61afef}
.code-section .sel{color:#e06c75}
.field{margin-bottom:10px}
.field label{display:block;font-size:0.72rem;color:#888;margin-bottom:3px}
.field input,.field select{width:100%;background:#0e1113;border:1px solid #2a2f35;color:#e0e0e0;padding:6px 8px;border-radius:4px;font-size:0.82rem;font-family:inherit}
.field input:focus,.field select:focus{outline:none;border-color:#00d2d3}
.field textarea{width:100%;background:#0e1113;border:1px solid #2a2f35;color:#e0e0e0;padding:6px 8px;border-radius:4px;font-family:'Courier New',monospace;font-size:0.78rem;min-height:60px;resize:vertical}
.field textarea:focus{outline:none;border-color:#00d2d3}
.row{display:flex;gap:8px}
.row .field{flex:1}
.items-list{display:flex;flex-direction:column;gap:4px;margin-bottom:10px}
.item-row{display:flex;gap:6px;align-items:center;background:#1e2329;padding:6px 8px;border-radius:4px;font-size:0.78rem;flex-wrap:wrap}
.item-row input{width:50px;background:#0e1113;border:1px solid #2a2f35;color:#e0e0e0;padding:3px 5px;border-radius:3px;font-size:0.72rem;text-align:center}
.item-row input:focus{outline:none;border-color:#00d2d3}
.item-color{width:16px;height:16px;border-radius:3px;flex-shrink:0;cursor:pointer}
.btn{background:#00d2d3;color:#0e1113;border:none;padding:6px 12px;border-radius:4px;cursor:pointer;font-size:0.78rem;font-weight:600;font-family:inherit}
.btn:hover{opacity:0.9}
.btn-sm{background:#1e2329;color:#aaa;border:1px solid #2a2f35;padding:3px 8px;font-size:0.68rem;cursor:pointer;border-radius:3px;font-family:inherit}
.btn-sm:hover{border-color:#ff6347;color:#ff6347}
.btn-add{background:#1e2329;color:#00d2d3;border:1px solid #2a2f35;width:100%;padding:6px;border-radius:4px;cursor:pointer;font-size:0.78rem;font-family:inherit}
.btn-add:hover{border-color:#00d2d3;background:#1e2329}
.copy-btn{background:#1e2329;border:1px solid #2a2f35;color:#aaa;padding:3px 10px;border-radius:4px;cursor:pointer;font-size:0.72rem;float:right;font-family:inherit}
.copy-btn:hover{color:#00d2d3;border-color:#00d2d3}
.preset-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;margin-bottom:12px}
.preset-card{background:#1e2329;border:1px solid #2a2f35;border-radius:4px;padding:8px;cursor:pointer;text-align:center;transition:all 0.2s;font-size:0.72rem}
.preset-card:hover{border-color:#00d2d3;background:#1a2228}
.preset-card .preview{height:30px;margin-bottom:4px;display:grid;gap:2px}
.preset-card .preview div{background:#00d2d322;border:1px solid #00d2d344;border-radius:2px}
.challenge-card{background:#1e2329;border:1px solid #2a2f35;border-radius:6px;padding:12px;margin-bottom:8px;cursor:pointer;transition:all 0.2s}
.challenge-card:hover{border-color:#00d2d3}
.challenge-card.completed{border-color:#2ecc71;background:#2ecc7108}
.challenge-card h4{font-size:0.8rem;color:#ccc;margin-bottom:4px}
.challenge-card p{font-size:0.68rem;color:#666;line-height:1.4}
.challenge-card .badge{display:inline-block;padding:2px 6px;border-radius:3px;font-size:0.6rem;font-weight:600;margin-top:4px}
.challenge-card .badge.easy{background:#2ecc7122;color:#2ecc71}
.challenge-card .badge.medium{background:#f39c1222;color:#f39c12}
.challenge-card .badge.hard{background:#e74c3c22;color:#e74c3c}
.toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:rgba(0,210,211,0.15);border:1px solid #00d2d3;color:#00d2d3;padding:8px 20px;border-radius:6px;z-index:100;opacity:0;transition:opacity 0.3s;font-size:0.82rem}
.toast.show{opacity:1}
.responsive-bar{display:flex;gap:4px;padding:8px 12px;background:#161a1e;border-bottom:1px solid #2a2f35}
.rp-btn{background:#1e2329;border:1px solid #2a2f35;color:#777;padding:3px 10px;border-radius:3px;cursor:pointer;font-size:0.68rem;font-family:inherit}
.rp-btn:hover{border-color:#00d2d3;color:#00d2d3}
.rp-btn.active{border-color:#00d2d3;color:#00d2d3;background:#00d2d311}
.status-bar{background:#0a0c0e;border-top:1px solid #2a2f35;padding:4px 16px;font-size:0.62rem;color:#556;display:flex;justify-content:space-between;flex-shrink:0}
.help-text{background:#1a1e24;border:1px solid #2a2f35;border-radius:4px;padding:8px;font-size:0.68rem;color:#888;line-height:1.5;margin-bottom:10px}
.help-text code{background:#0e1113;padding:1px 4px;border-radius:2px;color:#00d2d3;font-family:'Courier New',monospace}
.visual-canvas{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none}
@media(max-width:768px){.sidebar{width:220px}.code-panel{flex-direction:column;max-height:300px}.main{flex-direction:column}.sidebar{max-height:40vh;width:100%}}
</style>
</head>
<body>
<div class="app">
  <header>
    <h1>LAYOUTLAB</h1>
    <div class="tabs">
      <div class="tab active" data-tab="sandbox" onclick="switchTab('sandbox')">Sandbox</div>
      <div class="tab" data-tab="challenges" onclick="switchTab('challenges')">Challenges</div>
      <div class="tab" data-tab="learn" onclick="switchTab('learn')">Learn</div>
    </div>
    <div class="toolbar">
      <button class="tb-btn" onclick="copyCSS()">Copy CSS</button>
      <button class="tb-btn" onclick="copyHTML()">Copy HTML</button>
      <button class="tb-btn" onclick="saveLayout()">Save</button>
      <button class="tb-btn" onclick="loadLayout()">Load</button>
      <button class="tb-btn" onclick="resetLayout()">Reset</button>
    </div>
  </header>
  <div class="responsive-bar">
    <button class="rp-btn active" data-w="100%" onclick="setWidth(this,'100%')">Desktop</button>
    <button class="rp-btn" data-w="768px" onclick="setWidth(this,'768px')">Tablet</button>
    <button class="rp-btn" data-w="375px" onclick="setWidth(this,'375px')">Mobile</button>
    <button class="rp-btn" data-w="320px" onclick="setWidth(this,'320px')">Small</button>
    <span style="margin-left:auto;color:#556;font-size:0.68rem" id="sizeLabel">Width: 100%</span>
  </div>
  <div class="main">
    <div class="sidebar" id="sidebarContent">
      <!-- Populated by tab -->
    </div>
    <div class="content">
      <div class="preview-area" id="previewArea">
        <div id="preview" style="width:100%;height:100%;min-height:300px;transition:width 0.3s"></div>
      </div>
      <div class="code-panel">
        <div class="code-section">
          <h4>CSS</h4>
          <pre id="cssOut"></pre>
        </div>
        <div class="code-section">
          <h4>HTML</h4>
          <pre id="htmlOut"></pre>
        </div>
      </div>
    </div>
  </div>
  <div class="status-bar">
    <span id="statusText">LayoutLab - Interactive CSS Grid & Flexbox studio</span>
    <span id="itemCount">4 items</span>
  </div>
</div>
<div class="toast" id="toast"></div>
<script>
// === AUDIO ===
const AU={ctx:null,mg:null,en:true};
function initAu(){try{AU.ctx=new(window.AudioContext||window.webkitAudioContext)();AU.mg=AU.ctx.createGain();AU.mg.gain.value=0.06;AU.mg.connect(AU.ctx.destination)}catch(e){AU.en=false}}
function sfx(t){
  if(!AU.en||!AU.ctx)return;if(AU.ctx.state==='suspended')AU.ctx.resume();
  const n=AU.ctx.currentTime,o=AU.ctx.createOscillator(),g=AU.ctx.createGain();
  o.connect(g);g.connect(AU.mg);
  switch(t){
    case'click':o.type='sine';o.frequency.setValueAtTime(600,n);g.gain.setValueAtTime(0.12,n);g.gain.exponentialRampToValueAtTime(0.001,n+0.06);o.start(n);o.stop(n+0.06);break;
    case'add':o.type='sine';o.frequency.setValueAtTime(523,n);o.frequency.setValueAtTime(659,n+0.06);g.gain.setValueAtTime(0.15,n);g.gain.exponentialRampToValueAtTime(0.001,n+0.12);o.start(n);o.stop(n+0.12);break;
    case'delete':o.type='sine';o.frequency.setValueAtTime(400,n);o.frequency.exponentialRampToValueAtTime(200,n+0.1);g.gain.setValueAtTime(0.12,n);g.gain.exponentialRampToValueAtTime(0.001,n+0.12);o.start(n);o.stop(n+0.12);break;
    case'save':o.type='sine';o.frequency.setValueAtTime(440,n);o.frequency.setValueAtTime(554,n+0.08);o.frequency.setValueAtTime(659,n+0.16);g.gain.setValueAtTime(0.15,n);g.gain.exponentialRampToValueAtTime(0.001,n+0.25);o.start(n);o.stop(n+0.25);break;
    case'complete':o.type='sine';o.frequency.setValueAtTime(523,n);o.frequency.setValueAtTime(659,n+0.1);o.frequency.setValueAtTime(784,n+0.2);o.frequency.setValueAtTime(1047,n+0.3);g.gain.setValueAtTime(0.2,n);g.gain.exponentialRampToValueAtTime(0.001,n+0.5);o.start(n);o.stop(n+0.5);break;
    case'preset':o.type='sine';o.frequency.setValueAtTime(600,n);o.frequency.exponentialRampToValueAtTime(900,n+0.08);g.gain.setValueAtTime(0.15,n);g.gain.exponentialRampToValueAtTime(0.001,n+0.1);o.start(n);o.stop(n+0.1);break;
  }
}

// === COLORS ===
const COLORS=['#00d2d3','#ff6347','#4169e1','#ffa500','#2ecc71','#e056a0','#9b59b6','#f1c40f','#1abc9c','#e74c3c','#3498db','#27ae60'];

// === STATE ===
let layoutMode='grid'; // grid or flex
let currentTab='sandbox';
let items=[];
let gridConfig={
  cols:'1fr 1fr 1fr',rows:'auto',colGap:'10px',rowGap:'10px',
  justifyItems:'stretch',alignItems:'stretch',justifyContent:'stretch',alignContent:'stretch',
  areas:''
};
let flexConfig={
  direction:'row',wrap:'wrap',justifyContent:'flex-start',alignItems:'stretch',
  gap:'10px'
};
let completedChallenges=JSON.parse(localStorage.getItem('layoutlab_completed')||'[]');

// Default items
function defaultItems(){
  return[
    {name:'Header',colStart:'',colEnd:'',rowStart:'',rowEnd:'',area:'',flexGrow:'0',flexShrink:'1',flexBasis:'auto',order:'',alignSelf:'',color:COLORS[0]},
    {name:'Sidebar',colStart:'',colEnd:'',rowStart:'',rowEnd:'',area:'',flexGrow:'0',flexShrink:'1',flexBasis:'auto',order:'',alignSelf:'',color:COLORS[1]},
    {name:'Main',colStart:'',colEnd:'',rowStart:'',rowEnd:'',area:'',flexGrow:'1',flexShrink:'1',flexBasis:'auto',order:'',alignSelf:'',color:COLORS[2]},
    {name:'Footer',colStart:'',colEnd:'',rowStart:'',rowEnd:'',area:'',flexGrow:'0',flexShrink:'1',flexBasis:'auto',order:'',alignSelf:'',color:COLORS[3]}
  ];
}
items=JSON.parse(localStorage.getItem('layoutlab_items')||'null')||defaultItems();

// === PRESETS ===
const PRESETS={
  'holy-grail':{label:'Holy Grail',mode:'grid',config:{cols:'200px 1fr 200px',rows:'60px 1fr 50px',areas:'header header header\nsidebar main aside\nfooter footer footer'},items:[{name:'Header',area:'header'},{name:'Sidebar',area:'sidebar'},{name:'Main',area:'main'},{name:'Aside',area:'aside'},{name:'Footer',area:'footer'}]},
  'dashboard':{label:'Dashboard',mode:'grid',config:{cols:'repeat(4, 1fr)',rows:'60px repeat(3, 1fr)',areas:'nav nav nav nav\ncard1 card2 card3 card4\nchart chart table table\nchart chart table table'},items:[{name:'Nav',area:'nav'},{name:'Card 1',area:'card1'},{name:'Card 2',area:'card2'},{name:'Card 3',area:'card3'},{name:'Card 4',area:'card4'},{name:'Chart',area:'chart'},{name:'Table',area:'table'}]},
  'gallery':{label:'Gallery',mode:'grid',config:{cols:'repeat(auto-fill, minmax(150px, 1fr))',rows:'',areas:''},items:Array.from({length:8},(_,i)=>({name:'Photo '+(i+1)}))},
  'sidebar-layout':{label:'Sidebar',mode:'grid',config:{cols:'250px 1fr',rows:'1fr',areas:''},items:[{name:'Sidebar'},{name:'Content'}]},
  'cards':{label:'Cards',mode:'grid',config:{cols:'repeat(3, 1fr)',rows:'repeat(2, 200px)',areas:''},items:Array.from({length:6},(_,i)=>({name:'Card '+(i+1)}))},
  'navbar':{label:'Navbar',mode:'flex',flexConfig:{direction:'row',wrap:'nowrap',justifyContent:'space-between',alignItems:'center',gap:'8px'},items:[{name:'Logo',flexGrow:'0',flexBasis:'100px'},{name:'Nav Links',flexGrow:'1'},{name:'Actions',flexGrow:'0',flexBasis:'120px'}]},
  'centered':{label:'Centered',mode:'flex',flexConfig:{direction:'column',wrap:'nowrap',justifyContent:'center',alignItems:'center',gap:'16px'},items:[{name:'Title',flexGrow:'0'},{name:'Content',flexGrow:'0'},{name:'Button',flexGrow:'0'}]},
  'masonry':{label:'Masonry',mode:'grid',config:{cols:'repeat(3, 1fr)',rows:'auto',areas:''},items:[{name:'Tall',rowEnd:'span 2'},{name:'Short'},{name:'Medium'},{name:'Short'},{name:'Tall',rowEnd:'span 2'},{name:'Short'},{name:'Medium'},{name:'Short'}]},
  'footer':{label:'Footer',mode:'flex',flexConfig:{direction:'row',wrap:'wrap',justifyContent:'space-between',alignItems:'flex-start',gap:'24px'},items:[{name:'About',flexBasis:'200px',flexGrow:'1'},{name:'Links',flexBasis:'150px',flexGrow:'1'},{name:'Social',flexBasis:'150px',flexGrow:'1'},{name:'Contact',flexBasis:'200px',flexGrow:'1'}]}
};

// === CHALLENGES ===
const CHALLENGES=[
  {id:'ch1',title:'Basic Grid',desc:'Create a 3-column equal-width grid with 10px gap',difficulty:'easy',
    check:()=>gridConfig.cols.includes('1fr 1fr 1fr')&&gridConfig.colGap==='10px'},
  {id:'ch2',title:'Holy Grail Layout',desc:'Create a header, sidebar, main content, and footer layout using grid-template-areas',difficulty:'medium',
    check:()=>gridConfig.areas.includes('header')&&gridConfig.areas.includes('sidebar')&&gridConfig.areas.includes('main')&&gridConfig.areas.includes('footer')},
  {id:'ch3',title:'Responsive Gallery',desc:'Use auto-fill and minmax to create a responsive photo gallery',difficulty:'medium',
    check:()=>gridConfig.cols.includes('auto-fill')&&gridConfig.cols.includes('minmax')},
  {id:'ch4',title:'Centered Content',desc:'Center a single item both horizontally and vertically using flexbox',difficulty:'easy',
    check:()=>layoutMode==='flex'&&flexConfig.justifyContent==='center'&&flexConfig.alignItems==='center'},
  {id:'ch5',title:'Navbar Layout',desc:'Create a horizontal navbar with space-between and items centered vertically',difficulty:'easy',
    check:()=>layoutMode==='flex'&&flexConfig.direction==='row'&&flexConfig.justifyContent==='space-between'&&flexConfig.alignItems==='center'},
  {id:'ch6',title:'Column Spanning',desc:'Make an item span across 2 columns in a grid',difficulty:'medium',
    check:()=>items.some(it=>it.colEnd==='span 2'||it.colEnd==='3')},
  {id:'ch7',title:'Flex Grow Ratio',desc:'Create 3 items where the middle one takes 2x the space of the others',difficulty:'hard',
    check:()=>layoutMode==='flex'&&items.length>=3&&items[1]&&parseInt(items[1].flexGrow||0)>=2},
  {id:'ch8',title:'Asymmetric Grid',desc:'Create a grid with columns: 1fr 2fr 1fr (asymmetric widths)',difficulty:'easy',
    check:()=>gridConfig.cols==='1fr 2fr 1fr'},
  {id:'ch9',title:'Fixed + Flexible',desc:'Create a sidebar with fixed 250px width next to a flexible main area',difficulty:'medium',
    check:()=>gridConfig.cols.includes('250px')&&gridConfig.cols.includes('1fr')},
  {id:'ch10',title:'Reverse Order',desc:'Use flex-direction reverse to show items in reverse order',difficulty:'hard',
    check:()=>layoutMode==='flex'&&(flexConfig.direction==='row-reverse'||flexConfig.direction==='column-reverse')}
];

// === RENDERING ===
function renderSandbox(){
  const sb=document.getElementById('sidebarContent');
  let html='';
  // Mode toggle
  html+='<div class="row" style="margin-bottom:12px"><button class="btn" style="flex:1;background:'+(layoutMode==='grid'?'#00d2d3':'#1e2329')+';color:'+(layoutMode==='grid'?'#0e1113':'#aaa')+'" onclick="setMode(\'grid\')">CSS Grid</button><button class="btn" style="flex:1;background:'+(layoutMode==='flex'?'#00d2d3':'#1e2329')+';color:'+(layoutMode==='flex'?'#0e1113':'#aaa')+'" onclick="setMode(\'flex\')">Flexbox</button></div>';

  // Presets
  html+='<h3>Presets</h3><div class="preset-grid">';
  Object.entries(PRESETS).forEach(([key,preset])=>{
    const cols=preset.mode==='grid'?3:preset.items.length;
    html+='<div class="preset-card" onclick="applyPreset(\''+key+'\')"><div class="preview" style="grid-template-columns:repeat('+Math.min(cols,4)+',1fr)">';
    for(let i=0;i<Math.min(preset.items.length,6);i++)html+='<div></div>';
    html+='</div><span>'+preset.label+'</span></div>';
  });
  html+='</div>';

  // Container properties
  if(layoutMode==='grid'){
    html+='<h3>Grid Container</h3>';
    html+='<div class="field"><label>Columns</label><input id="cfg_cols" value="'+escH(gridConfig.cols)+'" oninput="gridConfig.cols=this.value;update()"></div>';
    html+='<div class="field"><label>Rows</label><input id="cfg_rows" value="'+escH(gridConfig.rows)+'" oninput="gridConfig.rows=this.value;update()"></div>';
    html+='<div class="row"><div class="field"><label>Col Gap</label><input id="cfg_cg" value="'+gridConfig.colGap+'" oninput="gridConfig.colGap=this.value;update()"></div><div class="field"><label>Row Gap</label><input id="cfg_rg" value="'+gridConfig.rowGap+'" oninput="gridConfig.rowGap=this.value;update()"></div></div>';
    html+='<div class="row"><div class="field"><label>Justify Items</label><select onchange="gridConfig.justifyItems=this.value;update()">'+['stretch','start','end','center'].map(o=>'<option'+(gridConfig.justifyItems===o?' selected':'')+'>'+o+'</option>').join('')+'</select></div>';
    html+='<div class="field"><label>Align Items</label><select onchange="gridConfig.alignItems=this.value;update()">'+['stretch','start','end','center'].map(o=>'<option'+(gridConfig.alignItems===o?' selected':'')+'>'+o+'</option>').join('')+'</select></div></div>';
    html+='<div class="row"><div class="field"><label>Justify Content</label><select onchange="gridConfig.justifyContent=this.value;update()">'+['stretch','start','end','center','space-between','space-around','space-evenly'].map(o=>'<option'+(gridConfig.justifyContent===o?' selected':'')+'>'+o+'</option>').join('')+'</select></div>';
    html+='<div class="field"><label>Align Content</label><select onchange="gridConfig.alignContent=this.value;update()">'+['stretch','start','end','center','space-between','space-around','space-evenly'].map(o=>'<option'+(gridConfig.alignContent===o?' selected':'')+'>'+o+'</option>').join('')+'</select></div></div>';
    html+='<div class="field"><label>Template Areas</label><textarea id="cfg_areas" oninput="gridConfig.areas=this.value;update()">'+escH(gridConfig.areas)+'</textarea></div>';
  }else{
    html+='<h3>Flex Container</h3>';
    html+='<div class="row"><div class="field"><label>Direction</label><select onchange="flexConfig.direction=this.value;update()">'+['row','row-reverse','column','column-reverse'].map(o=>'<option'+(flexConfig.direction===o?' selected':'')+'>'+o+'</option>').join('')+'</select></div>';
    html+='<div class="field"><label>Wrap</label><select onchange="flexConfig.wrap=this.value;update()">'+['nowrap','wrap','wrap-reverse'].map(o=>'<option'+(flexConfig.wrap===o?' selected':'')+'>'+o+'</option>').join('')+'</select></div></div>';
    html+='<div class="row"><div class="field"><label>Justify Content</label><select onchange="flexConfig.justifyContent=this.value;update()">'+['flex-start','flex-end','center','space-between','space-around','space-evenly'].map(o=>'<option'+(flexConfig.justifyContent===o?' selected':'')+'>'+o+'</option>').join('')+'</select></div>';
    html+='<div class="field"><label>Align Items</label><select onchange="flexConfig.alignItems=this.value;update()">'+['stretch','flex-start','flex-end','center','baseline'].map(o=>'<option'+(flexConfig.alignItems===o?' selected':'')+'>'+o+'</option>').join('')+'</select></div></div>';
    html+='<div class="field"><label>Gap</label><input value="'+flexConfig.gap+'" oninput="flexConfig.gap=this.value;update()"></div>';
  }

  html+='<hr style="border-color:#2a2f35;margin:12px 0">';
  html+='<h3>Items <button class="btn-add" onclick="addItem()">+ Add Item</button></h3>';
  html+='<div class="items-list" id="itemsList">';
  items.forEach((it,i)=>{
    html+='<div class="item-row"><div class="item-color" style="background:'+it.color+'" onclick="cycleColor('+i+')"></div>';
    html+='<input value="'+escH(it.name)+'" data-i="'+i+'" data-f="name" style="width:60px" oninput="items['+i+'].name=this.value;update()">';
    if(layoutMode==='grid'){
      html+='<span style="color:#556;font-size:.65rem">col:</span><input value="'+escH(it.colStart||'')+'" data-i="'+i+'" style="width:26px" oninput="items['+i+'].colStart=this.value;update()" placeholder="-">';
      html+='<span style="color:#444">/</span><input value="'+escH(it.colEnd||'')+'" style="width:35px" oninput="items['+i+'].colEnd=this.value;update()" placeholder="-">';
      html+='<span style="color:#556;font-size:.65rem">row:</span><input value="'+escH(it.rowStart||'')+'" style="width:26px" oninput="items['+i+'].rowStart=this.value;update()" placeholder="-">';
      html+='<span style="color:#444">/</span><input value="'+escH(it.rowEnd||'')+'" style="width:35px" oninput="items['+i+'].rowEnd=this.value;update()" placeholder="-">';
      if(gridConfig.areas)html+='<input value="'+escH(it.area||'')+'" style="width:50px" oninput="items['+i+'].area=this.value;update()" placeholder="area">';
    }else{
      html+='<span style="color:#556;font-size:.65rem">grow:</span><input value="'+escH(it.flexGrow||'0')+'" style="width:26px" oninput="items['+i+'].flexGrow=this.value;update()">';
      html+='<span style="color:#556;font-size:.65rem">basis:</span><input value="'+escH(it.flexBasis||'auto')+'" style="width:45px" oninput="items['+i+'].flexBasis=this.value;update()">';
      html+='<span style="color:#556;font-size:.65rem">ord:</span><input value="'+escH(it.order||'')+'" style="width:26px" oninput="items['+i+'].order=this.value;update()" placeholder="-">';
    }
    html+='<button class="btn-sm" onclick="removeItem('+i+')">x</button></div>';
  });
  html+='</div>';

  sb.innerHTML=html;
}

function renderChallenges(){
  const sb=document.getElementById('sidebarContent');
  let html='<h3>Layout Challenges</h3>';
  html+='<div class="help-text">Complete challenges by modifying the layout in sandbox mode. Click a challenge to see its requirements, then switch to Sandbox to build it.</div>';
  CHALLENGES.forEach(ch=>{
    const done=completedChallenges.includes(ch.id);
    html+='<div class="challenge-card'+(done?' completed':'')+'" onclick="selectChallenge(\''+ch.id+'\')">';
    html+='<h4>'+(done?'[done] ':'')+ch.title+'</h4>';
    html+='<p>'+ch.desc+'</p>';
    html+='<span class="badge '+ch.difficulty+'">'+ch.difficulty.toUpperCase()+'</span>';
    html+='</div>';
  });
  html+='<br><button class="btn" onclick="checkChallenges()">Check All Challenges</button>';
  html+='<div style="margin-top:8px;font-size:0.72rem;color:#556">Completed: '+completedChallenges.length+'/'+CHALLENGES.length+'</div>';
  sb.innerHTML=html;
}

function renderLearn(){
  const sb=document.getElementById('sidebarContent');
  let html='<h3>CSS Grid Cheatsheet</h3>';
  html+='<div class="help-text"><strong>Container:</strong><br><code>grid-template-columns</code>: Define column widths<br>- <code>1fr</code> = 1 fraction of space<br>- <code>repeat(3, 1fr)</code> = 3 equal columns<br>- <code>auto-fill</code> = fill available space<br>- <code>minmax(150px, 1fr)</code> = responsive</div>';
  html+='<div class="help-text"><strong>Items:</strong><br><code>grid-column: 1 / 3</code> = span cols 1-2<br><code>grid-column: span 2</code> = span 2 cols<br><code>grid-area: name</code> = place in named area</div>';
  html+='<div class="help-text"><strong>Alignment:</strong><br><code>justify-items</code>: horizontal within cell<br><code>align-items</code>: vertical within cell<br><code>justify-content</code>: horizontal grid in container<br><code>align-content</code>: vertical grid in container</div>';
  html+='<hr style="border-color:#2a2f35;margin:12px 0"><h3>Flexbox Cheatsheet</h3>';
  html+='<div class="help-text"><strong>Container:</strong><br><code>flex-direction</code>: row | column | reverse<br><code>flex-wrap</code>: nowrap | wrap<br><code>justify-content</code>: how items distribute on main axis<br><code>align-items</code>: alignment on cross axis</div>';
  html+='<div class="help-text"><strong>Items:</strong><br><code>flex-grow</code>: how much extra space to take<br><code>flex-shrink</code>: how much to shrink<br><code>flex-basis</code>: initial size<br><code>order</code>: visual order<br><code>align-self</code>: override alignment</div>';
  html+='<div class="help-text"><strong>Common Patterns:</strong><br>Center: <code>justify-content: center; align-items: center</code><br>Space out: <code>justify-content: space-between</code><br>Equal cols: <code>flex: 1</code> on each item</div>';
  sb.innerHTML=html;
}

// === UPDATE ===
function update(){
  if(!AU.ctx)initAu();
  saveState();
  renderPreview();
  generateCode();
  document.getElementById('itemCount').textContent=items.length+' items | '+layoutMode.toUpperCase();
}

function renderPreview(){
  const preview=document.getElementById('preview');
  const container=document.createElement('div');

  if(layoutMode==='grid'){
    container.style.cssText='display:grid;grid-template-columns:'+gridConfig.cols+';grid-template-rows:'+(gridConfig.rows||'auto')+';column-gap:'+gridConfig.colGap+';row-gap:'+gridConfig.rowGap+';justify-items:'+gridConfig.justifyItems+';align-items:'+gridConfig.alignItems+';justify-content:'+gridConfig.justifyContent+';align-content:'+gridConfig.alignContent+';width:100%;height:100%;min-height:300px;';
    if(gridConfig.areas){
      container.style.gridTemplateAreas=gridConfig.areas.split('\n').map(l=>'"'+l.trim()+'"').join(' ');
    }
  }else{
    container.style.cssText='display:flex;flex-direction:'+flexConfig.direction+';flex-wrap:'+flexConfig.wrap+';justify-content:'+flexConfig.justifyContent+';align-items:'+flexConfig.alignItems+';gap:'+flexConfig.gap+';width:100%;height:100%;min-height:300px;';
  }

  items.forEach((it,i)=>{
    const div=document.createElement('div');
    div.style.cssText='background:'+it.color+'22;border:2px solid '+it.color+';border-radius:6px;padding:12px;display:flex;align-items:center;justify-content:center;font-weight:600;color:'+it.color+';font-size:0.85rem;min-height:40px;transition:all 0.3s;';
    if(layoutMode==='grid'){
      if(it.colStart)div.style.gridColumnStart=it.colStart;
      if(it.colEnd)div.style.gridColumnEnd=it.colEnd;
      if(it.rowStart)div.style.gridRowStart=it.rowStart;
      if(it.rowEnd)div.style.gridRowEnd=it.rowEnd;
      if(it.area)div.style.gridArea=it.area;
    }else{
      if(it.flexGrow)div.style.flexGrow=it.flexGrow;
      if(it.flexShrink)div.style.flexShrink=it.flexShrink||'1';
      if(it.flexBasis&&it.flexBasis!=='auto')div.style.flexBasis=it.flexBasis;
      if(it.order)div.style.order=it.order;
      if(it.alignSelf)div.style.alignSelf=it.alignSelf;
    }
    div.textContent=it.name||('Item '+(i+1));
    container.appendChild(div);
  });

  preview.innerHTML='';
  preview.appendChild(container);
}

function generateCode(){
  let css='',html='';
  if(layoutMode==='grid'){
    css='.container {\n  display: grid;\n  grid-template-columns: '+gridConfig.cols+';\n  grid-template-rows: '+(gridConfig.rows||'auto')+';\n  column-gap: '+gridConfig.colGap+';\n  row-gap: '+gridConfig.rowGap+';';
    if(gridConfig.justifyItems!=='stretch')css+='\n  justify-items: '+gridConfig.justifyItems+';';
    if(gridConfig.alignItems!=='stretch')css+='\n  align-items: '+gridConfig.alignItems+';';
    if(gridConfig.justifyContent!=='stretch')css+='\n  justify-content: '+gridConfig.justifyContent+';';
    if(gridConfig.alignContent!=='stretch')css+='\n  align-content: '+gridConfig.alignContent+';';
    if(gridConfig.areas)css+='\n  grid-template-areas:\n    '+gridConfig.areas.split('\n').map(l=>'"'+l.trim()+'"').join('\n    ')+';';
    css+='\n}\n';
    items.forEach((it,i)=>{
      const sel='.'+(it.name||'item-'+(i+1)).toLowerCase().replace(/\s+/g,'-');
      let props=[];
      if(it.colStart&&it.colEnd)props.push('grid-column: '+it.colStart+' / '+it.colEnd);
      else if(it.colStart)props.push('grid-column-start: '+it.colStart);
      else if(it.colEnd)props.push('grid-column-end: '+it.colEnd);
      if(it.rowStart&&it.rowEnd)props.push('grid-row: '+it.rowStart+' / '+it.rowEnd);
      else if(it.rowStart)props.push('grid-row-start: '+it.rowStart);
      else if(it.rowEnd)props.push('grid-row-end: '+it.rowEnd);
      if(it.area)props.push('grid-area: '+it.area);
      if(props.length)css+='\n'+sel+' {\n  '+props.join(';\n  ')+';\n}\n';
    });
  }else{
    css='.container {\n  display: flex;\n  flex-direction: '+flexConfig.direction+';\n  flex-wrap: '+flexConfig.wrap+';\n  justify-content: '+flexConfig.justifyContent+';\n  align-items: '+flexConfig.alignItems+';\n  gap: '+flexConfig.gap+';\n}\n';
    items.forEach((it,i)=>{
      const sel='.'+(it.name||'item-'+(i+1)).toLowerCase().replace(/\s+/g,'-');
      let props=[];
      if(it.flexGrow&&it.flexGrow!=='0')props.push('flex-grow: '+it.flexGrow);
      if(it.flexBasis&&it.flexBasis!=='auto')props.push('flex-basis: '+it.flexBasis);
      if(it.order)props.push('order: '+it.order);
      if(it.alignSelf)props.push('align-self: '+it.alignSelf);
      if(props.length)css+='\n'+sel+' {\n  '+props.join(';\n  ')+';\n}\n';
    });
  }

  html='<div class="container">\n';
  items.forEach((it,i)=>{
    const cls=(it.name||'item-'+(i+1)).toLowerCase().replace(/\s+/g,'-');
    html+='  <div class="'+cls+'">'+(it.name||'Item '+(i+1))+'</div>\n';
  });
  html+='</div>';

  document.getElementById('cssOut').textContent=css;
  document.getElementById('htmlOut').textContent=html;
}

// === ACTIONS ===
function setMode(m){layoutMode=m;sfx('click');renderSandbox();update();}
function addItem(){items.push({name:'Item '+(items.length+1),colStart:'',colEnd:'',rowStart:'',rowEnd:'',area:'',flexGrow:'0',flexShrink:'1',flexBasis:'auto',order:'',alignSelf:'',color:COLORS[items.length%COLORS.length]});sfx('add');renderSandbox();update();}
function removeItem(i){items.splice(i,1);sfx('delete');renderSandbox();update();}
function cycleColor(i){const ci=COLORS.indexOf(items[i].color);items[i].color=COLORS[(ci+1)%COLORS.length];sfx('click');renderSandbox();update();}

function applyPreset(key){
  const p=PRESETS[key];if(!p)return;
  layoutMode=p.mode;
  if(p.mode==='grid'&&p.config){
    gridConfig={...gridConfig,...p.config,colGap:gridConfig.colGap,rowGap:gridConfig.rowGap};
  }
  if(p.mode==='flex'&&p.flexConfig){
    flexConfig={...flexConfig,...p.flexConfig};
  }
  items=p.items.map((it,i)=>({name:it.name||'Item '+(i+1),colStart:it.colStart||'',colEnd:it.colEnd||'',rowStart:it.rowStart||'',rowEnd:it.rowEnd||'',area:it.area||'',flexGrow:it.flexGrow||'0',flexShrink:it.flexShrink||'1',flexBasis:it.flexBasis||'auto',order:it.order||'',alignSelf:it.alignSelf||'',color:COLORS[i%COLORS.length]}));
  sfx('preset');renderSandbox();update();
}

function switchTab(tab){
  currentTab=tab;
  document.querySelectorAll('.tab').forEach(t=>t.classList.toggle('active',t.dataset.tab===tab));
  if(tab==='sandbox')renderSandbox();
  else if(tab==='challenges')renderChallenges();
  else if(tab==='learn')renderLearn();
}

function setWidth(btn,w){
  document.querySelectorAll('.rp-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('preview').style.width=w;
  document.getElementById('sizeLabel').textContent='Width: '+w;
  sfx('click');
}

function selectChallenge(id){
  const ch=CHALLENGES.find(c=>c.id===id);
  if(!ch)return;
  toast('Challenge: '+ch.desc);
  switchTab('sandbox');
}

function checkChallenges(){
  let newlyCompleted=0;
  CHALLENGES.forEach(ch=>{
    if(!completedChallenges.includes(ch.id)&&ch.check()){
      completedChallenges.push(ch.id);
      newlyCompleted++;
    }
  });
  localStorage.setItem('layoutlab_completed',JSON.stringify(completedChallenges));
  if(newlyCompleted>0){sfx('complete');toast(newlyCompleted+' challenge(s) completed!');}
  else toast('No new challenges completed. Keep trying!');
  renderChallenges();
}

function copyCSS(){
  navigator.clipboard.writeText(document.getElementById('cssOut').textContent).then(()=>{sfx('save');toast('CSS copied to clipboard');});
}
function copyHTML(){
  navigator.clipboard.writeText(document.getElementById('htmlOut').textContent).then(()=>{sfx('save');toast('HTML copied to clipboard');});
}

function saveLayout(){
  localStorage.setItem('layoutlab_state',JSON.stringify({layoutMode,gridConfig,flexConfig,items}));
  sfx('save');toast('Layout saved');
}
function loadLayout(){
  try{
    const data=JSON.parse(localStorage.getItem('layoutlab_state'));
    if(!data){toast('No saved layout');return;}
    layoutMode=data.layoutMode||'grid';
    gridConfig=data.gridConfig||gridConfig;
    flexConfig=data.flexConfig||flexConfig;
    items=data.items||defaultItems();
    sfx('save');toast('Layout loaded');
    renderSandbox();update();
  }catch(e){toast('Failed to load layout');}
}
function resetLayout(){
  items=defaultItems();
  gridConfig={cols:'1fr 1fr 1fr',rows:'auto',colGap:'10px',rowGap:'10px',justifyItems:'stretch',alignItems:'stretch',justifyContent:'stretch',alignContent:'stretch',areas:''};
  flexConfig={direction:'row',wrap:'wrap',justifyContent:'flex-start',alignItems:'stretch',gap:'10px'};
  layoutMode='grid';
  sfx('delete');renderSandbox();update();
}

function saveState(){
  localStorage.setItem('layoutlab_items',JSON.stringify(items));
  localStorage.setItem('layoutlab_mode',layoutMode);
}

function escH(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}

function toast(text){
  const el=document.getElementById('toast');
  el.textContent=text;el.classList.add('show');
  setTimeout(()=>el.classList.remove('show'),2000);
}

// === KEYBOARD ===
window.addEventListener('keydown',e=>{
  if(e.key==='s'&&(e.ctrlKey||e.metaKey)){e.preventDefault();saveLayout();}
});

// === INIT ===
renderSandbox();
update();
</script>
</body>
</html>