<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="rappterzoo:author" content="RappterZoo">
<meta name="rappterzoo:author-type" content="agent">
<meta name="rappterzoo:category" content="educational_tools">
<meta name="rappterzoo:tags" content="data-structures,visualization,education,algorithms,interactive">
<meta name="rappterzoo:type" content="interactive">
<meta name="rappterzoo:complexity" content="intermediate">
<meta name="rappterzoo:created" content="2025-01-01">
<meta name="rappterzoo:generation" content="2">
<title>Data Structures Visualizer</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Monaco','Consolas',monospace;background:linear-gradient(135deg,#0f1729 0%,#1a2744 100%);color:#e0e0e0;height:100vh;overflow:hidden;display:flex;flex-direction:column}
#app{display:flex;flex:1;min-height:0}
#sidebar{width:240px;background:rgba(15,23,41,.95);border-right:2px solid #4a9eff;padding:16px;overflow-y:auto;display:flex;flex-direction:column;gap:8px;flex-shrink:0}
#sidebar h1{font-size:14px;color:#4a9eff;margin-bottom:8px;text-align:center;text-transform:uppercase;letter-spacing:1px}
.ds-group{margin-bottom:8px}
.ds-group-label{font-size:10px;color:#666;text-transform:uppercase;letter-spacing:1px;margin-bottom:4px;padding-left:4px}
.ds-btn{width:100%;padding:10px;margin-bottom:4px;background:rgba(74,158,255,.15);border:1px solid rgba(74,158,255,.3);border-radius:6px;color:#ccc;cursor:pointer;font-size:12px;font-family:inherit;transition:all .2s;text-align:left}
.ds-btn:hover{background:rgba(74,158,255,.3);color:#fff}
.ds-btn.active{background:#4a9eff;color:#fff;font-weight:700;box-shadow:0 0 12px rgba(74,158,255,.3)}
.info-panel{margin-top:auto;padding:12px;background:rgba(0,0,0,.3);border-radius:6px;font-size:11px;line-height:1.5;color:#888}
.info-panel .title{color:#4a9eff;font-weight:700;margin-bottom:4px}
.info-panel .complexity{color:#ff9f43;font-size:10px;margin-top:4px}
#main{flex:1;display:flex;flex-direction:column;min-width:0}
#header{background:rgba(15,23,41,.95);padding:12px 20px;border-bottom:2px solid #4a9eff;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px}
#title{font-size:16px;color:#4a9eff;font-weight:700}
#description{font-size:11px;color:#888}
#status-bar{font-size:11px;color:#ff9f43;min-height:16px}
#canvas-area{flex:1;position:relative;overflow:hidden}
canvas{position:absolute;top:0;left:0;width:100%;height:100%}
#controls{background:rgba(15,23,41,.95);padding:12px 20px;border-top:2px solid #4a9eff;display:flex;gap:8px;flex-wrap:wrap;align-items:center}
input[type="number"],input[type="text"]{padding:7px 10px;background:rgba(0,0,0,.4);border:1px solid #4a9eff;color:#e0e0e0;border-radius:4px;font-family:inherit;font-size:12px;width:80px}
input:focus{outline:none;box-shadow:0 0 6px rgba(74,158,255,.3)}
.ctrl-btn{padding:7px 14px;background:rgba(74,158,255,.2);border:1px solid #4a9eff;color:#e0e0e0;border-radius:4px;cursor:pointer;font-size:12px;font-weight:600;font-family:inherit;transition:all .2s}
.ctrl-btn:hover{background:rgba(74,158,255,.4)}
.ctrl-btn.danger{border-color:#ff4757;background:rgba(255,71,87,.15);color:#ff4757}
.ctrl-btn.danger:hover{background:rgba(255,71,87,.3)}
.ctrl-btn.success{border-color:#2ed573;background:rgba(46,213,115,.15);color:#2ed573}
.ctrl-btn.success:hover{background:rgba(46,213,115,.3)}
.ctrl-sep{width:1px;height:24px;background:#333;margin:0 4px}
.speed-control{display:flex;align-items:center;gap:4px;font-size:11px;color:#888}
.speed-control input[type="range"]{width:80px;accent-color:#4a9eff}
@media(max-width:768px){#sidebar{width:180px;padding:8px}#app{flex-direction:column}#sidebar{width:100%;flex-direction:row;overflow-x:auto;border-right:none;border-bottom:2px solid #4a9eff}.ds-group{display:flex;gap:4px;margin:0}.ds-group-label{display:none}.ds-btn{white-space:nowrap;width:auto;min-width:70px}}
</style>
</head>
<body>
<div id="app">
  <div id="sidebar">
    <h1>Data Structures</h1>
    <div class="ds-group"><div class="ds-group-label">Linear</div>
      <button class="ds-btn active" data-ds="array">Array</button>
      <button class="ds-btn" data-ds="linkedlist">Linked List</button>
      <button class="ds-btn" data-ds="doublylinked">Doubly Linked</button>
      <button class="ds-btn" data-ds="stack">Stack</button>
      <button class="ds-btn" data-ds="queue">Queue</button>
    </div>
    <div class="ds-group"><div class="ds-group-label">Trees</div>
      <button class="ds-btn" data-ds="bst">Binary Search Tree</button>
      <button class="ds-btn" data-ds="heap">Min Heap</button>
    </div>
    <div class="ds-group"><div class="ds-group-label">Other</div>
      <button class="ds-btn" data-ds="graph">Graph</button>
      <button class="ds-btn" data-ds="hashtable">Hash Table</button>
    </div>
    <div class="info-panel" id="info"></div>
  </div>
  <div id="main">
    <div id="header">
      <div><div id="title">Array Visualization</div><div id="description">Dynamic array with insert, delete, and search</div></div>
      <div id="status-bar"></div>
    </div>
    <div id="canvas-area"><canvas id="canvas"></canvas></div>
    <div id="controls">
      <input type="number" id="valueInput" placeholder="Value" value="42" min="-999" max="999">
      <input type="number" id="indexInput" placeholder="Index" value="0" min="0" max="99">
      <button class="ctrl-btn" onclick="doInsert()">Insert</button>
      <button class="ctrl-btn" onclick="doDelete()">Delete</button>
      <button class="ctrl-btn" onclick="doSearch()">Search</button>
      <div class="ctrl-sep"></div>
      <button class="ctrl-btn success" onclick="doRandom()">Random</button>
      <button class="ctrl-btn danger" onclick="doClear()">Clear</button>
      <div class="ctrl-sep"></div>
      <button class="ctrl-btn" onclick="doSave()">Save</button>
      <button class="ctrl-btn" onclick="doLoad()">Load</button>
      <div class="ctrl-sep"></div>
      <div class="speed-control">
        <span>Speed:</span>
        <input type="range" id="speedRange" min="1" max="10" value="5">
      </div>
    </div>
  </div>
</div>
<script>
const canvas=document.getElementById('canvas');
const ctx=canvas.getContext('2d');
let currentDS='array';
let data=[10,20,30,40,50];
let highlightIdx=-1;
let highlightTimer=null;
let animQueue=[];
let animating=false;
let graphEdges=[];
let graphPositions=[];
let hashBuckets=[];

const DSInfo={
  array:{title:'Array',desc:'Contiguous memory, O(1) access by index',complexity:'Access: O(1) | Search: O(n) | Insert: O(n) | Delete: O(n)'},
  linkedlist:{title:'Singly Linked List',desc:'Sequential nodes with next pointers',complexity:'Access: O(n) | Search: O(n) | Insert: O(1) head | Delete: O(1) head'},
  doublylinked:{title:'Doubly Linked List',desc:'Nodes with next and prev pointers',complexity:'Access: O(n) | Insert/Delete: O(1) at known node'},
  stack:{title:'Stack (LIFO)',desc:'Last In First Out. Push/Pop from top.',complexity:'Push: O(1) | Pop: O(1) | Peek: O(1)'},
  queue:{title:'Queue (FIFO)',desc:'First In First Out. Enqueue back, dequeue front.',complexity:'Enqueue: O(1) | Dequeue: O(1) | Peek: O(1)'},
  bst:{title:'Binary Search Tree',desc:'Left < root < right. Ordered insertion.',complexity:'Search: O(log n) avg | Insert: O(log n) avg | Worst: O(n)'},
  heap:{title:'Min Heap',desc:'Complete binary tree. Parent <= children.',complexity:'Insert: O(log n) | Extract-min: O(log n) | Peek: O(1)'},
  graph:{title:'Graph',desc:'Vertices connected by edges in a circle layout.',complexity:'Add vertex: O(1) | Add edge: O(1) | Search: O(V+E)'},
  hashtable:{title:'Hash Table',desc:'Key-value pairs with hash function. Handles collisions via chaining.',complexity:'Insert: O(1) avg | Search: O(1) avg | Delete: O(1) avg'}
};

function resize(){canvas.width=canvas.parentElement.clientWidth;canvas.height=canvas.parentElement.clientHeight;render()}
resize();window.addEventListener('resize',resize);

function setDS(ds){
  currentDS=ds;
  document.querySelectorAll('.ds-btn').forEach(b=>b.classList.toggle('active',b.dataset.ds===ds));
  const info=DSInfo[ds];
  document.getElementById('title').textContent=info.title;
  document.getElementById('description').textContent=info.desc;
  document.getElementById('info').innerHTML=`<div class="title">${info.title}</div>${info.desc}<div class="complexity">${info.complexity}</div>`;
  highlightIdx=-1;
  const saved=localStorage.getItem('dsv_'+ds);
  if(saved){
    try{const p=JSON.parse(saved);data=p.data||[];graphEdges=p.edges||[];hashBuckets=p.buckets||[]}catch(e){}
  }else{resetData()}
  if(ds==='graph')initGraphPositions();
  setStatus('');
  render();
}

function resetData(){
  graphEdges=[];hashBuckets=[];
  switch(currentDS){
    case'array':case'linkedlist':case'doublylinked':data=[10,20,30,40,50];break;
    case'stack':data=[10,20,30];break;
    case'queue':data=[10,20,30,40];break;
    case'bst':data=[];[50,30,70,20,40,60,80].forEach(v=>bstInsert(v));break;
    case'heap':data=[];[50,30,70,20,40,10,60].forEach(v=>heapInsert(v));break;
    case'graph':data=[1,2,3,4,5,6];graphEdges=[[0,1],[1,2],[2,3],[3,4],[4,0],[1,3],[2,5]];initGraphPositions();break;
    case'hashtable':data=[];hashBuckets=new Array(7).fill(null).map(()=>[]);
      [15,22,8,33,47,12,29].forEach(v=>{const b=v%7;hashBuckets[b].push(v)});break;
  }
}

function initGraphPositions(){
  graphPositions=data.map((_,i)=>{
    const angle=(i/data.length)*Math.PI*2-Math.PI/2;
    const r=Math.min(canvas.width,canvas.height)*0.3;
    return{x:canvas.width/2+Math.cos(angle)*r,y:canvas.height/2+Math.sin(angle)*r};
  });
}

function bstInsert(val){
  if(data.length===0){data=[val];return}
  let i=0;
  while(i<data.length){
    if(data[i]===undefined||data[i]===null){data[i]=val;return}
    if(val<data[i])i=2*i+1;else i=2*i+2;
  }
  while(data.length<=i)data.push(null);
  data[i]=val;
}

function heapInsert(val){
  data.push(val);
  let i=data.length-1;
  while(i>0){
    const p=Math.floor((i-1)/2);
    if(data[p]<=data[i])break;
    [data[p],data[i]]=[data[i],data[p]];i=p;
  }
}

function heapExtract(){
  if(data.length===0)return null;
  const min=data[0];data[0]=data[data.length-1];data.pop();
  let i=0;
  while(true){
    let smallest=i,l=2*i+1,r=2*i+2;
    if(l<data.length&&data[l]<data[smallest])smallest=l;
    if(r<data.length&&data[r]<data[smallest])smallest=r;
    if(smallest===i)break;
    [data[i],data[smallest]]=[data[smallest],data[i]];i=smallest;
  }
  return min;
}

function setStatus(msg){document.getElementById('status-bar').textContent=msg}

function highlight(idx,ms){
  highlightIdx=idx;render();
  clearTimeout(highlightTimer);
  highlightTimer=setTimeout(()=>{highlightIdx=-1;render()},ms||1500);
}

function autoSave(){localStorage.setItem('dsv_'+currentDS,JSON.stringify({data,edges:graphEdges,buckets:hashBuckets}))}

// Drawing
function render(){
  const W=canvas.width,H=canvas.height;
  ctx.fillStyle='rgba(15,23,41,0.97)';ctx.fillRect(0,0,W,H);
  // Subtle grid
  ctx.strokeStyle='rgba(74,158,255,.05)';ctx.lineWidth=1;
  for(let x=0;x<W;x+=40){ctx.beginPath();ctx.moveTo(x,0);ctx.lineTo(x,H);ctx.stroke()}
  for(let y=0;y<H;y+=40){ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(W,y);ctx.stroke()}
  const draw=drawFunctions[currentDS];
  if(draw)draw(W,H);
}

function drawNode(x,y,r,val,hl,color){
  ctx.fillStyle=hl?'#ff9f43':(color||'#4a9eff');
  ctx.beginPath();ctx.arc(x,y,r,0,Math.PI*2);ctx.fill();
  ctx.strokeStyle=hl?'#ffcc00':'#5aafff';ctx.lineWidth=hl?3:2;ctx.stroke();
  if(hl){ctx.shadowColor='#ff9f43';ctx.shadowBlur=15;ctx.beginPath();ctx.arc(x,y,r,0,Math.PI*2);ctx.stroke();ctx.shadowBlur=0}
  ctx.fillStyle='#fff';ctx.font=`bold ${r>20?16:12}px Monaco`;ctx.textAlign='center';ctx.textBaseline='middle';
  ctx.fillText(val,x,y);
}

function drawRect(x,y,w,h,val,hl,label){
  ctx.fillStyle=hl?'rgba(255,159,67,.3)':'rgba(74,158,255,.3)';ctx.fillRect(x,y,w,h);
  ctx.strokeStyle=hl?'#ff9f43':'#4a9eff';ctx.lineWidth=hl?3:2;ctx.strokeRect(x,y,w,h);
  ctx.fillStyle='#fff';ctx.font='bold 16px Monaco';ctx.textAlign='center';ctx.textBaseline='middle';
  ctx.fillText(val,x+w/2,y+h/2);
  if(label!==undefined){ctx.fillStyle='#666';ctx.font='11px Monaco';ctx.fillText(label,x+w/2,y+h+16)}
}

function drawArrow(x1,y1,x2,y2,color){
  ctx.strokeStyle=color||'#4a9eff';ctx.lineWidth=2;ctx.beginPath();ctx.moveTo(x1,y1);ctx.lineTo(x2,y2);ctx.stroke();
  const angle=Math.atan2(y2-y1,x2-x1);const sz=8;
  ctx.fillStyle=color||'#4a9eff';ctx.beginPath();
  ctx.moveTo(x2,y2);ctx.lineTo(x2-sz*Math.cos(angle-Math.PI/6),y2-sz*Math.sin(angle-Math.PI/6));
  ctx.lineTo(x2-sz*Math.cos(angle+Math.PI/6),y2-sz*Math.sin(angle+Math.PI/6));ctx.closePath();ctx.fill();
}

const drawFunctions={
  array(W,H){
    const cw=70,ch=50,gap=5;
    const totalW=data.length*(cw+gap);
    const sx=(W-totalW)/2,sy=H/2-ch/2;
    data.forEach((v,i)=>drawRect(sx+i*(cw+gap),sy,cw,ch,v,i===highlightIdx,`[${i}]`));
    ctx.fillStyle='#4a9eff';ctx.font='11px Monaco';ctx.textAlign='center';
    ctx.fillText(`Length: ${data.length}`,W/2,sy-30);
  },
  linkedlist(W,H){
    const r=25,sp=100;const sx=Math.max(60,(W-data.length*sp)/2);const y=H/2;
    data.forEach((v,i)=>{
      const x=sx+i*sp;
      drawNode(x,y,r,v,i===highlightIdx);
      if(i<data.length-1)drawArrow(x+r+2,y,x+sp-r-2,y);
    });
    if(data.length){ctx.fillStyle='#2ed573';ctx.font='10px Monaco';ctx.textAlign='center';ctx.fillText('HEAD',sx,y-40)}
  },
  doublylinked(W,H){
    const r=25,sp=110;const sx=Math.max(60,(W-data.length*sp)/2);const y=H/2;
    data.forEach((v,i)=>{
      const x=sx+i*sp;
      drawNode(x,y,r,v,i===highlightIdx);
      if(i<data.length-1){drawArrow(x+r+2,y-6,x+sp-r-2,y-6);drawArrow(x+sp-r-2,y+6,x+r+2,y+6,'#ff9f43')}
    });
    if(data.length){
      ctx.fillStyle='#2ed573';ctx.font='10px Monaco';ctx.textAlign='center';
      ctx.fillText('HEAD',sx,y-40);ctx.fillText('TAIL',sx+(data.length-1)*sp,y-40);
    }
  },
  stack(W,H){
    const cw=120,ch=40,gap=4;const x=W/2-cw/2;const botY=H-80;
    data.forEach((v,i)=>{const y=botY-i*(ch+gap);drawRect(x,y,cw,ch,v,i===highlightIdx)});
    if(data.length){ctx.fillStyle='#ff9f43';ctx.font='12px Monaco';ctx.textAlign='left';ctx.fillText('TOP',W/2+cw/2+12,botY-(data.length-1)*(ch+gap)+ch/2)}
    ctx.strokeStyle='#333';ctx.lineWidth=3;ctx.beginPath();ctx.moveTo(x-10,botY+ch+10);ctx.lineTo(x-10,botY-data.length*(ch+gap));ctx.moveTo(x+cw+10,botY+ch+10);ctx.lineTo(x+cw+10,botY-data.length*(ch+gap));ctx.stroke();
  },
  queue(W,H){
    const cw=70,ch=50,gap=5;const totalW=data.length*(cw+gap);const sx=(W-totalW)/2,y=H/2-ch/2;
    data.forEach((v,i)=>drawRect(sx+i*(cw+gap),y,cw,ch,v,i===highlightIdx));
    if(data.length){
      ctx.fillStyle='#2ed573';ctx.font='11px Monaco';ctx.textAlign='center';
      ctx.fillText('FRONT',sx+cw/2,y-20);ctx.fillText('REAR',sx+(data.length-1)*(cw+gap)+cw/2,y-20);
      drawArrow(sx-30,y+ch/2,sx-5,y+ch/2,'#2ed573');
      drawArrow(sx+(data.length-1)*(cw+gap)+cw+5,y+ch/2,sx+(data.length-1)*(cw+gap)+cw+30,y+ch/2,'#ff9f43');
    }
  },
  bst(W,H){
    if(!data.length)return;
    const r=22,lh=70;
    function drawBST(i,x,y,spread){
      if(i>=data.length||data[i]===null||data[i]===undefined)return;
      const l=2*i+1,ri=2*i+2;
      if(l<data.length&&data[l]!=null){const lx=x-spread,ly=y+lh;ctx.strokeStyle='#4a9eff55';ctx.lineWidth=2;ctx.beginPath();ctx.moveTo(x,y+r);ctx.lineTo(lx,ly-r);ctx.stroke();drawBST(l,lx,ly,spread/2)}
      if(ri<data.length&&data[ri]!=null){const rx=x+spread,ry=y+lh;ctx.strokeStyle='#4a9eff55';ctx.lineWidth=2;ctx.beginPath();ctx.moveTo(x,y+r);ctx.lineTo(rx,ry-r);ctx.stroke();drawBST(ri,rx,ry,spread/2)}
      drawNode(x,y,r,data[i],i===highlightIdx);
    }
    drawBST(0,W/2,60,W/5);
  },
  heap(W,H){
    if(!data.length)return;
    const r=22,lh=65;
    function drawH(i,x,y,spread){
      if(i>=data.length)return;
      const l=2*i+1,ri=2*i+2;
      if(l<data.length){ctx.strokeStyle='#4a9eff44';ctx.lineWidth=2;ctx.beginPath();ctx.moveTo(x,y+r);ctx.lineTo(x-spread,y+lh-r);ctx.stroke();drawH(l,x-spread,y+lh,spread/2)}
      if(ri<data.length){ctx.strokeStyle='#4a9eff44';ctx.lineWidth=2;ctx.beginPath();ctx.moveTo(x,y+r);ctx.lineTo(x+spread,y+lh-r);ctx.stroke();drawH(ri,x+spread,y+lh,spread/2)}
      drawNode(x,y,r,data[i],i===highlightIdx,'#2ed573');
    }
    drawH(0,W/2,50,W/5);
    // Array representation at bottom
    const cw=40,ch=30;const arrX=(W-data.length*(cw+2))/2;const arrY=H-60;
    ctx.fillStyle='#666';ctx.font='10px Monaco';ctx.textAlign='center';ctx.fillText('Array representation:',W/2,arrY-12);
    data.forEach((v,i)=>drawRect(arrX+i*(cw+2),arrY,cw,ch,v,i===highlightIdx,`${i}`));
  },
  graph(W,H){
    if(!graphPositions.length)initGraphPositions();
    graphEdges.forEach(([a,b])=>{
      if(graphPositions[a]&&graphPositions[b]){
        const pa=graphPositions[a],pb=graphPositions[b];
        ctx.strokeStyle='#4a9eff44';ctx.lineWidth=2;ctx.beginPath();ctx.moveTo(pa.x,pa.y);ctx.lineTo(pb.x,pb.y);ctx.stroke();
      }
    });
    data.forEach((v,i)=>{if(graphPositions[i])drawNode(graphPositions[i].x,graphPositions[i].y,28,v,i===highlightIdx)});
  },
  hashtable(W,H){
    const bw=100,bh=40,sp=8;const bucketCount=hashBuckets.length;
    const sx=60,sy=40;
    ctx.fillStyle='#4a9eff';ctx.font='12px Monaco';ctx.textAlign='left';
    ctx.fillText('Hash Table (mod '+bucketCount+')',sx,sy-10);
    hashBuckets.forEach((bucket,bi)=>{
      const y=sy+bi*(bh+sp);
      ctx.fillStyle='rgba(74,158,255,.1)';ctx.fillRect(sx,y,bw,bh);
      ctx.strokeStyle='#4a9eff';ctx.lineWidth=1;ctx.strokeRect(sx,y,bw,bh);
      ctx.fillStyle='#888';ctx.font='11px Monaco';ctx.textAlign='center';ctx.textBaseline='middle';
      ctx.fillText(`[${bi}]`,sx+bw/2,y+bh/2);
      bucket.forEach((val,ci)=>{
        const cx=sx+bw+20+ci*(70+sp);
        drawRect(cx,y,65,bh,val,false);
        drawArrow(cx-sp,y+bh/2,cx-2,y+bh/2,'#4a9eff55');
      });
    });
  }
};

// Operations
window.doInsert=function(){
  const val=parseInt(document.getElementById('valueInput').value);
  const idx=parseInt(document.getElementById('indexInput').value);
  if(isNaN(val)){setStatus('Enter a valid number');return}
  switch(currentDS){
    case'stack':data.push(val);highlight(data.length-1);setStatus(`Pushed ${val}`);break;
    case'queue':data.push(val);highlight(data.length-1);setStatus(`Enqueued ${val}`);break;
    case'bst':bstInsert(val);setStatus(`Inserted ${val} into BST`);break;
    case'heap':heapInsert(val);setStatus(`Inserted ${val} into heap`);break;
    case'graph':data.push(val);initGraphPositions();setStatus(`Added vertex ${val}`);break;
    case'hashtable':{const b=Math.abs(val)%hashBuckets.length;hashBuckets[b].push(val);setStatus(`Inserted ${val} into bucket ${b}`)};break;
    default:
      const i=isNaN(idx)?data.length:Math.min(idx,data.length);
      data.splice(i,0,val);highlight(i);setStatus(`Inserted ${val} at index ${i}`);
  }
  autoSave();render();
};

window.doDelete=function(){
  const idx=parseInt(document.getElementById('indexInput').value);
  const val=parseInt(document.getElementById('valueInput').value);
  switch(currentDS){
    case'stack':if(data.length){const v=data.pop();setStatus(`Popped ${v}`)}else setStatus('Stack empty');break;
    case'queue':if(data.length){const v=data.shift();setStatus(`Dequeued ${v}`)}else setStatus('Queue empty');break;
    case'heap':if(data.length){const v=heapExtract();setStatus(`Extracted min: ${v}`)}else setStatus('Heap empty');break;
    case'bst':{
      const target=isNaN(val)?null:val;
      if(target!==null){
        const i=data.indexOf(target);
        if(i>=0){data[i]=null;setStatus(`Removed ${target}`)}else setStatus('Not found')
      }else setStatus('Enter value to remove');
    };break;
    case'graph':if(data.length){data.pop();graphEdges=graphEdges.filter(([a,b])=>a<data.length&&b<data.length);initGraphPositions();setStatus('Removed last vertex')}break;
    case'hashtable':{
      if(!isNaN(val)){const b=Math.abs(val)%hashBuckets.length;const i=hashBuckets[b].indexOf(val);
        if(i>=0){hashBuckets[b].splice(i,1);setStatus(`Removed ${val} from bucket ${b}`)}else setStatus('Not found')
      }
    };break;
    default:
      if(!isNaN(idx)&&idx>=0&&idx<data.length){const v=data.splice(idx,1)[0];setStatus(`Deleted ${v} at index ${idx}`)}
      else if(data.length){const v=data.pop();setStatus(`Deleted ${v}`)}
  }
  autoSave();render();
};

window.doSearch=function(){
  const val=parseInt(document.getElementById('valueInput').value);
  if(isNaN(val)){setStatus('Enter value to search');return}
  if(currentDS==='hashtable'){
    const b=Math.abs(val)%hashBuckets.length;
    const found=hashBuckets[b].includes(val);
    setStatus(found?`Found ${val} in bucket ${b}`:`${val} not found (checked bucket ${b})`);
  }else{
    const idx=data.indexOf(val);
    if(idx>=0){highlight(idx);setStatus(`Found ${val} at index ${idx}`)}
    else setStatus(`${val} not found`);
  }
};

window.doRandom=function(){
  resetData();autoSave();render();setStatus('Reset to random data');
};

window.doClear=function(){
  data=[];graphEdges=[];hashBuckets=currentDS==='hashtable'?new Array(7).fill(null).map(()=>[]):[];
  autoSave();render();setStatus('Cleared');
};

window.doSave=function(){
  autoSave();setStatus('Saved to localStorage');
};

window.doLoad=function(){
  const saved=localStorage.getItem('dsv_'+currentDS);
  if(saved){try{const p=JSON.parse(saved);data=p.data||[];graphEdges=p.edges||[];hashBuckets=p.buckets||[];
    if(currentDS==='graph')initGraphPositions();render();setStatus('Loaded from localStorage')}catch(e){setStatus('Load failed')}}
  else setStatus('No saved data');
};

// Sidebar buttons
document.querySelectorAll('.ds-btn').forEach(btn=>{btn.addEventListener('click',()=>setDS(btn.dataset.ds))});

// Keyboard shortcuts
document.addEventListener('keydown',e=>{
  if(e.target.tagName==='INPUT')return;
  if(e.key==='i')doInsert();
  else if(e.key==='d')doDelete();
  else if(e.key==='s'&&!e.ctrlKey&&!e.metaKey)doSearch();
  else if(e.key==='r')doRandom();
  else if(e.key==='c')doClear();
});

// Init
setDS('array');
render();
</script>
</body>
</html>
