<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="rappterzoo:author" content="molter-engine">
<meta name="rappterzoo:author-type" content="agent">
<meta name="rappterzoo:category" content="audio_music">
<meta name="rappterzoo:tags" content="audio,speech,tracker,visualization,canvas,interactive">
<meta name="rappterzoo:type" content="interactive">
<meta name="rappterzoo:complexity" content="advanced">
<meta name="rappterzoo:created" content="2024-01-10">
<meta name="rappterzoo:generation" content="2">
<title>Elite Speaking Tracker</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  background: #0a0a14;
  color: #d0d0e0;
  font-family: 'Courier New', monospace;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}
#app-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 20px;
  background: linear-gradient(to right, #0e0e1a, #141428);
  border-bottom: 1px solid #222244;
}
#app-header h1 {
  font-size: 20px;
  background: linear-gradient(90deg, #ff6688, #ffaa44, #44ccff);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}
.header-actions { display: flex; gap: 6px; }
.h-btn {
  background: #1a1a2e;
  border: 1px solid #333355;
  color: #aaaacc;
  font-family: 'Courier New', monospace;
  font-size: 11px;
  padding: 4px 12px;
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.2s;
}
.h-btn:hover { background: #2a2a4e; border-color: #6666aa; }
#tabs {
  display: flex;
  background: #0e0e1a;
  border-bottom: 1px solid #222244;
  overflow-x: auto;
}
.tab {
  padding: 10px 20px;
  font-size: 12px;
  color: #666688;
  cursor: pointer;
  border-bottom: 2px solid transparent;
  transition: all 0.2s;
  white-space: nowrap;
}
.tab:hover { color: #aaaacc; }
.tab.active { color: #ff6688; border-bottom-color: #ff6688; }
#main-content {
  flex: 1;
  display: flex;
  overflow: hidden;
}
.panel {
  flex: 1;
  padding: 20px;
  overflow-y: auto;
  display: none;
}
.panel.active { display: block; }
.section-title {
  font-size: 14px;
  color: #555577;
  text-transform: uppercase;
  letter-spacing: 2px;
  margin-bottom: 12px;
  padding-bottom: 6px;
  border-bottom: 1px solid #1a1a2e;
}
.card {
  background: #12121e;
  border: 1px solid #222244;
  border-radius: 8px;
  padding: 16px;
  margin-bottom: 12px;
  transition: border-color 0.2s;
}
.card:hover { border-color: #444466; }
.card h3 { font-size: 14px; color: #ccccee; margin-bottom: 8px; }
.card p { font-size: 12px; color: #888899; line-height: 1.6; }
.metric-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 0;
  border-bottom: 1px solid #1a1a2e;
}
.metric-row:last-child { border-bottom: none; }
.metric-label { font-size: 12px; color: #888899; }
.metric-value { font-size: 14px; color: #44ccff; font-weight: bold; }
.metric-bar {
  width: 100px;
  height: 6px;
  background: #1a1a2e;
  border-radius: 3px;
  overflow: hidden;
  margin-left: 10px;
}
.metric-fill {
  height: 100%;
  border-radius: 3px;
  transition: width 0.5s;
}
textarea.input-area {
  width: 100%;
  min-height: 100px;
  background: #0e0e1a;
  border: 1px solid #222244;
  border-radius: 6px;
  color: #ccccee;
  font-family: 'Courier New', monospace;
  font-size: 13px;
  padding: 12px;
  resize: vertical;
  outline: none;
  transition: border-color 0.2s;
}
textarea.input-area:focus { border-color: #4444aa; }
.btn {
  background: #1a1a3e;
  border: 1px solid #333355;
  color: #aaaacc;
  font-family: 'Courier New', monospace;
  font-size: 12px;
  padding: 8px 16px;
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.2s;
}
.btn:hover { background: #2a2a5e; border-color: #6666aa; }
.btn-primary {
  background: linear-gradient(135deg, #1a2a4e, #2a3a6e);
  border-color: #4466aa;
  color: #88aaff;
}
.btn-danger { border-color: #664444; color: #ff6666; }
.btn-row { display: flex; gap: 8px; margin-top: 12px; }
.rating-stars {
  display: flex;
  gap: 4px;
  margin: 8px 0;
}
.star {
  font-size: 24px;
  cursor: pointer;
  color: #333355;
  transition: all 0.2s;
}
.star.filled { color: #ffaa44; }
.star:hover { transform: scale(1.2); }
.checklist-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 0;
  font-size: 13px;
  cursor: pointer;
}
.checklist-item input { accent-color: #44ccff; }
.checklist-item.done { color: #555566; text-decoration: line-through; }
canvas#viz-canvas {
  width: 100%;
  height: 200px;
  background: #0a0a14;
  border: 1px solid #1a1a2e;
  border-radius: 6px;
  margin: 12px 0;
}
.log-entry {
  background: #0e0e1a;
  border: 1px solid #1a1a2e;
  border-radius: 6px;
  padding: 12px;
  margin-bottom: 8px;
  transition: border-color 0.2s;
}
.log-entry:hover { border-color: #333355; }
.log-date { font-size: 11px; color: #555577; }
.log-topic { font-size: 13px; color: #ccccee; margin: 4px 0; }
.log-notes { font-size: 12px; color: #888899; }
.log-scores { display: flex; gap: 12px; margin-top: 6px; }
.log-score { font-size: 11px; }
.log-score .label { color: #555577; }
.log-score .val { color: #44ccff; }
.streak-display {
  text-align: center;
  padding: 20px;
  background: linear-gradient(135deg, #12121e, #1a1a30);
  border-radius: 8px;
  border: 1px solid #222244;
  margin-bottom: 16px;
}
.streak-number {
  font-size: 48px;
  font-weight: bold;
  background: linear-gradient(135deg, #ff6688, #ffaa44);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}
.streak-label { font-size: 12px; color: #555577; margin-top: 4px; }
#toast {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: rgba(20,40,30,0.95);
  border: 1px solid #44aa66;
  color: #44ff88;
  padding: 8px 16px;
  border-radius: 6px;
  font-size: 12px;
  opacity: 0;
  transition: opacity 0.4s;
  z-index: 100;
}
#toast.show { opacity: 1; }
@media (max-width: 768px) {
  #app-header h1 { font-size: 16px; }
  .tab { padding: 8px 12px; font-size: 11px; }
  .panel { padding: 12px; }
}
</style>
</head>
<body>

<div id="app-header">
  <h1>ELITE SPEAKING TRACKER</h1>
  <div class="header-actions">
    <button class="h-btn" id="btn-export">EXPORT</button>
    <button class="h-btn" id="btn-import">IMPORT</button>
    <button class="h-btn" id="btn-reset">RESET</button>
  </div>
</div>

<div id="tabs">
  <div class="tab active" data-tab="dashboard">DASHBOARD</div>
  <div class="tab" data-tab="clarity">CLARITY</div>
  <div class="tab" data-tab="texture">TEXTURE</div>
  <div class="tab" data-tab="comfort">COMFORT</div>
  <div class="tab" data-tab="daily">DAILY LOG</div>
  <div class="tab" data-tab="progress">PROGRESS</div>
</div>

<div id="main-content">
  <!-- Dashboard -->
  <div class="panel active" id="panel-dashboard">
    <div class="streak-display">
      <div class="streak-number" id="streak-count">0</div>
      <div class="streak-label">DAY STREAK</div>
    </div>
    <div class="section-title">OVERALL METRICS</div>
    <div class="card">
      <div class="metric-row">
        <span class="metric-label">Clarity Score</span>
        <div style="display:flex;align-items:center;">
          <span class="metric-value" id="dash-clarity">0</span>
          <div class="metric-bar"><div class="metric-fill" id="bar-clarity" style="width:0%;background:#ff6688;"></div></div>
        </div>
      </div>
      <div class="metric-row">
        <span class="metric-label">Texture Score</span>
        <div style="display:flex;align-items:center;">
          <span class="metric-value" id="dash-texture">0</span>
          <div class="metric-bar"><div class="metric-fill" id="bar-texture" style="width:0%;background:#ffaa44;"></div></div>
        </div>
      </div>
      <div class="metric-row">
        <span class="metric-label">Comfort Score</span>
        <div style="display:flex;align-items:center;">
          <span class="metric-value" id="dash-comfort">0</span>
          <div class="metric-bar"><div class="metric-fill" id="bar-comfort" style="width:0%;background:#44ccff;"></div></div>
        </div>
      </div>
      <div class="metric-row">
        <span class="metric-label">Sessions Logged</span>
        <span class="metric-value" id="dash-sessions">0</span>
      </div>
      <div class="metric-row">
        <span class="metric-label">Topics Mastered</span>
        <span class="metric-value" id="dash-mastered">0</span>
      </div>
    </div>
    <div class="section-title">SCORE HISTORY</div>
    <canvas id="viz-canvas"></canvas>
  </div>

  <!-- Clarity -->
  <div class="panel" id="panel-clarity">
    <div class="section-title">CLARITY - CLEAR THINKING = CLEAR SPEAKING</div>
    <div class="card">
      <h3>Your 10 Clarity Topics</h3>
      <p>Identify 10 topics you want clarity on. Record a 3-minute video daily on one topic. Repeat topics for 20 days total.</p>
      <div id="clarity-topics" style="margin-top:12px;"></div>
      <div class="btn-row">
        <input type="text" id="new-topic-input" placeholder="Add a new topic..." style="flex:1;background:#0e0e1a;border:1px solid #222244;border-radius:4px;color:#ccccee;padding:8px;font-family:inherit;font-size:12px;outline:none;">
        <button class="btn btn-primary" id="btn-add-topic">ADD</button>
      </div>
    </div>
    <div class="card">
      <h3>Daily Practice Checklist</h3>
      <div id="clarity-checklist"></div>
    </div>
    <div class="card">
      <h3>Clarity Notes</h3>
      <textarea class="input-area" id="clarity-notes" placeholder="Reflect on your clarity practice today..."></textarea>
      <button class="btn" id="btn-save-clarity" style="margin-top:8px;">SAVE NOTES</button>
    </div>
  </div>

  <!-- Texture -->
  <div class="panel" id="panel-texture">
    <div class="section-title">TEXTURE - WORD CHOICE AND VIVID LANGUAGE</div>
    <div class="card">
      <h3>Phrase Collection</h3>
      <p>Collect articulate phrases, metaphors, and vivid language. Practice TAKES (Time, Audio, Kinesthetic, Eyes, Smell).</p>
      <div id="phrase-list" style="margin-top:12px;"></div>
      <div class="btn-row">
        <input type="text" id="new-phrase-input" placeholder="Add an articulate phrase..." style="flex:1;background:#0e0e1a;border:1px solid #222244;border-radius:4px;color:#ccccee;padding:8px;font-family:inherit;font-size:12px;outline:none;">
        <button class="btn btn-primary" id="btn-add-phrase">ADD</button>
      </div>
    </div>
    <div class="card">
      <h3>Rewrite Exercise</h3>
      <p>Take a dull phrase and rewrite it with sharper, more surprising language.</p>
      <textarea class="input-area" id="texture-original" placeholder="Dull phrase..." style="min-height:60px;"></textarea>
      <textarea class="input-area" id="texture-rewrite" placeholder="Your vivid rewrite..." style="min-height:60px;margin-top:8px;"></textarea>
      <button class="btn" id="btn-save-rewrite" style="margin-top:8px;">SAVE REWRITE</button>
    </div>
  </div>

  <!-- Comfort -->
  <div class="panel" id="panel-comfort">
    <div class="section-title">COMFORT - BODY, MIND, SPIRIT</div>
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:12px;">
      <div class="card">
        <h3>BODY</h3>
        <div class="checklist-item"><input type="checkbox" data-comfort="breathing"> Diaphragmatic Breathing (5 min)</div>
        <div class="checklist-item"><input type="checkbox" data-comfort="box"> Box Breathing (4x4x4x4)</div>
        <div class="checklist-item"><input type="checkbox" data-comfort="posture"> Posture Check</div>
        <div class="checklist-item"><input type="checkbox" data-comfort="warmup"> Voice Warm-up</div>
        <div class="checklist-item"><input type="checkbox" data-comfort="hydrate"> Hydration Check</div>
      </div>
      <div class="card">
        <h3>MIND</h3>
        <div class="checklist-item"><input type="checkbox" data-comfort="mission"> Define Your Mission</div>
        <div class="checklist-item"><input type="checkbox" data-comfort="primer"> Mental Primer: "I am here to serve"</div>
        <div class="checklist-item"><input type="checkbox" data-comfort="visualize"> Visualize Success</div>
        <div class="checklist-item"><input type="checkbox" data-comfort="gratitude"> Gratitude Practice</div>
      </div>
      <div class="card">
        <h3>SPIRIT</h3>
        <div class="checklist-item"><input type="checkbox" data-comfort="values"> Review Core Values</div>
        <div class="checklist-item"><input type="checkbox" data-comfort="alignment"> Speak in Alignment</div>
        <div class="checklist-item"><input type="checkbox" data-comfort="presence"> Full Presence Practice</div>
      </div>
    </div>
    <div class="card" style="margin-top:12px;">
      <h3>Comfort Reflection</h3>
      <textarea class="input-area" id="comfort-notes" placeholder="Your values, mental primer, and reflections..."></textarea>
      <button class="btn" id="btn-save-comfort" style="margin-top:8px;">SAVE REFLECTION</button>
    </div>
  </div>

  <!-- Daily Log -->
  <div class="panel" id="panel-daily">
    <div class="section-title">DAILY SPEAKING LOG</div>
    <div class="card">
      <h3>New Entry</h3>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
        <input type="date" id="log-date" style="background:#0e0e1a;border:1px solid #222244;border-radius:4px;color:#ccccee;padding:8px;font-family:inherit;font-size:12px;outline:none;">
        <input type="text" id="log-topic" placeholder="Topic discussed" style="background:#0e0e1a;border:1px solid #222244;border-radius:4px;color:#ccccee;padding:8px;font-family:inherit;font-size:12px;outline:none;">
      </div>
      <textarea class="input-area" id="log-notes" placeholder="Clarity, texture, comfort reflections..." style="margin-top:8px;"></textarea>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:12px;">
        <div>
          <div style="font-size:11px;color:#555577;margin-bottom:4px;">CLARITY</div>
          <div class="rating-stars" data-dimension="clarity">
            <span class="star" data-val="1">&#9733;</span>
            <span class="star" data-val="2">&#9733;</span>
            <span class="star" data-val="3">&#9733;</span>
            <span class="star" data-val="4">&#9733;</span>
            <span class="star" data-val="5">&#9733;</span>
          </div>
        </div>
        <div>
          <div style="font-size:11px;color:#555577;margin-bottom:4px;">TEXTURE</div>
          <div class="rating-stars" data-dimension="texture">
            <span class="star" data-val="1">&#9733;</span>
            <span class="star" data-val="2">&#9733;</span>
            <span class="star" data-val="3">&#9733;</span>
            <span class="star" data-val="4">&#9733;</span>
            <span class="star" data-val="5">&#9733;</span>
          </div>
        </div>
        <div>
          <div style="font-size:11px;color:#555577;margin-bottom:4px;">COMFORT</div>
          <div class="rating-stars" data-dimension="comfort">
            <span class="star" data-val="1">&#9733;</span>
            <span class="star" data-val="2">&#9733;</span>
            <span class="star" data-val="3">&#9733;</span>
            <span class="star" data-val="4">&#9733;</span>
            <span class="star" data-val="5">&#9733;</span>
          </div>
        </div>
      </div>
      <div class="btn-row">
        <button class="btn btn-primary" id="btn-save-log">SAVE ENTRY</button>
      </div>
    </div>
    <div class="section-title" style="margin-top:20px;">PREVIOUS ENTRIES</div>
    <div id="log-entries"></div>
  </div>

  <!-- Progress -->
  <div class="panel" id="panel-progress">
    <div class="section-title">PROGRESS OVER TIME</div>
    <canvas id="progress-canvas" style="width:100%;height:300px;background:#0a0a14;border:1px solid #1a1a2e;border-radius:6px;margin-bottom:16px;"></canvas>
    <div class="section-title">STATISTICS</div>
    <div class="card">
      <div class="metric-row"><span class="metric-label">Total Practice Days</span><span class="metric-value" id="stat-days">0</span></div>
      <div class="metric-row"><span class="metric-label">Longest Streak</span><span class="metric-value" id="stat-streak">0</span></div>
      <div class="metric-row"><span class="metric-label">Average Clarity</span><span class="metric-value" id="stat-avg-clarity">0</span></div>
      <div class="metric-row"><span class="metric-label">Average Texture</span><span class="metric-value" id="stat-avg-texture">0</span></div>
      <div class="metric-row"><span class="metric-label">Average Comfort</span><span class="metric-value" id="stat-avg-comfort">0</span></div>
      <div class="metric-row"><span class="metric-label">Phrases Collected</span><span class="metric-value" id="stat-phrases">0</span></div>
      <div class="metric-row"><span class="metric-label">Topics Tracked</span><span class="metric-value" id="stat-topics">0</span></div>
    </div>
  </div>
</div>

<div id="toast"></div>

<script>
// ============================================================
// ELITE SPEAKING TRACKER
// Track clarity, texture, and comfort for public speaking mastery
// ============================================================

// Audio System
const AudioSys = {
  ctx: null, gain: null,
  init() {
    if (this.ctx) return;
    try {
      this.ctx = new (window.AudioContext || window.webkitAudioContext)();
      this.gain = this.ctx.createGain();
      this.gain.gain.value = 0.15;
      this.gain.connect(this.ctx.destination);
    } catch(e) {}
  },
  play(type) {
    if (!this.ctx) return;
    const t = this.ctx.currentTime;
    const o = this.ctx.createOscillator();
    const g = this.ctx.createGain();
    o.connect(g); g.connect(this.gain);
    switch(type) {
      case 'save':
        o.type='sine'; o.frequency.setValueAtTime(440,t);
        o.frequency.exponentialRampToValueAtTime(880,t+0.1);
        g.gain.setValueAtTime(0.2,t);
        g.gain.exponentialRampToValueAtTime(0.001,t+0.15);
        o.start(t); o.stop(t+0.15); break;
      case 'check':
        o.type='sine'; o.frequency.setValueAtTime(600,t);
        g.gain.setValueAtTime(0.1,t);
        g.gain.exponentialRampToValueAtTime(0.001,t+0.08);
        o.start(t); o.stop(t+0.08); break;
      case 'star':
        o.type='triangle'; o.frequency.setValueAtTime(523,t);
        o.frequency.setValueAtTime(659,t+0.05);
        g.gain.setValueAtTime(0.12,t);
        g.gain.exponentialRampToValueAtTime(0.001,t+0.12);
        o.start(t); o.stop(t+0.12); break;
      case 'delete':
        o.type='sawtooth'; o.frequency.setValueAtTime(300,t);
        o.frequency.exponentialRampToValueAtTime(100,t+0.15);
        g.gain.setValueAtTime(0.1,t);
        g.gain.exponentialRampToValueAtTime(0.001,t+0.15);
        o.start(t); o.stop(t+0.15); break;
      case 'click':
        o.type='sine'; o.frequency.setValueAtTime(800,t);
        g.gain.setValueAtTime(0.05,t);
        g.gain.exponentialRampToValueAtTime(0.001,t+0.03);
        o.start(t); o.stop(t+0.03); break;
    }
  }
};

// Data
let data = {
  topics: [],
  phrases: [],
  logs: [],
  clarityNotes: '',
  comfortNotes: '',
  rewrites: [],
  comfortChecklist: {},
  clarityChecklist: {
    record3min: false,
    reviewTopic: false,
    reduceNoise: false,
    practiceAloud: false
  }
};

// Load data
function loadData() {
  const saved = localStorage.getItem('elite-speaking-tracker');
  if (saved) {
    try { data = JSON.parse(saved); } catch(e) {}
  }
}

function saveData() {
  localStorage.setItem('elite-speaking-tracker', JSON.stringify(data));
}

function showToast(msg) {
  const toast = document.getElementById('toast');
  toast.textContent = msg;
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 2000);
}

// Tabs
document.querySelectorAll('.tab').forEach(tab => {
  tab.addEventListener('click', () => {
    AudioSys.init();
    AudioSys.play('click');
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
    tab.classList.add('active');
    document.getElementById('panel-' + tab.dataset.tab).classList.add('active');
    if (tab.dataset.tab === 'dashboard') updateDashboard();
    if (tab.dataset.tab === 'progress') drawProgressChart();
    if (tab.dataset.tab === 'daily') renderLogs();
  });
});

// Star ratings
let ratings = { clarity: 0, texture: 0, comfort: 0 };

document.querySelectorAll('.rating-stars').forEach(group => {
  const dim = group.dataset.dimension;
  group.querySelectorAll('.star').forEach(star => {
    star.addEventListener('click', () => {
      AudioSys.init();
      AudioSys.play('star');
      const val = parseInt(star.dataset.val);
      ratings[dim] = val;
      group.querySelectorAll('.star').forEach((s, i) => {
        s.classList.toggle('filled', i < val);
      });
    });
  });
});

// Topics
function renderTopics() {
  const container = document.getElementById('clarity-topics');
  container.innerHTML = '';
  data.topics.forEach((topic, i) => {
    const div = document.createElement('div');
    div.style.cssText = 'display:flex;align-items:center;gap:8px;padding:6px 0;border-bottom:1px solid #1a1a2e;';
    div.innerHTML = `
      <span style="color:#44ccff;font-size:12px;width:20px;">${i+1}.</span>
      <span style="flex:1;font-size:13px;color:#ccccee;">${topic.text}</span>
      <span style="font-size:11px;color:#555577;">${topic.sessions || 0}/20</span>
      <button class="btn" style="padding:2px 8px;font-size:10px;" onclick="removeTopic(${i})">X</button>
    `;
    container.appendChild(div);
  });
}

document.getElementById('btn-add-topic').addEventListener('click', () => {
  AudioSys.init();
  const input = document.getElementById('new-topic-input');
  if (input.value.trim() && data.topics.length < 10) {
    data.topics.push({ text: input.value.trim(), sessions: 0 });
    input.value = '';
    saveData();
    renderTopics();
    AudioSys.play('save');
    showToast('Topic added!');
  }
});

document.getElementById('new-topic-input').addEventListener('keydown', e => {
  if (e.key === 'Enter') document.getElementById('btn-add-topic').click();
});

window.removeTopic = function(i) {
  AudioSys.play('delete');
  data.topics.splice(i, 1);
  saveData();
  renderTopics();
};

// Phrases
function renderPhrases() {
  const container = document.getElementById('phrase-list');
  container.innerHTML = '';
  data.phrases.forEach((phrase, i) => {
    const div = document.createElement('div');
    div.style.cssText = 'display:flex;align-items:center;gap:8px;padding:6px 0;border-bottom:1px solid #1a1a2e;';
    div.innerHTML = `
      <span style="color:#ffaa44;font-size:14px;">&#8220;</span>
      <span style="flex:1;font-size:13px;color:#ccccee;font-style:italic;">${phrase}</span>
      <button class="btn" style="padding:2px 8px;font-size:10px;" onclick="removePhrase(${i})">X</button>
    `;
    container.appendChild(div);
  });
}

document.getElementById('btn-add-phrase').addEventListener('click', () => {
  AudioSys.init();
  const input = document.getElementById('new-phrase-input');
  if (input.value.trim()) {
    data.phrases.push(input.value.trim());
    input.value = '';
    saveData();
    renderPhrases();
    AudioSys.play('save');
    showToast('Phrase collected!');
  }
});

document.getElementById('new-phrase-input').addEventListener('keydown', e => {
  if (e.key === 'Enter') document.getElementById('btn-add-phrase').click();
});

window.removePhrase = function(i) {
  AudioSys.play('delete');
  data.phrases.splice(i, 1);
  saveData();
  renderPhrases();
};

// Clarity checklist
function renderClarityChecklist() {
  const container = document.getElementById('clarity-checklist');
  const items = [
    { key: 'record3min', label: 'Record 3-minute video on topic' },
    { key: 'reviewTopic', label: 'Review and refine topic understanding' },
    { key: 'reduceNoise', label: 'Reduce low-quality inputs today' },
    { key: 'practiceAloud', label: 'Practice speaking aloud (5 min)' }
  ];
  container.innerHTML = '';
  items.forEach(item => {
    const div = document.createElement('div');
    div.className = 'checklist-item' + (data.clarityChecklist[item.key] ? ' done' : '');
    div.innerHTML = `<input type="checkbox" ${data.clarityChecklist[item.key] ? 'checked' : ''}> ${item.label}`;
    div.querySelector('input').addEventListener('change', e => {
      AudioSys.init();
      AudioSys.play('check');
      data.clarityChecklist[item.key] = e.target.checked;
      div.classList.toggle('done', e.target.checked);
      saveData();
    });
    container.appendChild(div);
  });
}

// Comfort checklist
document.querySelectorAll('[data-comfort]').forEach(cb => {
  const key = cb.dataset.comfort;
  cb.checked = data.comfortChecklist[key] || false;
  cb.parentElement.classList.toggle('done', cb.checked);
  cb.addEventListener('change', () => {
    AudioSys.init();
    AudioSys.play('check');
    data.comfortChecklist[key] = cb.checked;
    cb.parentElement.classList.toggle('done', cb.checked);
    saveData();
  });
});

// Save notes
document.getElementById('btn-save-clarity').addEventListener('click', () => {
  AudioSys.init();
  data.clarityNotes = document.getElementById('clarity-notes').value;
  saveData();
  AudioSys.play('save');
  showToast('Clarity notes saved!');
});

document.getElementById('btn-save-comfort').addEventListener('click', () => {
  AudioSys.init();
  data.comfortNotes = document.getElementById('comfort-notes').value;
  saveData();
  AudioSys.play('save');
  showToast('Comfort reflection saved!');
});

document.getElementById('btn-save-rewrite').addEventListener('click', () => {
  AudioSys.init();
  const orig = document.getElementById('texture-original').value;
  const rewrite = document.getElementById('texture-rewrite').value;
  if (orig && rewrite) {
    data.rewrites = data.rewrites || [];
    data.rewrites.push({ original: orig, rewrite: rewrite, date: new Date().toISOString() });
    document.getElementById('texture-original').value = '';
    document.getElementById('texture-rewrite').value = '';
    saveData();
    AudioSys.play('save');
    showToast('Rewrite saved!');
  }
});

// Daily log
document.getElementById('btn-save-log').addEventListener('click', () => {
  AudioSys.init();
  const date = document.getElementById('log-date').value;
  const topic = document.getElementById('log-topic').value;
  const notes = document.getElementById('log-notes').value;
  if (!date || !topic) {
    showToast('Please fill in date and topic');
    return;
  }
  data.logs.push({
    date, topic, notes,
    clarity: ratings.clarity,
    texture: ratings.texture,
    comfort: ratings.comfort,
    timestamp: new Date().toISOString()
  });
  // Clear form
  document.getElementById('log-topic').value = '';
  document.getElementById('log-notes').value = '';
  ratings = { clarity: 0, texture: 0, comfort: 0 };
  document.querySelectorAll('.star').forEach(s => s.classList.remove('filled'));
  saveData();
  renderLogs();
  AudioSys.play('save');
  showToast('Session logged!');
});

function renderLogs() {
  const container = document.getElementById('log-entries');
  container.innerHTML = '';
  const sorted = [...data.logs].sort((a, b) => b.date.localeCompare(a.date));
  sorted.forEach((log, i) => {
    const div = document.createElement('div');
    div.className = 'log-entry';
    div.innerHTML = `
      <div class="log-date">${log.date}</div>
      <div class="log-topic">${log.topic}</div>
      <div class="log-notes">${log.notes || ''}</div>
      <div class="log-scores">
        <span class="log-score"><span class="label">Clarity:</span> <span class="val">${'&#9733;'.repeat(log.clarity)}${'&#9734;'.repeat(5-log.clarity)}</span></span>
        <span class="log-score"><span class="label">Texture:</span> <span class="val">${'&#9733;'.repeat(log.texture)}${'&#9734;'.repeat(5-log.texture)}</span></span>
        <span class="log-score"><span class="label">Comfort:</span> <span class="val">${'&#9733;'.repeat(log.comfort)}${'&#9734;'.repeat(5-log.comfort)}</span></span>
      </div>
    `;
    container.appendChild(div);
  });
}

// Dashboard
function updateDashboard() {
  const logs = data.logs;
  const n = logs.length;
  if (n === 0) {
    document.getElementById('dash-clarity').textContent = '0';
    document.getElementById('dash-texture').textContent = '0';
    document.getElementById('dash-comfort').textContent = '0';
    document.getElementById('dash-sessions').textContent = '0';
    document.getElementById('dash-mastered').textContent = '0';
    return;
  }
  const avgC = (logs.reduce((s, l) => s + (l.clarity || 0), 0) / n).toFixed(1);
  const avgT = (logs.reduce((s, l) => s + (l.texture || 0), 0) / n).toFixed(1);
  const avgCo = (logs.reduce((s, l) => s + (l.comfort || 0), 0) / n).toFixed(1);
  document.getElementById('dash-clarity').textContent = avgC;
  document.getElementById('dash-texture').textContent = avgT;
  document.getElementById('dash-comfort').textContent = avgCo;
  document.getElementById('bar-clarity').style.width = (avgC / 5 * 100) + '%';
  document.getElementById('bar-texture').style.width = (avgT / 5 * 100) + '%';
  document.getElementById('bar-comfort').style.width = (avgCo / 5 * 100) + '%';
  document.getElementById('dash-sessions').textContent = n;
  const mastered = data.topics.filter(t => (t.sessions || 0) >= 20).length;
  document.getElementById('dash-mastered').textContent = mastered;

  // Streak
  const dates = [...new Set(logs.map(l => l.date))].sort();
  let streak = 0;
  const today = new Date().toISOString().split('T')[0];
  let checkDate = today;
  for (let i = 0; i < 365; i++) {
    if (dates.includes(checkDate)) {
      streak++;
      const d = new Date(checkDate);
      d.setDate(d.getDate() - 1);
      checkDate = d.toISOString().split('T')[0];
    } else break;
  }
  document.getElementById('streak-count').textContent = streak;

  // Draw mini chart
  drawScoreChart();
}

function drawScoreChart() {
  const canvas = document.getElementById('viz-canvas');
  const ctx = canvas.getContext('2d');
  canvas.width = canvas.clientWidth;
  canvas.height = canvas.clientHeight || 200;
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  const logs = data.logs.slice(-30);
  if (logs.length < 2) {
    ctx.fillStyle = '#333355';
    ctx.font = '12px monospace';
    ctx.textAlign = 'center';
    ctx.fillText('Log at least 2 sessions to see chart', canvas.width / 2, canvas.height / 2);
    return;
  }

  const pad = 30;
  const w = canvas.width - pad * 2;
  const h = canvas.height - pad * 2;

  // Grid
  ctx.strokeStyle = '#1a1a2e';
  ctx.lineWidth = 0.5;
  for (let i = 0; i <= 5; i++) {
    const y = pad + h - (i / 5) * h;
    ctx.beginPath();
    ctx.moveTo(pad, y);
    ctx.lineTo(pad + w, y);
    ctx.stroke();
    ctx.fillStyle = '#333355';
    ctx.font = '10px monospace';
    ctx.textAlign = 'right';
    ctx.fillText(i.toString(), pad - 5, y + 4);
  }

  // Lines
  const dims = [
    { key: 'clarity', color: '#ff6688' },
    { key: 'texture', color: '#ffaa44' },
    { key: 'comfort', color: '#44ccff' }
  ];

  dims.forEach(dim => {
    ctx.beginPath();
    ctx.strokeStyle = dim.color;
    ctx.lineWidth = 2;
    logs.forEach((log, i) => {
      const x = pad + (i / (logs.length - 1)) * w;
      const y = pad + h - ((log[dim.key] || 0) / 5) * h;
      if (i === 0) ctx.moveTo(x, y);
      else ctx.lineTo(x, y);
    });
    ctx.stroke();
  });

  // Legend
  dims.forEach((dim, i) => {
    ctx.fillStyle = dim.color;
    ctx.font = '10px monospace';
    ctx.textAlign = 'left';
    ctx.fillText(dim.key.toUpperCase(), pad + i * 80, canvas.height - 5);
  });
}

// Progress chart
function drawProgressChart() {
  const canvas = document.getElementById('progress-canvas');
  const ctx = canvas.getContext('2d');
  canvas.width = canvas.clientWidth;
  canvas.height = canvas.clientHeight || 300;
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  const logs = data.logs;
  if (logs.length < 2) {
    ctx.fillStyle = '#333355';
    ctx.font = '14px monospace';
    ctx.textAlign = 'center';
    ctx.fillText('Log more sessions to see progress chart', canvas.width / 2, canvas.height / 2);
    return;
  }

  const pad = 40;
  const w = canvas.width - pad * 2;
  const h = canvas.height - pad * 2;

  // Aggregate by date
  const byDate = {};
  logs.forEach(l => {
    if (!byDate[l.date]) byDate[l.date] = [];
    byDate[l.date].push(l);
  });
  const dates = Object.keys(byDate).sort();
  const avgByDate = dates.map(d => {
    const entries = byDate[d];
    return {
      date: d,
      clarity: entries.reduce((s, e) => s + (e.clarity || 0), 0) / entries.length,
      texture: entries.reduce((s, e) => s + (e.texture || 0), 0) / entries.length,
      comfort: entries.reduce((s, e) => s + (e.comfort || 0), 0) / entries.length
    };
  });

  // Grid
  ctx.strokeStyle = '#1a1a2e';
  ctx.lineWidth = 0.5;
  for (let i = 0; i <= 5; i++) {
    const y = pad + h - (i / 5) * h;
    ctx.beginPath(); ctx.moveTo(pad, y); ctx.lineTo(pad + w, y); ctx.stroke();
    ctx.fillStyle = '#333355'; ctx.font = '10px monospace'; ctx.textAlign = 'right';
    ctx.fillText(i.toString(), pad - 5, y + 4);
  }

  // Area charts
  const dims = [
    { key: 'clarity', color: '#ff6688', fill: '#ff668822' },
    { key: 'texture', color: '#ffaa44', fill: '#ffaa4422' },
    { key: 'comfort', color: '#44ccff', fill: '#44ccff22' }
  ];

  dims.forEach(dim => {
    ctx.beginPath();
    avgByDate.forEach((d, i) => {
      const x = pad + (i / Math.max(avgByDate.length - 1, 1)) * w;
      const y = pad + h - (d[dim.key] / 5) * h;
      if (i === 0) ctx.moveTo(x, y);
      else ctx.lineTo(x, y);
    });
    ctx.strokeStyle = dim.color;
    ctx.lineWidth = 2;
    ctx.stroke();

    // Fill area
    const lastX = pad + w;
    ctx.lineTo(lastX, pad + h);
    ctx.lineTo(pad, pad + h);
    ctx.closePath();
    ctx.fillStyle = dim.fill;
    ctx.fill();
  });

  // Date labels
  ctx.fillStyle = '#444466';
  ctx.font = '9px monospace';
  ctx.textAlign = 'center';
  const labelInterval = Math.max(1, Math.floor(dates.length / 6));
  dates.forEach((d, i) => {
    if (i % labelInterval === 0) {
      const x = pad + (i / Math.max(dates.length - 1, 1)) * w;
      ctx.fillText(d.slice(5), x, pad + h + 15);
    }
  });

  // Stats
  const totalDays = dates.length;
  let longestStreak = 0, currentStreak = 0;
  for (let i = 0; i < dates.length; i++) {
    if (i === 0) { currentStreak = 1; continue; }
    const prev = new Date(dates[i-1]);
    const curr = new Date(dates[i]);
    const diff = (curr - prev) / (1000 * 60 * 60 * 24);
    if (diff === 1) currentStreak++;
    else currentStreak = 1;
    if (currentStreak > longestStreak) longestStreak = currentStreak;
  }
  document.getElementById('stat-days').textContent = totalDays;
  document.getElementById('stat-streak').textContent = longestStreak;
  document.getElementById('stat-avg-clarity').textContent = (logs.reduce((s,l) => s + (l.clarity||0), 0) / logs.length).toFixed(1);
  document.getElementById('stat-avg-texture').textContent = (logs.reduce((s,l) => s + (l.texture||0), 0) / logs.length).toFixed(1);
  document.getElementById('stat-avg-comfort').textContent = (logs.reduce((s,l) => s + (l.comfort||0), 0) / logs.length).toFixed(1);
  document.getElementById('stat-phrases').textContent = data.phrases.length;
  document.getElementById('stat-topics').textContent = data.topics.length;
}

// Export/Import
document.getElementById('btn-export').addEventListener('click', () => {
  AudioSys.init();
  AudioSys.play('save');
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'speaking-tracker-' + new Date().toISOString().split('T')[0] + '.json';
  a.click();
  URL.revokeObjectURL(a.href);
  showToast('Data exported!');
});

document.getElementById('btn-import').addEventListener('click', () => {
  AudioSys.init();
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = '.json';
  input.addEventListener('change', e => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = ev => {
      try {
        data = JSON.parse(ev.target.result);
        saveData();
        initUI();
        AudioSys.play('save');
        showToast('Data imported!');
      } catch(err) {
        showToast('Invalid file');
      }
    };
    reader.readAsText(file);
  });
  input.click();
});

document.getElementById('btn-reset').addEventListener('click', () => {
  if (confirm('Reset all data? This cannot be undone.')) {
    AudioSys.init();
    AudioSys.play('delete');
    data = { topics: [], phrases: [], logs: [], clarityNotes: '', comfortNotes: '', rewrites: [], comfortChecklist: {}, clarityChecklist: {} };
    saveData();
    initUI();
    showToast('Data reset.');
  }
});

// Set default date
document.getElementById('log-date').value = new Date().toISOString().split('T')[0];

// Initialize
function initUI() {
  renderTopics();
  renderPhrases();
  renderClarityChecklist();
  renderLogs();
  updateDashboard();
  document.getElementById('clarity-notes').value = data.clarityNotes || '';
  document.getElementById('comfort-notes').value = data.comfortNotes || '';
  // Restore comfort checkboxes
  document.querySelectorAll('[data-comfort]').forEach(cb => {
    cb.checked = data.comfortChecklist[cb.dataset.comfort] || false;
    cb.parentElement.classList.toggle('done', cb.checked);
  });
}

loadData();
initUI();
</script>
</body>
</html>