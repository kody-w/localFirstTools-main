<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mirage Simulator</title>
    <meta name="description" content="Interactive desert heat distortion and optical illusion explorer with physics-based refraction">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #f4e8c0; min-height: 100vh; font-family: monospace; color: #5a4020; overflow: hidden; }
        #canvas { position: fixed; top: 0; left: 0; }
        #controls {
            position: fixed; top: 20px; left: 20px; background: rgba(255,250,230,0.95);
            padding: 20px; border-radius: 10px; border: 1px solid rgba(180,140,60,0.3);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1); z-index: 100;
        }
        h3 { margin-bottom: 15px; color: #8a5a20; }
        .control-row { margin: 10px 0; }
        label { display: block; font-size: 11px; margin-bottom: 5px; opacity: 0.8; }
        input[type="range"] { width: 140px; }
        .value { float: right; color: #a06020; font-size: 12px; }
        button {
            display: block; width: 100%; padding: 10px; margin: 6px 0;
            background: rgba(200,160,80,0.3); border: 1px solid rgba(180,140,60,0.4);
            color: #5a4020; cursor: pointer; border-radius: 6px;
        }
        #temp-display {
            position: fixed; top: 20px; right: 20px; background: rgba(255,250,230,0.95);
            padding: 15px 25px; border-radius: 10px; border: 1px solid rgba(180,140,60,0.3);
            z-index: 100; text-align: center;
        }
        .temp-value { font-size: 28px; color: #c04020; }
        .temp-label { font-size: 10px; opacity: 0.7; }
        #info { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); font-size: 12px; opacity: 0.5; z-index: 100; }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div id="controls">
        <h3>Desert Heat</h3>
        <div class="control-row">
            <label>Temperature <span class="value" id="temp-val">45C</span></label>
            <input type="range" id="temp" min="30" max="60" value="45">
        </div>
        <div class="control-row">
            <label>Distance <span class="value" id="dist-val">2km</span></label>
            <input type="range" id="distance" min="1" max="10" value="2">
        </div>
        <div class="control-row">
            <label>Wind Speed <span class="value" id="wind-val">5</span></label>
            <input type="range" id="wind" min="0" max="20" value="5">
        </div>
        <button id="oasis-btn">Toggle Oasis</button>
    </div>
    <div id="temp-display">
        <div class="temp-value" id="current-temp">45°C</div>
        <div class="temp-label">Ground Temperature</div>
    </div>
    <div id="info">Watch heat waves distort the horizon | Adjust temperature to see mirages form</div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let W, H;
        function resize() { W = canvas.width = innerWidth; H = canvas.height = innerHeight; }
        resize(); window.onresize = resize;
        
        let temperature = 45;
        let distance = 2;
        let windSpeed = 5;
        let showOasis = true;
        let time = 0;
        let heatWaves = [];
        
        class HeatWave {
            constructor(y) {
                this.y = y;
                this.phase = Math.random() * Math.PI * 2;
                this.speed = 0.02 + Math.random() * 0.02;
                this.amplitude = 2 + Math.random() * 4;
                this.frequency = 0.01 + Math.random() * 0.01;
            }
            getOffset(x) {
                const heatFactor = (temperature - 30) / 30;
                return Math.sin(x * this.frequency + this.phase + time * (windSpeed * 0.1)) 
                    * this.amplitude * heatFactor;
            }
        }
        
        function initHeatWaves() {
            heatWaves = [];
            for (let y = H * 0.4; y < H; y += 10) {
                heatWaves.push(new HeatWave(y));
            }
        }
        
        function drawSky() {
            const gradient = ctx.createLinearGradient(0, 0, 0, H * 0.5);
            gradient.addColorStop(0, '#87ceeb');
            gradient.addColorStop(0.5, '#b0d4e8');
            gradient.addColorStop(1, '#e8e0c8');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, W, H * 0.5);
            
            ctx.beginPath();
            ctx.arc(W * 0.8, H * 0.15, 50, 0, Math.PI * 2);
            const sunGrad = ctx.createRadialGradient(W * 0.8, H * 0.15, 0, W * 0.8, H * 0.15, 100);
            sunGrad.addColorStop(0, 'rgba(255, 255, 200, 1)');
            sunGrad.addColorStop(0.3, 'rgba(255, 240, 150, 0.8)');
            sunGrad.addColorStop(1, 'transparent');
            ctx.fillStyle = sunGrad;
            ctx.fill();
        }
        
        function drawDesert() {
            const horizonY = H * 0.5;
            
            const sandGrad = ctx.createLinearGradient(0, horizonY, 0, H);
            sandGrad.addColorStop(0, '#e8d4a0');
            sandGrad.addColorStop(0.3, '#d4c090');
            sandGrad.addColorStop(1, '#c4a870');
            ctx.fillStyle = sandGrad;
            ctx.fillRect(0, horizonY, W, H - horizonY);
            
            for (let i = 0; i < 5; i++) {
                const duneX = (i * W / 4) + Math.sin(time * 0.1 + i) * 20;
                const duneY = horizonY + 50 + i * 30;
                const duneWidth = 200 + i * 50;
                const duneHeight = 30 + i * 15;
                
                ctx.beginPath();
                ctx.moveTo(duneX - duneWidth, duneY + duneHeight);
                ctx.quadraticCurveTo(duneX, duneY - duneHeight, duneX + duneWidth, duneY + duneHeight);
                ctx.fillStyle = "rgba(200, 170, 100, " + (0.2 + i * 0.1) + ")";
                ctx.fill();
            }
        }
        
        function drawMirage() {
            const mirageY = H * 0.55;
            const heatFactor = (temperature - 30) / 30;
            
            if (heatFactor > 0.3) {
                const mirageGrad = ctx.createLinearGradient(0, mirageY - 20, 0, mirageY + 50);
                mirageGrad.addColorStop(0, 'transparent');
                mirageGrad.addColorStop(0.3, "rgba(135, 206, 235, " + (heatFactor * 0.3) + ")");
                mirageGrad.addColorStop(0.7, "rgba(176, 224, 240, " + (heatFactor * 0.4) + ")");
                mirageGrad.addColorStop(1, 'transparent');
                
                ctx.fillStyle = mirageGrad;
                
                ctx.beginPath();
                ctx.moveTo(0, mirageY);
                for (let x = 0; x <= W; x += 5) {
                    const wave = heatWaves[0] ? heatWaves[0].getOffset(x) * 2 : 0;
                    ctx.lineTo(x, mirageY + wave);
                }
                ctx.lineTo(W, mirageY + 60);
                ctx.lineTo(0, mirageY + 60);
                ctx.closePath();
                ctx.fill();
            }
        }
        
        function drawOasis() {
            if (!showOasis) return;
            
            const oasisX = W * 0.3;
            const oasisY = H * 0.52;
            const heatFactor = (temperature - 30) / 30;
            
            const shimmer = Math.sin(time * 2) * heatFactor * 10;
            
            ctx.save();
            ctx.translate(oasisX, oasisY);
            
            for (let i = 0; i < 3; i++) {
                const palmX = -40 + i * 40 + shimmer * (i - 1) * 0.3;
                const palmY = 0;
                
                ctx.beginPath();
                ctx.moveTo(palmX, palmY);
                ctx.quadraticCurveTo(palmX + 5, palmY - 40, palmX + 3, palmY - 60);
                ctx.strokeStyle = '#5a4020';
                ctx.lineWidth = 4;
                ctx.stroke();
                
                for (let j = 0; j < 5; j++) {
                    const angle = -0.8 + j * 0.4;
                    const leafLen = 30;
                    ctx.beginPath();
                    ctx.moveTo(palmX + 3, palmY - 55);
                    ctx.quadraticCurveTo(
                        palmX + 3 + Math.cos(angle) * leafLen * 0.6,
                        palmY - 55 + Math.sin(angle) * leafLen * 0.3,
                        palmX + 3 + Math.cos(angle) * leafLen,
                        palmY - 55 + Math.sin(angle) * leafLen
                    );
                    ctx.strokeStyle = '#2a5a20';
                    ctx.lineWidth = 3;
                    ctx.stroke();
                }
            }
            
            ctx.beginPath();
            ctx.ellipse(0, 20, 50 + shimmer, 15, 0, 0, Math.PI * 2);
            ctx.fillStyle = "rgba(100, 180, 220, " + (0.4 + heatFactor * 0.2) + ")";
            ctx.fill();
            
            ctx.restore();
        }
        
        function drawHeatDistortion() {
            const imageData = ctx.getImageData(0, H * 0.4, W, H * 0.6);
            const data = imageData.data;
            const heatFactor = (temperature - 30) / 30;
            
            if (heatFactor > 0.2) {
                for (let y = 0; y < imageData.height; y += 3) {
                    const wave = heatWaves[Math.floor(y / 10)];
                    if (!wave) continue;
                    
                    const offset = Math.floor(wave.getOffset(y * 10) * 2);
                    if (Math.abs(offset) < 1) continue;
                    
                    for (let x = 0; x < imageData.width; x++) {
                        const srcX = Math.max(0, Math.min(imageData.width - 1, x + offset));
                        const srcIdx = (y * imageData.width + srcX) * 4;
                        const dstIdx = (y * imageData.width + x) * 4;
                        
                        data[dstIdx] = data[srcIdx];
                        data[dstIdx + 1] = data[srcIdx + 1];
                        data[dstIdx + 2] = data[srcIdx + 2];
                    }
                }
                ctx.putImageData(imageData, 0, H * 0.4);
            }
        }
        
        function drawHeatParticles() {
            const heatFactor = (temperature - 30) / 30;
            
            for (let i = 0; i < 50 * heatFactor; i++) {
                const x = Math.random() * W;
                const y = H * 0.5 + Math.random() * H * 0.3;
                const rise = Math.sin(time * 3 + i) * 2;
                
                ctx.beginPath();
                ctx.moveTo(x, y);
                ctx.lineTo(x + (Math.random() - 0.5) * 10, y - 10 + rise);
                ctx.strokeStyle = "rgba(255, 200, 100, " + (0.1 * heatFactor) + ")";
                ctx.lineWidth = 1;
                ctx.stroke();
            }
        }
        
        function animate() {
            time += 0.016;
            
            drawSky();
            drawDesert();
            drawMirage();
            drawOasis();
            drawHeatParticles();
            drawHeatDistortion();
            
            requestAnimationFrame(animate);
        }
        
        document.getElementById('temp').oninput = e => {
            temperature = parseInt(e.target.value);
            document.getElementById('temp-val').textContent = temperature + 'C';
            document.getElementById('current-temp').textContent = temperature + '°C';
        };
        
        document.getElementById('distance').oninput = e => {
            distance = parseInt(e.target.value);
            document.getElementById('dist-val').textContent = distance + 'km';
        };
        
        document.getElementById('wind').oninput = e => {
            windSpeed = parseInt(e.target.value);
            document.getElementById('wind-val').textContent = windSpeed;
        };
        
        document.getElementById('oasis-btn').onclick = () => {
            showOasis = !showOasis;
        };
        
        initHeatWaves();
        animate();
    </script>
</body>
</html>