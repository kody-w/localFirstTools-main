<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spectral Erosion</title>
    <meta name="description" content="Colors exert gravitational forces - warm hues pull and consume cooler wavelengths in a dance of chromatic dominance">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #0a0510; min-height: 100vh; font-family: 'Georgia', serif; color: #a080a0; overflow: hidden; }
        #canvas { position: fixed; top: 0; left: 0; }
        #controls {
            position: fixed; top: 20px; left: 20px; background: rgba(20,10,25,0.95);
            padding: 20px; border-radius: 10px; border: 1px solid rgba(160,100,180,0.3);
            z-index: 100;
        }
        h3 { margin-bottom: 15px; color: #d0a0e0; font-weight: normal; }
        .control-row { margin: 10px 0; }
        label { display: block; font-size: 11px; margin-bottom: 5px; opacity: 0.8; }
        input[type="range"] { width: 140px; }
        .value { float: right; color: #e0b0f0; font-size: 12px; }
        .color-btn { display: inline-block; width: 25px; height: 25px; border-radius: 50%; margin: 2px; cursor: pointer; border: 2px solid transparent; }
        .color-btn.selected { border-color: white; }
        button {
            display: block; width: 100%; padding: 10px; margin: 6px 0;
            background: rgba(100,60,140,0.4); border: 1px solid rgba(160,100,180,0.4);
            color: #b090c0; cursor: pointer; border-radius: 6px; font-family: inherit;
        }
        #info { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); font-size: 12px; opacity: 0.5; z-index: 100; }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div id="controls">
        <h3>Spectral Erosion</h3>
        <div class="control-row">
            <label>Inject Color</label>
            <div id="color-palette"></div>
        </div>
        <div class="control-row">
            <label>Gravity Strength <span class="value" id="gravity-val">50</span></label>
            <input type="range" id="gravity" min="10" max="100" value="50">
        </div>
        <div class="control-row">
            <label>Erosion Rate <span class="value" id="erosion-val">40</span></label>
            <input type="range" id="erosion" min="10" max="100" value="40">
        </div>
        <button id="spawn-btn">Spawn Wave</button>
        <button id="clear-btn">Clear Field</button>
    </div>
    <div id="info">Click to inject color | Watch chromatic gravity consume weaker wavelengths</div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let W, H;
        function resize() { W = canvas.width = innerWidth; H = canvas.height = innerHeight; }
        resize(); window.onresize = resize;
        
        const COLORS = [
            { hue: 0, name: 'Red', mass: 1.0 },
            { hue: 30, name: 'Orange', mass: 0.9 },
            { hue: 60, name: 'Yellow', mass: 0.8 },
            { hue: 120, name: 'Green', mass: 0.6 },
            { hue: 180, name: 'Cyan', mass: 0.5 },
            { hue: 240, name: 'Blue', mass: 0.4 },
            { hue: 280, name: 'Purple', mass: 0.7 }
        ];
        
        let selectedColor = 0;
        let gravityStrength = 0.5;
        let erosionRate = 0.4;
        let time = 0;
        
        const particles = [];
        
        function createPalette() {
            const palette = document.getElementById('color-palette');
            COLORS.forEach((color, i) => {
                const btn = document.createElement('div');
                btn.className = 'color-btn' + (i === selectedColor ? ' selected' : '');
                btn.style.background = "hsl(" + color.hue + ", 80%, 50%)";
                btn.onclick = () => {
                    document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('selected'));
                    btn.classList.add('selected');
                    selectedColor = i;
                };
                palette.appendChild(btn);
            });
        }
        createPalette();
        
        class ColorParticle {
            constructor(x, y, colorIndex) {
                this.x = x;
                this.y = y;
                this.vx = (Math.random() - 0.5) * 2;
                this.vy = (Math.random() - 0.5) * 2;
                this.colorIndex = colorIndex;
                this.hue = COLORS[colorIndex].hue;
                this.mass = COLORS[colorIndex].mass;
                this.size = 6 + this.mass * 4;
                this.saturation = 80;
                this.lightness = 50;
                this.trail = [];
            }
            
            update() {
                let totalFx = 0;
                let totalFy = 0;
                
                particles.forEach(other => {
                    if (other === this) return;
                    
                    const dx = other.x - this.x;
                    const dy = other.y - this.y;
                    const dist = Math.hypot(dx, dy);
                    
                    if (dist < 5 || dist > 300) return;
                    
                    const hueDiff = Math.abs(this.hue - other.hue);
                    const normalizedDiff = Math.min(hueDiff, 360 - hueDiff) / 180;
                    
                    const attraction = (other.mass - this.mass) * gravityStrength;
                    const force = attraction * 50 / (dist * dist);
                    
                    totalFx += (dx / dist) * force;
                    totalFy += (dy / dist) * force;
                    
                    if (dist < 30 && other.mass > this.mass) {
                        const erosion = erosionRate * 0.002 * (other.mass - this.mass);
                        this.hue += (other.hue - this.hue) * erosion;
                        if (this.hue < 0) this.hue += 360;
                        if (this.hue > 360) this.hue -= 360;
                        
                        this.saturation = Math.max(20, this.saturation - erosion * 5);
                        
                        const closestColor = COLORS.reduce((best, c, i) => {
                            const diff = Math.abs(c.hue - this.hue);
                            return diff < best.diff ? { i, diff } : best;
                        }, { i: 0, diff: Infinity });
                        this.mass = COLORS[closestColor.i].mass * (this.saturation / 80);
                    }
                });
                
                this.vx += totalFx;
                this.vy += totalFy;
                this.vx *= 0.98;
                this.vy *= 0.98;
                
                this.x += this.vx;
                this.y += this.vy;
                
                if (this.x < 0) { this.x = 0; this.vx *= -0.5; }
                if (this.x > W) { this.x = W; this.vx *= -0.5; }
                if (this.y < 0) { this.y = 0; this.vy *= -0.5; }
                if (this.y > H) { this.y = H; this.vy *= -0.5; }
                
                this.trail.push({ x: this.x, y: this.y, hue: this.hue });
                if (this.trail.length > 20) this.trail.shift();
                
                return this.saturation > 10;
            }
            
            draw() {
                if (this.trail.length > 1) {
                    ctx.beginPath();
                    ctx.moveTo(this.trail[0].x, this.trail[0].y);
                    for (let i = 1; i < this.trail.length; i++) {
                        ctx.lineTo(this.trail[i].x, this.trail[i].y);
                    }
                    ctx.strokeStyle = "hsla(" + this.hue + ", " + this.saturation + "%, 40%, 0.3)";
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }
                
                const gradient = ctx.createRadialGradient(this.x, this.y, 0, this.x, this.y, this.size * 2);
                gradient.addColorStop(0, "hsla(" + this.hue + ", " + this.saturation + "%, " + this.lightness + "%, 0.8)");
                gradient.addColorStop(0.5, "hsla(" + this.hue + ", " + (this.saturation * 0.7) + "%, " + (this.lightness * 0.7) + "%, 0.4)");
                gradient.addColorStop(1, "transparent");
                ctx.fillStyle = gradient;
                ctx.fillRect(this.x - this.size * 2, this.y - this.size * 2, this.size * 4, this.size * 4);
                
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = "hsla(" + this.hue + ", " + this.saturation + "%, " + this.lightness + "%, 0.9)";
                ctx.fill();
            }
        }
        
        function drawBackground() {
            ctx.fillStyle = '#0a0510';
            ctx.fillRect(0, 0, W, H);
        }
        
        function animate() {
            time += 0.016;
            
            drawBackground();
            
            for (let i = particles.length - 1; i >= 0; i--) {
                if (!particles[i].update()) {
                    particles.splice(i, 1);
                }
            }
            
            particles.forEach(p => p.draw());
            
            requestAnimationFrame(animate);
        }
        
        canvas.onclick = e => {
            if (e.clientX < 200 && e.clientY < 320) return;
            
            for (let i = 0; i < 8; i++) {
                particles.push(new ColorParticle(
                    e.clientX + (Math.random() - 0.5) * 40,
                    e.clientY + (Math.random() - 0.5) * 40,
                    selectedColor
                ));
            }
        };
        
        document.getElementById('gravity').oninput = e => {
            gravityStrength = e.target.value / 100;
            document.getElementById('gravity-val').textContent = e.target.value;
        };
        
        document.getElementById('erosion').oninput = e => {
            erosionRate = e.target.value / 100;
            document.getElementById('erosion-val').textContent = e.target.value;
        };
        
        document.getElementById('spawn-btn').onclick = () => {
            for (let i = 0; i < 30; i++) {
                particles.push(new ColorParticle(
                    Math.random() * W,
                    Math.random() * H,
                    Math.floor(Math.random() * COLORS.length)
                ));
            }
        };
        
        document.getElementById('clear-btn').onclick = () => {
            particles.length = 0;
        };
        
        for (let i = 0; i < 40; i++) {
            particles.push(new ColorParticle(
                Math.random() * W,
                Math.random() * H,
                Math.floor(Math.random() * COLORS.length)
            ));
        }
        
        animate();
    </script>
</body>
</html>