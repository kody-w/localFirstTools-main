<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>War Card Game Tutor</title>
    <meta name="description" content="Interactive companion for learning the card game War. Input your physical cards and get real-time guidance on rules and winning.">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #e74c3c;
            --accent: #3498db;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #27ae60;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--light);
            color: var(--dark);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            width: 100%;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #eee;
            padding-bottom: 20px;
        }

        h1 {
            margin: 0;
            color: var(--primary);
            font-size: 2.5rem;
        }

        .subtitle {
            color: #7f8c8d;
            font-size: 1.1rem;
        }

        .game-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 600px) {
            .game-area {
                grid-template-columns: 1fr;
            }
        }

        .player-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .player-section.winner {
            border-color: var(--success);
            background: #e8f8f5;
        }

        .player-section h2 {
            margin-top: 0;
            color: var(--primary);
        }

        .card-input {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .rank-btn {
            width: 100%;
            height: 60px;
            font-size: 1.2rem;
            border: 2px solid #bdc3c7;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.1s;
            touch-action: manipulation; /* Better for touch */
        }

        .rank-btn:active {
            transform: scale(0.95);
        }

        .rank-btn:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .rank-btn.selected {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 0 10px rgba(44, 62, 80, 0.5);
        }

        .voice-controls {
            text-align: center;
            margin-bottom: 20px;
        }

        .btn-voice {
            background: #8e44ad;
            color: white;
            font-size: 1.1rem;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .btn-voice.listening {
            background: #e74c3c;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(231, 76, 60, 0); }
            100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); }
        }

        /* Make suit selector bigger too */
        .suit-btn {
            font-size: 1.5rem;
            padding: 10px 20px;
            flex: 1;
        }

        .action-area {
            text-align: center;
            margin: 20px 0;
        }

        .btn {
            padding: 12px 30px;
            font-size: 1.2rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }

        .btn-reset {
            background: #95a5a6;
            color: white;
            font-size: 0.9rem;
            padding: 8px 20px;
            margin-top: 20px;
        }

        .guidance-box {
            background: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 20px;
            margin-top: 20px;
            border-radius: 5px;
            display: none;
        }

        .guidance-box.active {
            display: block;
            animation: slideIn 0.3s ease-out;
        }

        .guidance-title {
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 10px;
            display: block;
        }

        .war-alert {
            background: #f8d7da;
            border-left: 5px solid #dc3545;
            color: #721c24;
        }

        .history-log {
            margin-top: 30px;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }

        .history-item {
            padding: 10px;
            border-bottom: 1px solid #f1f1f1;
            font-size: 0.9rem;
            color: #666;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card-display {
            font-size: 3rem;
            width: 100px;
            height: 140px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 10px auto;
            background: white;
            border: 3px solid #333;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .suit-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .suit-btn {
            font-size: 1.2rem;
            padding: 5px 10px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 5px;
            cursor: pointer;
        }

        .suit-btn.selected {
            background: #eee;
            border-color: #aaa;
        }

        .red { color: #e74c3c; }
        .black { color: #2c3e50; }

        .card-back {
            background: linear-gradient(135deg, #2c3e50 25%, #34495e 50%, #2c3e50 75%);
            color: white;
            font-weight: bold;
        }

    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>War Tutor</h1>
        <div class="subtitle">Play with your physical deck, I'll teach you the rules.</div>
        <div class="voice-controls" style="margin-top: 15px;">
            <button id="voice-btn" class="btn btn-voice" onclick="toggleVoice()">
                <span>üéôÔ∏è</span> Enable Voice Control
            </button>
            <div style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                Say "Player Ace", "Opponent 5", "Reset", etc.
            </div>
        </div>
    </header>

    <div class="game-area">
        <div class="player-section" id="player-area">
            <h2>You</h2>
            <div class="card-display card-back" id="player-card-display">?</div>
            <div class="suit-selector">
                <button class="suit-btn black" onclick="selectSuit('player', '‚ô†')">‚ô†</button>
                <button class="suit-btn red" onclick="selectSuit('player', '‚ô•')">‚ô•</button>
                <button class="suit-btn black" onclick="selectSuit('player', '‚ô£')">‚ô£</button>
                <button class="suit-btn red" onclick="selectSuit('player', '‚ô¶')">‚ô¶</button>
            </div>
            <div class="card-input">
                <button class="rank-btn" onclick="selectRank('player', 2)">2</button>
                <button class="rank-btn" onclick="selectRank('player', 3)">3</button>
                <button class="rank-btn" onclick="selectRank('player', 4)">4</button>
                <button class="rank-btn" onclick="selectRank('player', 5)">5</button>
                <button class="rank-btn" onclick="selectRank('player', 6)">6</button>
                <button class="rank-btn" onclick="selectRank('player', 7)">7</button>
                <button class="rank-btn" onclick="selectRank('player', 8)">8</button>
                <button class="rank-btn" onclick="selectRank('player', 9)">9</button>
                <button class="rank-btn" onclick="selectRank('player', 10)">10</button>
                <button class="rank-btn" onclick="selectRank('player', 11)">J</button>
                <button class="rank-btn" onclick="selectRank('player', 12)">Q</button>
                <button class="rank-btn" onclick="selectRank('player', 13)">K</button>
                <button class="rank-btn" onclick="selectRank('player', 14)">A</button>
            </div>
        </div>

        <div class="player-section" id="opponent-area">
            <h2>Opponent</h2>
            <div class="card-display card-back" id="opponent-card-display">?</div>
            <div class="suit-selector">
                <button class="suit-btn black" onclick="selectSuit('opponent', '‚ô†')">‚ô†</button>
                <button class="suit-btn red" onclick="selectSuit('opponent', '‚ô•')">‚ô•</button>
                <button class="suit-btn black" onclick="selectSuit('opponent', '‚ô£')">‚ô£</button>
                <button class="suit-btn red" onclick="selectSuit('opponent', '‚ô¶')">‚ô¶</button>
            </div>
            <div class="card-input">
                <button class="rank-btn" onclick="selectRank('opponent', 2)">2</button>
                <button class="rank-btn" onclick="selectRank('opponent', 3)">3</button>
                <button class="rank-btn" onclick="selectRank('opponent', 4)">4</button>
                <button class="rank-btn" onclick="selectRank('opponent', 5)">5</button>
                <button class="rank-btn" onclick="selectRank('opponent', 6)">6</button>
                <button class="rank-btn" onclick="selectRank('opponent', 7)">7</button>
                <button class="rank-btn" onclick="selectRank('opponent', 8)">8</button>
                <button class="rank-btn" onclick="selectRank('opponent', 9)">9</button>
                <button class="rank-btn" onclick="selectRank('opponent', 10)">10</button>
                <button class="rank-btn" onclick="selectRank('opponent', 11)">J</button>
                <button class="rank-btn" onclick="selectRank('opponent', 12)">Q</button>
                <button class="rank-btn" onclick="selectRank('opponent', 13)">K</button>
                <button class="rank-btn" onclick="selectRank('opponent', 14)">A</button>
            </div>
        </div>
    </div>

    <div class="action-area">
        <button class="btn btn-primary" id="compare-btn" onclick="compareCards()" disabled>Compare Cards</button>
    </div>

    <div id="guidance" class="guidance-box">
        <span class="guidance-title">What happened?</span>
        <p id="guidance-text"></p>
    </div>

    <div class="action-area">
        <button class="btn btn-reset" onclick="resetGame()">Start New Game</button>
    </div>

    <div class="history-log">
        <h3>Game Log</h3>
        <div id="log-container"></div>
    </div>
</div>

<script>
    const state = {
        player: { rank: null, suit: null },
        opponent: { rank: null, suit: null },
        warMode: false,
        warPot: 0,
        voiceEnabled: false
    };

    // Voice Recognition Setup
    let recognition;
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new SpeechRecognition();
        recognition.continuous = true;
        recognition.interimResults = false;
        recognition.lang = 'en-US';

        recognition.onresult = (event) => {
            const last = event.results.length - 1;
            const command = event.results[last][0].transcript.toLowerCase().trim();
            console.log('Voice command:', command);
            processVoiceCommand(command);
        };

        recognition.onerror = (event) => {
            console.error('Speech recognition error', event.error);
            const btn = document.getElementById('voice-btn');
            btn.classList.remove('listening');
            btn.innerHTML = '<span>‚ö†Ô∏è</span> Error - Try Again';
            state.voiceEnabled = false;
        };
        
        recognition.onend = () => {
            if (state.voiceEnabled) {
                recognition.start();
            } else {
                const btn = document.getElementById('voice-btn');
                btn.classList.remove('listening');
                btn.innerHTML = '<span>üéôÔ∏è</span> Enable Voice Control';
            }
        };
    }

    function toggleVoice() {
        if (!recognition) {
            alert("Voice control is not supported in this browser. Try Chrome or Edge.");
            return;
        }

        const btn = document.getElementById('voice-btn');
        state.voiceEnabled = !state.voiceEnabled;

        if (state.voiceEnabled) {
            recognition.start();
            btn.classList.add('listening');
            btn.innerHTML = '<span>üî¥</span> Listening...';
        } else {
            recognition.stop();
            btn.classList.remove('listening');
            btn.innerHTML = '<span>üéôÔ∏è</span> Enable Voice Control';
        }
    }

    function processVoiceCommand(cmd) {
        // Map words to numbers
        const numberMap = {
            'two': 2, 'to': 2, 'too': 2,
            'three': 3, 'tree': 3,
            'four': 4, 'for': 4,
            'five': 5,
            'six': 6,
            'seven': 7,
            'eight': 8, 'ate': 8,
            'nine': 9,
            'ten': 10,
            'jack': 11,
            'queen': 12,
            'king': 13,
            'ace': 14
        };

        // Helper to extract rank
        const findRank = (str) => {
            for (const [word, val] of Object.entries(numberMap)) {
                if (str.includes(word)) return val;
            }
            // Check for digits
            const match = str.match(/\d+/);
            if (match) {
                const val = parseInt(match[0]);
                if (val >= 2 && val <= 10) return val;
            }
            return null;
        };

        if (cmd.includes('reset') || cmd.includes('new game')) {
            resetGame();
            return;
        }

        let target = null;
        if (cmd.includes('player') || cmd.includes('my') || cmd.includes('i have')) target = 'player';
        else if (cmd.includes('opponent') || cmd.includes('their') || cmd.includes('they')) target = 'opponent';

        const rank = findRank(cmd);

        if (rank) {
            if (target) {
                selectRank(target, rank);
            } else {
                // If no target specified, try to fill empty slot
                if (!state.player.rank) selectRank('player', rank);
                else if (!state.opponent.rank) selectRank('opponent', rank);
            }
        }
    }

    const rankNames = {
        11: 'Jack', 12: 'Queen', 13: 'King', 14: 'Ace'
    };

    function getRankName(rank) {
        return rankNames[rank] || rank;
    }

    function selectRank(who, rank) {
        state[who].rank = rank;
        updateUI(who);
        checkReady();
    }

    function selectSuit(who, suit) {
        state[who].suit = suit;
        updateUI(who);
    }

    function updateUI(who) {
        // Update buttons
        const area = document.getElementById(`${who}-area`);
        const rankBtns = area.querySelectorAll('.rank-btn');
        rankBtns.forEach(btn => {
            // Handle J, Q, K, A mapping for button selection
            let btnRank = btn.innerText;
            if (btnRank === 'J') btnRank = 11;
            else if (btnRank === 'Q') btnRank = 12;
            else if (btnRank === 'K') btnRank = 13;
            else if (btnRank === 'A') btnRank = 14;
            else btnRank = parseInt(btnRank);

            if (btnRank === state[who].rank) {
                btn.classList.add('selected');
            } else {
                btn.classList.remove('selected');
            }
        });

        const suitBtns = area.querySelectorAll('.suit-btn');
        suitBtns.forEach(btn => {
            if (btn.innerText === state[who].suit) {
                btn.classList.add('selected');
            } else {
                btn.classList.remove('selected');
            }
        });

        // Update display
        const display = document.getElementById(`${who}-card-display`);
        if (state[who].rank) {
            let rankText = getRankName(state[who].rank);
            if (typeof rankText === 'string' && rankText.length > 2) {
                rankText = rankText[0]; // J, Q, K, A
            }
            const suitText = state[who].suit || '';
            display.innerText = `${rankText}${suitText}`;
            display.className = `card-display ${['‚ô•', '‚ô¶'].includes(suitText) ? 'red' : 'black'}`;
        } else {
            // Reset to card back when no rank selected
            display.innerText = '?';
            display.className = 'card-display card-back';
        }
    }

    function checkReady() {
        const btn = document.getElementById('compare-btn');
        if (state.player.rank && state.opponent.rank) {
            btn.disabled = false;
            btn.innerText = state.warMode ? "Resolve War" : "Compare Cards";
            
            // Auto-compare for distracted users (UX improvement)
            // Small delay to let them see what they selected
            setTimeout(() => {
                if (state.player.rank && state.opponent.rank) {
                    compareCards();
                }
            }, 800);
        }
    }

    function compareCards() {
        const pRank = state.player.rank;
        const oRank = state.opponent.rank;
        const guidance = document.getElementById('guidance');
        const guidanceText = document.getElementById('guidance-text');
        const playerArea = document.getElementById('player-area');
        const opponentArea = document.getElementById('opponent-area');

        // Reset styles
        playerArea.classList.remove('winner');
        opponentArea.classList.remove('winner');
        guidance.className = 'guidance-box active';

        let message = '';
        let logMsg = '';

        if (pRank > oRank) {
            // Player wins
            const cardsWon = state.warMode ? (state.warPot + 2) : 2;
            message = `<strong>You win!</strong><br>${getRankName(pRank)} is higher than ${getRankName(oRank)}.`;
            if (state.warMode) {
                message += `<br>You win the War! Take all ${cardsWon} cards (the face-down ones and the face-up ones) and put them at the bottom of your deck.`;
            } else {
                message += `<br>Take both cards and put them at the bottom of your deck.`;
            }
            playerArea.classList.add('winner');
            logMsg = `You won with ${getRankName(pRank)} vs ${getRankName(oRank)}`;
            resetRound();
        } else if (oRank > pRank) {
            // Opponent wins
            const cardsWon = state.warMode ? (state.warPot + 2) : 2;
            message = `<strong>Opponent wins.</strong><br>${getRankName(oRank)} is higher than ${getRankName(pRank)}.`;
            if (state.warMode) {
                message += `<br>Opponent wins the War! They take all ${cardsWon} cards.`;
            } else {
                message += `<br>Give both cards to your opponent.`;
            }
            opponentArea.classList.add('winner');
            logMsg = `Opponent won with ${getRankName(oRank)} vs ${getRankName(pRank)}`;
            resetRound();
        } else {
            // Tie - WAR
            guidance.className = 'guidance-box active war-alert';
            message = `<strong>It's a Tie! (${getRankName(pRank)})</strong><br>This means <strong>WAR!</strong>`;
            message += `<br>1. Each player puts <strong>3 cards face down</strong>.`;
            message += `<br>2. Then, flip <strong>1 more card face up</strong>.`;
            message += `<br>Input the new face-up cards above to decide who gets everything.`;
            
            state.warMode = true;
            state.warPot += (state.warMode ? 2 : 2) + 6; // Previous cards + 3 face down each
            
            logMsg = `WAR triggered by ${getRankName(pRank)}s`;
            
            // Clear inputs for next round of war
            setTimeout(() => {
                state.player = { rank: null, suit: null };
                state.opponent = { rank: null, suit: null };
                updateUI('player');
                updateUI('opponent');
                document.getElementById('compare-btn').disabled = true;
                document.getElementById('compare-btn').innerText = "Resolve War";
            }, 500);
        }

        guidanceText.innerHTML = message;
        addToLog(logMsg);
    }

    function resetRound() {
        state.warMode = false;
        state.warPot = 0;
        state.player = { rank: null, suit: null };
        state.opponent = { rank: null, suit: null };
        
        document.getElementById('compare-btn').disabled = true;
        document.getElementById('compare-btn').innerText = "Compare Cards";
        
        // Clear selection UI after a delay
        setTimeout(() => {
            updateUI('player');
            updateUI('opponent');
        }, 2000);
    }

    function addToLog(msg) {
        const log = document.getElementById('log-container');
        const entry = document.createElement('div');
        entry.className = 'history-item';
        entry.innerText = `${new Date().toLocaleTimeString()} - ${msg}`;
        log.prepend(entry);
    }

    function resetGame() {
        state.warMode = false;
        state.warPot = 0;
        state.player = { rank: null, suit: null };
        state.opponent = { rank: null, suit: null };
        updateUI('player');
        updateUI('opponent');
        document.getElementById('guidance').classList.remove('active');
        document.getElementById('log-container').innerHTML = '';
        document.getElementById('player-area').classList.remove('winner');
        document.getElementById('opponent-area').classList.remove('winner');
    }
</script>

</body>
</html>