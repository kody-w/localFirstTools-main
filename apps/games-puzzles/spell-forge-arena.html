<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spell Forge Arena</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#0a0a1a;color:#e0e0e0;font-family:'Segoe UI',system-ui,sans-serif;overflow:hidden;width:100vw;height:100vh;user-select:none}
canvas{display:block}
.screen{position:absolute;top:0;left:0;width:100%;height:100%;display:none;flex-direction:column}
.screen.active{display:flex}
#menuScreen{justify-content:center;align-items:center;background:radial-gradient(ellipse at center,#1a1040 0%,#0a0a1a 70%)}
.menu-title{font-size:4em;font-weight:900;background:linear-gradient(135deg,#ff6600,#ffcc00,#00ccff,#9900ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-align:center;margin-bottom:10px;text-shadow:0 0 40px rgba(255,102,0,0.3)}
.menu-subtitle{font-size:1.2em;color:#8888aa;text-align:center;margin-bottom:40px}
.menu-btn{padding:15px 50px;font-size:1.3em;background:linear-gradient(135deg,#2a1a4a,#1a2a4a);border:2px solid #6644aa;color:#ccbbff;border-radius:12px;cursor:pointer;margin:8px;transition:all 0.3s;font-family:inherit}
.menu-btn:hover{background:linear-gradient(135deg,#4a2a6a,#2a4a6a);border-color:#aa66ff;box-shadow:0 0 20px rgba(102,68,170,0.5);transform:scale(1.05)}
.menu-btn.primary{border-color:#ff6600;color:#ffcc88;background:linear-gradient(135deg,#4a2200,#2a1a00)}
.menu-btn.primary:hover{border-color:#ff8800;box-shadow:0 0 20px rgba(255,102,0,0.5)}
#forgeScreen{background:#0a0a1a}
.forge-top{display:flex;justify-content:space-between;align-items:center;padding:8px 16px;background:#111128;border-bottom:1px solid #2a2a4a;z-index:10}
.forge-title{font-size:1.3em;color:#aa88ff}
.forge-actions button{padding:6px 18px;margin-left:8px;background:#1a1a3a;border:1px solid #4a4a6a;color:#aaa;border-radius:6px;cursor:pointer;font-family:inherit;font-size:0.9em}
.forge-actions button:hover{background:#2a2a5a;color:#fff}
.forge-actions .go-btn{border-color:#ff6600;color:#ff8844}
.forge-actions .go-btn:hover{background:#4a2200;box-shadow:0 0 10px rgba(255,102,0,0.3)}
.forge-body{display:flex;flex:1;overflow:hidden}
.forge-palette{width:200px;background:#0d0d22;border-right:1px solid #2a2a4a;overflow-y:auto;flex-shrink:0}
.palette-cat{padding:8px 12px;border-bottom:1px solid #1a1a3a}
.palette-cat-title{font-size:0.75em;text-transform:uppercase;letter-spacing:2px;color:#666;margin-bottom:6px}
.palette-item{padding:6px 10px;margin:3px 0;border-radius:6px;cursor:grab;font-size:0.85em;border:1px solid transparent;transition:all 0.2s;display:flex;align-items:center;gap:6px}
.palette-item:hover{border-color:var(--cat-color,#666);background:rgba(255,255,255,0.03)}
.palette-item.locked{opacity:0.3;cursor:not-allowed}
.palette-item .pip{width:8px;height:8px;border-radius:50%;background:var(--cat-color,#666)}
.forge-workspace{flex:1;position:relative;background:#08081a;overflow:hidden}
.forge-workspace canvas{position:absolute;top:0;left:0;width:100%;height:100%}
.forge-node{position:absolute;background:#151530;border:2px solid var(--node-color,#444);border-radius:10px;padding:10px 14px;min-width:120px;cursor:move;z-index:5;transition:box-shadow 0.2s}
.forge-node:hover{box-shadow:0 0 15px rgba(var(--node-rgb,100,100,100),0.3)}
.forge-node .node-title{font-size:0.8em;font-weight:700;color:var(--node-color,#aaa)}
.forge-node .node-type{font-size:0.65em;color:#666;text-transform:uppercase;letter-spacing:1px}
.forge-node .port{position:absolute;width:14px;height:14px;border-radius:50%;background:#222;border:2px solid var(--node-color,#444);cursor:crosshair;z-index:6}
.forge-node .port-in{left:-8px;top:50%;transform:translateY(-50%)}
.forge-node .port-out{right:-8px;top:50%;transform:translateY(-50%)}
.forge-node .port:hover{background:var(--node-color,#666);box-shadow:0 0 8px var(--node-color,#666)}
.forge-node.selected{box-shadow:0 0 20px rgba(var(--node-rgb,100,100,100),0.5)}
.forge-right{width:260px;background:#0d0d22;border-left:1px solid #2a2a4a;display:flex;flex-direction:column;flex-shrink:0}
.spell-preview{height:200px;border-bottom:1px solid #2a2a4a;position:relative}
.spell-preview canvas{width:100%;height:100%}
.spell-stats{padding:12px;flex:1;overflow-y:auto}
.spell-stats h3{font-size:0.85em;color:#888;margin-bottom:8px}
.stat-row{display:flex;justify-content:space-between;padding:4px 0;font-size:0.8em;border-bottom:1px solid #1a1a2a}
.stat-row .label{color:#666}
.stat-row .value{color:#aaa}
.spell-slots{display:flex;gap:8px;padding:12px;background:#111128;border-top:1px solid #2a2a4a}
.spell-slot{flex:1;aspect-ratio:1;background:#1a1a3a;border:2px solid #2a2a5a;border-radius:10px;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:all 0.2s;font-size:0.7em;text-align:center;padding:4px;position:relative}
.spell-slot:hover{border-color:#6644aa}
.spell-slot.active{border-color:#ff6600;box-shadow:0 0 10px rgba(255,102,0,0.3)}
.spell-slot .slot-key{position:absolute;top:3px;left:6px;font-size:0.8em;color:#555}
.spell-slot .slot-name{color:#aaa;font-size:0.9em}
.spell-slot.empty{border-style:dashed}
#arenaScreen{position:relative}
#arenaCanvas{width:100%;height:100%}
.arena-hud{position:absolute;top:0;left:0;width:100%;pointer-events:none;z-index:10}
.hud-top{display:flex;justify-content:space-between;padding:12px 16px}
.hud-bars{display:flex;flex-direction:column;gap:4px}
.hud-bar{width:200px;height:18px;background:#1a1a2a;border-radius:9px;overflow:hidden;position:relative}
.hud-bar-fill{height:100%;border-radius:9px;transition:width 0.3s}
.hp-fill{background:linear-gradient(90deg,#cc2222,#ff4444)}
.mana-fill{background:linear-gradient(90deg,#2244cc,#4488ff)}
.hud-bar-text{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:0.7em;font-weight:700;text-shadow:0 0 4px #000}
.hud-wave{font-size:1.2em;color:#aa88ff;text-shadow:0 0 10px rgba(170,136,255,0.5)}
.hud-bottom{position:absolute;bottom:12px;left:50%;transform:translateX(-50%);display:flex;gap:8px;pointer-events:auto}
.hud-spell{width:60px;height:60px;background:rgba(20,20,40,0.8);border:2px solid #2a2a5a;border-radius:10px;display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:0.7em;text-align:center;position:relative}
.hud-spell.active-spell{border-color:#ff6600;box-shadow:0 0 10px rgba(255,102,0,0.4)}
.hud-spell .cooldown-overlay{position:absolute;bottom:0;left:0;width:100%;background:rgba(0,0,0,0.6);border-radius:0 0 8px 8px}
.hud-spell .spell-key{position:absolute;top:2px;left:5px;font-size:0.85em;color:#555}
.wave-banner{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:2.5em;font-weight:900;color:#ff6600;text-shadow:0 0 30px rgba(255,102,0,0.5);opacity:0;transition:opacity 0.5s;pointer-events:none;z-index:20}
.wave-banner.show{opacity:1}
.discovery-banner{position:absolute;top:30%;left:50%;transform:translate(-50%,-50%);padding:15px 40px;background:linear-gradient(135deg,rgba(255,200,0,0.2),rgba(255,150,0,0.1));border:2px solid #ffcc00;border-radius:12px;font-size:1.5em;font-weight:900;color:#ffcc00;text-shadow:0 0 20px rgba(255,204,0,0.5);opacity:0;transition:opacity 0.5s;pointer-events:none;z-index:20}
.discovery-banner.show{opacity:1}
#waveScreen{justify-content:center;align-items:center;background:rgba(10,10,26,0.95)}
.wave-complete{text-align:center}
.wave-complete h2{font-size:2em;color:#ff6600;margin-bottom:10px}
.wave-complete p{color:#888;margin-bottom:20px}
.reward-list{margin:20px auto;max-width:400px}
.reward-item{padding:10px 16px;margin:6px 0;background:#1a1a3a;border:1px solid #3a3a5a;border-radius:8px;display:flex;align-items:center;gap:10px}
.reward-item .reward-icon{font-size:1.5em}
.reward-item .reward-text{color:#ccbbff;font-size:0.9em}
#spellbookScreen{background:#0a0a1a}
.spellbook-header{padding:16px;background:#111128;border-bottom:1px solid #2a2a4a;display:flex;justify-content:space-between;align-items:center}
.spellbook-header h2{color:#aa88ff}
.spellbook-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:12px;padding:16px;overflow-y:auto;flex:1}
.spellbook-card{background:#151530;border:1px solid #2a2a4a;border-radius:10px;padding:14px;cursor:pointer;transition:all 0.2s}
.spellbook-card:hover{border-color:#6644aa;transform:translateY(-2px)}
.spellbook-card h3{font-size:1em;margin-bottom:4px}
.spellbook-card p{font-size:0.8em;color:#666}
.spellbook-card .card-tags{display:flex;gap:4px;margin-top:8px;flex-wrap:wrap}
.spellbook-card .tag{padding:2px 8px;border-radius:4px;font-size:0.7em;background:rgba(255,255,255,0.05);border:1px solid #2a2a4a}
#gameoverScreen{justify-content:center;align-items:center;background:rgba(10,10,26,0.95)}
.gameover h2{font-size:3em;color:#cc2222;margin-bottom:10px;text-shadow:0 0 30px rgba(204,34,34,0.5)}
.gameover p{color:#888;margin-bottom:30px}
.mobile-controls{position:absolute;bottom:80px;left:16px;pointer-events:auto;z-index:15;display:none}
.dpad{width:130px;height:130px;position:relative}
.dpad-btn{position:absolute;width:42px;height:42px;background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.2);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:1.2em;color:rgba(255,255,255,0.5)}
.dpad-up{top:0;left:44px}.dpad-down{bottom:0;left:44px}.dpad-left{top:44px;left:0}.dpad-right{top:44px;right:0}
.modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);display:none;justify-content:center;align-items:center;z-index:100}
.modal-overlay.show{display:flex}
.modal{background:#151530;border:1px solid #3a3a5a;border-radius:14px;padding:24px;max-width:400px;width:90%}
.modal h3{margin-bottom:12px;color:#aa88ff}
.modal input{width:100%;padding:8px 12px;background:#0a0a1a;border:1px solid #3a3a5a;color:#e0e0e0;border-radius:6px;margin-bottom:12px;font-family:inherit}
.modal button{padding:8px 20px;margin-right:8px;border:1px solid #4a4a6a;background:#1a1a3a;color:#aaa;border-radius:6px;cursor:pointer;font-family:inherit}
@media(max-width:768px){
.forge-palette{width:140px}
.forge-right{width:200px}
.mobile-controls{display:block}
.menu-title{font-size:2.5em}
}
@media(max-width:500px){
.forge-body{flex-direction:column}
.forge-palette{width:100%;height:100px;flex-direction:row;overflow-x:auto;overflow-y:hidden;border-right:none;border-bottom:1px solid #2a2a4a}
.forge-right{width:100%;height:200px;flex-direction:row;border-left:none;border-top:1px solid #2a2a4a}
}
</style>
</head>
<body>
<div id="menuScreen" class="screen active">
<div>
<div class="menu-title">SPELL FORGE ARENA</div>
<div class="menu-subtitle">Program your spells. Fight with your creations.</div>
<div style="text-align:center">
<button class="menu-btn primary" onclick="Game.startNew()">New Game</button><br>
<button class="menu-btn" id="continueBtn" onclick="Game.continueGame()" style="display:none">Continue</button><br>
<button class="menu-btn" onclick="Game.showScreen('spellbook')" id="menuSpellbookBtn" style="display:none">Spell Book</button>
</div>
</div>
</div>
<div id="forgeScreen" class="screen">
<div class="forge-top">
<span class="forge-title">‚öí SPELL FORGE</span>
<div class="forge-actions">
<button onclick="Game.showScreen('spellbook')">üìñ Spell Book</button>
<button onclick="Forge.clearWorkspace()">üóë Clear</button>
<button class="go-btn" onclick="Game.enterArena()">‚öî Enter Arena</button>
</div>
</div>
<div class="forge-body">
<div class="forge-palette" id="forgePalette"></div>
<div class="forge-workspace" id="forgeWorkspace">
<canvas id="forgeCanvas"></canvas>
</div>
<div class="forge-right">
<div class="spell-preview"><canvas id="previewCanvas"></canvas></div>
<div class="spell-stats" id="spellStats"><h3>Select components to forge a spell</h3></div>
<div class="spell-slots" id="spellSlots"></div>
</div>
</div>
</div>
<div id="arenaScreen" class="screen">
<canvas id="arenaCanvas"></canvas>
<div class="arena-hud">
<div class="hud-top">
<div class="hud-bars">
<div class="hud-bar"><div class="hud-bar-fill hp-fill" id="hpBar"></div><div class="hud-bar-text" id="hpText">100/100</div></div>
<div class="hud-bar"><div class="hud-bar-fill mana-fill" id="manaBar"></div><div class="hud-bar-text" id="manaText">100/100</div></div>
</div>
<div class="hud-wave" id="waveText">Wave 1</div>
</div>
<div class="hud-bottom" id="hudSpells"></div>
</div>
<div class="wave-banner" id="waveBanner"></div>
<div class="discovery-banner" id="discoveryBanner"></div>
<div class="mobile-controls">
<div class="dpad">
<div class="dpad-btn dpad-up" data-dir="up">‚ñ≤</div>
<div class="dpad-btn dpad-down" data-dir="down">‚ñº</div>
<div class="dpad-btn dpad-left" data-dir="left">‚óÄ</div>
<div class="dpad-btn dpad-right" data-dir="right">‚ñ∂</div>
</div>
</div>
</div>
<div id="waveScreen" class="screen">
<div class="wave-complete">
<h2>Wave <span id="waveNum">1</span> Complete!</h2>
<p>Enemies slain: <span id="waveKills">0</span></p>
<div class="reward-list" id="rewardList"></div>
<button class="menu-btn primary" onclick="Game.showScreen('forge')">Return to Forge</button>
<button class="menu-btn" onclick="Game.enterArena()">Next Wave ‚Üí</button>
</div>
</div>
<div id="spellbookScreen" class="screen">
<div class="spellbook-header">
<h2>üìñ Spell Book</h2>
<button class="menu-btn" onclick="Game.returnFromSpellbook()">‚Üê Back</button>
</div>
<div class="spellbook-grid" id="spellbookGrid"></div>
</div>
<div id="gameoverScreen" class="screen">
<div class="gameover">
<h2>DEFEATED</h2>
<p>You fell on wave <span id="deathWave">1</span></p>
<button class="menu-btn primary" onclick="Game.startNew()">Try Again</button>
<button class="menu-btn" onclick="Game.showScreen('menu')">Menu</button>
</div>
</div>
<div class="modal-overlay" id="nameModal">
<div class="modal">
<h3>Name Your Spell</h3>
<input type="text" id="spellNameInput" placeholder="Enter spell name..." maxlength="30">
<div><button onclick="Forge.confirmName()">Save</button><button onclick="Forge.cancelName()">Cancel</button></div>
</div>
</div>
