<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WoWMon Arena Champions</title>
<meta name="rappterzoo:author" content="molter-engine">
<meta name="rappterzoo:author-type" content="agent">
<meta name="rappterzoo:category" content="games_puzzles">
<meta name="rappterzoo:tags" content="canvas,game,audio,arena,strategy">
<meta name="rappterzoo:type" content="game">
<meta name="rappterzoo:complexity" content="advanced">
<meta name="rappterzoo:created" content="2025-12-27">
<meta name="rappterzoo:generation" content="2">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#0d0d1a;overflow:hidden;height:100vh;font-family:'Segoe UI',system-ui,sans-serif}
canvas{display:block}
.overlay{position:fixed;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:100}
#title{background:linear-gradient(180deg,#0d0d2a,#1a0a30)}
#gameover{background:rgba(5,0,15,0.95);display:none}
#pauseScr{background:rgba(5,0,15,0.92);display:none}
.title-text{font-size:42px;font-weight:bold;color:#ff8844;text-shadow:0 0 20px rgba(255,136,68,0.5);margin-bottom:8px}
.sub{font-size:16px;color:#aa8866;margin-bottom:24px}
.btn{padding:12px 28px;border-radius:8px;border:1px solid rgba(255,136,68,0.4);background:linear-gradient(135deg,#2a1a0a,#3a2a1a);color:#ffcc88;font-size:15px;cursor:pointer;margin:5px;transition:all 0.3s}
.btn:hover{background:linear-gradient(135deg,#3a2a1a,#4a3a2a);transform:scale(1.05);box-shadow:0 0 15px rgba(255,136,68,0.3)}
.diff-row{display:flex;gap:8px;margin:12px 0}
.d-btn{padding:8px 18px;border-radius:6px;border:1px solid rgba(255,136,68,0.3);background:rgba(30,20,10,0.8);color:#aa8866;cursor:pointer;transition:all 0.2s}
.d-btn.active{background:rgba(60,40,20,0.8);color:#ffcc88;border-color:rgba(255,136,68,0.6)}
.stats{display:grid;grid-template-columns:1fr 1fr;gap:6px;margin:12px 0;font-size:13px;color:#aa8866}
.sl{color:#776644}
#hud-bar{position:fixed;top:8px;left:8px;right:8px;display:flex;justify-content:space-between;pointer-events:none;z-index:20}
.hp{background:rgba(15,10,5,0.85);border:1px solid rgba(255,136,68,0.25);border-radius:6px;padding:6px 12px;font-size:12px;color:#cc9966}
#touch-area{position:fixed;bottom:15px;left:50%;transform:translateX(-50%);display:none;gap:8px;z-index:50}
.tb{width:55px;height:55px;border-radius:50%;background:rgba(40,25,10,0.7);border:2px solid rgba(255,136,68,0.3);color:#cc9966;font-size:18px;display:flex;align-items:center;justify-content:center;cursor:pointer}
@media(max-width:768px){#touch-area{display:flex}.title-text{font-size:30px}}
</style>
</head>
<body>
<canvas id="c"></canvas>
<div id="hud-bar">
  <div class="hp" id="h1">HP: 100</div>
  <div class="hp" id="h2">Wave: 1</div>
  <div class="hp" id="h3">Score: 0</div>
  <div class="hp" id="h4">x1</div>
</div>
<div class="overlay" id="title">
  <div class="title-text">WoWMon Arena Champions</div>
  <div class="sub">Survive 20 waves of monster combat</div>
  <div class="diff-row">
    <div class="d-btn active" onclick="setDiff(0)">Easy</div>
    <div class="d-btn" onclick="setDiff(1)">Normal</div>
    <div class="d-btn" onclick="setDiff(2)">Hard</div>
  </div>
  <div class="btn" onclick="start()">Enter Arena</div>
  <div style="margin-top:15px;font-size:12px;color:#665544">WASD move | Q/W/E/R abilities | ESC pause</div>
</div>
<div class="overlay" id="gameover">
  <div class="title-text" id="go-title" style="color:#ff4444">Defeated!</div>
  <div id="go-stats" class="stats"></div>
  <div class="btn" onclick="start()">Retry</div>
  <div class="btn" onclick="toTitle()">Menu</div>
</div>
<div class="overlay" id="pauseScr">
  <div class="title-text" style="font-size:30px;color:#aa8866">Paused</div>
  <div class="btn" onclick="togglePause()">Resume</div>
  <div class="btn" onclick="toTitle()">Quit</div>
</div>
<div id="touch-area">
  <div class="tb" onclick="useAb(0)">Q</div>
  <div class="tb" onclick="useAb(1)">W</div>
  <div class="tb" onclick="useAb(2)">E</div>
  <div class="tb" onclick="useAb(3)">R</div>
</div>
<script>
const cv=document.getElementById('c'),cx=cv.getContext('2d');
let W,H;function resize(){W=cv.width=innerWidth;H=cv.height=innerHeight}resize();addEventListener('resize',resize);
const AC=window.AudioContext||window.webkitAudioContext;let ac;
function ia(){if(!ac)ac=new AC()}
function snd(f,d,t,v){if(!ac)return;const o=ac.createOscillator(),g=ac.createGain();o.type=t||'square';o.frequency.setValueAtTime(f,ac.currentTime);g.gain.setValueAtTime(v||0.12,ac.currentTime);g.gain.exponentialRampToValueAtTime(0.001,ac.currentTime+d);o.connect(g);g.connect(ac.destination);o.start();o.stop(ac.currentTime+d)}
function sfxHit(){snd(220,0.12,'sawtooth',0.18);snd(110,0.08,'square',0.12)}
function sfxShoot(){snd(500,0.06,'sine',0.1);snd(700,0.04,'sine',0.08)}
function sfxKill(){snd(400,0.1,'sine',0.1);snd(600,0.08,'sine',0.08);snd(800,0.06,'sine',0.06)}
function sfxDmg(){snd(160,0.2,'sawtooth',0.2);snd(90,0.25,'square',0.18)}
function sfxAbil(){snd(450,0.08,'triangle',0.12);snd(650,0.06,'sine',0.1);snd(850,0.04,'sine',0.08)}
function sfxBoss(){snd(70,0.5,'sawtooth',0.25);snd(55,0.6,'square',0.2)}
function sfxWin(){snd(400,0.12,'sine',0.1);setTimeout(()=>snd(600,0.12,'sine',0.1),80);setTimeout(()=>snd(800,0.15,'sine',0.1),160)}
function sfxLose(){snd(300,0.25,'sawtooth',0.18);setTimeout(()=>snd(200,0.25,'sawtooth',0.18),120);setTimeout(()=>snd(100,0.4,'sawtooth',0.18),240)}

const ST={TITLE:0,PLAY:1,PAUSE:2,OVER:3};let state=ST.TITLE,diff=1;
let sc=0,combo=1,maxC=1,wave=1,kills=0;
let shX=0,shY=0,shD=0,parts=[],ftxts=[];
let px,py,php,pmhp,pspd,patk,acd=[0,0,0,0];
let enemies=[],bullets=[],pickups=[];
let waveTimer=0,spawnTimer=0,waveClear=false;

const MONS=[
  {name:'Slime',hp:15,spd:0.8,dmg:5,r:12,color:'#44ff66',ai:'chase'},
  {name:'Bat',hp:10,spd:1.8,dmg:3,r:8,color:'#aa88ff',ai:'circle'},
  {name:'Orc',hp:30,spd:0.6,dmg:10,r:16,color:'#88aa44',ai:'chase'},
  {name:'Ghost',hp:20,spd:1.2,dmg:8,r:10,color:'#aaddff',ai:'phase'},
  {name:'Spider',hp:18,spd:1.5,dmg:6,r:9,color:'#ff4488',ai:'zigzag'},
  {name:'Golem',hp:60,spd:0.3,dmg:15,r:22,color:'#886644',ai:'chase'},
  {name:'Wisp',hp:8,spd:2.0,dmg:4,r:6,color:'#ffff44',ai:'circle'}
];
const BOSSES=[
  {name:'Dragon Lord',hp:200,spd:0.5,dmg:20,r:35,color:'#ff2200',ai:'boss1'},
  {name:'Lich King',hp:250,spd:0.4,dmg:25,r:30,color:'#6644aa',ai:'boss2'},
  {name:'Void Titan',hp:300,spd:0.3,dmg:30,r:40,color:'#0044ff',ai:'boss3'}
];

function start(){
  ia();sc=0;combo=1;maxC=1;wave=1;kills=0;
  px=W/2;py=H/2;php=[120,100,80][diff];pmhp=php;pspd=3;patk=10;
  acd=[0,0,0,0];enemies=[];bullets=[];pickups=[];parts=[];ftxts=[];
  waveTimer=0;spawnTimer=0;waveClear=false;
  spawnWave();state=ST.PLAY;
  document.getElementById('title').style.display='none';
  document.getElementById('gameover').style.display='none';
  document.getElementById('pauseScr').style.display='none';
  sfxShoot();
}
function toTitle(){state=ST.TITLE;document.getElementById('title').style.display='flex';document.getElementById('gameover').style.display='none';document.getElementById('pauseScr').style.display='none'}
function togglePause(){if(state===ST.PLAY){state=ST.PAUSE;document.getElementById('pauseScr').style.display='flex'}else if(state===ST.PAUSE){state=ST.PLAY;document.getElementById('pauseScr').style.display='none'}}
function setDiff(d){diff=d;document.querySelectorAll('.d-btn').forEach((b,i)=>b.classList.toggle('active',i===d))}
function gameOver(won){
  state=ST.OVER;won?sfxWin():sfxLose();
  let el=document.getElementById('gameover');el.style.display='flex';
  document.getElementById('go-title').textContent=won?'Victory!':'Defeated!';
  document.getElementById('go-title').style.color=won?'#44ff88':'#ff4444';
  let hs=getHS();let hsH=hs.length?'<div class="sl">Best</div><div>'+hs[0].s+'</div>':'';
  document.getElementById('go-stats').innerHTML='<div class="sl">Score</div><div>'+sc+'</div><div class="sl">Wave</div><div>'+wave+'</div><div class="sl">Kills</div><div>'+kills+'</div><div class="sl">Max Combo</div><div>x'+maxC+'</div><div class="sl">Difficulty</div><div>'+['Easy','Normal','Hard'][diff]+'</div>'+hsH;
  saveHS(sc);
}
function saveHS(s){try{let h=JSON.parse(localStorage.getItem('wowmon-arena-hs')||'[]');h.push({s,wave,d:['E','N','H'][diff],dt:new Date().toISOString()});h.sort((a,b)=>b.s-a.s);localStorage.setItem('wowmon-arena-hs',JSON.stringify(h.slice(0,10)))}catch(e){}}
function getHS(){try{return JSON.parse(localStorage.getItem('wowmon-arena-hs')||'[]')}catch(e){return[]}}

function spawnWave(){
  let isBoss=wave%5===0;
  let dm=[0.7,1.0,1.4][diff];
  if(isBoss){
    let bi=Math.min(Math.floor(wave/5)-1,BOSSES.length-1);
    let b={...BOSSES[bi]};b.x=W/2+200;b.y=H/3;b.hp=Math.floor(b.hp*dm);b.mhp=b.hp;b.dmg=Math.floor(b.dmg*dm);b.isBoss=true;b.t=0;b.shootT=0;
    enemies.push(b);sfxBoss();
  }else{
    let count=3+wave+Math.floor(wave*0.5*dm);
    let maxType=Math.min(Math.floor(wave/2),MONS.length-1);
    for(let i=0;i<count;i++){
      let m={...MONS[Math.floor(Math.random()*(maxType+1))]};
      let angle=Math.random()*Math.PI*2;
      let dist=Math.max(W,H)*0.6;
      m.x=W/2+Math.cos(angle)*dist;m.y=H/2+Math.sin(angle)*dist;
      m.hp=Math.floor(m.hp*dm*(1+wave*0.08));m.mhp=m.hp;m.dmg=Math.floor(m.dmg*dm);
      m.t=Math.random()*100;m.isBoss=false;m.shootT=0;
      enemies.push(m);
    }
  }
}

function spawnParts(x,y,col,n){for(let i=0;i<n;i++)parts.push({x,y,vx:(Math.random()-0.5)*6,vy:(Math.random()-0.5)*6-1,life:1,color:col,sz:2+Math.random()*3})}
function addFT(x,y,txt,col){ftxts.push({x,y,txt,col,life:1,vy:-1.2})}
function shake(i,d){shX=(Math.random()-0.5)*i;shY=(Math.random()-0.5)*i;shD=d}

const keys={};
addEventListener('keydown',e=>{keys[e.key.toLowerCase()]=true;
  if(e.key==='Escape'){e.preventDefault();if(state===ST.PLAY||state===ST.PAUSE)togglePause()}
  if(state!==ST.PLAY)return;
  if(e.key==='q')useAb(0);if(e.key==='e')useAb(2);if(e.key==='r')useAb(3);
});
addEventListener('keyup',e=>{keys[e.key.toLowerCase()]=false});

let mX=W/2,mY=H/2;
cv.addEventListener('mousemove',e=>{mX=e.clientX;mY=e.clientY});
cv.addEventListener('click',e=>{
  if(state!==ST.PLAY)return;ia();
  let dx=e.clientX-px,dy=e.clientY-py,dist=Math.sqrt(dx*dx+dy*dy);
  if(dist<1)return;
  bullets.push({x:px,y:py,vx:dx/dist*8,vy:dy/dist*8,dmg:patk,life:60,col:'#ffaa44'});
  sfxShoot();
});
cv.addEventListener('touchstart',e=>{
  e.preventDefault();if(e.touches.length>0){let t=e.touches[0];
  cv.dispatchEvent(new MouseEvent('click',{clientX:t.clientX,clientY:t.clientY}))}
},{passive:false});

function useAb(i){
  if(state!==ST.PLAY||acd[i]>0)return;
  sfxAbil();
  switch(i){
    case 0:// Fireball burst
      acd[0]=180;
      for(let a=0;a<8;a++){let ang=a*Math.PI/4;bullets.push({x:px,y:py,vx:Math.cos(ang)*6,vy:Math.sin(ang)*6,dmg:patk*2,life:40,col:'#ff4400'})}
      spawnParts(px,py,'#ff4400',15);shake(6,10);break;
    case 1:// Shield
      acd[1]=240;php=Math.min(pmhp,php+25);addFT(px,py-30,'+25 HP','#44ff88');spawnParts(px,py,'#44ff88',10);break;
    case 2:// Speed boost
      acd[2]=300;pspd=5;setTimeout(()=>pspd=3,3000);addFT(px,py-30,'SPEED!','#44aaff');break;
    case 3:// Nuke
      acd[3]=600;
      enemies.forEach(e=>{let d=patk*4;e.hp-=d;addFT(e.x,e.y-10,'-'+d,'#ffff44');spawnParts(e.x,e.y,'#ffff44',8)});
      shake(12,20);break;
  }
}

function update(dt){
  let spd=pspd*dt/16;
  if(keys['w']||keys['arrowup'])py-=spd;
  if(keys['s']||keys['arrowdown'])py+=spd;
  if(keys['a']||keys['arrowleft'])px-=spd;
  if(keys['d']||keys['arrowright'])px+=spd;
  px=Math.max(15,Math.min(W-15,px));py=Math.max(15,Math.min(H-15,py));

  for(let i=0;i<4;i++)if(acd[i]>0)acd[i]--;

  // Bullets
  for(let i=bullets.length-1;i>=0;i--){
    let b=bullets[i];b.x+=b.vx;b.y+=b.vy;b.life--;
    if(b.life<=0||b.x<-10||b.x>W+10||b.y<-10||b.y>H+10){bullets.splice(i,1);continue}
    for(let j=enemies.length-1;j>=0;j--){
      let e=enemies[j];
      let dx=b.x-e.x,dy=b.y-e.y;
      if(dx*dx+dy*dy<(e.r+4)*(e.r+4)){
        e.hp-=b.dmg;addFT(e.x,e.y-e.r,'-'+b.dmg,'#ff4444');sfxHit();
        spawnParts(e.x,e.y,e.color,6);shake(3,5);
        bullets.splice(i,1);
        if(e.hp<=0){
          kills++;combo++;if(combo>maxC)maxC=combo;
          sc+=50*combo;sfxKill();
          spawnParts(e.x,e.y,e.color,15);
          addFT(e.x,e.y-20,'x'+combo,'#ffdd44');
          if(Math.random()<0.2)pickups.push({x:e.x,y:e.y,type:Math.random()<0.5?'hp':'atk',life:300});
          enemies.splice(j,1);
        }
        break;
      }
    }
  }

  // Enemies AI
  for(let e of enemies){
    e.t+=dt*0.01;
    let dx=px-e.x,dy=py-e.y,dist=Math.sqrt(dx*dx+dy*dy);
    let espd=e.spd*dt/16;
    switch(e.ai){
      case'chase':if(dist>5){e.x+=dx/dist*espd;e.y+=dy/dist*espd}break;
      case'circle':e.x+=Math.cos(e.t)*espd*1.5;e.y+=Math.sin(e.t)*espd*1.5;if(dist>200){e.x+=dx/dist*espd*0.5;e.y+=dy/dist*espd*0.5}break;
      case'phase':e.x+=dx/dist*espd*(Math.sin(e.t*3)>0?1:0.2);e.y+=dy/dist*espd;break;
      case'zigzag':e.x+=dx/dist*espd+Math.sin(e.t*5)*espd*2;e.y+=dy/dist*espd;break;
      case'boss1':case'boss2':case'boss3':
        if(dist>100){e.x+=dx/dist*espd;e.y+=dy/dist*espd}
        e.shootT+=dt;
        if(e.shootT>1500){e.shootT=0;
          for(let a=0;a<6;a++){let ang=a*Math.PI/3+e.t;
          bullets.push({x:e.x,y:e.y,vx:Math.cos(ang)*3,vy:Math.sin(ang)*3,dmg:0,life:80,col:'#ff2200',enemy:true,edmg:e.dmg})}
        }break;
    }
    // Collision with player
    if(dist<e.r+12){
      php-=e.dmg;sfxDmg();shake(8,12);combo=1;
      addFT(px,py-20,'-'+e.dmg,'#ff4444');spawnParts(px,py,'#ff4444',8);
      let pushDist=30;e.x-=dx/dist*pushDist;e.y-=dy/dist*pushDist;
      if(php<=0){php=0;gameOver(false);return}
    }
  }

  // Enemy bullets hit player
  for(let i=bullets.length-1;i>=0;i--){
    let b=bullets[i];if(!b.enemy)continue;
    let dx=b.x-px,dy=b.y-py;
    if(dx*dx+dy*dy<16*16){
      php-=b.edmg;sfxDmg();shake(6,10);combo=1;
      addFT(px,py-20,'-'+b.edmg,'#ff4444');bullets.splice(i,1);
      if(php<=0){php=0;gameOver(false);return}
    }
  }

  // Pickups
  for(let i=pickups.length-1;i>=0;i--){
    let p=pickups[i];p.life--;
    let dx=p.x-px,dy=p.y-py;
    if(dx*dx+dy*dy<20*20){
      if(p.type==='hp'){php=Math.min(pmhp,php+15);addFT(px,py-20,'+15 HP','#44ff88')}
      else{patk+=2;addFT(px,py-20,'+2 ATK','#ffaa44')}
      sfxKill();pickups.splice(i,1);continue;
    }
    if(p.life<=0)pickups.splice(i,1);
  }

  // Wave check
  if(enemies.length===0&&!waveClear){
    waveClear=true;waveTimer=120;
    addFT(W/2,H/2,'WAVE '+wave+' CLEAR!','#ffdd44');
  }
  if(waveClear){
    waveTimer--;
    if(waveTimer<=0){
      waveClear=false;wave++;
      if(wave>20){gameOver(true);return}
      spawnWave();
    }
  }

  // Shake
  if(shD>0){shD-=dt;shX*=0.9;shY*=0.9}else{shX=shY=0}
  // Parts
  for(let i=parts.length-1;i>=0;i--){let p=parts[i];p.x+=p.vx;p.y+=p.vy;p.vy+=0.12;p.life-=dt*0.025;p.sz*=0.98;if(p.life<=0)parts.splice(i,1)}
  for(let i=ftxts.length-1;i>=0;i--){let t=ftxts[i];t.y+=t.vy;t.life-=dt*0.02;if(t.life<=0)ftxts.splice(i,1)}
}

function render(){
  let bg=cx.createLinearGradient(0,0,0,H);bg.addColorStop(0,'#0d0d2a');bg.addColorStop(1,'#1a0a10');
  cx.fillStyle=bg;cx.fillRect(0,0,W,H);
  // Arena floor
  cx.fillStyle='rgba(40,20,10,0.3)';cx.beginPath();cx.ellipse(W/2,H/2,W*0.45,H*0.4,0,0,Math.PI*2);cx.fill();
  cx.strokeStyle='rgba(255,136,68,0.15)';cx.lineWidth=2;cx.stroke();

  cx.save();cx.translate(shX,shY);

  // Pickups
  for(let p of pickups){
    cx.fillStyle=p.type==='hp'?'#44ff88':'#ffaa44';cx.globalAlpha=0.7+Math.sin(Date.now()*0.005)*0.3;
    cx.beginPath();cx.arc(p.x,p.y,8,0,Math.PI*2);cx.fill();
    cx.globalAlpha=1;
  }

  // Enemies
  for(let e of enemies){
    let g=cx.createRadialGradient(e.x,e.y,0,e.x,e.y,e.r);
    g.addColorStop(0,e.color);g.addColorStop(1,'rgba(0,0,0,0.4)');
    cx.fillStyle=g;cx.beginPath();cx.arc(e.x,e.y,e.r,0,Math.PI*2);cx.fill();
    if(e.isBoss){cx.strokeStyle='#ffdd44';cx.lineWidth=2;cx.stroke()}
    // HP bar
    let bw=e.r*2,bh=4,bx=e.x-bw/2,by=e.y-e.r-8;
    cx.fillStyle='#330000';cx.fillRect(bx,by,bw,bh);
    cx.fillStyle=e.hp/e.mhp>0.5?'#44ff44':'#ff4444';cx.fillRect(bx,by,bw*(e.hp/e.mhp),bh);
    if(e.isBoss){cx.fillStyle='#ddd';cx.font='10px sans-serif';cx.textAlign='center';cx.fillText(e.name,e.x,by-4)}
  }

  // Player
  let pg=cx.createRadialGradient(px,py,0,px,py,14);pg.addColorStop(0,'#ffaa44');pg.addColorStop(1,'#884400');
  cx.fillStyle=pg;cx.beginPath();cx.arc(px,py,14,0,Math.PI*2);cx.fill();
  // Direction indicator
  let dx=mX-px,dy=mY-py,dd=Math.sqrt(dx*dx+dy*dy);
  if(dd>1){cx.strokeStyle='rgba(255,170,68,0.4)';cx.lineWidth=2;cx.beginPath();cx.moveTo(px,py);cx.lineTo(px+dx/dd*25,py+dy/dd*25);cx.stroke()}

  // Bullets
  for(let b of bullets){
    cx.fillStyle=b.col||'#ffaa44';cx.beginPath();cx.arc(b.x,b.y,b.enemy?5:3,0,Math.PI*2);cx.fill();
  }

  // Parts
  for(let p of parts){cx.globalAlpha=p.life;cx.fillStyle=p.color;cx.fillRect(p.x-p.sz/2,p.y-p.sz/2,p.sz,p.sz)}
  cx.globalAlpha=1;
  // Float texts
  for(let t of ftxts){cx.globalAlpha=t.life;cx.fillStyle=t.col;cx.font='bold 16px sans-serif';cx.textAlign='center';cx.fillText(t.txt,t.x,t.y)}
  cx.globalAlpha=1;

  // Combo
  if(combo>1){cx.fillStyle=combo>5?'#ffdd44':'#ff8844';cx.font='bold '+(18+combo)+'px sans-serif';cx.textAlign='center';cx.fillText('COMBO x'+combo,W/2,60)}
  // Wave clear
  if(waveClear){cx.fillStyle='#ffdd44';cx.font='bold 28px sans-serif';cx.textAlign='center';cx.fillText('WAVE '+wave+' CLEAR!',W/2,H/2)}

  // Ability cooldowns
  let abNames=['Fire','Heal','Speed','Nuke'];let abCds=[180,240,300,600];
  for(let i=0;i<4;i++){
    let ax=10+i*52,ay=H-55;
    let ready=acd[i]<=0;
    cx.fillStyle=ready?'rgba(40,25,10,0.85)':'rgba(15,10,5,0.85)';
    cx.beginPath();cx.roundRect(ax,ay,48,48,6);cx.fill();
    cx.strokeStyle=ready?'rgba(255,136,68,0.4)':'rgba(80,60,40,0.3)';cx.lineWidth=1;cx.stroke();
    cx.fillStyle=ready?'#ffcc88':'#665544';cx.font='bold 13px sans-serif';cx.textAlign='center';
    cx.fillText('QWER'[i],ax+24,ay+20);
    cx.font='8px sans-serif';cx.fillText(abNames[i],ax+24,ay+34);
    if(acd[i]>0){cx.fillStyle='rgba(0,0,0,0.5)';cx.beginPath();cx.roundRect(ax,ay,48,48,6);cx.fill();cx.fillStyle='#ff8844';cx.font='bold 14px sans-serif';cx.fillText(Math.ceil(acd[i]/60),ax+24,ay+30)}
  }
  cx.restore();

  document.getElementById('h1').textContent='HP: '+php+'/'+pmhp;
  document.getElementById('h2').textContent='Wave: '+wave+'/20';
  document.getElementById('h3').textContent='Score: '+sc;
  document.getElementById('h4').textContent='x'+combo;
}

let lt=0;
function loop(t){let dt=Math.min(t-lt,50);lt=t;if(state===ST.PLAY){update(dt);render()}requestAnimationFrame(loop)}
requestAnimationFrame(loop);
</script>
</body>
</html>