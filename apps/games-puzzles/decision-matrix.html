<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Decision Matrix Engine - Weighted multi-criteria decision making with visualization">
    <title>Decision Matrix Engine</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e4e4e7;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        h1 { font-size: 24px; color: #60a5fa; }
        .header-actions { display: flex; gap: 10px; }
        .btn {
            background: rgba(96, 165, 250, 0.2);
            border: 1px solid rgba(96, 165, 250, 0.4);
            color: #60a5fa;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        .btn:hover { background: rgba(96, 165, 250, 0.3); }
        .btn-primary { background: #3b82f6; border-color: #3b82f6; color: white; }
        .layout { display: grid; grid-template-columns: 1fr 350px; gap: 20px; }
        .main-panel {
            background: rgba(0,0,0,0.2);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .panel-title { font-size: 16px; font-weight: 600; }
        .matrix-container { overflow-x: auto; }
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }
        th, td {
            padding: 12px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
        }
        th {
            background: rgba(0,0,0,0.3);
            font-weight: 500;
            font-size: 13px;
        }
        th.option-header {
            min-width: 120px;
            background: rgba(96, 165, 250, 0.1);
        }
        th.criteria-header { background: rgba(16, 185, 129, 0.1); }
        td input[type="text"] {
            background: transparent;
            border: none;
            color: #e4e4e7;
            text-align: center;
            width: 100%;
            font-size: 14px;
        }
        td input[type="text"]:focus { outline: none; }
        td input[type="number"] {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: #e4e4e7;
            padding: 8px;
            border-radius: 4px;
            width: 60px;
            text-align: center;
        }
        .weight-slider {
            width: 80px;
            accent-color: #10b981;
        }
        .weight-value {
            font-size: 12px;
            color: #10b981;
            display: block;
            margin-top: 4px;
        }
        .score-cell { position: relative; }
        .score-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 4px;
            background: #60a5fa;
            transition: width 0.3s;
        }
        .total-row { background: rgba(96, 165, 250, 0.1); }
        .total-row td { font-weight: 600; font-size: 16px; }
        .winner { color: #22c55e; }
        .winner-badge {
            background: #22c55e;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            margin-left: 8px;
        }
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .sidebar-panel {
            background: rgba(0,0,0,0.2);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .result-display {
            text-align: center;
            padding: 25px;
        }
        .winner-name {
            font-size: 28px;
            font-weight: 700;
            color: #22c55e;
            margin-bottom: 10px;
        }
        .winner-score {
            font-size: 48px;
            font-weight: 700;
            color: #60a5fa;
        }
        .winner-label {
            font-size: 12px;
            color: #71717a;
            margin-top: 5px;
        }
        .chart-container {
            height: 200px;
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            gap: 10px;
            padding: 20px 0;
        }
        .chart-bar {
            flex: 1;
            max-width: 60px;
            background: linear-gradient(to top, #3b82f6, #60a5fa);
            border-radius: 4px 4px 0 0;
            transition: height 0.5s;
            position: relative;
        }
        .chart-bar.winner-bar { background: linear-gradient(to top, #16a34a, #22c55e); }
        .chart-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 11px;
            color: #71717a;
            white-space: nowrap;
        }
        .chart-value {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            font-weight: 600;
        }
        .sensitivity-panel {
            padding: 15px;
        }
        .sensitivity-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .sensitivity-item:last-child { border: none; }
        .sensitivity-label { font-size: 13px; }
        .sensitivity-value {
            font-size: 13px;
            padding: 4px 8px;
            border-radius: 4px;
        }
        .high-sensitivity { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .medium-sensitivity { background: rgba(234, 179, 8, 0.2); color: #eab308; }
        .low-sensitivity { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
        .add-btn {
            background: transparent;
            border: 1px dashed rgba(255,255,255,0.3);
            color: #71717a;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
        }
        .add-btn:hover { border-color: #60a5fa; color: #60a5fa; }
        .remove-btn {
            background: rgba(239, 68, 68, 0.2);
            border: none;
            color: #ef4444;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        .decision-title {
            background: transparent;
            border: none;
            color: #60a5fa;
            font-size: 24px;
            font-weight: 600;
            width: 100%;
            margin-bottom: 20px;
        }
        .decision-title:focus { outline: none; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>⚖️ Decision Matrix Engine</h1>
            <div class="header-actions">
                <button class="btn" onclick="newDecision()">New Decision</button>
                <button class="btn" onclick="exportDecision()">Export</button>
                <button class="btn" onclick="importDecision()">Import</button>
                <button class="btn btn-primary" onclick="saveDecision()">Save</button>
            </div>
        </div>

        <input type="text" class="decision-title" id="decisionTitle" placeholder="What decision are you making?" value="Which option should I choose?">

        <div class="layout">
            <div class="main-panel">
                <div class="panel-header">
                    <span class="panel-title">Decision Matrix</span>
                    <div>
                        <button class="add-btn" onclick="addOption()">+ Add Option</button>
                        <button class="add-btn" onclick="addCriteria()">+ Add Criteria</button>
                    </div>
                </div>

                <div class="matrix-container">
                    <table id="matrixTable">
                        <thead id="tableHead"></thead>
                        <tbody id="tableBody"></tbody>
                        <tfoot id="tableFoot"></tfoot>
                    </table>
                </div>
            </div>

            <div class="sidebar">
                <div class="sidebar-panel result-display">
                    <div class="winner-label">RECOMMENDED CHOICE</div>
                    <div class="winner-name" id="winnerName">-</div>
                    <div class="winner-score" id="winnerScore">0</div>
                    <div class="winner-label">WEIGHTED SCORE</div>
                </div>

                <div class="sidebar-panel">
                    <div class="panel-title" style="margin-bottom: 15px;">Comparison Chart</div>
                    <div class="chart-container" id="chartContainer"></div>
                </div>

                <div class="sidebar-panel sensitivity-panel">
                    <div class="panel-title" style="margin-bottom: 15px;">Sensitivity Analysis</div>
                    <div id="sensitivityList"></div>
                </div>
            </div>
        </div>
    </div>

    <input type="file" id="importInput" accept=".json" style="display: none;" onchange="handleImport(event)">

    <script>
        let options = ['Option A', 'Option B', 'Option C'];
        let criteria = [
            { name: 'Cost', weight: 8 },
            { name: 'Quality', weight: 9 },
            { name: 'Time', weight: 6 },
            { name: 'Risk', weight: 7 }
        ];
        let scores = {}; // { 'Option A': { 'Cost': 7, 'Quality': 8 } }

        // Initialize scores
        function initScores() {
            options.forEach(opt => {
                if (!scores[opt]) scores[opt] = {};
                criteria.forEach(crit => {
                    if (scores[opt][crit.name] === undefined) {
                        scores[opt][crit.name] = 5;
                    }
                });
            });
        }

        function renderMatrix() {
            initScores();

            // Header
            const thead = document.getElementById('tableHead');
            thead.innerHTML = `
                <tr>
                    <th>Criteria</th>
                    <th class="criteria-header">Weight</th>
                    ${options.map((opt, i) => `
                        <th class="option-header">
                            <input type="text" value="${opt}" onchange="renameOption(${i}, this.value)">
                            <button class="remove-btn" onclick="removeOption(${i})" style="margin-top:5px;">×</button>
                        </th>
                    `).join('')}
                </tr>
            `;

            // Body
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = criteria.map((crit, ci) => `
                <tr>
                    <td>
                        <input type="text" value="${crit.name}" onchange="renameCriteria(${ci}, this.value)">
                        <button class="remove-btn" onclick="removeCriteria(${ci})">×</button>
                    </td>
                    <td>
                        <input type="range" class="weight-slider" min="1" max="10" value="${crit.weight}"
                               onchange="updateWeight(${ci}, this.value)">
                        <span class="weight-value">${crit.weight}/10</span>
                    </td>
                    ${options.map(opt => `
                        <td class="score-cell">
                            <input type="number" min="1" max="10" value="${scores[opt][crit.name] || 5}"
                                   onchange="updateScore('${opt}', '${crit.name}', this.value)">
                            <div class="score-bar" style="width: ${(scores[opt][crit.name] || 5) * 10}%"></div>
                        </td>
                    `).join('')}
                </tr>
            `).join('');

            // Footer with totals
            const totals = calculateTotals();
            const maxTotal = Math.max(...Object.values(totals));
            const tfoot = document.getElementById('tableFoot');
            tfoot.innerHTML = `
                <tr class="total-row">
                    <td colspan="2"><strong>WEIGHTED TOTAL</strong></td>
                    ${options.map(opt => `
                        <td class="${totals[opt] === maxTotal ? 'winner' : ''}">
                            ${totals[opt].toFixed(1)}
                            ${totals[opt] === maxTotal ? '<span class="winner-badge">BEST</span>' : ''}
                        </td>
                    `).join('')}
                </tr>
            `;

            updateResults(totals, maxTotal);
            updateChart(totals, maxTotal);
            updateSensitivity(totals);
        }

        function calculateTotals() {
            const totals = {};
            const totalWeight = criteria.reduce((sum, c) => sum + c.weight, 0);

            options.forEach(opt => {
                let total = 0;
                criteria.forEach(crit => {
                    const score = scores[opt][crit.name] || 5;
                    total += score * (crit.weight / totalWeight);
                });
                totals[opt] = total;
            });

            return totals;
        }

        function updateResults(totals, maxTotal) {
            const winner = Object.keys(totals).find(k => totals[k] === maxTotal);
            document.getElementById('winnerName').textContent = winner || '-';
            document.getElementById('winnerScore').textContent = maxTotal.toFixed(1);
        }

        function updateChart(totals, maxTotal) {
            const container = document.getElementById('chartContainer');
            const max = Math.max(...Object.values(totals));

            container.innerHTML = Object.entries(totals).map(([name, value]) => `
                <div class="chart-bar ${value === maxTotal ? 'winner-bar' : ''}"
                     style="height: ${(value / 10) * 100}%">
                    <span class="chart-value">${value.toFixed(1)}</span>
                    <span class="chart-label">${name.slice(0, 10)}</span>
                </div>
            `).join('');
        }

        function updateSensitivity(totals) {
            const container = document.getElementById('sensitivityList');
            const sortedOptions = Object.entries(totals).sort((a, b) => b[1] - a[1]);

            if (sortedOptions.length < 2) {
                container.innerHTML = '<p style="color:#71717a;font-size:13px;">Add more options for analysis</p>';
                return;
            }

            const winner = sortedOptions[0];
            const runnerUp = sortedOptions[1];
            const margin = winner[1] - runnerUp[1];

            let sensitivity = 'high-sensitivity';
            let label = 'Fragile';
            if (margin > 1) { sensitivity = 'low-sensitivity'; label = 'Robust'; }
            else if (margin > 0.5) { sensitivity = 'medium-sensitivity'; label = 'Moderate'; }

            container.innerHTML = `
                <div class="sensitivity-item">
                    <span class="sensitivity-label">Decision Robustness</span>
                    <span class="sensitivity-value ${sensitivity}">${label}</span>
                </div>
                <div class="sensitivity-item">
                    <span class="sensitivity-label">Winning Margin</span>
                    <span class="sensitivity-value">${margin.toFixed(2)} pts</span>
                </div>
                <div class="sensitivity-item">
                    <span class="sensitivity-label">Runner Up</span>
                    <span class="sensitivity-value">${runnerUp[0]}</span>
                </div>
                <div class="sensitivity-item">
                    <span class="sensitivity-label">Most Weighted Criteria</span>
                    <span class="sensitivity-value">${criteria.sort((a,b) => b.weight - a.weight)[0]?.name || '-'}</span>
                </div>
            `;
        }

        function addOption() {
            const name = `Option ${String.fromCharCode(65 + options.length)}`;
            options.push(name);
            scores[name] = {};
            renderMatrix();
        }

        function removeOption(index) {
            const name = options[index];
            options.splice(index, 1);
            delete scores[name];
            renderMatrix();
        }

        function renameOption(index, newName) {
            const oldName = options[index];
            options[index] = newName;
            scores[newName] = scores[oldName];
            delete scores[oldName];
            renderMatrix();
        }

        function addCriteria() {
            criteria.push({ name: `Criteria ${criteria.length + 1}`, weight: 5 });
            renderMatrix();
        }

        function removeCriteria(index) {
            const name = criteria[index].name;
            criteria.splice(index, 1);
            options.forEach(opt => delete scores[opt][name]);
            renderMatrix();
        }

        function renameCriteria(index, newName) {
            const oldName = criteria[index].name;
            criteria[index].name = newName;
            options.forEach(opt => {
                scores[opt][newName] = scores[opt][oldName];
                delete scores[opt][oldName];
            });
            renderMatrix();
        }

        function updateWeight(index, value) {
            criteria[index].weight = parseInt(value);
            renderMatrix();
        }

        function updateScore(option, criteriaName, value) {
            scores[option][criteriaName] = parseInt(value);
            renderMatrix();
        }

        function newDecision() {
            if (confirm('Start a new decision? Current data will be cleared.')) {
                options = ['Option A', 'Option B'];
                criteria = [{ name: 'Criteria 1', weight: 5 }];
                scores = {};
                document.getElementById('decisionTitle').value = '';
                renderMatrix();
            }
        }

        function saveDecision() {
            const data = {
                title: document.getElementById('decisionTitle').value,
                options,
                criteria,
                scores,
                savedAt: new Date().toISOString()
            };
            localStorage.setItem('decisionMatrix_current', JSON.stringify(data));
            alert('Decision saved!');
        }

        function exportDecision() {
            const data = {
                title: document.getElementById('decisionTitle').value,
                options,
                criteria,
                scores
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'decision-matrix.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        function importDecision() {
            document.getElementById('importInput').click();
        }

        function handleImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    document.getElementById('decisionTitle').value = data.title || '';
                    options = data.options || [];
                    criteria = data.criteria || [];
                    scores = data.scores || {};
                    renderMatrix();
                } catch (err) {
                    alert('Failed to import: Invalid JSON');
                }
            };
            reader.readAsText(file);
        }

        // Load saved or initialize
        document.addEventListener('DOMContentLoaded', () => {
            const saved = localStorage.getItem('decisionMatrix_current');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    document.getElementById('decisionTitle').value = data.title || '';
                    options = data.options || options;
                    criteria = data.criteria || criteria;
                    scores = data.scores || scores;
                } catch (e) {}
            }
            renderMatrix();
        });
    </script>
</body>
</html>
