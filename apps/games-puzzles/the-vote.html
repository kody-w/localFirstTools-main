<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE VOTE — Absurdist Political Campaign Simulator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            overflow-x: hidden;
            min-height: 100vh;
        }

        #game-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, #c1121f 0%, #780000 100%);
            border: 4px solid #ffd700;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 8px;
            background: repeating-linear-gradient(90deg, #ffd700 0px, #ffd700 20px, #003f88 20px, #003f88 40px);
        }

        h1 {
            font-size: 3em;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 4px;
            text-shadow: 4px 4px 0 rgba(0,0,0,0.5),
                         -2px -2px 0 #ffd700;
            margin-bottom: 10px;
        }

        .tagline {
            text-align: center;
            font-style: italic;
            font-size: 1.2em;
            opacity: 0.9;
        }

        /* Stats Bar */
        #stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #003f88 0%, #002855 100%);
            border: 3px solid #ffd700;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.3);
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.8;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #ffd700;
        }

        /* Main Content Area */
        #main-content {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        /* Sidebar */
        #sidebar {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .panel {
            background: rgba(255,255,255,0.1);
            border: 2px solid #ffd700;
            border-radius: 8px;
            padding: 15px;
            backdrop-filter: blur(10px);
        }

        .panel h3 {
            color: #ffd700;
            margin-bottom: 12px;
            font-size: 1.2em;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 2px solid #ffd700;
            padding-bottom: 8px;
        }

        /* Faction List */
        .faction-item {
            background: rgba(0,0,0,0.3);
            border-left: 4px solid;
            padding: 8px;
            margin-bottom: 8px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .faction-item:hover {
            background: rgba(0,0,0,0.5);
            transform: translateX(5px);
        }

        .faction-name {
            font-weight: bold;
            margin-bottom: 4px;
            font-size: 0.95em;
        }

        .faction-approval {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85em;
        }

        .approval-bar {
            flex: 1;
            height: 12px;
            background: rgba(0,0,0,0.5);
            border-radius: 6px;
            overflow: hidden;
        }

        .approval-fill {
            height: 100%;
            background: linear-gradient(90deg, #c1121f 0%, #4caf50 100%);
            transition: width 0.5s ease;
        }

        /* Map Canvas */
        #map-container {
            position: relative;
            background: rgba(0,0,0,0.3);
            border: 3px solid #ffd700;
            border-radius: 8px;
            overflow: hidden;
        }

        #game-canvas {
            display: block;
            width: 100%;
            height: 600px;
            cursor: pointer;
        }

        /* Action Buttons */
        #action-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .action-btn {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #000;
            border: none;
            border-radius: 8px;
            padding: 15px 20px;
            font-size: 1em;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 12px rgba(255,215,0,0.3);
            position: relative;
            overflow: hidden;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255,215,0,0.5);
        }

        .action-btn:active {
            transform: translateY(0);
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.5);
            transform: translate(-50%, -50%);
            transition: width 0.3s, height 0.3s;
        }

        .action-btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .action-btn span {
            position: relative;
            z-index: 1;
        }

        /* Modal System */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.85);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(8px);
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border: 4px solid #ffd700;
            border-radius: 12px;
            padding: 30px;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.6);
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ffd700;
        }

        .modal-title {
            font-size: 2em;
            color: #ffd700;
            text-transform: uppercase;
        }

        .close-btn {
            background: #c1121f;
            color: #fff;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.5em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .close-btn:hover {
            background: #780000;
            transform: rotate(90deg);
        }

        /* Speech Builder */
        #phrase-bank {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .phrase-option {
            background: rgba(255,255,255,0.05);
            border: 2px solid #ffd700;
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .phrase-option:hover {
            background: rgba(255,215,0,0.1);
            transform: scale(1.02);
        }

        .phrase-option.selected {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #000;
            border-color: #fff;
        }

        .phrase-text {
            font-size: 1.05em;
            margin-bottom: 8px;
        }

        .phrase-hint {
            font-size: 0.85em;
            opacity: 0.7;
            font-style: italic;
        }

        /* Selected Speech Preview */
        #speech-preview {
            background: rgba(0,0,0,0.5);
            border: 2px solid #ffd700;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            min-height: 150px;
        }

        #speech-preview h4 {
            color: #ffd700;
            margin-bottom: 12px;
            font-size: 1.1em;
        }

        .speech-text {
            font-size: 1.2em;
            line-height: 1.6;
            font-style: italic;
        }

        /* Faction Reactions */
        .reaction-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
        }

        .reaction-item {
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 12px;
            border-left: 4px solid;
        }

        .reaction-faction {
            font-weight: bold;
            margin-bottom: 6px;
        }

        .reaction-value {
            font-size: 1.3em;
            font-weight: bold;
        }

        .reaction-value.positive {
            color: #4caf50;
        }

        .reaction-value.negative {
            color: #c1121f;
        }

        .reaction-value.neutral {
            color: #ffd700;
        }

        /* Debate Interface */
        #debate-question {
            background: rgba(0,0,0,0.5);
            border: 2px solid #ffd700;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .debate-timer {
            text-align: center;
            font-size: 3em;
            color: #ffd700;
            margin-bottom: 15px;
            font-weight: bold;
            text-shadow: 0 0 20px #ffd700;
        }

        .question-text {
            font-size: 1.3em;
            line-height: 1.6;
            text-align: center;
            margin-bottom: 10px;
        }

        .question-category {
            text-align: center;
            font-size: 0.9em;
            opacity: 0.7;
            font-style: italic;
        }

        #debate-answers {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .answer-option {
            background: linear-gradient(135deg, #003f88 0%, #002855 100%);
            border: 3px solid #ffd700;
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.2s;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 1.1em;
        }

        .answer-option:hover {
            background: linear-gradient(135deg, #004999 0%, #003366 100%);
            transform: scale(1.02);
            box-shadow: 0 8px 24px rgba(255,215,0,0.3);
        }

        /* News Ticker */
        #news-ticker {
            background: #000;
            border: 2px solid #ffd700;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 20px;
            overflow: hidden;
            position: relative;
        }

        .news-label {
            display: inline-block;
            background: #c1121f;
            color: #fff;
            padding: 4px 12px;
            font-weight: bold;
            margin-right: 12px;
            border-radius: 4px;
        }

        .news-content {
            display: inline;
            font-size: 1.05em;
        }

        /* District Info */
        #district-info {
            background: rgba(0,0,0,0.7);
            border: 3px solid #ffd700;
            border-radius: 8px;
            padding: 20px;
            margin-top: 15px;
        }

        .district-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }

        /* Policy List */
        .policy-item {
            background: rgba(0,0,0,0.3);
            border: 2px solid #ffd700;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .policy-item:hover {
            background: rgba(0,0,0,0.5);
        }

        .policy-item.selected {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #000;
        }

        .policy-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .policy-description {
            margin-bottom: 10px;
            line-height: 1.5;
        }

        .policy-effects {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .effect-tag {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: bold;
        }

        .effect-positive {
            background: #4caf50;
            color: #fff;
        }

        .effect-negative {
            background: #c1121f;
            color: #fff;
        }

        /* Intro Screen */
        #intro-screen {
            text-align: center;
            padding: 40px;
        }

        #intro-screen h2 {
            font-size: 2.5em;
            color: #ffd700;
            margin-bottom: 20px;
        }

        .intro-text {
            font-size: 1.2em;
            line-height: 1.8;
            margin-bottom: 30px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .start-btn {
            background: linear-gradient(135deg, #c1121f 0%, #780000 100%);
            color: #fff;
            border: 4px solid #ffd700;
            border-radius: 12px;
            padding: 20px 50px;
            font-size: 1.5em;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 24px rgba(193,18,31,0.4);
        }

        .start-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 32px rgba(193,18,31,0.6);
        }

        /* Results Screen */
        .results-container {
            text-align: center;
            padding: 20px;
        }

        .results-title {
            font-size: 3em;
            color: #ffd700;
            margin-bottom: 20px;
            text-transform: uppercase;
        }

        .results-subtitle {
            font-size: 1.5em;
            margin-bottom: 30px;
            opacity: 0.9;
        }

        .results-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .result-card {
            background: rgba(0,0,0,0.5);
            border: 2px solid #ffd700;
            border-radius: 8px;
            padding: 20px;
        }

        .result-label {
            font-size: 1em;
            opacity: 0.8;
            margin-bottom: 8px;
        }

        .result-value {
            font-size: 2em;
            font-weight: bold;
            color: #ffd700;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            #main-content {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 2em;
            }

            #debate-answers {
                grid-template-columns: 1fr;
            }
        }

        /* Animations */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .pulsing {
            animation: pulse 2s infinite;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .slide-in {
            animation: slideIn 0.3s ease-out;
        }

        /* Contradiction Meter */
        #contradiction-meter {
            background: rgba(0,0,0,0.5);
            border: 2px solid #c1121f;
            border-radius: 8px;
            padding: 12px;
            margin-top: 15px;
        }

        .meter-label {
            font-size: 0.9em;
            margin-bottom: 6px;
            color: #c1121f;
            font-weight: bold;
        }

        .meter-bar {
            height: 20px;
            background: rgba(0,0,0,0.5);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .meter-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffd700 0%, #ff6b6b 50%, #c1121f 100%);
            transition: width 0.5s ease;
        }

        .meter-warning {
            font-size: 0.85em;
            color: #ff6b6b;
            margin-top: 6px;
            font-style: italic;
        }

        /* Event Log */
        #event-log {
            max-height: 200px;
            overflow-y: auto;
        }

        .event-item {
            background: rgba(0,0,0,0.3);
            border-left: 3px solid #ffd700;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 4px;
            font-size: 0.95em;
        }

        .event-day {
            color: #ffd700;
            font-weight: bold;
            margin-right: 8px;
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.3);
        }

        ::-webkit-scrollbar-thumb {
            background: #ffd700;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #ffed4e;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <header>
            <h1>THE VOTE</h1>
            <div class="tagline">Run for President of Absurdistan — Where Logic Goes to Die</div>
        </header>

        <!-- Stats Bar -->
        <div id="stats-bar">
            <div class="stat-card">
                <div class="stat-label">Campaign Day</div>
                <div class="stat-value" id="current-day">1</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">National Approval</div>
                <div class="stat-value" id="national-approval">45%</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Districts Won</div>
                <div class="stat-value" id="districts-won">0/12</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Campaign Funds</div>
                <div class="stat-value" id="campaign-funds">$10,000</div>
            </div>
        </div>

        <!-- News Ticker -->
        <div id="news-ticker">
            <span class="news-label">BREAKING</span>
            <span class="news-content" id="news-text">Campaign season begins in Absurdistan! Polls show voters have no idea what they want!</span>
        </div>

        <!-- Main Content -->
        <div id="main-content">
            <!-- Sidebar -->
            <div id="sidebar">
                <!-- Faction Panel -->
                <div class="panel">
                    <h3>Faction Support</h3>
                    <div id="faction-list"></div>
                </div>

                <!-- Current District -->
                <div class="panel">
                    <h3>Current Location</h3>
                    <div id="current-location">Neutralia</div>
                    <div id="district-info" style="display:none;">
                        <div class="district-stats" id="district-stats"></div>
                    </div>
                </div>

                <!-- Event Log -->
                <div class="panel">
                    <h3>Recent Events</h3>
                    <div id="event-log"></div>
                </div>
            </div>

            <!-- Map Area -->
            <div id="map-container">
                <canvas id="game-canvas"></canvas>
            </div>
        </div>

        <!-- Action Panel -->
        <div id="action-panel">
            <button class="action-btn" onclick="game.openSpeechBuilder()">
                <span>Give Speech</span>
            </button>
            <button class="action-btn" onclick="game.holdRally()">
                <span>Hold Rally</span>
            </button>
            <button class="action-btn" onclick="game.openPolicyManager()">
                <span>Manage Policies</span>
            </button>
            <button class="action-btn" onclick="game.startDebate()">
                <span>Debate Opponent</span>
            </button>
            <button class="action-btn" onclick="game.townHall()">
                <span>Town Hall</span>
            </button>
            <button class="action-btn" onclick="game.makeBackroomDeal()">
                <span>Backroom Deal</span>
            </button>
            <button class="action-btn" onclick="game.advanceDay()">
                <span>End Day</span>
            </button>
            <button class="action-btn" onclick="game.saveGame()">
                <span>Save Campaign</span>
            </button>
        </div>

        <!-- Contradiction Meter -->
        <div id="contradiction-meter">
            <div class="meter-label">CONTRADICTION METER</div>
            <div class="meter-bar">
                <div class="meter-fill" id="contradiction-fill" style="width: 0%"></div>
            </div>
            <div class="meter-warning" id="contradiction-warning" style="display:none;">
                Warning: Your conflicting promises are being noticed!
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Intro Modal -->
    <div id="intro-modal" class="modal active">
        <div class="modal-content" style="max-width: 900px;">
            <div id="intro-screen">
                <h2>Welcome to Absurdistan</h2>
                <div class="intro-text">
                    <p style="margin-bottom: 20px;">
                        You're running for President of the most confused nation on Earth. The election is in <strong>30 days</strong>.
                    </p>
                    <p style="margin-bottom: 20px;">
                        Your opponents: <strong>The Populist</strong> (promises everything) and <strong>The Robot</strong> (perfectly logical, completely unrelatable).
                    </p>
                    <p style="margin-bottom: 20px;">
                        Your challenge: Win over <strong>10 absurd factions</strong> who believe mutually exclusive things. The Flat Earthers think gravity is propaganda. The Time Deniers reject the concept of yesterday. The Militant Pacifists will fight anyone who isn't peaceful enough.
                    </p>
                    <p style="margin-bottom: 20px;">
                        Your weapon: <strong>DOUBLESPEAK</strong>. Say things that ALL factions think support them. Make contradictory promises. Survive debates. Hold rallies. Cut backroom deals.
                    </p>
                    <p style="font-weight: bold; color: #ffd700;">
                        Just don't get caught. Contradictions lead to scandals. Scandals lead to revolution. Revolution leads to... well, you'll see.
                    </p>
                </div>
                <button class="start-btn" onclick="game.startGame()">BEGIN CAMPAIGN</button>
            </div>
        </div>
    </div>

    <!-- Speech Builder Modal -->
    <div id="speech-modal" class="modal">
        <div class="modal-content" style="max-width: 1200px;">
            <div class="modal-header">
                <h2 class="modal-title">Build Your Speech</h2>
                <button class="close-btn" onclick="game.closeSpeechBuilder()">&times;</button>
            </div>
            <p style="margin-bottom: 20px;">Select 5-8 phrases to build your campaign speech. Choose wisely — each phrase affects different factions in hidden ways.</p>
            <div id="phrase-bank"></div>
            <div id="speech-preview">
                <h4>Your Speech (Select phrases to build it)</h4>
                <div class="speech-text" id="speech-text">Your speech will appear here as you select phrases...</div>
            </div>
            <button class="action-btn" onclick="game.deliverSpeech()" id="deliver-speech-btn" style="width: 100%;">
                <span>Deliver Speech to the People</span>
            </button>
        </div>
    </div>

    <!-- Debate Modal -->
    <div id="debate-modal" class="modal">
        <div class="modal-content" style="max-width: 1100px;">
            <div class="modal-header">
                <h2 class="modal-title">Presidential Debate</h2>
                <button class="close-btn" onclick="game.endDebate()">&times;</button>
            </div>
            <div id="debate-question">
                <div class="debate-timer" id="debate-timer">10</div>
                <div class="question-text" id="question-text"></div>
                <div class="question-category" id="question-category"></div>
            </div>
            <div id="debate-answers"></div>
            <div id="debate-results" style="display:none;">
                <h4 style="color: #ffd700; margin-bottom: 15px;">Post-Debate Analysis</h4>
                <div id="debate-reaction-grid" class="reaction-grid"></div>
                <button class="action-btn" onclick="game.nextDebateQuestion()" style="width: 100%; margin-top: 20px;">
                    <span>Continue Debate</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Policy Manager Modal -->
    <div id="policy-modal" class="modal">
        <div class="modal-content" style="max-width: 1000px;">
            <div class="modal-header">
                <h2 class="modal-title">Policy Platform</h2>
                <button class="close-btn" onclick="game.closePolicyManager()">&times;</button>
            </div>
            <p style="margin-bottom: 20px;">Select policies to run on. Be careful — contradictory promises will increase your Contradiction Meter!</p>
            <div id="policy-list"></div>
            <button class="action-btn" onclick="game.confirmPolicies()" style="width: 100%; margin-top: 20px;">
                <span>Confirm Policy Platform</span>
            </button>
        </div>
    </div>

    <!-- Reaction Modal -->
    <div id="reaction-modal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2 class="modal-title">Faction Reactions</h2>
                <button class="close-btn" onclick="game.closeReactionModal()">&times;</button>
            </div>
            <div id="reaction-content"></div>
            <div class="reaction-grid" id="reaction-grid"></div>
        </div>
    </div>

    <!-- Results Modal -->
    <div id="results-modal" class="modal">
        <div class="modal-content" style="max-width: 1000px;">
            <div class="results-container">
                <h2 class="results-title" id="results-title">ELECTION RESULTS</h2>
                <div class="results-subtitle" id="results-subtitle"></div>
                <div class="results-stats" id="results-stats"></div>
                <div id="results-narrative" style="margin: 30px 0; font-size: 1.2em; line-height: 1.8;"></div>
                <button class="start-btn" onclick="game.newCampaign()">Start New Campaign</button>
            </div>
        </div>
    </div>

    <script>
        // Game State and Configuration
        const FACTIONS = {
            flatEarth: {
                name: 'Flat Earth Federation',
                color: '#ff6b6b',
                beliefs: ['Earth is flat', 'Gravity is a hoax', '"Up" is propaganda', 'NASA is fiction'],
                keywords: ['rise', 'up', 'level', 'horizon', 'foundation', 'ground'],
                baseSize: 18
            },
            timeDeniers: {
                name: 'Time Deniers',
                color: '#4ecdc4',
                beliefs: ['Clocks are propaganda', 'Yesterday doesn\'t exist', 'Aging is optional', 'The future is now'],
                keywords: ['now', 'moment', 'present', 'eternal', 'timeless', 'forever'],
                baseSize: 15
            },
            reverseEcon: {
                name: 'Reverse Economists',
                color: '#95e1d3',
                beliefs: ['Debt is wealth', 'Spending creates money', 'Banks owe YOU interest', 'Poverty is a hoax'],
                keywords: ['invest', 'spend', 'owe', 'debt', 'redistribute', 'wealth'],
                baseSize: 20
            },
            antiGravity: {
                name: 'Anti-Gravity Party',
                color: '#f38181',
                beliefs: ['Gravity is oppression', 'Demand floating rights', 'Ceiling equality', 'Down is a social construct'],
                keywords: ['rise', 'float', 'ascend', 'elevate', 'lift', 'soar'],
                baseSize: 12
            },
            militantPacifists: {
                name: 'Militant Pacifists',
                color: '#aa96da',
                beliefs: ['Fight for peace', 'Aggressive nonviolence', 'Mandatory harmony', 'Peace through strength'],
                keywords: ['peace', 'fight', 'strength', 'unity', 'force', 'harmony'],
                baseSize: 17
            },
            literalists: {
                name: 'The Literalists',
                color: '#fcbad3',
                beliefs: ['"Break a leg" = assault', 'Idioms are lies', '"Raining cats and dogs" = weather report', 'Metaphors are illegal'],
                keywords: ['actual', 'real', 'literal', 'concrete', 'fact', 'truth'],
                baseSize: 14
            },
            quantumVoters: {
                name: 'Quantum Voters',
                color: '#ffffd2',
                beliefs: ['Support and oppose everything', 'Observation collapses position', 'Schrödinger\'s ballot', 'Superposition is sovereignty'],
                keywords: ['both', 'potential', 'possibility', 'maybe', 'could', 'perhaps'],
                baseSize: 10
            },
            nostalgia: {
                name: 'Nostalgia Party',
                color: '#a8d8ea',
                beliefs: ['Return to "good old days"', 'Remember the future', 'Past was perfect', 'Nostalgia for tomorrow'],
                keywords: ['tradition', 'heritage', 'remember', 'restore', 'legacy', 'classic'],
                baseSize: 19
            },
            contrarians: {
                name: 'The Contrarians',
                color: '#ffb6b9',
                beliefs: ['Oppose popular opinion', 'Disagree on principle', 'If you agree, they change', 'Against the grain'],
                keywords: ['different', 'alternative', 'unique', 'independent', 'unconventional', 'rebel'],
                baseSize: 11
            },
            chaos: {
                name: 'Chaos Party',
                color: '#fec8d8',
                beliefs: ['Random policy generation', 'Coin flip decisions', 'Embrace entropy', 'Order is tyranny'],
                keywords: ['change', 'surprise', 'spontaneous', 'unpredictable', 'dynamic', 'evolve'],
                baseSize: 13
            }
        };

        const SPEECH_PHRASES = [
            {
                text: 'I believe in the POWER of the PEOPLE to RISE UP',
                effects: { flatEarth: 8, antiGravity: 12, militantPacifists: 6, contrarians: -4 }
            },
            {
                text: 'We must live in the PRESENT and seize THIS MOMENT',
                effects: { timeDeniers: 15, quantumVoters: 5, nostalgia: -10 }
            },
            {
                text: 'I will INVEST in YOU by SPENDING on what matters',
                effects: { reverseEcon: 18, chaos: 4, literalists: -3 }
            },
            {
                text: 'Together we will ELEVATE our nation to new HEIGHTS',
                effects: { antiGravity: 14, flatEarth: 6, militantPacifists: 3 }
            },
            {
                text: 'We will FIGHT for PEACE with every ounce of STRENGTH',
                effects: { militantPacifists: 16, contrarians: -6, chaos: 5 }
            },
            {
                text: 'I speak LITERAL TRUTH — my words mean exactly what they say',
                effects: { literalists: 20, quantumVoters: -8, nostalgia: 4 }
            },
            {
                text: 'This is BOTH a promise AND a possibility — MAYBE',
                effects: { quantumVoters: 18, literalists: -12, timeDeniers: 5 }
            },
            {
                text: 'We must RESTORE the timeless TRADITIONS of our HERITAGE',
                effects: { nostalgia: 17, timeDeniers: -10, contrarians: -5 }
            },
            {
                text: 'I offer an ALTERNATIVE vision — DIFFERENT from the rest',
                effects: { contrarians: 15, chaos: 8, militantPacifists: -4 }
            },
            {
                text: 'Change is the only constant — embrace the UNEXPECTED',
                effects: { chaos: 16, quantumVoters: 7, nostalgia: -8 }
            },
            {
                text: 'The FOUNDATION of our nation is SOLID and LEVEL',
                effects: { flatEarth: 14, literalists: 6, antiGravity: -5 }
            },
            {
                text: 'Time to REDISTRIBUTE wealth — what you OWE is what you EARN',
                effects: { reverseEcon: 20, contrarians: 5, nostalgia: -6 }
            },
            {
                text: 'Our potential is LIMITLESS if we dare to FLOAT above constraints',
                effects: { antiGravity: 15, quantumVoters: 6, flatEarth: -4 }
            },
            {
                text: 'UNITY through FORCE — MANDATORY cooperation for all',
                effects: { militantPacifists: 14, chaos: -8, contrarians: -10 }
            },
            {
                text: 'I stand on CONCRETE facts, not metaphorical nonsense',
                effects: { literalists: 18, flatEarth: 7, quantumVoters: -6 }
            },
            {
                text: 'Every decision exists in SUPERPOSITION until we observe it',
                effects: { quantumVoters: 20, chaos: 8, literalists: -15 }
            },
            {
                text: 'Remember when tomorrow was yesterday? Let\'s go back to that',
                effects: { nostalgia: 16, timeDeniers: 12, literalists: -10 }
            },
            {
                text: 'Whatever they propose, I oppose — INDEPENDENT thinking!',
                effects: { contrarians: 18, chaos: 6, militantPacifists: -7 }
            },
            {
                text: 'Let the COIN FLIP decide — pure SPONTANEOUS governance',
                effects: { chaos: 20, quantumVoters: 10, nostalgia: -12 }
            },
            {
                text: 'The HORIZON stretches LEVEL as far as the eye can see',
                effects: { flatEarth: 16, nostalgia: 5, antiGravity: -8 }
            },
            {
                text: 'FOREVER starts NOW — aging is just a mindset',
                effects: { timeDeniers: 18, quantumVoters: 5, nostalgia: -8 }
            },
            {
                text: 'Your POVERTY is their WEALTH — time to flip the script',
                effects: { reverseEcon: 22, contrarians: 8, chaos: 6 }
            },
            {
                text: 'Down with UP and up with DOWN — CEILING equality now!',
                effects: { antiGravity: 18, chaos: 10, literalists: -5 }
            },
            {
                text: 'PEACEFUL warriors UNITE — we\'ll fight anyone who disagrees',
                effects: { militantPacifists: 20, contrarians: -8, chaos: 4 }
            }
        ];

        const DEBATE_QUESTIONS = [
            {
                category: 'Science Policy',
                question: 'What is your stance on funding scientific research into the shape of our planet?',
                answers: [
                    { text: 'We must explore ALL possibilities — flat, round, and everything between', effects: { flatEarth: 12, quantumVoters: 8, literalists: -5 } },
                    { text: 'Science is about RISING above old assumptions and ELEVATING our understanding', effects: { antiGravity: 10, flatEarth: 5, nostalgia: -8 } },
                    { text: 'The FACTS speak for themselves — I deal in LITERAL truth, not theory', effects: { literalists: 15, flatEarth: -6, quantumVoters: -8 } },
                    { text: 'Whatever the mainstream scientists say, I say the OPPOSITE', effects: { contrarians: 18, flatEarth: 8, chaos: 5 } }
                ]
            },
            {
                category: 'Economic Policy',
                question: 'How will you address the national debt?',
                answers: [
                    { text: 'Debt IS wealth! We should BORROW more to become RICHER', effects: { reverseEcon: 20, chaos: 6, literalists: -10 } },
                    { text: 'We need to INVEST in SPENDING programs to create prosperity', effects: { reverseEcon: 15, militantPacifists: 5, nostalgia: -6 } },
                    { text: 'Return to the TRADITIONAL economic values of our ancestors', effects: { nostalgia: 16, reverseEcon: -12, timeDeniers: -8 } },
                    { text: 'Let CHAOS decide — coin flip between paying it off and tripling it', effects: { chaos: 18, quantumVoters: 8, literalists: -12 } }
                ]
            },
            {
                category: 'Time Policy',
                question: 'Should we maintain daylight saving time?',
                answers: [
                    { text: 'Time is an ILLUSION — clocks are PROPAGANDA tools', effects: { timeDeniers: 22, chaos: 6, nostalgia: -10 } },
                    { text: 'We should REMEMBER when time didn\'t change and RESTORE that', effects: { nostalgia: 14, timeDeniers: -8, literalists: 5 } },
                    { text: 'BOTH keep it AND abolish it — let voters exist in SUPERPOSITION', effects: { quantumVoters: 20, timeDeniers: 6, literalists: -15 } },
                    { text: 'The LITERAL movement of clocks should match ACTUAL sunlight', effects: { literalists: 16, timeDeniers: -6, quantumVoters: -8 } }
                ]
            },
            {
                category: 'Gravity Rights',
                question: 'What is your position on anti-gravity legislation?',
                answers: [
                    { text: 'ALL citizens have the right to FLOAT — gravity is OPPRESSION', effects: { antiGravity: 22, flatEarth: 8, literalists: -8 } },
                    { text: 'We will FIGHT to ELEVATE every person to EQUAL HEIGHT', effects: { antiGravity: 15, militantPacifists: 10, flatEarth: 5 } },
                    { text: 'What goes up shouldn\'t have to come down — ALTERNATIVE physics!', effects: { antiGravity: 18, contrarians: 10, literalists: -12 } },
                    { text: 'Gravity keeps us GROUNDED on our FLAT, LEVEL earth', effects: { flatEarth: 16, antiGravity: -20, nostalgia: 6 } }
                ]
            },
            {
                category: 'Peace & Defense',
                question: 'How will you ensure national security?',
                answers: [
                    { text: 'MANDATORY PEACE enforced through AGGRESSIVE nonviolence', effects: { militantPacifists: 24, contrarians: -8, chaos: 4 } },
                    { text: 'FIGHT for peace, BATTLE for harmony, WAR against war', effects: { militantPacifists: 20, chaos: 8, quantumVoters: 6 } },
                    { text: 'Whatever the defense establishment recommends, do the OPPOSITE', effects: { contrarians: 18, militantPacifists: -6, chaos: 10 } },
                    { text: 'Return to TRADITIONAL values of... aggressive peaceful strength?', effects: { nostalgia: 12, militantPacifists: 8, quantumVoters: 6 } }
                ]
            },
            {
                category: 'Language Policy',
                question: 'Should we regulate the use of metaphors and idioms?',
                answers: [
                    { text: 'Ban ALL metaphors — only LITERAL language is TRUTHFUL', effects: { literalists: 25, quantumVoters: -15, chaos: -8 } },
                    { text: 'Language should be BOTH literal AND metaphorical SIMULTANEOUSLY', effects: { quantumVoters: 18, literalists: -12, chaos: 8 } },
                    { text: 'RESTORE the pure language of our ancestors before idioms existed', effects: { nostalgia: 16, literalists: 10, timeDeniers: -6 } },
                    { text: 'Let words mean RANDOM things — SPONTANEOUS semantics!', effects: { chaos: 20, literalists: -18, contrarians: 10 } }
                ]
            }
        ];

        const POLICIES = [
            {
                id: 'flatEarthEducation',
                title: 'Flat Earth Science Curriculum',
                description: 'Teach alternative planetary geometry in all schools',
                category: 'Education',
                effects: { flatEarth: 25, literalists: -15, quantumVoters: -10 },
                contradicts: ['sphericalEarthScience']
            },
            {
                id: 'sphericalEarthScience',
                title: 'Evidence-Based Astronomy',
                description: 'Mandate teaching of spherical Earth model',
                category: 'Education',
                effects: { flatEarth: -25, literalists: 20, nostalgia: -10 },
                contradicts: ['flatEarthEducation']
            },
            {
                id: 'abolishClocks',
                title: 'Clock Abolition Act',
                description: 'Remove all public timekeeping devices',
                category: 'Time',
                effects: { timeDeniers: 30, chaos: 15, literalists: -20 },
                contradicts: ['standardTime']
            },
            {
                id: 'standardTime',
                title: 'Universal Time Standard',
                description: 'Synchronize all clocks nationally',
                category: 'Time',
                effects: { timeDeniers: -30, literalists: 15, nostalgia: 10 },
                contradicts: ['abolishClocks']
            },
            {
                id: 'debtAsWealth',
                title: 'Debt-Based Prosperity Program',
                description: 'Government pays citizens to take on debt',
                category: 'Economy',
                effects: { reverseEcon: 35, chaos: 10, nostalgia: -15 },
                contradicts: ['balancedBudget']
            },
            {
                id: 'balancedBudget',
                title: 'Balanced Budget Amendment',
                description: 'Require government to balance income and spending',
                category: 'Economy',
                effects: { reverseEcon: -30, nostalgia: 20, literalists: 15 },
                contradicts: ['debtAsWealth']
            },
            {
                id: 'antiGravityZones',
                title: 'Designated Float Spaces',
                description: 'Create gravity-free zones for floating citizens',
                category: 'Rights',
                effects: { antiGravity: 30, chaos: 12, flatEarth: -10 },
                contradicts: ['gravityEnforcement']
            },
            {
                id: 'gravityEnforcement',
                title: 'Universal Gravity Compliance',
                description: 'Mandate adherence to gravitational laws',
                category: 'Rights',
                effects: { antiGravity: -35, literalists: 15, flatEarth: 10 },
                contradicts: ['antiGravityZones']
            },
            {
                id: 'mandatoryPeace',
                title: 'Aggressive Peace Enforcement',
                description: 'Jail anyone who isn\'t peaceful enough',
                category: 'Defense',
                effects: { militantPacifists: 30, contrarians: -20, chaos: -15 },
                contradicts: ['peaceAsChoice']
            },
            {
                id: 'peaceAsChoice',
                title: 'Voluntary Peace Initiative',
                description: 'Encourage but don\'t mandate peaceful behavior',
                category: 'Defense',
                effects: { militantPacifists: -25, quantumVoters: 15, chaos: 10 },
                contradicts: ['mandatoryPeace']
            },
            {
                id: 'literalLanguage',
                title: 'Literal Language Law',
                description: 'Ban all metaphors, idioms, and figurative speech',
                category: 'Language',
                effects: { literalists: 35, chaos: -20, quantumVoters: -15 },
                contradicts: ['freeExpression']
            },
            {
                id: 'freeExpression',
                title: 'Free Expression Act',
                description: 'Protect all forms of speech including metaphors',
                category: 'Language',
                effects: { literalists: -30, quantumVoters: 20, chaos: 15 },
                contradicts: ['literalLanguage']
            }
        ];

        const DISTRICTS = [
            { name: 'Neutralia', x: 400, y: 300, factions: ['quantumVoters', 'chaos'] },
            { name: 'Flatlandia', x: 150, y: 150, factions: ['flatEarth', 'literalists'] },
            { name: 'Timeless Valley', x: 650, y: 150, factions: ['timeDeniers', 'nostalgia'] },
            { name: 'Debtopia', x: 150, y: 450, factions: ['reverseEcon', 'chaos'] },
            { name: 'Skyreach', x: 650, y: 450, factions: ['antiGravity', 'flatEarth'] },
            { name: 'Peaceland', x: 300, y: 200, factions: ['militantPacifists', 'nostalgia'] },
            { name: 'Literalton', x: 500, y: 200, factions: ['literalists', 'contrarians'] },
            { name: 'Schrödingersburg', x: 300, y: 400, factions: ['quantumVoters', 'timeDeniers'] },
            { name: 'Yesteryear', x: 500, y: 400, factions: ['nostalgia', 'reverseEcon'] },
            { name: 'Oppositedale', x: 200, y: 300, factions: ['contrarians', 'antiGravity'] },
            { name: 'Randomville', x: 600, y: 300, factions: ['chaos', 'militantPacifists'] },
            { name: 'The Capital', x: 400, y: 250, factions: ['quantumVoters', 'literalists'] }
        ];

        const NEWS_HEADLINES = [
            'Time Deniers protest clock factory: "We were never here!"',
            'Flat Earth Federation demands NASA budget for edge exploration',
            'Reverse Economists celebrate national debt reaching new highs',
            'Anti-Gravity Party holds floating rally — attendees fail to float',
            'Militant Pacifists peacefully beat protesters for insufficient tranquility',
            'Literalists sue weather service for false "raining cats and dogs" report',
            'Quantum Voters simultaneously endorse all candidates and none',
            'Nostalgia Party nostalgic for political scandals that never happened',
            'Contrarians oppose their own platform after gaining support',
            'Chaos Party chooses policies via coin flip — lands on edge',
            'Breaking: Yesterday cancelled due to lack of evidence',
            'Banks confused as Reverse Economists demand to owe more money',
            'Ceiling Rights activists demand equal floor-ceiling accommodation',
            'Peace enforcement squad aggressively mediates disagreement',
            'Metaphor ban proposed — opponents say it\'s "dead on arrival" then arrested'
        ];

        class Game {
            constructor() {
                this.day = 1;
                this.maxDays = 30;
                this.funds = 10000;
                this.currentDistrict = 'Neutralia';
                this.selectedPhrases = [];
                this.selectedPolicies = [];
                this.contradictionLevel = 0;

                this.factionApprovals = {};
                Object.keys(FACTIONS).forEach(key => {
                    this.factionApprovals[key] = 45 + Math.floor(Math.random() * 10) - 5;
                });

                this.districtApprovals = {};
                DISTRICTS.forEach(d => {
                    this.districtApprovals[d.name] = 40 + Math.floor(Math.random() * 20);
                });

                this.events = [];
                this.debateQuestionIndex = 0;
                this.debateTimer = null;
                this.debateTimeLeft = 10;

                this.opponents = [
                    { name: 'The Populist', approval: 48 },
                    { name: 'The Robot', approval: 42 }
                ];

                this.canvas = document.getElementById('game-canvas');
                this.ctx = this.canvas.getContext('2d');
                this.initCanvas();

                this.loadGame();
            }

            initCanvas() {
                this.canvas.width = 800;
                this.canvas.height = 600;
                this.drawMap();
            }

            drawMap() {
                const ctx = this.ctx;
                ctx.fillStyle = '#0a0a15';
                ctx.fillRect(0, 0, 800, 600);

                // Draw districts
                DISTRICTS.forEach((district, i) => {
                    const dominantFaction = FACTIONS[district.factions[0]];
                    const approval = this.districtApprovals[district.name];

                    // Draw district circle
                    ctx.beginPath();
                    ctx.arc(district.x, district.y, 50, 0, Math.PI * 2);
                    ctx.fillStyle = dominantFaction.color + '40';
                    ctx.fill();
                    ctx.strokeStyle = dominantFaction.color;
                    ctx.lineWidth = 3;
                    ctx.stroke();

                    // Highlight current district
                    if (district.name === this.currentDistrict) {
                        ctx.beginPath();
                        ctx.arc(district.x, district.y, 60, 0, Math.PI * 2);
                        ctx.strokeStyle = '#ffd700';
                        ctx.lineWidth = 4;
                        ctx.stroke();
                    }

                    // District name
                    ctx.fillStyle = '#fff';
                    ctx.font = 'bold 14px Georgia';
                    ctx.textAlign = 'center';
                    ctx.fillText(district.name, district.x, district.y - 60);

                    // Approval %
                    ctx.font = 'bold 16px Georgia';
                    ctx.fillStyle = approval >= 50 ? '#4caf50' : '#ff6b6b';
                    ctx.fillText(approval + '%', district.x, district.y + 5);

                    // Draw connections
                    if (i < DISTRICTS.length - 1) {
                        ctx.beginPath();
                        ctx.moveTo(district.x, district.y);
                        const next = DISTRICTS[(i + 1) % DISTRICTS.length];
                        ctx.lineTo(next.x, next.y);
                        ctx.strokeStyle = 'rgba(255,255,255,0.1)';
                        ctx.lineWidth = 1;
                        ctx.stroke();
                    }
                });

                // Draw legend
                ctx.fillStyle = 'rgba(0,0,0,0.7)';
                ctx.fillRect(10, 10, 200, 150);
                ctx.strokeStyle = '#ffd700';
                ctx.lineWidth = 2;
                ctx.strokeRect(10, 10, 200, 150);

                ctx.fillStyle = '#ffd700';
                ctx.font = 'bold 14px Georgia';
                ctx.textAlign = 'left';
                ctx.fillText('MAP LEGEND', 20, 30);

                ctx.font = '12px Georgia';
                ctx.fillStyle = '#fff';
                ctx.fillText('• Click district to travel', 20, 55);
                ctx.fillText('• Gold border = You are here', 20, 75);
                ctx.fillText('• Color = Dominant faction', 20, 95);
                ctx.fillText('• Number = Your approval', 20, 115);
                ctx.fillText('• Green >50% = Winning', 20, 135);
            }

            startGame() {
                document.getElementById('intro-modal').classList.remove('active');
                this.updateUI();
                this.addEvent('Campaign begins! You arrive in Neutralia, the nation\'s confused capital.');
                this.updateNewsTicker();
                this.drawMap();

                // Add click handler for map
                this.canvas.addEventListener('click', (e) => this.handleMapClick(e));
            }

            handleMapClick(e) {
                const rect = this.canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                const scaleX = this.canvas.width / rect.width;
                const scaleY = this.canvas.height / rect.height;
                const mapX = x * scaleX;
                const mapY = y * scaleY;

                DISTRICTS.forEach(district => {
                    const dist = Math.sqrt((mapX - district.x) ** 2 + (mapY - district.y) ** 2);
                    if (dist < 50) {
                        this.travelTo(district.name);
                    }
                });
            }

            travelTo(districtName) {
                if (districtName === this.currentDistrict) return;

                this.currentDistrict = districtName;
                this.addEvent(`Traveled to ${districtName}`);

                document.getElementById('current-location').textContent = districtName;
                this.drawMap();

                const district = DISTRICTS.find(d => d.name === districtName);
                this.showDistrictInfo(district);
            }

            showDistrictInfo(district) {
                const infoDiv = document.getElementById('district-info');
                const statsDiv = document.getElementById('district-stats');

                infoDiv.style.display = 'block';

                let html = '';
                district.factions.forEach(fKey => {
                    const faction = FACTIONS[fKey];
                    const approval = this.factionApprovals[fKey];
                    html += `
                        <div class="stat-card">
                            <div class="stat-label" style="color: ${faction.color}">${faction.name}</div>
                            <div class="stat-value">${approval}%</div>
                        </div>
                    `;
                });

                statsDiv.innerHTML = html;
            }

            updateUI() {
                document.getElementById('current-day').textContent = `${this.day}/${this.maxDays}`;
                document.getElementById('campaign-funds').textContent = `$${this.funds.toLocaleString()}`;

                const nationalApproval = this.calculateNationalApproval();
                document.getElementById('national-approval').textContent = nationalApproval + '%';

                const districtsWon = Object.values(this.districtApprovals).filter(a => a >= 50).length;
                document.getElementById('districts-won').textContent = `${districtsWon}/12`;

                this.updateFactionList();
                this.updateContradictionMeter();
            }

            calculateNationalApproval() {
                const total = Object.values(this.factionApprovals).reduce((sum, val) => sum + val, 0);
                return Math.round(total / Object.keys(this.factionApprovals).length);
            }

            updateFactionList() {
                const list = document.getElementById('faction-list');
                let html = '';

                Object.keys(FACTIONS).forEach(key => {
                    const faction = FACTIONS[key];
                    const approval = this.factionApprovals[key];

                    html += `
                        <div class="faction-item" style="border-left-color: ${faction.color}" title="${faction.beliefs.join(', ')}">
                            <div class="faction-name" style="color: ${faction.color}">${faction.name}</div>
                            <div class="faction-approval">
                                <div class="approval-bar">
                                    <div class="approval-fill" style="width: ${approval}%"></div>
                                </div>
                                <span style="color: ${faction.color}">${approval}%</span>
                            </div>
                        </div>
                    `;
                });

                list.innerHTML = html;
            }

            updateContradictionMeter() {
                const fill = document.getElementById('contradiction-fill');
                const warning = document.getElementById('contradiction-warning');

                fill.style.width = this.contradictionLevel + '%';

                if (this.contradictionLevel >= 70) {
                    warning.style.display = 'block';
                    warning.textContent = 'DANGER: Media is investigating your contradictory promises!';
                } else if (this.contradictionLevel >= 50) {
                    warning.style.display = 'block';
                    warning.textContent = 'Warning: Your conflicting promises are being noticed!';
                } else {
                    warning.style.display = 'none';
                }
            }

            openSpeechBuilder() {
                this.selectedPhrases = [];
                const modal = document.getElementById('speech-modal');
                modal.classList.add('active');

                const phraseBank = document.getElementById('phrase-bank');
                let html = '';

                SPEECH_PHRASES.forEach((phrase, i) => {
                    html += `
                        <div class="phrase-option" onclick="game.togglePhrase(${i})">
                            <div class="phrase-text">${phrase.text}</div>
                            <div class="phrase-hint">Effects hidden until delivered</div>
                        </div>
                    `;
                });

                phraseBank.innerHTML = html;
                this.updateSpeechPreview();
            }

            togglePhrase(index) {
                const phraseIndex = this.selectedPhrases.indexOf(index);

                if (phraseIndex > -1) {
                    this.selectedPhrases.splice(phraseIndex, 1);
                } else {
                    if (this.selectedPhrases.length < 8) {
                        this.selectedPhrases.push(index);
                    }
                }

                // Update visual selection
                const options = document.querySelectorAll('.phrase-option');
                options[index].classList.toggle('selected');

                this.updateSpeechPreview();
            }

            updateSpeechPreview() {
                const preview = document.getElementById('speech-text');
                const btn = document.getElementById('deliver-speech-btn');

                if (this.selectedPhrases.length === 0) {
                    preview.textContent = 'Your speech will appear here as you select phrases...';
                    btn.disabled = true;
                } else {
                    const speech = this.selectedPhrases
                        .map(i => SPEECH_PHRASES[i].text)
                        .join('. ') + '.';
                    preview.textContent = '"' + speech + '"';
                    btn.disabled = this.selectedPhrases.length < 5;
                }
            }

            deliverSpeech() {
                if (this.selectedPhrases.length < 5) return;

                const effects = {};
                Object.keys(FACTIONS).forEach(key => effects[key] = 0);

                this.selectedPhrases.forEach(i => {
                    const phrase = SPEECH_PHRASES[i];
                    Object.keys(phrase.effects).forEach(faction => {
                        effects[faction] += phrase.effects[faction];
                    });
                });

                // Apply effects
                Object.keys(effects).forEach(faction => {
                    this.factionApprovals[faction] = Math.max(0, Math.min(100,
                        this.factionApprovals[faction] + effects[faction]
                    ));
                });

                // Update district approval
                const currentDist = DISTRICTS.find(d => d.name === this.currentDistrict);
                if (currentDist) {
                    const avgEffect = currentDist.factions.reduce((sum, f) => sum + effects[f], 0) / currentDist.factions.length;
                    this.districtApprovals[this.currentDistrict] = Math.max(0, Math.min(100,
                        this.districtApprovals[this.currentDistrict] + avgEffect
                    ));
                }

                this.closeSpeechBuilder();
                this.showReactions(effects, 'Speech delivered!');
                this.addEvent(`Gave speech in ${this.currentDistrict}`);
                this.updateUI();
                this.drawMap();
            }

            closeSpeechBuilder() {
                document.getElementById('speech-modal').classList.remove('active');
            }

            showReactions(effects, title) {
                const modal = document.getElementById('reaction-modal');
                modal.classList.add('active');

                document.querySelector('#reaction-modal .modal-title').textContent = title;

                const grid = document.getElementById('reaction-grid');
                let html = '';

                Object.keys(effects).forEach(key => {
                    const faction = FACTIONS[key];
                    const effect = effects[key];

                    if (effect !== 0) {
                        const cssClass = effect > 0 ? 'positive' : 'negative';
                        const symbol = effect > 0 ? '+' : '';

                        html += `
                            <div class="reaction-item" style="border-left-color: ${faction.color}">
                                <div class="reaction-faction" style="color: ${faction.color}">${faction.name}</div>
                                <div class="reaction-value ${cssClass}">${symbol}${effect}%</div>
                            </div>
                        `;
                    }
                });

                grid.innerHTML = html || '<p>No significant reactions</p>';
            }

            closeReactionModal() {
                document.getElementById('reaction-modal').classList.remove('active');
            }

            holdRally() {
                if (this.funds < 2000) {
                    alert('Not enough funds! Rallies cost $2,000.');
                    return;
                }

                this.funds -= 2000;

                const district = DISTRICTS.find(d => d.name === this.currentDistrict);
                const effects = {};
                Object.keys(FACTIONS).forEach(key => effects[key] = 0);

                district.factions.forEach(fKey => {
                    const boost = 5 + Math.floor(Math.random() * 5);
                    effects[fKey] = boost;
                    this.factionApprovals[fKey] = Math.min(100, this.factionApprovals[fKey] + boost);
                });

                this.districtApprovals[this.currentDistrict] = Math.min(100,
                    this.districtApprovals[this.currentDistrict] + 8
                );

                this.showReactions(effects, 'Rally Results!');
                this.addEvent(`Held rally in ${this.currentDistrict} - crowd size: ${Math.floor(Math.random() * 5000) + 2000}`);
                this.updateUI();
                this.drawMap();
            }

            startDebate() {
                this.debateQuestionIndex = 0;
                const modal = document.getElementById('debate-modal');
                modal.classList.add('active');
                document.getElementById('debate-results').style.display = 'none';
                this.showDebateQuestion();
            }

            showDebateQuestion() {
                if (this.debateQuestionIndex >= 5) {
                    this.endDebate();
                    return;
                }

                const question = DEBATE_QUESTIONS[Math.floor(Math.random() * DEBATE_QUESTIONS.length)];

                document.getElementById('question-text').textContent = question.question;
                document.getElementById('question-category').textContent = `Category: ${question.category}`;

                const answersDiv = document.getElementById('debate-answers');
                let html = '';

                question.answers.forEach((answer, i) => {
                    html += `
                        <div class="answer-option" onclick="game.selectDebateAnswer(${i}, ${JSON.stringify(answer.effects).replace(/"/g, '&quot;')})">
                            ${answer.text}
                        </div>
                    `;
                });

                answersDiv.innerHTML = html;

                this.debateTimeLeft = 10;
                this.updateDebateTimer();

                if (this.debateTimer) clearInterval(this.debateTimer);
                this.debateTimer = setInterval(() => {
                    this.debateTimeLeft--;
                    this.updateDebateTimer();

                    if (this.debateTimeLeft <= 0) {
                        clearInterval(this.debateTimer);
                        // Auto-select random answer if time runs out
                        const randomAnswer = Math.floor(Math.random() * 4);
                        const question = DEBATE_QUESTIONS[this.debateQuestionIndex % DEBATE_QUESTIONS.length];
                        this.selectDebateAnswer(randomAnswer, question.answers[randomAnswer].effects);
                    }
                }, 1000);
            }

            updateDebateTimer() {
                const timer = document.getElementById('debate-timer');
                timer.textContent = this.debateTimeLeft;

                if (this.debateTimeLeft <= 3) {
                    timer.style.color = '#ff6b6b';
                    timer.classList.add('pulsing');
                } else {
                    timer.style.color = '#ffd700';
                    timer.classList.remove('pulsing');
                }
            }

            selectDebateAnswer(index, effects) {
                clearInterval(this.debateTimer);

                Object.keys(effects).forEach(faction => {
                    this.factionApprovals[faction] = Math.max(0, Math.min(100,
                        this.factionApprovals[faction] + effects[faction]
                    ));
                });

                document.getElementById('debate-answers').style.display = 'none';
                document.getElementById('debate-results').style.display = 'block';

                const grid = document.getElementById('debate-reaction-grid');
                let html = '';

                Object.keys(effects).forEach(key => {
                    const faction = FACTIONS[key];
                    const effect = effects[key];

                    if (effect !== 0) {
                        const cssClass = effect > 0 ? 'positive' : 'negative';
                        const symbol = effect > 0 ? '+' : '';

                        html += `
                            <div class="reaction-item" style="border-left-color: ${faction.color}">
                                <div class="reaction-faction" style="color: ${faction.color}">${faction.name}</div>
                                <div class="reaction-value ${cssClass}">${symbol}${effect}%</div>
                            </div>
                        `;
                    }
                });

                grid.innerHTML = html;

                this.debateQuestionIndex++;
                this.updateUI();
            }

            nextDebateQuestion() {
                document.getElementById('debate-answers').style.display = 'grid';
                document.getElementById('debate-results').style.display = 'none';
                this.showDebateQuestion();
            }

            endDebate() {
                clearInterval(this.debateTimer);
                document.getElementById('debate-modal').classList.remove('active');
                this.addEvent('Completed presidential debate');
                this.updateNewsTicker();
                this.updateUI();
            }

            openPolicyManager() {
                const modal = document.getElementById('policy-modal');
                modal.classList.add('active');

                const list = document.getElementById('policy-list');
                let html = '';

                POLICIES.forEach((policy, i) => {
                    const selected = this.selectedPolicies.includes(policy.id);
                    const cssClass = selected ? 'selected' : '';

                    let effectTags = '';
                    Object.keys(policy.effects).forEach(fKey => {
                        const faction = FACTIONS[fKey];
                        const effect = policy.effects[fKey];
                        const tagClass = effect > 0 ? 'effect-positive' : 'effect-negative';
                        const symbol = effect > 0 ? '+' : '';

                        effectTags += `<span class="effect-tag ${tagClass}">${faction.name}: ${symbol}${effect}%</span>`;
                    });

                    html += `
                        <div class="policy-item ${cssClass}" onclick="game.togglePolicy('${policy.id}')">
                            <div class="policy-title">${policy.title}</div>
                            <div class="policy-description">${policy.description}</div>
                            <div class="policy-effects">${effectTags}</div>
                        </div>
                    `;
                });

                list.innerHTML = html;
            }

            togglePolicy(policyId) {
                const policy = POLICIES.find(p => p.id === policyId);
                const index = this.selectedPolicies.indexOf(policyId);

                if (index > -1) {
                    this.selectedPolicies.splice(index, 1);
                } else {
                    this.selectedPolicies.push(policyId);

                    // Check for contradictions
                    if (policy.contradicts) {
                        policy.contradicts.forEach(contradictId => {
                            if (this.selectedPolicies.includes(contradictId)) {
                                this.contradictionLevel = Math.min(100, this.contradictionLevel + 15);
                            }
                        });
                    }
                }

                this.openPolicyManager();
            }

            confirmPolicies() {
                const effects = {};
                Object.keys(FACTIONS).forEach(key => effects[key] = 0);

                this.selectedPolicies.forEach(policyId => {
                    const policy = POLICIES.find(p => p.id === policyId);
                    Object.keys(policy.effects).forEach(faction => {
                        effects[faction] += policy.effects[faction];
                    });
                });

                Object.keys(effects).forEach(faction => {
                    this.factionApprovals[faction] = Math.max(0, Math.min(100,
                        this.factionApprovals[faction] + effects[faction]
                    ));
                });

                this.closePolicyManager();
                this.showReactions(effects, 'Policy Platform Updated!');
                this.addEvent('Announced new policy platform');
                this.updateUI();
            }

            closePolicyManager() {
                document.getElementById('policy-modal').classList.remove('active');
            }

            townHall() {
                const factionKeys = Object.keys(FACTIONS);
                const randomFaction = factionKeys[Math.floor(Math.random() * factionKeys.length)];
                const faction = FACTIONS[randomFaction];

                const question = faction.beliefs[Math.floor(Math.random() * faction.beliefs.length)];

                const responses = [
                    `I COMPLETELY agree that ${question.toLowerCase()}`,
                    `The OPPOSITE of what you're suggesting is what I believe`,
                    `That's an interesting PERSPECTIVE we should explore TOGETHER`,
                    `I think we can find COMMON GROUND on this issue`
                ];

                const response = responses[Math.floor(Math.random() * responses.length)];

                const success = Math.random() > 0.5;
                const effect = success ? (5 + Math.floor(Math.random() * 10)) : -(5 + Math.floor(Math.random() * 10));

                this.factionApprovals[randomFaction] = Math.max(0, Math.min(100,
                    this.factionApprovals[randomFaction] + effect
                ));

                const effects = {};
                effects[randomFaction] = effect;

                this.showReactions(effects, `Town Hall: ${faction.name} asks about "${question}"`);
                this.addEvent(`Town hall in ${this.currentDistrict}`);
                this.updateUI();
            }

            makeBackroomDeal() {
                if (this.funds < 5000) {
                    alert('Not enough funds! Backroom deals cost $5,000.');
                    return;
                }

                this.funds -= 5000;

                const factionKeys = Object.keys(FACTIONS);
                const randomFaction = factionKeys[Math.floor(Math.random() * factionKeys.length)];

                const boost = 15 + Math.floor(Math.random() * 10);
                this.factionApprovals[randomFaction] = Math.min(100,
                    this.factionApprovals[randomFaction] + boost
                );

                const effects = {};
                effects[randomFaction] = boost;

                // Increase contradiction meter (secret deals are risky)
                this.contradictionLevel = Math.min(100, this.contradictionLevel + 10);

                this.showReactions(effects, 'Backroom Deal Completed!');
                this.addEvent(`Secret meeting with ${FACTIONS[randomFaction].name} leadership`);
                this.updateUI();
            }

            advanceDay() {
                this.day++;

                // Random events
                if (Math.random() < 0.3) {
                    this.triggerScandal();
                }

                // Opponent actions
                this.opponentActions();

                // Update district approvals based on faction approvals
                DISTRICTS.forEach(district => {
                    const avgApproval = district.factions.reduce((sum, f) =>
                        sum + this.factionApprovals[f], 0) / district.factions.length;
                    this.districtApprovals[district.name] = Math.round(avgApproval);
                });

                this.updateNewsTicker();
                this.addEvent(`Day ${this.day} begins`);
                this.updateUI();
                this.drawMap();

                if (this.day > this.maxDays) {
                    this.triggerElection();
                }
            }

            triggerScandal() {
                if (this.contradictionLevel > 50) {
                    const penalty = -10 - Math.floor(Math.random() * 10);

                    Object.keys(this.factionApprovals).forEach(faction => {
                        this.factionApprovals[faction] = Math.max(0,
                            this.factionApprovals[faction] + penalty
                        );
                    });

                    this.addEvent('SCANDAL! Contradictory promises exposed by media!');
                    this.contradictionLevel = Math.max(0, this.contradictionLevel - 20);
                    this.updateUI();
                }
            }

            opponentActions() {
                this.opponents.forEach(opp => {
                    const change = Math.floor(Math.random() * 6) - 3;
                    opp.approval = Math.max(0, Math.min(100, opp.approval + change));
                });
            }

            updateNewsTicker() {
                const headline = NEWS_HEADLINES[Math.floor(Math.random() * NEWS_HEADLINES.length)];
                document.getElementById('news-text').textContent = headline;
            }

            addEvent(text) {
                this.events.unshift({ day: this.day, text });
                if (this.events.length > 10) this.events.pop();

                const log = document.getElementById('event-log');
                let html = '';

                this.events.forEach(event => {
                    html += `
                        <div class="event-item slide-in">
                            <span class="event-day">Day ${event.day}:</span>
                            ${event.text}
                        </div>
                    `;
                });

                log.innerHTML = html;
            }

            triggerElection() {
                const modal = document.getElementById('results-modal');
                modal.classList.add('active');

                const nationalApproval = this.calculateNationalApproval();
                const districtsWon = Object.values(this.districtApprovals).filter(a => a >= 50).length;

                let outcome, subtitle, narrative;

                if (this.contradictionLevel >= 80) {
                    outcome = 'REVOLUTION!';
                    subtitle = 'Your contradictions caused all factions to unite... against you';
                    narrative = `
                        The people of Absurdistan discovered your web of contradictory promises. In an unprecedented moment of clarity,
                        all 10 factions put aside their differences and united for the first time in history... to vote against you.
                        Even the Quantum Voters collapsed into a single definite state of "absolutely not."
                        <br><br>
                        Final approval: ${nationalApproval}%<br>
                        Districts won: ${districtsWon}/12<br>
                        <br>
                        The Contrarians tried to support you out of principle, but then opposed themselves and collapsed into a logical paradox.
                    `;
                } else if (districtsWon >= 11 && nationalApproval >= 70) {
                    outcome = 'ASCENSION!';
                    subtitle = 'You achieved the impossible — universal approval in Absurdistan';
                    narrative = `
                        Through masterful doublespeak, you convinced every faction that you support them exclusively.
                        The Flat Earthers think you'll prove Earth is flat. The Anti-Gravity Party thinks you'll make everyone float.
                        The Time Deniers think you've abolished clocks. The Literalists think you've banned metaphors.
                        <br><br>
                        This should be impossible, but you've done it. Reality itself bends to your campaign promises.
                        As you take office, the Quantum Voters observe your superposition and... reality collapses.
                        <br><br>
                        You didn't just win the election. You transcended it.
                        <br><br>
                        Final approval: ${nationalApproval}%<br>
                        Districts won: ${districtsWon}/12
                    `;
                } else if (districtsWon >= 7) {
                    outcome = 'LANDSLIDE VICTORY!';
                    subtitle = 'President of Absurdistan';
                    narrative = `
                        You won! Through a combination of strategic doublespeak, carefully timed rallies, and only moderate contradictions,
                        you've convinced enough of Absurdistan's confused citizens to vote for you.
                        <br><br>
                        The Populist concedes, saying "I promised I'd win, so this is actually a victory for me."
                        The Robot simply states "Error 404: Democracy not found" and shuts down.
                        <br><br>
                        You are now President of the most confusing nation on Earth. Good luck governing people who believe
                        mutually exclusive things!
                        <br><br>
                        Final approval: ${nationalApproval}%<br>
                        Districts won: ${districtsWon}/12<br>
                        Campaign funds remaining: $${this.funds.toLocaleString()}
                    `;
                } else if (districtsWon >= 5) {
                    outcome = 'NARROW VICTORY';
                    subtitle = 'You scraped by... barely';
                    narrative = `
                        You won by the slimmest of margins. Several districts are demanding recounts.
                        The Quantum Voters are claiming they both did and didn't vote for you.
                        The Contrarians voted for you, then against themselves for doing so.
                        <br><br>
                        But a win is a win! You're now President of Absurdistan, though nobody's quite sure how or why.
                        <br><br>
                        Final approval: ${nationalApproval}%<br>
                        Districts won: ${districtsWon}/12<br>
                        <br>
                        The Chaos Party wants to flip a coin to determine if you actually won.
                    `;
                } else {
                    outcome = 'DEFEAT';
                    subtitle = 'The Populist won by promising everything to everyone';
                    narrative = `
                        You lost. The Populist somehow promised even more contradictory things than you did
                        and the people loved it. They don't care about consistency — they care about being told
                        exactly what they want to hear.
                        <br><br>
                        The Robot came in third place with a perfectly logical platform that nobody understood.
                        <br><br>
                        Final approval: ${nationalApproval}%<br>
                        Districts won: ${districtsWon}/12<br>
                        <br>
                        Better luck next cycle! Maybe try MORE doublespeak next time?
                    `;
                }

                document.getElementById('results-title').textContent = outcome;
                document.getElementById('results-subtitle').textContent = subtitle;
                document.getElementById('results-narrative').innerHTML = narrative;

                const stats = document.getElementById('results-stats');
                let statsHtml = '';

                Object.keys(FACTIONS).forEach(key => {
                    const faction = FACTIONS[key];
                    const approval = this.factionApprovals[key];

                    statsHtml += `
                        <div class="result-card">
                            <div class="result-label" style="color: ${faction.color}">${faction.name}</div>
                            <div class="result-value">${approval}%</div>
                        </div>
                    `;
                });

                stats.innerHTML = statsHtml;
            }

            newCampaign() {
                localStorage.removeItem('theVoteSave');
                location.reload();
            }

            saveGame() {
                const save = {
                    day: this.day,
                    funds: this.funds,
                    currentDistrict: this.currentDistrict,
                    factionApprovals: this.factionApprovals,
                    districtApprovals: this.districtApprovals,
                    selectedPolicies: this.selectedPolicies,
                    contradictionLevel: this.contradictionLevel,
                    events: this.events,
                    opponents: this.opponents
                };

                localStorage.setItem('theVoteSave', JSON.stringify(save));
                this.addEvent('Campaign progress saved');
            }

            loadGame() {
                const saved = localStorage.getItem('theVoteSave');
                if (saved) {
                    const save = JSON.parse(saved);
                    this.day = save.day;
                    this.funds = save.funds;
                    this.currentDistrict = save.currentDistrict;
                    this.factionApprovals = save.factionApprovals;
                    this.districtApprovals = save.districtApprovals;
                    this.selectedPolicies = save.selectedPolicies || [];
                    this.contradictionLevel = save.contradictionLevel || 0;
                    this.events = save.events || [];
                    this.opponents = save.opponents || this.opponents;
                }
            }
        }

        // Initialize game
        let game;
        window.addEventListener('DOMContentLoaded', () => {
            game = new Game();
        });
    </script>
</body>
</html>