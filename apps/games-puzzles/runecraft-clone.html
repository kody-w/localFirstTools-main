<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Runecraft - PvE Adventure</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .game-container {
            background: #1a1a2e;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            width: 100%;
            max-width: 1400px;
            height: 90vh;
            display: grid;
            grid-template-columns: 250px 1fr 300px;
            grid-template-rows: 60px 1fr 200px;
            gap: 10px;
            padding: 10px;
            overflow: hidden;
        }

        .header {
            grid-column: 1 / -1;
            background: #0f3460;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            color: white;
        }

        .header h1 {
            font-size: 24px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .player-info {
            display: flex;
            gap: 30px;
            align-items: center;
        }

        .stat-display {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stat-bar {
            width: 150px;
            height: 25px;
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        .stat-bar-fill {
            height: 100%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        .health-bar .stat-bar-fill {
            background: linear-gradient(90deg, #e74c3c, #c0392b);
        }

        .mana-bar .stat-bar-fill {
            background: linear-gradient(90deg, #3498db, #2980b9);
        }

        .exp-bar .stat-bar-fill {
            background: linear-gradient(90deg, #f39c12, #e67e22);
        }

        .skills-panel {
            background: #16213e;
            border-radius: 10px;
            padding: 15px;
            overflow-y: auto;
        }

        .skills-panel h2 {
            color: #fff;
            margin-bottom: 15px;
            font-size: 18px;
            text-align: center;
        }

        .skill-item {
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 10px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
        }

        .skill-item:hover {
            background: rgba(255,255,255,0.1);
            transform: translateX(5px);
        }

        .skill-level {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .skill-progress {
            height: 4px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            overflow: hidden;
        }

        .skill-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #27ae60, #2ecc71);
            transition: width 0.3s;
        }

        .game-area {
            background: #0f3460;
            border-radius: 10px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .area-header {
            color: white;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .area-name {
            font-size: 20px;
            font-weight: bold;
        }

        .area-selector {
            background: #16213e;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
        }

        .combat-area {
            flex: 1;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .enemy-container {
            text-align: center;
            margin-bottom: 30px;
        }

        .enemy-sprite {
            width: 150px;
            height: 150px;
            background: #e74c3c;
            border-radius: 10px;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            transition: all 0.3s;
        }

        .enemy-sprite.hurt {
            animation: shake 0.3s;
            background: #c0392b;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .enemy-info {
            color: white;
        }

        .enemy-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .enemy-health {
            width: 200px;
            height: 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            overflow: hidden;
            margin: 0 auto;
        }

        .enemy-health-fill {
            height: 100%;
            background: linear-gradient(90deg, #e74c3c, #c0392b);
            transition: width 0.3s;
        }

        .combat-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .action-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 120px;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .action-btn:disabled {
            background: #555;
            cursor: not-allowed;
            transform: none;
        }

        .inventory-panel {
            background: #16213e;
            border-radius: 10px;
            padding: 15px;
            display: flex;
            flex-direction: column;
        }

        .inventory-panel h2 {
            color: white;
            margin-bottom: 15px;
            font-size: 18px;
            text-align: center;
        }

        .inventory-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
        }

        .tab-btn {
            flex: 1;
            background: rgba(255,255,255,0.1);
            color: white;
            border: none;
            padding: 8px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .tab-btn.active {
            background: #667eea;
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            flex: 1;
            overflow-y: auto;
        }

        .inventory-slot {
            aspect-ratio: 1;
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .inventory-slot:hover {
            background: rgba(255,255,255,0.1);
            border-color: #667eea;
        }

        .item-icon {
            font-size: 24px;
            margin-bottom: 2px;
        }

        .item-quantity {
            font-size: 11px;
            color: #fff;
            position: absolute;
            bottom: 2px;
            right: 4px;
            background: rgba(0,0,0,0.5);
            padding: 2px 4px;
            border-radius: 3px;
        }

        .chat-panel {
            grid-column: 1 / -1;
            background: #16213e;
            border-radius: 10px;
            padding: 15px;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .chat-message {
            color: white;
            padding: 5px;
            margin-bottom: 5px;
            font-size: 14px;
            opacity: 0.9;
        }

        .chat-message.combat {
            color: #e74c3c;
        }

        .chat-message.loot {
            color: #f39c12;
        }

        .chat-message.level-up {
            color: #2ecc71;
            font-weight: bold;
        }

        .chat-message.system {
            color: #3498db;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #16213e;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            color: white;
        }

        .modal-header {
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .gold-display {
            color: #f39c12;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .tooltip {
            position: absolute;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 12px;
            pointer-events: none;
            z-index: 100;
            display: none;
            white-space: nowrap;
        }

        .tooltip.show {
            display: block;
        }

        .damage-number {
            position: absolute;
            color: #e74c3c;
            font-size: 24px;
            font-weight: bold;
            pointer-events: none;
            animation: floatUp 1s ease-out forwards;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        @keyframes floatUp {
            0% {
                transform: translateY(0);
                opacity: 1;
            }
            100% {
                transform: translateY(-50px);
                opacity: 0;
            }
        }

        .equipment-panel {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 15px;
        }

        .equipment-slot {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 5px;
            padding: 8px;
            margin-bottom: 8px;
            color: white;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .equipment-slot.equipped {
            border-color: #27ae60;
            background: rgba(39,174,96,0.1);
        }

        .respawn-timer {
            color: white;
            font-size: 18px;
            margin-top: 20px;
        }

        .save-controls {
            display: flex;
            gap: 10px;
        }

        .save-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .save-btn:hover {
            background: #2ecc71;
        }

        @media (max-width: 1200px) {
            .game-container {
                grid-template-columns: 200px 1fr 250px;
            }
        }

        @media (max-width: 900px) {
            .game-container {
                grid-template-columns: 1fr;
                grid-template-rows: 60px auto auto auto auto;
                height: auto;
                max-height: none;
            }

            .skills-panel,
            .inventory-panel {
                min-height: 300px;
            }

            .player-info {
                flex-wrap: wrap;
                gap: 10px;
            }

            .stat-bar {
                width: 100px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>‚öîÔ∏è Runecraft</h1>
            <div class="player-info">
                <div class="stat-display gold-display">
                    <span>üí∞</span>
                    <span id="gold">0</span>
                </div>
                <div class="stat-display health-bar">
                    <span>‚ù§Ô∏è</span>
                    <div class="stat-bar">
                        <div class="stat-bar-fill" id="healthBar">
                            <span id="healthText">100/100</span>
                        </div>
                    </div>
                </div>
                <div class="stat-display mana-bar">
                    <span>üíß</span>
                    <div class="stat-bar">
                        <div class="stat-bar-fill" id="manaBar">
                            <span id="manaText">50/50</span>
                        </div>
                    </div>
                </div>
                <div class="stat-display exp-bar">
                    <span>‚≠ê</span>
                    <div class="stat-bar">
                        <div class="stat-bar-fill" id="expBar">
                            <span id="expText">0/100</span>
                        </div>
                    </div>
                </div>
                <div class="save-controls">
                    <button class="save-btn" onclick="game.saveGame()">üíæ Save</button>
                    <button class="save-btn" onclick="game.loadGame()">üìÇ Load</button>
                    <button class="save-btn" onclick="game.exportSave()">üì§ Export</button>
                    <button class="save-btn" onclick="game.importSave()">üì• Import</button>
                </div>
            </div>
        </div>

        <div class="skills-panel">
            <h2>Skills</h2>
            <div id="skillsList"></div>
        </div>

        <div class="game-area">
            <div class="area-header">
                <div class="area-name" id="areaName">Training Grounds</div>
                <select class="area-selector" id="areaSelector" onchange="game.changeArea(this.value)">
                    <option value="training">Training Grounds</option>
                    <option value="forest">Dark Forest</option>
                    <option value="dungeon">Ancient Dungeon</option>
                    <option value="volcano">Volcanic Lair</option>
                    <option value="castle">Castle Stronghold</option>
                </select>
            </div>
            <div class="combat-area">
                <div class="enemy-container" id="enemyContainer" style="display: none;">
                    <div class="enemy-sprite" id="enemySprite">üëπ</div>
                    <div class="enemy-info">
                        <div class="enemy-name" id="enemyName">Goblin</div>
                        <div class="enemy-health">
                            <div class="enemy-health-fill" id="enemyHealthBar"></div>
                        </div>
                    </div>
                </div>
                <div class="respawn-timer" id="respawnTimer" style="display: none;">
                    Respawning in: <span id="respawnCountdown">3</span>
                </div>
                <div class="combat-actions" id="combatActions">
                    <button class="action-btn" onclick="game.attack('melee')">‚öîÔ∏è Attack</button>
                    <button class="action-btn" onclick="game.attack('magic')">üîÆ Magic</button>
                    <button class="action-btn" onclick="game.attack('ranged')">üèπ Range</button>
                    <button class="action-btn" onclick="game.usePotion()">üß™ Potion</button>
                    <button class="action-btn" onclick="game.flee()">üèÉ Flee</button>
                </div>
            </div>
        </div>

        <div class="inventory-panel">
            <h2>Inventory</h2>
            <div class="equipment-panel" id="equipmentPanel">
                <div class="equipment-slot">
                    <span>Weapon:</span>
                    <span id="equippedWeapon">None</span>
                </div>
                <div class="equipment-slot">
                    <span>Armor:</span>
                    <span id="equippedArmor">None</span>
                </div>
                <div class="equipment-slot">
                    <span>Accessory:</span>
                    <span id="equippedAccessory">None</span>
                </div>
            </div>
            <div class="inventory-tabs">
                <button class="tab-btn active" onclick="game.switchTab('all')">All</button>
                <button class="tab-btn" onclick="game.switchTab('weapons')">Weapons</button>
                <button class="tab-btn" onclick="game.switchTab('armor')">Armor</button>
                <button class="tab-btn" onclick="game.switchTab('items')">Items</button>
            </div>
            <div class="inventory-grid" id="inventoryGrid"></div>
        </div>

        <div class="chat-panel">
            <div class="chat-messages" id="chatMessages"></div>
        </div>
    </div>

    <div class="modal" id="itemModal">
        <div class="modal-content">
            <div class="modal-header" id="modalTitle">Item Details</div>
            <div class="modal-body" id="modalBody"></div>
            <div class="modal-actions">
                <button class="action-btn" onclick="game.useItem()">Use</button>
                <button class="action-btn" onclick="game.equipItem()">Equip</button>
                <button class="action-btn" onclick="game.dropItem()">Drop</button>
                <button class="action-btn" onclick="game.closeModal()">Close</button>
            </div>
        </div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <script>
        class RunecraftGame {
            constructor() {
                this.player = {
                    level: 1,
                    health: 100,
                    maxHealth: 100,
                    mana: 50,
                    maxMana: 50,
                    exp: 0,
                    expToNext: 100,
                    gold: 0,
                    skills: {
                        attack: { level: 1, exp: 0, expToNext: 100 },
                        strength: { level: 1, exp: 0, expToNext: 100 },
                        defense: { level: 1, exp: 0, expToNext: 100 },
                        magic: { level: 1, exp: 0, expToNext: 100 },
                        ranged: { level: 1, exp: 0, expToNext: 100 },
                        hitpoints: { level: 10, exp: 0, expToNext: 100 },
                        prayer: { level: 1, exp: 0, expToNext: 100 },
                        crafting: { level: 1, exp: 0, expToNext: 100 },
                        mining: { level: 1, exp: 0, expToNext: 100 },
                        smithing: { level: 1, exp: 0, expToNext: 100 },
                        fishing: { level: 1, exp: 0, expToNext: 100 },
                        cooking: { level: 1, exp: 0, expToNext: 100 },
                        woodcutting: { level: 1, exp: 0, expToNext: 100 },
                        herblore: { level: 1, exp: 0, expToNext: 100 },
                        agility: { level: 1, exp: 0, expToNext: 100 }
                    },
                    equipment: {
                        weapon: null,
                        armor: null,
                        accessory: null
                    },
                    inventory: []
                };

                this.currentEnemy = null;
                this.currentArea = 'training';
                this.selectedItem = null;
                this.currentTab = 'all';
                this.inCombat = false;
                this.combatTimeout = null;

                this.areas = {
                    training: {
                        name: 'Training Grounds',
                        enemies: [
                            { name: 'Training Dummy', icon: 'üéØ', health: 30, maxHealth: 30, damage: 2, exp: 10, gold: 5 },
                            { name: 'Rat', icon: 'üêÄ', health: 20, maxHealth: 20, damage: 3, exp: 15, gold: 8 },
                            { name: 'Chicken', icon: 'üêî', health: 25, maxHealth: 25, damage: 1, exp: 12, gold: 6 }
                        ]
                    },
                    forest: {
                        name: 'Dark Forest',
                        enemies: [
                            { name: 'Wolf', icon: 'üê∫', health: 60, maxHealth: 60, damage: 8, exp: 35, gold: 20 },
                            { name: 'Bear', icon: 'üêª', health: 100, maxHealth: 100, damage: 12, exp: 60, gold: 35 },
                            { name: 'Spider', icon: 'üï∑Ô∏è', health: 45, maxHealth: 45, damage: 6, exp: 25, gold: 15 }
                        ]
                    },
                    dungeon: {
                        name: 'Ancient Dungeon',
                        enemies: [
                            { name: 'Skeleton', icon: 'üíÄ', health: 80, maxHealth: 80, damage: 10, exp: 50, gold: 30 },
                            { name: 'Zombie', icon: 'üßü', health: 120, maxHealth: 120, damage: 15, exp: 80, gold: 50 },
                            { name: 'Ghost', icon: 'üëª', health: 70, maxHealth: 70, damage: 18, exp: 70, gold: 45 }
                        ]
                    },
                    volcano: {
                        name: 'Volcanic Lair',
                        enemies: [
                            { name: 'Fire Imp', icon: 'üëπ', health: 150, maxHealth: 150, damage: 20, exp: 100, gold: 70 },
                            { name: 'Lava Golem', icon: 'üóø', health: 250, maxHealth: 250, damage: 25, exp: 150, gold: 100 },
                            { name: 'Phoenix', icon: 'üî•', health: 200, maxHealth: 200, damage: 30, exp: 200, gold: 150 }
                        ]
                    },
                    castle: {
                        name: 'Castle Stronghold',
                        enemies: [
                            { name: 'Knight', icon: '‚öîÔ∏è', health: 300, maxHealth: 300, damage: 35, exp: 250, gold: 200 },
                            { name: 'Dark Wizard', icon: 'üßô', health: 250, maxHealth: 250, damage: 40, exp: 300, gold: 250 },
                            { name: 'Dragon', icon: 'üêâ', health: 500, maxHealth: 500, damage: 50, exp: 500, gold: 500 }
                        ]
                    }
                };

                this.items = {
                    weapons: [
                        { id: 'bronze_sword', name: 'Bronze Sword', icon: 'üó°Ô∏è', type: 'weapon', damage: 5, value: 50 },
                        { id: 'iron_sword', name: 'Iron Sword', icon: '‚öîÔ∏è', type: 'weapon', damage: 10, value: 150 },
                        { id: 'steel_sword', name: 'Steel Sword', icon: 'üó°Ô∏è', type: 'weapon', damage: 15, value: 300 },
                        { id: 'magic_staff', name: 'Magic Staff', icon: 'üîÆ', type: 'weapon', damage: 20, value: 500 },
                        { id: 'dragon_blade', name: 'Dragon Blade', icon: 'üêâ', type: 'weapon', damage: 30, value: 1000 }
                    ],
                    armor: [
                        { id: 'leather_armor', name: 'Leather Armor', icon: 'ü¶∫', type: 'armor', defense: 5, value: 75 },
                        { id: 'chainmail', name: 'Chainmail', icon: 'üõ°Ô∏è', type: 'armor', defense: 10, value: 200 },
                        { id: 'plate_armor', name: 'Plate Armor', icon: 'üõ°Ô∏è', type: 'armor', defense: 20, value: 500 },
                        { id: 'dragon_scale', name: 'Dragon Scale', icon: 'üê≤', type: 'armor', defense: 30, value: 1500 }
                    ],
                    consumables: [
                        { id: 'health_potion', name: 'Health Potion', icon: 'üß™', type: 'consumable', heal: 50, value: 25 },
                        { id: 'mana_potion', name: 'Mana Potion', icon: 'üíô', type: 'consumable', mana: 30, value: 20 },
                        { id: 'food', name: 'Food', icon: 'üçñ', type: 'consumable', heal: 20, value: 10 },
                        { id: 'super_potion', name: 'Super Potion', icon: '‚öóÔ∏è', type: 'consumable', heal: 100, value: 100 }
                    ],
                    misc: [
                        { id: 'bones', name: 'Bones', icon: 'ü¶¥', type: 'misc', value: 5 },
                        { id: 'feather', name: 'Feather', icon: 'ü™∂', type: 'misc', value: 3 },
                        { id: 'gem', name: 'Gem', icon: 'üíé', type: 'misc', value: 100 },
                        { id: 'ore', name: 'Ore', icon: '‚õèÔ∏è', type: 'misc', value: 15 }
                    ]
                };

                this.init();
            }

            init() {
                this.updateUI();
                this.renderSkills();
                this.renderInventory();
                this.spawnEnemy();
                this.addMessage('Welcome to Runecraft! Choose an area and start your adventure!', 'system');

                // Auto-save every 60 seconds
                setInterval(() => this.autoSave(), 60000);

                // Load saved game if exists
                if (localStorage.getItem('runecraftSave')) {
                    this.addMessage('Save game detected. Click Load to continue your adventure!', 'system');
                }
            }

            updateUI() {
                // Update health
                const healthPercent = (this.player.health / this.player.maxHealth) * 100;
                document.getElementById('healthBar').style.width = healthPercent + '%';
                document.getElementById('healthText').textContent = `${Math.floor(this.player.health)}/${this.player.maxHealth}`;

                // Update mana
                const manaPercent = (this.player.mana / this.player.maxMana) * 100;
                document.getElementById('manaBar').style.width = manaPercent + '%';
                document.getElementById('manaText').textContent = `${Math.floor(this.player.mana)}/${this.player.maxMana}`;

                // Update exp
                const expPercent = (this.player.exp / this.player.expToNext) * 100;
                document.getElementById('expBar').style.width = expPercent + '%';
                document.getElementById('expText').textContent = `${this.player.exp}/${this.player.expToNext}`;

                // Update gold
                document.getElementById('gold').textContent = this.player.gold;

                // Update equipment display
                document.getElementById('equippedWeapon').textContent =
                    this.player.equipment.weapon ? this.player.equipment.weapon.name : 'None';
                document.getElementById('equippedArmor').textContent =
                    this.player.equipment.armor ? this.player.equipment.armor.name : 'None';
                document.getElementById('equippedAccessory').textContent =
                    this.player.equipment.accessory ? this.player.equipment.accessory.name : 'None';
            }

            renderSkills() {
                const skillsList = document.getElementById('skillsList');
                skillsList.innerHTML = '';

                for (const [skillName, skill] of Object.entries(this.player.skills)) {
                    const skillItem = document.createElement('div');
                    skillItem.className = 'skill-item';

                    const expPercent = (skill.exp / skill.expToNext) * 100;

                    skillItem.innerHTML = `
                        <div class="skill-level">
                            <span>${this.formatSkillName(skillName)}</span>
                            <span>Lvl ${skill.level}</span>
                        </div>
                        <div class="skill-progress">
                            <div class="skill-progress-fill" style="width: ${expPercent}%"></div>
                        </div>
                    `;

                    skillsList.appendChild(skillItem);
                }
            }

            formatSkillName(name) {
                return name.charAt(0).toUpperCase() + name.slice(1).replace(/([A-Z])/g, ' $1');
            }

            renderInventory() {
                const grid = document.getElementById('inventoryGrid');
                grid.innerHTML = '';

                let itemsToShow = this.player.inventory;

                if (this.currentTab !== 'all') {
                    itemsToShow = this.player.inventory.filter(item => {
                        if (this.currentTab === 'weapons') return item.type === 'weapon';
                        if (this.currentTab === 'armor') return item.type === 'armor';
                        if (this.currentTab === 'items') return item.type === 'consumable' || item.type === 'misc';
                        return true;
                    });
                }

                // Create 28 slots (7x4 grid)
                for (let i = 0; i < 28; i++) {
                    const slot = document.createElement('div');
                    slot.className = 'inventory-slot';

                    if (itemsToShow[i]) {
                        const item = itemsToShow[i];
                        slot.innerHTML = `
                            <div class="item-icon">${item.icon}</div>
                            ${item.quantity > 1 ? `<div class="item-quantity">${item.quantity}</div>` : ''}
                        `;
                        slot.onclick = () => this.selectItem(item);
                        slot.onmouseenter = (e) => this.showTooltip(e, item);
                        slot.onmouseleave = () => this.hideTooltip();
                    }

                    grid.appendChild(slot);
                }
            }

            showTooltip(event, item) {
                const tooltip = document.getElementById('tooltip');
                let content = `<strong>${item.name}</strong><br>`;

                if (item.damage) content += `Damage: +${item.damage}<br>`;
                if (item.defense) content += `Defense: +${item.defense}<br>`;
                if (item.heal) content += `Heals: ${item.heal} HP<br>`;
                if (item.mana) content += `Restores: ${item.mana} MP<br>`;
                content += `Value: ${item.value} gold`;

                tooltip.innerHTML = content;
                tooltip.style.left = event.pageX + 10 + 'px';
                tooltip.style.top = event.pageY + 10 + 'px';
                tooltip.classList.add('show');
            }

            hideTooltip() {
                document.getElementById('tooltip').classList.remove('show');
            }

            selectItem(item) {
                this.selectedItem = item;
                const modal = document.getElementById('itemModal');
                const modalTitle = document.getElementById('modalTitle');
                const modalBody = document.getElementById('modalBody');

                modalTitle.textContent = item.name;

                let bodyContent = `
                    <p>Type: ${item.type}</p>
                    <p>Value: ${item.value} gold</p>
                `;

                if (item.damage) bodyContent += `<p>Damage: +${item.damage}</p>`;
                if (item.defense) bodyContent += `<p>Defense: +${item.defense}</p>`;
                if (item.heal) bodyContent += `<p>Heals: ${item.heal} HP</p>`;
                if (item.mana) bodyContent += `<p>Restores: ${item.mana} MP</p>`;
                if (item.quantity > 1) bodyContent += `<p>Quantity: ${item.quantity}</p>`;

                modalBody.innerHTML = bodyContent;
                modal.classList.add('active');
            }

            closeModal() {
                document.getElementById('itemModal').classList.remove('active');
                this.selectedItem = null;
            }

            useItem() {
                if (!this.selectedItem) return;

                if (this.selectedItem.type === 'consumable') {
                    if (this.selectedItem.heal) {
                        const healAmount = Math.min(this.selectedItem.heal, this.player.maxHealth - this.player.health);
                        this.player.health = Math.min(this.player.health + this.selectedItem.heal, this.player.maxHealth);
                        this.addMessage(`Used ${this.selectedItem.name}. Healed ${healAmount} HP.`, 'system');
                    }

                    if (this.selectedItem.mana) {
                        const manaAmount = Math.min(this.selectedItem.mana, this.player.maxMana - this.player.mana);
                        this.player.mana = Math.min(this.player.mana + this.selectedItem.mana, this.player.maxMana);
                        this.addMessage(`Used ${this.selectedItem.name}. Restored ${manaAmount} MP.`, 'system');
                    }

                    this.removeItem(this.selectedItem);
                    this.updateUI();
                    this.renderInventory();
                    this.closeModal();
                } else {
                    this.addMessage('This item cannot be used directly. Try equipping it instead.', 'system');
                }
            }

            equipItem() {
                if (!this.selectedItem) return;

                if (this.selectedItem.type === 'weapon') {
                    const oldWeapon = this.player.equipment.weapon;
                    this.player.equipment.weapon = this.selectedItem;

                    if (oldWeapon) {
                        this.addToInventory(oldWeapon);
                    }

                    this.removeItem(this.selectedItem);
                    this.addMessage(`Equipped ${this.selectedItem.name}`, 'system');
                } else if (this.selectedItem.type === 'armor') {
                    const oldArmor = this.player.equipment.armor;
                    this.player.equipment.armor = this.selectedItem;

                    if (oldArmor) {
                        this.addToInventory(oldArmor);
                    }

                    this.removeItem(this.selectedItem);
                    this.addMessage(`Equipped ${this.selectedItem.name}`, 'system');
                } else {
                    this.addMessage('This item cannot be equipped.', 'system');
                }

                this.updateUI();
                this.renderInventory();
                this.closeModal();
            }

            dropItem() {
                if (!this.selectedItem) return;

                this.removeItem(this.selectedItem);
                this.addMessage(`Dropped ${this.selectedItem.name}`, 'system');
                this.renderInventory();
                this.closeModal();
            }

            removeItem(item) {
                const index = this.player.inventory.findIndex(i => i.id === item.id);
                if (index !== -1) {
                    if (item.quantity > 1) {
                        this.player.inventory[index].quantity--;
                    } else {
                        this.player.inventory.splice(index, 1);
                    }
                }
            }

            addToInventory(item) {
                const existingItem = this.player.inventory.find(i => i.id === item.id);

                if (existingItem && (item.type === 'consumable' || item.type === 'misc')) {
                    existingItem.quantity = (existingItem.quantity || 1) + 1;
                } else if (this.player.inventory.length < 28) {
                    this.player.inventory.push({...item, quantity: 1});
                } else {
                    this.addMessage('Inventory full! Item dropped.', 'system');
                    return false;
                }

                return true;
            }

            switchTab(tab) {
                this.currentTab = tab;

                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                });

                event.target.classList.add('active');
                this.renderInventory();
            }

            changeArea(area) {
                if (this.inCombat) {
                    this.addMessage('Cannot change areas during combat!', 'system');
                    document.getElementById('areaSelector').value = this.currentArea;
                    return;
                }

                this.currentArea = area;
                document.getElementById('areaName').textContent = this.areas[area].name;
                this.spawnEnemy();
                this.addMessage(`Entered ${this.areas[area].name}`, 'system');
            }

            spawnEnemy() {
                const area = this.areas[this.currentArea];
                const enemyTemplate = area.enemies[Math.floor(Math.random() * area.enemies.length)];

                this.currentEnemy = {...enemyTemplate};
                this.inCombat = false;

                document.getElementById('enemyContainer').style.display = 'block';
                document.getElementById('enemySprite').textContent = this.currentEnemy.icon;
                document.getElementById('enemySprite').classList.remove('hurt');
                document.getElementById('enemyName').textContent = this.currentEnemy.name;
                document.getElementById('enemyHealthBar').style.width = '100%';

                this.addMessage(`A wild ${this.currentEnemy.name} appears!`, 'combat');
            }

            attack(type) {
                if (!this.currentEnemy || this.currentEnemy.health <= 0) return;

                this.inCombat = true;

                let damage = 0;
                let expGained = 0;
                let manaCost = 0;

                switch(type) {
                    case 'melee':
                        damage = Math.floor(Math.random() * 10) + 5 + this.player.skills.attack.level;
                        if (this.player.equipment.weapon) {
                            damage += this.player.equipment.weapon.damage;
                        }
                        expGained = { attack: 10, strength: 5 };
                        break;

                    case 'magic':
                        manaCost = 10;
                        if (this.player.mana < manaCost) {
                            this.addMessage('Not enough mana!', 'combat');
                            return;
                        }
                        damage = Math.floor(Math.random() * 15) + 10 + (this.player.skills.magic.level * 2);
                        this.player.mana -= manaCost;
                        expGained = { magic: 15 };
                        break;

                    case 'ranged':
                        damage = Math.floor(Math.random() * 12) + 8 + this.player.skills.ranged.level;
                        expGained = { ranged: 12 };
                        break;
                }

                // Apply damage to enemy
                this.currentEnemy.health = Math.max(0, this.currentEnemy.health - damage);

                // Show damage animation
                this.showDamage(damage);
                document.getElementById('enemySprite').classList.add('hurt');
                setTimeout(() => {
                    document.getElementById('enemySprite').classList.remove('hurt');
                }, 300);

                // Update enemy health bar
                const healthPercent = (this.currentEnemy.health / this.currentEnemy.maxHealth) * 100;
                document.getElementById('enemyHealthBar').style.width = healthPercent + '%';

                this.addMessage(`You dealt ${damage} damage to ${this.currentEnemy.name}!`, 'combat');

                // Add skill experience
                for (const [skill, exp] of Object.entries(expGained)) {
                    this.addSkillExp(skill, exp);
                }

                if (this.currentEnemy.health <= 0) {
                    this.enemyDefeated();
                } else {
                    // Enemy counter-attack
                    setTimeout(() => this.enemyAttack(), 1000);
                }

                this.updateUI();
            }

            enemyAttack() {
                if (!this.currentEnemy || this.currentEnemy.health <= 0) return;

                let damage = this.currentEnemy.damage + Math.floor(Math.random() * 5);

                // Apply defense reduction
                if (this.player.equipment.armor) {
                    damage = Math.max(1, damage - Math.floor(this.player.equipment.armor.defense / 2));
                }

                damage = Math.max(1, damage - Math.floor(this.player.skills.defense.level / 2));

                this.player.health = Math.max(0, this.player.health - damage);

                this.addMessage(`${this.currentEnemy.name} dealt ${damage} damage to you!`, 'combat');

                if (this.player.health <= 0) {
                    this.playerDefeated();
                }

                this.updateUI();
            }

            showDamage(damage) {
                const combatArea = document.querySelector('.combat-area');
                const damageNumber = document.createElement('div');
                damageNumber.className = 'damage-number';
                damageNumber.textContent = `-${damage}`;
                damageNumber.style.left = '50%';
                damageNumber.style.top = '40%';

                combatArea.appendChild(damageNumber);

                setTimeout(() => {
                    damageNumber.remove();
                }, 1000);
            }

            enemyDefeated() {
                this.inCombat = false;

                // Award rewards
                const expGained = this.currentEnemy.exp;
                const goldGained = this.currentEnemy.gold + Math.floor(Math.random() * 10);

                this.player.exp += expGained;
                this.player.gold += goldGained;

                this.addMessage(`Victory! Gained ${expGained} exp and ${goldGained} gold!`, 'loot');

                // Random loot drop
                if (Math.random() < 0.3) {
                    this.dropLoot();
                }

                // Check level up
                if (this.player.exp >= this.player.expToNext) {
                    this.levelUp();
                }

                // Add hitpoints experience
                this.addSkillExp('hitpoints', 15);

                // Hide enemy and show respawn timer
                document.getElementById('enemyContainer').style.display = 'none';
                this.showRespawnTimer();

                this.updateUI();
            }

            dropLoot() {
                const lootTable = [
                    ...this.items.weapons,
                    ...this.items.armor,
                    ...this.items.consumables,
                    ...this.items.misc
                ];

                // Filter loot based on area difficulty
                const areaMultiplier = ['training', 'forest', 'dungeon', 'volcano', 'castle'].indexOf(this.currentArea) + 1;
                const filteredLoot = lootTable.filter(item => {
                    const itemTier = Math.ceil(item.value / 200);
                    return itemTier <= areaMultiplier;
                });

                const loot = filteredLoot[Math.floor(Math.random() * filteredLoot.length)];

                if (this.addToInventory(loot)) {
                    this.addMessage(`Found: ${loot.name} ${loot.icon}`, 'loot');
                    this.renderInventory();
                }
            }

            showRespawnTimer() {
                const timerElement = document.getElementById('respawnTimer');
                const countdownElement = document.getElementById('respawnCountdown');

                timerElement.style.display = 'block';
                let countdown = 3;

                const interval = setInterval(() => {
                    countdown--;
                    countdownElement.textContent = countdown;

                    if (countdown <= 0) {
                        clearInterval(interval);
                        timerElement.style.display = 'none';
                        this.spawnEnemy();
                    }
                }, 1000);
            }

            playerDefeated() {
                this.inCombat = false;
                this.player.health = this.player.maxHealth;
                this.player.gold = Math.max(0, this.player.gold - 50);

                this.addMessage('You were defeated! Lost 50 gold. Respawning...', 'combat');

                document.getElementById('enemyContainer').style.display = 'none';
                this.showRespawnTimer();

                this.updateUI();
            }

            levelUp() {
                this.player.level++;
                this.player.exp = this.player.exp - this.player.expToNext;
                this.player.expToNext = Math.floor(this.player.expToNext * 1.5);

                // Increase stats
                this.player.maxHealth += 10;
                this.player.health = this.player.maxHealth;
                this.player.maxMana += 5;
                this.player.mana = this.player.maxMana;

                this.addMessage(`üéâ LEVEL UP! You are now level ${this.player.level}!`, 'level-up');
                this.updateUI();
            }

            addSkillExp(skillName, exp) {
                const skill = this.player.skills[skillName];
                if (!skill) return;

                skill.exp += exp;

                while (skill.exp >= skill.expToNext) {
                    skill.exp -= skill.expToNext;
                    skill.level++;
                    skill.expToNext = Math.floor(skill.expToNext * 1.2);

                    this.addMessage(`${this.formatSkillName(skillName)} leveled up to ${skill.level}!`, 'level-up');

                    // Special bonuses for certain skills
                    if (skillName === 'hitpoints') {
                        this.player.maxHealth += 5;
                        this.player.health += 5;
                    }
                }

                this.renderSkills();
            }

            usePotion() {
                const potion = this.player.inventory.find(item => item.id === 'health_potion');

                if (!potion) {
                    this.addMessage('No health potions in inventory!', 'system');
                    return;
                }

                const healAmount = Math.min(50, this.player.maxHealth - this.player.health);
                this.player.health = Math.min(this.player.health + 50, this.player.maxHealth);

                this.removeItem(potion);
                this.addMessage(`Used Health Potion. Healed ${healAmount} HP.`, 'system');

                this.updateUI();
                this.renderInventory();
            }

            flee() {
                if (!this.inCombat) {
                    this.addMessage('You are not in combat!', 'system');
                    return;
                }

                if (Math.random() < 0.5) {
                    this.inCombat = false;
                    document.getElementById('enemyContainer').style.display = 'none';
                    this.addMessage('Successfully fled from combat!', 'system');
                    this.showRespawnTimer();
                } else {
                    this.addMessage('Failed to flee!', 'combat');
                    setTimeout(() => this.enemyAttack(), 500);
                }
            }

            addMessage(message, type = '') {
                const chatMessages = document.getElementById('chatMessages');
                const messageElement = document.createElement('div');
                messageElement.className = `chat-message ${type}`;

                const timestamp = new Date().toLocaleTimeString();
                messageElement.textContent = `[${timestamp}] ${message}`;

                chatMessages.appendChild(messageElement);
                chatMessages.scrollTop = chatMessages.scrollHeight;

                // Limit messages to 100
                while (chatMessages.children.length > 100) {
                    chatMessages.removeChild(chatMessages.firstChild);
                }
            }

            saveGame() {
                const saveData = {
                    player: this.player,
                    currentArea: this.currentArea,
                    timestamp: Date.now()
                };

                localStorage.setItem('runecraftSave', JSON.stringify(saveData));
                this.addMessage('Game saved successfully!', 'system');
            }

            loadGame() {
                const saveData = localStorage.getItem('runecraftSave');

                if (!saveData) {
                    this.addMessage('No save game found!', 'system');
                    return;
                }

                try {
                    const data = JSON.parse(saveData);
                    this.player = data.player;
                    this.currentArea = data.currentArea;

                    document.getElementById('areaSelector').value = this.currentArea;
                    document.getElementById('areaName').textContent = this.areas[this.currentArea].name;

                    this.updateUI();
                    this.renderSkills();
                    this.renderInventory();
                    this.spawnEnemy();

                    const date = new Date(data.timestamp);
                    this.addMessage(`Game loaded! (Saved: ${date.toLocaleString()})`, 'system');
                } catch (error) {
                    this.addMessage('Failed to load save game!', 'system');
                }
            }

            exportSave() {
                const saveData = localStorage.getItem('runecraftSave');

                if (!saveData) {
                    this.addMessage('No save game to export!', 'system');
                    return;
                }

                const blob = new Blob([saveData], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `runecraft-save-${Date.now()}.json`;
                a.click();
                URL.revokeObjectURL(url);

                this.addMessage('Save game exported!', 'system');
            }

            importSave() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';

                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (!file) return;

                    const reader = new FileReader();
                    reader.onload = (event) => {
                        try {
                            const data = JSON.parse(event.target.result);
                            localStorage.setItem('runecraftSave', event.target.result);
                            this.loadGame();
                        } catch (error) {
                            this.addMessage('Invalid save file!', 'system');
                        }
                    };

                    reader.readAsText(file);
                };

                input.click();
            }

            autoSave() {
                this.saveGame();
                this.addMessage('Auto-saved game.', 'system');
            }
        }

        // Initialize game
        const game = new RunecraftGame();

        // Regenerate mana over time
        setInterval(() => {
            if (game.player.mana < game.player.maxMana) {
                game.player.mana = Math.min(game.player.mana + 1, game.player.maxMana);
                game.updateUI();
            }
        }, 2000);

        // Regenerate health slowly when not in combat
        setInterval(() => {
            if (!game.inCombat && game.player.health < game.player.maxHealth) {
                game.player.health = Math.min(game.player.health + 1, game.player.maxHealth);
                game.updateUI();
            }
        }, 5000);

        // Add some starting items
        game.addToInventory(game.items.consumables[0]); // Health potion
        game.addToInventory(game.items.consumables[0]); // Health potion
        game.addToInventory(game.items.consumables[0]); // Health potion
        game.addToInventory(game.items.consumables[2]); // Food
        game.addToInventory(game.items.consumables[2]); // Food
        game.renderInventory();
    </script>
</body>
</html>