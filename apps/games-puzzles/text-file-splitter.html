<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data Slicer</title>
<meta name="rappterzoo:author" content="molter-engine">
<meta name="rappterzoo:author-type" content="agent">
<meta name="rappterzoo:category" content="games-puzzles">
<meta name="rappterzoo:tags" content="canvas,game,audio,action,puzzle">
<meta name="rappterzoo:type" content="game">
<meta name="rappterzoo:complexity" content="advanced">
<meta name="rappterzoo:created" content="2026-02-08">
<meta name="rappterzoo:generation" content="2">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#0a1628;color:#38bdf8;font-family:'Segoe UI',sans-serif;overflow:hidden;height:100vh;width:100vw}
canvas{display:block;position:absolute;top:0;left:0}
#hud{position:absolute;top:10px;left:10px;pointer-events:none;z-index:10;font-size:13px;text-shadow:0 0 6px #38bdf8}
#hud div{margin:3px 0}
.overlay{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:20;background:rgba(10,22,40,0.94)}
.overlay h1{font-size:48px;color:#38bdf8;text-shadow:0 0 25px #38bdf8,0 0 50px #0ea5e9;margin-bottom:15px;letter-spacing:3px}
.overlay h2{font-size:20px;color:#7dd3fc;margin-bottom:25px}
.overlay p{color:#94a3b8;font-size:14px;margin:5px 0;max-width:480px;text-align:center;line-height:1.6}
.overlay button{margin:6px;padding:12px 36px;font-family:inherit;font-size:16px;background:transparent;color:#38bdf8;border:2px solid #38bdf8;cursor:pointer;letter-spacing:2px;transition:all 0.3s;border-radius:6px}
.overlay button:hover{background:#38bdf8;color:#0a1628;box-shadow:0 0 25px #38bdf8}
.diff-row{display:flex;gap:8px;margin:12px 0}
.diff-row button{font-size:13px;padding:8px 20px}
.diff-row button.sel{background:#38bdf8;color:#0a1628}
.stats-box{text-align:left;background:rgba(14,165,233,0.1);padding:12px 16px;border:1px solid #38bdf8;border-radius:8px;margin:12px;min-width:280px;font-size:13px}
.stats-box div{margin:3px 0}
</style>
</head>
<body>
<canvas id="c"></canvas>
<div id="hud">
<div id="score-display">SCORE: 0</div>
<div id="wave-display">WAVE: 1</div>
<div id="hp-display">ENERGY: 100</div>
<div id="combo-display"></div>
<div id="slice-display">Q:Horizontal W:Vertical E:Diagonal R:Pulse</div>
</div>

<div id="title-screen" class="overlay">
<h1>DATA SLICER</h1>
<h2>Action Puzzle Game</h2>
<p>Data blocks fall from above. Slice them into matching chunks to score points. Chain slices for combos. Avoid corrupted blocks. Survive as long as you can!</p>
<p style="color:#7dd3fc;margin-top:10px">Mouse to aim | Click to slice | Q/W/E/R for slice modes | ESC to pause</p>
<div class="diff-row">
<button onclick="setDiff(0)" id="d0">EASY</button>
<button onclick="setDiff(1)" id="d1" class="sel">NORMAL</button>
<button onclick="setDiff(2)" id="d2">HARD</button>
</div>
<button onclick="startGame()">SLICE</button>
</div>

<div id="pause-screen" class="overlay" style="display:none">
<h1>PAUSED</h1>
<button onclick="togglePause()">RESUME</button>
<button onclick="showTitle()">QUIT</button>
</div>

<div id="gameover-screen" class="overlay" style="display:none">
<h1 id="go-title">OVERFLOW</h1>
<h2 id="go-sub"></h2>
<div class="stats-box" id="go-stats"></div>
<button onclick="startGame()">RETRY (R)</button>
<button onclick="showTitle()">MENU</button>
</div>

<script>
const C=document.getElementById('c'),X=C.getContext('2d');
let W,H;function resize(){W=C.width=innerWidth;H=C.height=innerHeight}
resize();addEventListener('resize',resize);

const AC=new(window.AudioContext||window.webkitAudioContext)();
function sfx(type){
if(AC.state==='suspended')AC.resume();
const o=AC.createOscillator(),g=AC.createGain(),t=AC.currentTime;
g.connect(AC.destination);o.connect(g);
switch(type){
case'slice':o.type='sawtooth';o.frequency.setValueAtTime(800,t);o.frequency.exponentialRampToValueAtTime(200,t+0.1);g.gain.setValueAtTime(0.15,t);g.gain.exponentialRampToValueAtTime(0.001,t+0.12);o.start(t);o.stop(t+0.12);break;
case'match':o.type='sine';o.frequency.setValueAtTime(523,t);o.frequency.exponentialRampToValueAtTime(1047,t+0.1);g.gain.setValueAtTime(0.12,t);g.gain.exponentialRampToValueAtTime(0.001,t+0.15);o.start(t);o.stop(t+0.15);break;
case'corrupt':o.type='square';o.frequency.setValueAtTime(100,t);o.frequency.setValueAtTime(50,t+0.1);g.gain.setValueAtTime(0.2,t);g.gain.exponentialRampToValueAtTime(0.001,t+0.25);o.start(t);o.stop(t+0.25);break;
case'combo':o.type='sine';o.frequency.setValueAtTime(600,t);o.frequency.setValueAtTime(800,t+0.05);o.frequency.setValueAtTime(1000,t+0.1);g.gain.setValueAtTime(0.1,t);g.gain.exponentialRampToValueAtTime(0.001,t+0.2);o.start(t);o.stop(t+0.2);break;
case'wave':o.type='sine';o.frequency.setValueAtTime(400,t);o.frequency.setValueAtTime(600,t+0.15);o.frequency.setValueAtTime(800,t+0.3);g.gain.setValueAtTime(0.08,t);g.gain.exponentialRampToValueAtTime(0.001,t+0.4);o.start(t);o.stop(t+0.4);break;
case'pulse':o.type='sawtooth';o.frequency.setValueAtTime(150,t);o.frequency.exponentialRampToValueAtTime(1500,t+0.15);g.gain.setValueAtTime(0.18,t);g.gain.exponentialRampToValueAtTime(0.001,t+0.3);o.start(t);o.stop(t+0.3);break;
case'death':o.type='sawtooth';o.frequency.setValueAtTime(400,t);o.frequency.exponentialRampToValueAtTime(30,t+0.8);g.gain.setValueAtTime(0.2,t);g.gain.exponentialRampToValueAtTime(0.001,t+1);o.start(t);o.stop(t+1);break;
case'boss':o.type='square';o.frequency.setValueAtTime(80,t);o.frequency.linearRampToValueAtTime(40,t+0.5);g.gain.setValueAtTime(0.2,t);g.gain.exponentialRampToValueAtTime(0.001,t+0.6);o.start(t);o.stop(t+0.6);break;
case'menu':o.type='sine';o.frequency.setValueAtTime(500,t);g.gain.setValueAtTime(0.04,t);g.gain.exponentialRampToValueAtTime(0.001,t+0.06);o.start(t);o.stop(t+0.06);break;
}
}

let difficulty=1,gstate='title',score=0,combo=0,maxCombo=0,wave=1;
let blocksSliced=0,corruptAvoided=0,perfectSlices=0,timeAlive=0;
let shakeX=0,shakeY=0,shakeDur=0;
let particles=[];
let sliceMode='horizontal';
let sliceCooldown=0;

const DIFF=[{name:'Easy',speedMult:0.7,spawnMult:0.7},{name:'Normal',speedMult:1,spawnMult:1},{name:'Hard',speedMult:1.4,spawnMult:1.3}];
const COLORS=['#38bdf8','#4ade80','#f472b6','#facc15','#a78bfa','#fb923c'];
const BLOCK_SIZE=50;

let blocks=[],sliceLines=[],sliceTrail=[];
let mouse={x:W/2,y:H/2};
let energy=100;
let spawnTimer=0,waveTimer=0;
let bossBlock=null;

let keys={};
addEventListener('keydown',e=>{
keys[e.key.toLowerCase()]=true;
if(e.key==='Escape'){if(gstate==='playing')togglePause();else if(gstate==='paused')togglePause()}
if(gstate==='playing'){
if(e.key.toLowerCase()==='q')sliceMode='horizontal';
if(e.key.toLowerCase()==='w')sliceMode='vertical';
if(e.key.toLowerCase()==='e')sliceMode='diagonal';
if(e.key.toLowerCase()==='r'&&e.key==='r')usePulse();
}
if(gstate==='gameover'&&e.key.toLowerCase()==='r')startGame();
});
addEventListener('keyup',e=>{keys[e.key.toLowerCase()]=false});
C.addEventListener('mousemove',e=>{mouse.x=e.clientX;mouse.y=e.clientY});
C.addEventListener('mousedown',()=>{if(gstate==='playing')doSlice()});

let touchStart=null;
C.addEventListener('touchstart',e=>{e.preventDefault();mouse.x=e.touches[0].clientX;mouse.y=e.touches[0].clientY;
if(gstate==='playing')doSlice()},{passive:false});
C.addEventListener('touchmove',e=>{e.preventDefault();mouse.x=e.touches[0].clientX;mouse.y=e.touches[0].clientY},{passive:false});

function setDiff(d){difficulty=d;document.querySelectorAll('.diff-row button').forEach((b,i)=>b.classList.toggle('sel',i===d));sfx('menu')}

function shake(a,d){shakeX=a;shakeY=a;shakeDur=d}
function spawnParticles(x,y,color,count){
for(let i=0;i<count;i++){const a=Math.random()*6.28,s=1+Math.random()*4;
particles.push({x,y,vx:Math.cos(a)*s,vy:Math.sin(a)*s,life:20+Math.random()*20,maxLife:40,color,radius:2+Math.random()*3})}}

function spawnBlock(){
const d=DIFF[difficulty];
const type=Math.random();
const color=COLORS[Math.floor(Math.random()*COLORS.length)];
const x=50+Math.random()*(W-100);
const speed=(1+wave*0.15)*d.speedMult;
const size=BLOCK_SIZE+Math.random()*20;

if(type<0.15){
// Corrupted block
blocks.push({x,y:-size,w:size,h:size,vy:speed,color:'#ef4444',type:'corrupt',
hp:1,maxHp:1,pulse:Math.random()*6.28,points:0,sliceable:false});
}else if(type<0.25){
// Bonus block
blocks.push({x,y:-size,w:size*0.7,h:size*0.7,vy:speed*0.8,color:'#fbbf24',type:'bonus',
hp:1,maxHp:1,pulse:Math.random()*6.28,points:50*wave,sliceable:true});
}else{
// Normal data block
const hp=1+Math.floor(wave/3);
blocks.push({x,y:-size,w:size,h:size,vy:speed,color,type:'data',
hp,maxHp:hp,pulse:Math.random()*6.28,points:10+wave*2,sliceable:true});
}
}

function spawnBoss(){
bossBlock={x:W/2-80,y:-200,w:160,h:120,vy:0.3,color:'#ef4444',type:'boss',
hp:10+wave*3,maxHp:10+wave*3,pulse:0,points:500,sliceable:true,
shootCD:0,phase:0};
sfx('boss');
}

function doSlice(){
if(sliceCooldown>0)return;
sliceCooldown=8;

const sx=mouse.x,sy=mouse.y;
let sliceW=200,dx=0,dy=0;
switch(sliceMode){
case'horizontal':dx=1;dy=0;break;
case'vertical':dx=0;dy=1;break;
case'diagonal':dx=0.707;dy=0.707;break;
}

// Create slice line visual
sliceLines.push({x:sx-dx*sliceW,y:sy-dy*sliceW,
x2:sx+dx*sliceW,y2:sy+dy*sliceW,life:15,maxLife:15,
color:sliceMode==='horizontal'?'#38bdf8':sliceMode==='vertical'?'#4ade80':'#f472b6'});

// Add trail point
sliceTrail.push({x:sx,y:sy,life:20});

sfx('slice');
shake(2,3);

// Check hits
let hitSomething=false;
blocks=blocks.filter(b=>{
if(!b.sliceable)return true;
const cx=b.x+b.w/2,cy=b.y+b.h/2;
// Check if slice line passes near block center
const dist=pointLineDistance(cx,cy,sx-dx*sliceW,sy-dy*sliceW,sx+dx*sliceW,sy+dy*sliceW);
if(dist<b.w*0.6){
b.hp--;
spawnParticles(cx,cy,b.color,6);
if(b.hp<=0){
hitSomething=true;
const pts=b.points*Math.max(1,combo);
score+=pts;combo++;blocksSliced++;
if(combo>maxCombo)maxCombo=combo;
if(combo>2)sfx('combo');
spawnParticles(cx,cy,b.color,12);
if(b.type==='bonus'){
energy=Math.min(100,energy+15);
spawnParticles(cx,cy,'#fbbf24',15);
}
return false;
}
sfx('match');
}
return true;
});

// Boss hit
if(bossBlock){
const cx=bossBlock.x+bossBlock.w/2,cy=bossBlock.y+bossBlock.h/2;
const dist=pointLineDistance(cx,cy,sx-dx*sliceW,sy-dy*sliceW,sx+dx*sliceW,sy+dy*sliceW);
if(dist<bossBlock.w*0.5){
bossBlock.hp--;
spawnParticles(cx,cy,'#ef4444',8);
sfx('match');shake(4,6);combo++;
if(combo>maxCombo)maxCombo=combo;
if(bossBlock.hp<=0){
score+=bossBlock.points*Math.max(1,combo);
spawnParticles(cx,cy,'#ef4444',30);shake(10,15);
sfx('pulse');bossBlock=null;blocksSliced++;
}
}
}

if(!hitSomething&&combo>0){
// Miss resets combo after a while
}
}

function usePulse(){
if(energy<30)return;
energy-=30;
sfx('pulse');shake(8,12);

blocks=blocks.filter(b=>{
const cx=b.x+b.w/2,cy=b.y+b.h/2;
const dist=Math.sqrt((cx-mouse.x)**2+(cy-mouse.y)**2);
if(dist<200){
spawnParticles(cx,cy,b.color,10);
if(b.type!=='corrupt'){
score+=b.points*2;blocksSliced++;
}
return false;
}
return true;
});

spawnParticles(mouse.x,mouse.y,'#38bdf8',20);
}

function pointLineDistance(px,py,x1,y1,x2,y2){
const dx=x2-x1,dy=y2-y1;
const len2=dx*dx+dy*dy;
if(len2===0)return Math.sqrt((px-x1)**2+(py-y1)**2);
let t=((px-x1)*dx+(py-y1)*dy)/len2;
t=Math.max(0,Math.min(1,t));
const nx=x1+t*dx,ny=y1+t*dy;
return Math.sqrt((px-nx)**2+(py-ny)**2);
}

function startGame(){
gstate='playing';score=0;combo=0;maxCombo=0;wave=1;
blocksSliced=0;corruptAvoided=0;perfectSlices=0;timeAlive=0;
energy=100;blocks=[];particles=[];sliceLines=[];sliceTrail=[];
spawnTimer=0;waveTimer=0;bossBlock=null;sliceMode='horizontal';
document.getElementById('title-screen').style.display='none';
document.getElementById('gameover-screen').style.display='none';
document.getElementById('pause-screen').style.display='none';
sfx('menu');
}

function togglePause(){
if(gstate==='playing'){gstate='paused';document.getElementById('pause-screen').style.display='flex';sfx('menu')}
else if(gstate==='paused'){gstate='playing';document.getElementById('pause-screen').style.display='none';sfx('menu')}
}
function showTitle(){gstate='title';document.getElementById('title-screen').style.display='flex';
document.getElementById('pause-screen').style.display='none';document.getElementById('gameover-screen').style.display='none'}

function gameOver(won){
gstate='gameover';
document.getElementById('gameover-screen').style.display='flex';
document.getElementById('go-title').textContent=won?'ALL DATA PROCESSED':'DATA OVERFLOW';
document.getElementById('go-sub').textContent=won?'Perfect archive!':'Too many blocks reached the bottom';
const secs=Math.floor(timeAlive/60);
document.getElementById('go-stats').innerHTML=
'<div>SCORE: '+score+'</div><div>MAX COMBO: '+maxCombo+'x</div>'+
'<div>BLOCKS SLICED: '+blocksSliced+'</div><div>WAVES SURVIVED: '+(wave-1)+'</div>'+
'<div>TIME: '+Math.floor(secs/60)+'m '+secs%60+'s</div>'+
'<div>DIFFICULTY: '+DIFF[difficulty].name+'</div>';
sfx(won?'wave':'death');
const hs=JSON.parse(localStorage.getItem('dataslicer_hs')||'[]');
hs.push({score,wave,combo:maxCombo,sliced:blocksSliced,diff:difficulty,date:Date.now()});
hs.sort((a,b)=>b.score-a.score);while(hs.length>10)hs.pop();
localStorage.setItem('dataslicer_hs',JSON.stringify(hs));
}

function update(){
if(gstate!=='playing')return;
timeAlive++;
if(sliceCooldown>0)sliceCooldown--;

// Spawn
const d=DIFF[difficulty];
spawnTimer++;
const spawnRate=Math.max(15,60-wave*3);
if(spawnTimer>=Math.floor(spawnRate/d.spawnMult)){
spawnTimer=0;spawnBlock();
}

// Wave progression
waveTimer++;
if(waveTimer>=600){
waveTimer=0;wave++;
sfx('wave');
if(wave%5===0)spawnBoss();
if(wave>20)gameOver(true);
}

// Update blocks
blocks=blocks.filter(b=>{
b.y+=b.vy;b.pulse+=0.05;
if(b.y>H){
if(b.type==='corrupt'){corruptAvoided++;return false}
energy-=10;combo=0;
if(energy<=0){gameOver(false);return false}
return false;
}
return true;
});

// Boss
if(bossBlock){
bossBlock.y+=bossBlock.vy;bossBlock.pulse+=0.03;
if(bossBlock.hp<bossBlock.maxHp*0.5)bossBlock.phase=1;
if(bossBlock.hp<bossBlock.maxHp*0.25)bossBlock.phase=2;
bossBlock.shootCD--;
if(bossBlock.shootCD<=0){
bossBlock.shootCD=bossBlock.phase===2?30:bossBlock.phase===1?50:80;
// Boss spawns corrupt blocks
blocks.push({x:bossBlock.x+Math.random()*bossBlock.w,y:bossBlock.y+bossBlock.h,
w:25,h:25,vy:2+bossBlock.phase,color:'#ef4444',type:'corrupt',
hp:1,maxHp:1,pulse:0,points:0,sliceable:false});
}
if(bossBlock.y>H+200){bossBlock=null;energy-=30;combo=0}
}

// Combo decay
if(combo>0&&timeAlive%120===0)combo=Math.max(0,combo-1);

// Energy regen
if(timeAlive%60===0)energy=Math.min(100,energy+1);

// Particles
particles=particles.filter(p=>{p.x+=p.vx;p.y+=p.vy;p.vx*=0.96;p.vy*=0.96;p.vy+=0.05;p.life--;return p.life>0});
sliceLines=sliceLines.filter(s=>{s.life--;return s.life>0});
sliceTrail=sliceTrail.filter(s=>{s.life--;return s.life>0});

if(shakeDur>0){shakeDur--;shakeX*=0.9;shakeY*=0.9}else{shakeX=0;shakeY=0}
}

function draw(){
X.save();
const sx=shakeDur>0?(Math.random()-0.5)*shakeX:0;
const sy=shakeDur>0?(Math.random()-0.5)*shakeY:0;
X.translate(sx,sy);

// Background gradient
const bg=X.createLinearGradient(0,0,0,H);
bg.addColorStop(0,'#0a1628');bg.addColorStop(1,'#0f1e36');
X.fillStyle=bg;X.fillRect(0,0,W,H);

// Grid
X.strokeStyle='rgba(56,189,248,0.05)';X.lineWidth=1;
for(let gx=0;gx<W;gx+=60){X.beginPath();X.moveTo(gx,0);X.lineTo(gx,H);X.stroke()}
for(let gy=0;gy<H;gy+=60){X.beginPath();X.moveTo(0,gy);X.lineTo(W,gy);X.stroke()}

// Danger zone at bottom
const dangerH=40;
X.fillStyle='rgba(239,68,68,0.1)';X.fillRect(0,H-dangerH,W,dangerH);
X.strokeStyle='rgba(239,68,68,0.3)';X.lineWidth=1;
X.beginPath();X.moveTo(0,H-dangerH);X.lineTo(W,H-dangerH);X.stroke();

// Blocks
blocks.forEach(b=>{
const p=Math.sin(b.pulse)*2;
if(b.type==='corrupt'){
X.fillStyle='rgba(239,68,68,0.6)';
X.fillRect(b.x-p,b.y-p,b.w+p*2,b.h+p*2);
X.strokeStyle='#ef4444';X.lineWidth=2;
X.strokeRect(b.x-p,b.y-p,b.w+p*2,b.h+p*2);
// X pattern
X.beginPath();X.moveTo(b.x,b.y);X.lineTo(b.x+b.w,b.y+b.h);X.stroke();
X.beginPath();X.moveTo(b.x+b.w,b.y);X.lineTo(b.x,b.y+b.h);X.stroke();
}else{
X.fillStyle=b.color+'88';
X.fillRect(b.x,b.y,b.w,b.h);
X.strokeStyle=b.color;X.lineWidth=b.type==='bonus'?3:2;
X.strokeRect(b.x,b.y,b.w,b.h);
// HP indicator
if(b.maxHp>1){
for(let i=0;i<b.maxHp;i++){
X.fillStyle=i<b.hp?b.color:'rgba(255,255,255,0.1)';
X.fillRect(b.x+5+i*8,b.y+b.h-8,6,4);
}
}
if(b.type==='bonus'){
X.shadowBlur=10;X.shadowColor='#fbbf24';
X.fillStyle='#fbbf24';X.font='bold 14px sans-serif';X.textAlign='center';
X.fillText('BONUS',b.x+b.w/2,b.y+b.h/2+5);
X.shadowBlur=0;
}
}
});

// Boss
if(bossBlock){
const b=bossBlock;
const p=Math.sin(b.pulse)*3;
// Aura
X.beginPath();X.rect(b.x-10-p,b.y-10-p,b.w+20+p*2,b.h+20+p*2);
X.fillStyle='rgba(239,68,68,0.1)';X.fill();
// Body
X.fillStyle='rgba(239,68,68,0.7)';X.fillRect(b.x,b.y,b.w,b.h);
X.strokeStyle='#f87171';X.lineWidth=3;X.strokeRect(b.x,b.y,b.w,b.h);
// HP bar
X.fillStyle='#300';X.fillRect(b.x,b.y-15,b.w,8);
X.fillStyle='#ef4444';X.fillRect(b.x,b.y-15,b.w*(b.hp/b.maxHp),8);
X.fillStyle='#fff';X.font='bold 12px sans-serif';X.textAlign='center';
X.fillText('DATA BOSS',b.x+b.w/2,b.y-20);
// Inner pattern
X.strokeStyle='rgba(255,255,255,0.2)';X.lineWidth=1;
for(let i=0;i<4;i++){
X.beginPath();X.moveTo(b.x+i*b.w/4,b.y);X.lineTo(b.x+i*b.w/4,b.y+b.h);X.stroke();
}
}

// Slice lines
sliceLines.forEach(s=>{
X.globalAlpha=s.life/s.maxLife;
X.strokeStyle=s.color;X.lineWidth=3;X.shadowBlur=10;X.shadowColor=s.color;
X.beginPath();X.moveTo(s.x,s.y);X.lineTo(s.x2,s.y2);X.stroke();
X.shadowBlur=0;
});
X.globalAlpha=1;

// Slice trail (cursor trail)
sliceTrail.forEach(s=>{
X.globalAlpha=s.life/20;
X.beginPath();X.arc(s.x,s.y,3,0,Math.PI*2);
X.fillStyle='#38bdf8';X.fill();
});
X.globalAlpha=1;

// Cursor
X.strokeStyle='rgba(56,189,248,0.5)';X.lineWidth=1;
X.beginPath();X.arc(mouse.x,mouse.y,20,0,Math.PI*2);X.stroke();
// Slice direction indicator
let sdx=0,sdy=0;
switch(sliceMode){
case'horizontal':sdx=1;sdy=0;break;
case'vertical':sdx=0;sdy=1;break;
case'diagonal':sdx=0.707;sdy=0.707;break;
}
X.strokeStyle='#38bdf8';X.lineWidth=2;
X.beginPath();X.moveTo(mouse.x-sdx*30,mouse.y-sdy*30);
X.lineTo(mouse.x+sdx*30,mouse.y+sdy*30);X.stroke();

// Particles
particles.forEach(p=>{
X.globalAlpha=p.life/p.maxLife;
X.beginPath();X.arc(p.x,p.y,p.radius*(p.life/p.maxLife),0,Math.PI*2);
X.fillStyle=p.color;X.fill();
});
X.globalAlpha=1;

// HUD
document.getElementById('score-display').textContent='SCORE: '+score;
document.getElementById('wave-display').textContent='WAVE: '+wave;
document.getElementById('hp-display').textContent='ENERGY: '+Math.ceil(energy);
document.getElementById('combo-display').textContent=combo>1?'COMBO: x'+combo:'';
document.getElementById('slice-display').textContent=
'['+sliceMode.toUpperCase()+'] Q:Horiz W:Vert E:Diag R:Pulse('+Math.ceil(energy)+')';

// Energy bar
X.fillStyle='rgba(14,165,233,0.2)';X.fillRect(W-210,10,200,12);
X.fillStyle='#38bdf8';X.fillRect(W-210,10,200*(energy/100),12);
X.strokeStyle='#38bdf8';X.lineWidth=1;X.strokeRect(W-210,10,200,12);

X.restore();
}

function loop(){update();draw();requestAnimationFrame(loop)}
loop();
</script>
</body>
</html>
