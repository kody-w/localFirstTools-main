<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Archaeology Dig Simulator</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#1a1410;color:#e8d5b7;font-family:'Courier New',monospace;overflow:hidden;user-select:none}
#screens{width:100vw;height:100vh;position:relative}
.screen{display:none;width:100%;height:100%;position:absolute;top:0;left:0}
.screen.active{display:flex}
#menuScreen{flex-direction:column;align-items:center;justify-content:center;background:linear-gradient(180deg,#2a1f14,#1a1410)}
#menuScreen h1{font-size:2.4em;color:#c9a96e;text-shadow:0 2px 8px rgba(0,0,0,.6);margin-bottom:.2em}
#menuScreen p{color:#8a7a60;margin-bottom:1.5em;font-size:.9em}
.btn{background:#4a3520;border:2px solid #6b5030;color:#e8d5b7;padding:10px 28px;font-family:inherit;font-size:1em;cursor:pointer;border-radius:4px;margin:6px;transition:background .2s}
.btn:hover{background:#6b5030}
.btn.sm{padding:5px 14px;font-size:.8em}
#gameScreen{flex-direction:row}
#leftPanel{display:flex;flex-direction:column;padding:8px;width:60%}
#topBar{display:flex;justify-content:space-between;align-items:center;padding:4px 8px;background:#2a1f14;border-radius:4px;margin-bottom:6px;font-size:.82em;flex-wrap:wrap;gap:4px}
#topBar span{margin-right:12px}
.tool-ind{display:inline-block;padding:2px 8px;border-radius:3px;margin:0 2px;cursor:pointer;font-size:.78em}
.tool-ind.active{background:#6b5030;border:1px solid #c9a96e}
.tool-ind:not(.active){background:#2a1f14;border:1px solid #4a3520;opacity:.6}
#gridWrap{flex:1;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}
#gridCanvas{image-rendering:pixelated;cursor:crosshair}
#rightPanel{width:40%;display:flex;flex-direction:column;padding:8px;gap:6px;overflow:hidden}
.panel{background:#2a1f1480;border:1px solid #4a3520;border-radius:4px;padding:8px}
.panel h3{font-size:.85em;color:#c9a96e;margin-bottom:6px;border-bottom:1px solid #3a2a18;padding-bottom:4px}
#inventoryPanel{flex:1;overflow-y:auto;min-height:0}
#inventoryList{display:flex;flex-wrap:wrap;gap:4px}
.inv-item{width:70px;text-align:center;padding:4px;background:#1a1410;border:1px solid #3a2a18;border-radius:3px;cursor:pointer;font-size:.65em;transition:border-color .2s}
.inv-item:hover{border-color:#c9a96e}
.inv-item canvas{display:block;margin:0 auto 2px}
.inv-item.damaged{border-color:#8b3030}
#analysisPanel{min-height:120px}
#analysisArea{min-height:60px;background:#1a1410;border:1px dashed #4a3520;border-radius:3px;padding:8px;text-align:center;font-size:.75em;color:#8a7a60}
.era-btn{display:inline-block;padding:3px 8px;margin:3px;background:#3a2a18;border:1px solid #5a4a30;border-radius:3px;cursor:pointer;font-size:.72em}
.era-btn:hover{background:#5a4a30}
#fragmentPanel{min-height:80px}
#fragmentArea{font-size:.75em;color:#8a7a60}
.frag-group{margin:4px 0;padding:4px;background:#1a1410;border-radius:3px;display:flex;align-items:center;gap:6px}
.frag-group .btn{padding:2px 8px;font-size:.7em}
#cellInfo{font-size:.75em;color:#8a7a60;padding:4px;min-height:2em}
#reportScreen{flex-direction:column;align-items:center;justify-content:center;background:#1a1410;padding:20px}
#reportScreen h2{color:#c9a96e;margin-bottom:16px}
#reportContent{background:#2a1f14;border:1px solid #4a3520;border-radius:6px;padding:20px;max-width:500px;width:90%;font-size:.85em;line-height:1.6;max-height:60vh;overflow-y:auto}
#reportContent .stat{display:flex;justify-content:space-between;padding:2px 0;border-bottom:1px solid #2a1f1480}
.stat-label{color:#8a7a60}.stat-value{color:#c9a96e}
#museumScreen{flex-direction:column;align-items:center;background:#1a1410;padding:16px;overflow-y:auto}
#museumScreen h2{color:#c9a96e;margin-bottom:12px}
#museumGrid{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;max-width:800px;padding-bottom:60px}
.mus-item{width:90px;text-align:center;padding:6px;background:#2a1f14;border:1px solid #3a2a18;border-radius:4px;font-size:.65em}
.mus-item canvas{display:block;margin:0 auto 3px}
#particleCanvas{position:absolute;top:0;left:0;pointer-events:none}
::-webkit-scrollbar{width:6px}
::-webkit-scrollbar-track{background:#1a1410}
::-webkit-scrollbar-thumb{background:#4a3520;border-radius:3px}
</style>
</head>
<body>
<div id="screens">
<div id="menuScreen" class="screen active">
<h1>‚õè Dig Site</h1>
<p>Archaeology Dig Simulator</p>
<button class="btn" onclick="G.startNewDig()">New Excavation</button>
<button class="btn" onclick="G.showMuseum()">Museum Collection</button>
<div style="margin-top:20px;font-size:.7em;color:#5a4a30">
<p>Tools: [1] Trowel [2] Shovel [3] Brush</p>
<p>Click grid to dig ‚Ä¢ 100 actions per site</p>
</div>
</div>
<div id="gameScreen" class="screen">
<div id="leftPanel">
<div id="topBar">
<span>Actions: <b id="actionsLeft">100</b></span>
<span>Score: <b id="scoreDisp">0</b></span>
<span>Seed: <b id="seedDisp">0</b></span>
<span>
<span class="tool-ind active" data-t="0" onclick="G.setTool(0)">1:Trowel</span>
<span class="tool-ind" data-t="1" onclick="G.setTool(1)">2:Shovel</span>
<span class="tool-ind" data-t="2" onclick="G.setTool(2)">3:Brush</span>
</span>
</div>
<div id="gridWrap">
<canvas id="gridCanvas"></canvas>
<canvas id="particleCanvas"></canvas>
</div>
<div id="cellInfo">&nbsp;</div>
</div>
<div id="rightPanel">
<div class="panel" id="inventoryPanel">
<h3>Inventory (<span id="invCount">0</span>)</h3>
<div id="inventoryList"></div>
</div>
<div class="panel" id="analysisPanel">
<h3>Analysis Table</h3>
<div id="analysisArea">Click an artifact to analyze.<br>Match it to the correct era for bonus points.</div>
</div>
<div class="panel" id="fragmentPanel">
<h3>Fragment Assembly</h3>
<div id="fragmentArea">Find 3+ pottery shards of the same style to combine.</div>
</div>
<div style="display:flex;gap:6px;margin-top:auto">
<button class="btn sm" onclick="G.endDig()">End Dig</button>
<button class="btn sm" onclick="G.showScreen('menuScreen')">Menu</button>
</div>
</div>
</div>
<div id="reportScreen" class="screen">
<h2>üìã Dig Report</h2>
<div id="reportContent"></div>
<div style="margin-top:16px"><button class="btn" onclick="G.showScreen('menuScreen')">Back to Menu</button></div>
</div>
<div id="museumScreen" class="screen">
<h2>üèõ Museum Collection</h2>
<div id="museumGrid"></div>
<div style="position:fixed;bottom:16px"><button class="btn" onclick="G.showScreen('menuScreen')">Back</button></div>
</div>
</div>
<script>
(()=>{
const W=20,H=20,LAYERS=4,MAX_ACTIONS=100;
const LAYER_COLORS=['#6b4226','#c47028','#d4b860','#808080'];
const LAYER_NAMES=['Topsoil','Clay','Sand','Bedrock'];
const ERAS=['Bronze Age','Iron Age','Roman','Medieval'];
const ARTIFACT_TYPES=[
{name:'Pottery Shard',id:'pottery',rarity:'common',minD:0,maxD:1,minPts:5,maxPts:15,w:1,h:1,era:null,color:'#b85c38'},
{name:'Coin',id:'coin',rarity:'common',minD:1,maxD:2,minPts:10,maxPts:20,w:1,h:1,era:null,color:'#c9a96e'},
{name:'Bone Fragment',id:'bone',rarity:'uncommon',minD:0,maxD:3,minPts:15,maxPts:30,w:1,h:1,era:null,color:'#d4c8a0'},
{name:'Jewelry',id:'jewelry',rarity:'rare',minD:2,maxD:3,minPts:40,maxPts:60,w:1,h:1,era:null,color:'#e0c040'},
{name:'Tool/Weapon',id:'tool',rarity:'uncommon',minD:1,maxD:2,minPts:20,maxPts:40,w:1,h:1,era:null,color:'#7a8a6a'},
{name:'Fossil',id:'fossil',rarity:'rare',minD:2,maxD:3,minPts:50,maxPts:80,w:1,h:1,era:null,color:'#a09880'},
{name:'Complete Skeleton',id:'skeleton',rarity:'very_rare',minD:2,maxD:3,minPts:100,maxPts:100,w:3,h:2,era:null,color:'#e8e0d0'},
{name:'Sealed Tomb',id:'tomb',rarity:'legendary',minD:3,maxD:3,minPts:200,maxPts:200,w:3,h:3,era:null,color:'#604020'}
];
let seed,grid,artifacts,found,inventory,actions,score,currentTool,shimmerCells,selectedArtifact,datingDone;
let gridCanvas,gridCtx,partCanvas,partCtx,particles,cellSize,animFrame;
const audioCtx=new(window.AudioContext||window.webkitAudioContext)();
function rng(){seed=(seed*1103515245+12345)&0x7fffffff;return(seed>>16)/32767}
function rngInt(a,b){return a+Math.floor(rng()*(b-a+1))|0}
function playSound(type){
const now=audioCtx.currentTime;
const o=audioCtx.createOscillator();
const g=audioCtx.createGain();
o.connect(g);g.connect(audioCtx.destination);
if(type==='dig'){
o.type='triangle';o.frequency.setValueAtTime(80+Math.random()*60,now);
o.frequency.exponentialRampToValueAtTarget(40,now+0.15);
g.gain.setValueAtTime(0.12,now);g.gain.exponentialRampToValueAtTarget(0.001,now+0.15);
o.start(now);o.stop(now+0.15);
}else if(type==='find'){
o.type='sine';o.frequency.setValueAtTime(600,now);
o.frequency.exponentialRampToValueAtTarget(1200,now+0.3);
g.gain.setValueAtTime(0.15,now);g.gain.exponentialRampToValueAtTarget(0.001,now+0.4);
o.start(now);o.stop(now+0.4);
}else if(type==='damage'){
o.type='sawtooth';o.frequency.setValueAtTime(200,now);
o.frequency.exponentialRampToValueAtTarget(50,now+0.2);
g.gain.setValueAtTime(0.15,now);g.gain.exponentialRampToValueAtTarget(0.001,now+0.2);
o.start(now);o.stop(now+0.2);
}else if(type==='brush'){
const buf=audioCtx.createBuffer(1,audioCtx.sampleRate*0.15|0,audioCtx.sampleRate);
const d=buf.getChannelData(0);
for(let i=0;i<d.length;i++)d[i]=(Math.random()*2-1)*0.06*(1-i/d.length);
const n=audioCtx.createBufferSource();n.buffer=buf;n.connect(audioCtx.destination);
n.start(now);return;
}
}
function spawnParticles(px,py,color,count){
for(let i=0;i<count;i++){
particles.push({x:px,y:py,vx:(Math.random()-0.5)*3,vy:-Math.random()*2-1,life:30+Math.random()*20|0,color:color,size:2+Math.random()*2});
}
}
function initGrid(){
grid=[];
for(let y=0;y<H;y++){
grid[y]=[];
for(let x=0;x<W;x++){
grid[y][x]={layers:LAYERS,artifact:null,artRef:null,shimmer:0,revealed:false};
}
}
}
function placeArtifacts(){
artifacts=[];
const counts={common:rngInt(12,18),uncommon:rngInt(5,8),rare:rngInt(2,4),very_rare:rngInt(0,1),legendary:rngInt(0,1)};
const pool=[];
for(const t of ARTIFACT_TYPES){
const c=counts[t.rarity]||0;
for(let i=0;i<c;i++)pool.push(Object.assign({},t));
}
for(let i=pool.length-1;i>0;i--){const j=rngInt(0,i);[pool[i],pool[j]]=[pool[j],pool[i]];}
let potteryGroups=[];
let pgIdx=0;
const potteryColors=['#b85c38','#8b4513','#a0522d','#cd853f','#d2691e'];
const potteryPatterns=['dots','lines','zigzag','waves','plain'];
for(const art of pool){
const depth=rngInt(art.minD,art.maxD);
const era=ERAS[rngInt(0,3)];
art.era=era;
art.depth=depth;
art.points=rngInt(art.minPts,art.maxPts);
art.damaged=false;
art.dated=false;
art.datingCorrect=false;
art.uid=artifacts.length;
if(art.id==='pottery'){
if(potteryGroups.length===0||potteryGroups[potteryGroups.length-1].count>=rngInt(3,5)){
potteryGroups.push({color:potteryColors[pgIdx%potteryColors.length],pattern:potteryPatterns[pgIdx%potteryPatterns.length],count:0,gid:pgIdx});
pgIdx++;
}
const pg=potteryGroups[potteryGroups.length-1];
art.potGroup=pg.gid;art.potColor=pg.color;art.potPattern=pg.pattern;
pg.count++;
}
let placed=false;
for(let attempt=0;attempt<200;attempt++){
const px=rngInt(0,W-art.w);
const py=rngInt(0,H-art.h);
let ok=true;
for(let dy=0;dy<art.h&&ok;dy++){
for(let dx=0;dx<art.w&&ok;dx++){
if(grid[py+dy][px+dx].artifact!==null)ok=false;
}
}
if(ok){
for(let dy=0;dy<art.h;dy++){
for(let dx=0;dx<art.w;dx++){
grid[py+dy][px+dx].artifact=art;
grid[py+dy][px+dx].artRef={ox:dx,oy:dy};
}
}
art.x=px;art.y=py;
artifacts.push(art);
placed=true;break;
}
}
if(!placed){
art.x=-1;art.y=-1;
}
}
}
function getCell(x,y){if(x>=0&&x<W&&y>=0&&y<H)return grid[y][x];return null}
function digCell(x,y,canDamage){
const c=getCell(x,y);if(!c||c.layers<=0)return null;
c.layers--;
let foundArt=null;
if(c.artifact&&c.layers<=c.artifact.depth){
if(!c.artifact._found){
if(canDamage&&rng()<0.3){
c.artifact.damaged=true;
playSound('damage');
}else{
playSound('find');
}
c.artifact._found=true;
foundArt=c.artifact;
found.push(foundArt);
inventory.push(foundArt);
const pts=foundArt.damaged?Math.floor(foundArt.points*0.5):foundArt.points;
score+=pts;
}
}
const px=(x+0.5)*cellSize;const py=(y+0.5)*cellSize;
spawnParticles(px,py,LAYER_COLORS[c.layers]||'#606060',6);
return foundArt;
}
function useTrowel(x,y){
if(actions<=0)return;
actions--;
const c=getCell(x,y);if(!c||c.layers<=0)return;
playSound('dig');
digCell(x,y,false);
updateUI();
}
function useShovel(x,y){
if(actions<=0)return;
actions--;
playSound('dig');
for(let dy=-1;dy<=1;dy++){
for(let dx=-1;dx<=1;dx++){
const nx=x+dx,ny=y+dy;
const c=getCell(nx,ny);
if(c&&c.layers>0)digCell(nx,ny,true);
}
}
updateUI();
}
function useBrush(x,y){
if(actions<=0)return;
actions--;
playSound('brush');
for(let dy=-1;dy<=1;dy++){
for(let dx=-1;dx<=1;dx++){
const nx=x+dx,ny=y+dy;
const c=getCell(nx,ny);
if(c&&c.artifact&&!c.artifact._found){
c.shimmer=120;
shimmerCells.add(ny*W+nx);
}
}
}
updateUI();
}
function drawGrid(){
const cs=cellSize;
for(let y=0;y<H;y++){
for(let x=0;x<W;x++){
const c=grid[y][x];
const px=x*cs,py=y*cs;
if(c.layers>0){
gridCtx.fillStyle=LAYER_COLORS[LAYERS-c.layers];
gridCtx.fillRect(px,py,cs,cs);
const depth=LAYERS-c.layers;
if(depth>0){
gridCtx.fillStyle='rgba(0,0,0,'+(depth*0.06)+')';
gridCtx.fillRect(px,py,cs,cs);
}
}else{
gridCtx.fillStyle='#505050';
gridCtx.fillRect(px,py,cs,cs);
}
if(c.artifact&&c.artifact._found&&c.layers<=c.artifact.depth){
drawArtifactOnGrid(c.artifact,x,y,px,py,cs);
}
if(c.shimmer>0){
c.shimmer--;
const alpha=0.15+0.15*Math.sin(Date.now()*0.01);
gridCtx.fillStyle='rgba(255,255,200,'+alpha+')';
gridCtx.fillRect(px,py,cs,cs);
if(c.shimmer<=0)shimmerCells.delete(y*W+x);
}
gridCtx.strokeStyle='rgba(0,0,0,0.15)';
gridCtx.strokeRect(px,py,cs,cs);
}
}
}
function drawArtifactOnGrid(art,gx,gy,px,py,cs){
const ref=grid[gy][gx].artRef;
if(!ref)return;
gridCtx.fillStyle=art.damaged?'#8b3030':art.color;
const m=cs*0.15;
if(art.id==='pottery'){
gridCtx.fillStyle=art.potColor||(art.damaged?'#8b3030':art.color);
gridCtx.beginPath();
gridCtx.moveTo(px+m,py+cs-m);
gridCtx.lineTo(px+cs*0.3,py+m);
gridCtx.lineTo(px+cs*0.7,py+m);
gridCtx.lineTo(px+cs-m,py+cs-m);
gridCtx.fill();
}else if(art.id==='coin'){
gridCtx.beginPath();
gridCtx.arc(px+cs/2,py+cs/2,cs*0.3,0,Math.PI*2);
gridCtx.fill();
gridCtx.strokeStyle='#a08030';gridCtx.lineWidth=1;gridCtx.stroke();
}else if(art.id==='bone'){
gridCtx.fillStyle=art.damaged?'#8b3030':'#d4c8a0';
gridCtx.fillRect(px+m,py+cs*0.4,cs-m*2,cs*0.2);
gridCtx.beginPath();gridCtx.arc(px+m,py+cs*0.5,cs*0.12,0,Math.PI*2);gridCtx.fill();
gridCtx.beginPath();gridCtx.arc(px+cs-m,py+cs*0.5,cs*0.12,0,Math.PI*2);gridCtx.fill();
}else if(art.id==='jewelry'){
gridCtx.strokeStyle=art.damaged?'#8b3030':'#e0c040';
gridCtx.lineWidth=2;
gridCtx.beginPath();gridCtx.arc(px+cs/2,py+cs/2,cs*0.28,0,Math.PI*2);gridCtx.stroke();
gridCtx.fillStyle='#e04040';
gridCtx.beginPath();gridCtx.arc(px+cs/2,py+cs*0.35,cs*0.08,0,Math.PI*2);gridCtx.fill();
}else if(art.id==='tool'){
gridCtx.fillRect(px+cs*0.45,py+m,cs*0.1,cs*0.5);
gridCtx.fillRect(px+cs*0.3,py+m,cs*0.4,cs*0.15);
}else if(art.id==='fossil'){
gridCtx.strokeStyle=art.damaged?'#8b3030':'#a09880';
gridCtx.lineWidth=2;
gridCtx.beginPath();
for(let i=0;i<3;i++){
const r=cs*(0.15+i*0.08);
gridCtx.arc(px+cs/2,py+cs/2,r,Math.PI*0.2,Math.PI*1.6);
}
gridCtx.stroke();
}else if(art.id==='skeleton'){
if(ref.ox===0&&ref.oy===0){
gridCtx.fillStyle=art.damaged?'#8b3030':'#e8e0d0';
gridCtx.beginPath();gridCtx.arc(px+cs/2,py+cs/2,cs*0.3,0,Math.PI*2);gridCtx.fill();
gridCtx.fillStyle='#333';
gridCtx.beginPath();gridCtx.arc(px+cs*0.4,py+cs*0.4,2,0,Math.PI*2);gridCtx.fill();
gridCtx.beginPath();gridCtx.arc(px+cs*0.6,py+cs*0.4,2,0,Math.PI*2);gridCtx.fill();
}else{
gridCtx.fillStyle=art.damaged?'#8b3030':'#d4c8a0';
gridCtx.fillRect(px+cs*0.4,py+m,cs*0.2,cs-m*2);
if(ref.oy===1){
gridCtx.fillRect(px+m,py+cs*0.35,cs-m*2,cs*0.1);
}
}
}else if(art.id==='tomb'){
gridCtx.fillStyle=art.damaged?'#5a2020':'#604020';
gridCtx.fillRect(px+1,py+1,cs-2,cs-2);
if(ref.ox===1&&ref.oy===0){
gridCtx.fillStyle='#806040';
gridCtx.beginPath();
gridCtx.moveTo(px+cs*0.2,py+cs*0.1);
gridCtx.lineTo(px+cs*0.8,py+cs*0.1);
gridCtx.lineTo(px+cs*0.5,py+cs*0.8);
gridCtx.fill();
}
gridCtx.strokeStyle='#806040';gridCtx.lineWidth=1;
gridCtx.strokeRect(px+2,py+2,cs-4,cs-4);
}
if(art.damaged){
gridCtx.strokeStyle='#ff000080';gridCtx.lineWidth=1;
gridCtx.beginPath();
gridCtx.moveTo(px+cs*0.2,py+cs*0.2);gridCtx.lineTo(px+cs*0.5,py+cs*0.5);
gridCtx.lineTo(px+cs*0.4,py+cs*0.8);gridCtx.stroke();
}
}
function drawArtifactIcon(ctx,art,w,h){
ctx.clearRect(0,0,w,h);
const m=4;
ctx.fillStyle=art.damaged?'#8b3030':art.color;
if(art.id==='pottery'){
ctx.fillStyle=art.potColor||art.color;
ctx.beginPath();ctx.moveTo(m,h-m);ctx.lineTo(w*0.3,m);ctx.lineTo(w*0.7,m);ctx.lineTo(w-m,h-m);ctx.fill();
if(art.potPattern==='dots'){
ctx.fillStyle='#00000040';
for(let i=0;i<3;i++)ctx.fillRect(w*0.3+i*8,h*0.4,3,3);
}else if(art.potPattern==='lines'){
ctx.strokeStyle='#00000040';ctx.lineWidth=1;
ctx.beginPath();ctx.moveTo(w*0.25,h*0.4);ctx.lineTo(w*0.75,h*0.4);ctx.stroke();
ctx.beginPath();ctx.moveTo(w*0.2,h*0.6);ctx.lineTo(w*0.8,h*0.6);ctx.stroke();
}
}else if(art.id==='coin'){
ctx.beginPath();ctx.arc(w/2,h/2,Math.min(w,h)*0.35,0,Math.PI*2);ctx.fill();
ctx.strokeStyle='#a08030';ctx.lineWidth=1;ctx.stroke();
}else if(art.id==='bone'){
ctx.fillRect(m,h*0.4,w-m*2,h*0.2);
ctx.beginPath();ctx.arc(m+2,h*0.5,4,0,Math.PI*2);ctx.fill();
ctx.beginPath();ctx.arc(w-m-2,h*0.5,4,0,Math.PI*2);ctx.fill();
}else if(art.id==='jewelry'){
ctx.strokeStyle=art.damaged?'#8b3030':'#e0c040';ctx.lineWidth=2;
ctx.beginPath();ctx.arc(w/2,h/2,Math.min(w,h)*0.3,0,Math.PI*2);ctx.stroke();
ctx.fillStyle='#e04040';ctx.beginPath();ctx.arc(w/2,h*0.3,3,0,Math.PI*2);ctx.fill();
}else if(art.id==='tool'){
ctx.fillRect(w*0.45,m,w*0.1,h*0.55);ctx.fillRect(w*0.25,m,w*0.5,h*0.18);
}else if(art.id==='fossil'){
ctx.strokeStyle=art.color;ctx.lineWidth=2;ctx.beginPath();
for(let i=0;i<3;i++){ctx.arc(w/2,h/2,6+i*4,0.3,5.5);}ctx.stroke();
}else if(art.id==='skeleton'){
ctx.fillStyle=art.damaged?'#8b3030':'#e8e0d0';
ctx.beginPath();ctx.arc(w/2,h*0.25,6,0,Math.PI*2);ctx.fill();
ctx.fillRect(w*0.44,h*0.35,w*0.12,h*0.4);
ctx.fillRect(w*0.25,h*0.4,w*0.5,h*0.08);
}else if(art.id==='tomb'){
ctx.fillStyle=art.damaged?'#5a2020':'#604020';ctx.fillRect(2,2,w-4,h-4);
ctx.fillStyle='#806040';ctx.beginPath();
ctx.moveTo(w*0.2,h*0.15);ctx.lineTo(w*0.8,h*0.15);ctx.lineTo(w*0.5,h*0.7);ctx.fill();
ctx.strokeStyle='#806040';ctx.lineWidth=1;ctx.strokeRect(3,3,w-6,h-6);
}
if(art.damaged){
ctx.strokeStyle='#ff000080';ctx.lineWidth=1;ctx.beginPath();
ctx.moveTo(w*0.2,h*0.2);ctx.lineTo(w*0.5,h*0.5);ctx.lineTo(w*0.3,h*0.8);ctx.stroke();
}
}
function updateParticles(){
partCtx.clearRect(0,0,partCanvas.width,partCanvas.height);
for(let i=particles.length-1;i>=0;i--){
const p=particles[i];
p.x+=p.vx;p.y+=p.vy;p.vy+=0.1;p.life--;
if(p.life<=0){particles.splice(i,1);continue;}
partCtx.globalAlpha=p.life/50;
partCtx.fillStyle=p.color;
partCtx.fillRect(p.x-p.size/2,p.y-p.size/2,p.size,p.size);
}
partCtx.globalAlpha=1;
}
function updateUI(){
document.getElementById('actionsLeft').textContent=actions;
document.getElementById('scoreDisp').textContent=score;
document.getElementById('invCount').textContent=inventory.length;
updateInventory();
updateFragments();
if(actions<=0)setTimeout(()=>G.endDig(),500);
}
function updateInventory(){
const el=document.getElementById('inventoryList');
el.innerHTML='';
for(const art of inventory){
const div=document.createElement('div');
div.className='inv-item'+(art.damaged?' damaged':'');
const cvs=document.createElement('canvas');
cvs.width=40;cvs.height=32;
drawArtifactIcon(cvs.getContext('2d'),art,40,32);
div.appendChild(cvs);
const nm=document.createElement('div');
nm.textContent=art.name;
div.appendChild(nm);
const info=document.createElement('div');
const pts=art.damaged?Math.floor(art.points*0.5):art.points;
info.textContent=(art.damaged?'Damaged ':'')+'D:'+art.depth+' '+pts+'pts';
info.style.color=art.damaged?'#8b3030':'#8a7a60';
div.appendChild(info);
if(art.dated){
const dt=document.createElement('div');
dt.textContent=art.datingCorrect?'‚úì '+art.era:'‚úó Misdated';
dt.style.color=art.datingCorrect?'#60a060':'#a06060';
div.appendChild(dt);
}
div.onclick=()=>selectForAnalysis(art);
el.appendChild(div);
}
}
function selectForAnalysis(art){
if(art.dated){return;}
selectedArtifact=art;
const area=document.getElementById('analysisArea');
area.innerHTML='';
const cvs=document.createElement('canvas');
cvs.width=60;cvs.height=48;
drawArtifactIcon(cvs.getContext('2d'),art,60,48);
area.appendChild(cvs);
const info=document.createElement('div');
info.textContent='Analyzing: '+art.name;
info.style.marginBottom='6px';
area.appendChild(info);
const hint=document.createElement('div');
hint.style.fontSize='.7em';hint.style.color='#8a7a60';hint.style.marginBottom='6px';
const eraIdx=ERAS.indexOf(art.era);
const hints=['Crude, hammered finish','Intricate ironwork details','Stamped with Latin lettering','Gothic, ornate decoration'];
hint.textContent='Clue: '+hints[eraIdx];
area.appendChild(hint);
const label=document.createElement('div');
label.textContent='Date this artifact:';
label.style.fontSize='.75em';label.style.marginBottom='4px';
area.appendChild(label);
for(const era of ERAS){
const btn=document.createElement('span');
btn.className='era-btn';
btn.textContent=era;
btn.onclick=()=>dateArtifact(art,era);
area.appendChild(btn);
}
}
function dateArtifact(art,guessEra){
if(art.dated)return;
art.dated=true;
art.datingCorrect=(guessEra===art.era);
if(art.datingCorrect){
score+=25;
playSound('find');
}else{
playSound('damage');
}
datingDone++;
selectedArtifact=null;
const area=document.getElementById('analysisArea');
area.innerHTML='<div style="color:'+(art.datingCorrect?'#60a060':'#a06060')+'">'+
(art.datingCorrect?'‚úì Correct! +25 bonus':'‚úó Wrong era. It was '+art.era)+
'</div><div style="margin-top:6px;font-size:.72em;color:#8a7a60">Click another artifact to analyze.</div>';
updateUI();
}
function updateFragments(){
const groups={};
for(const art of inventory){
if(art.id==='pottery'&&art.potGroup!==undefined){
if(!groups[art.potGroup])groups[art.potGroup]={arts:[],color:art.potColor,pattern:art.potPattern,combined:false};
groups[art.potGroup].arts.push(art);
}
}
const el=document.getElementById('fragmentArea');
el.innerHTML='';
let hasGroups=false;
for(const gid in groups){
const g=groups[gid];
if(g.arts.length<2)continue;
hasGroups=true;
const div=document.createElement('div');
div.className='frag-group';
const swatch=document.createElement('span');
swatch.style.display='inline-block';swatch.style.width='12px';swatch.style.height='12px';
swatch.style.background=g.color;swatch.style.borderRadius='2px';swatch.style.flexShrink='0';
div.appendChild(swatch);
const txt=document.createElement('span');
txt.textContent=g.arts.length+' shards ('+g.pattern+')';
txt.style.flex='1';
div.appendChild(txt);
if(g.arts.length>=3&&!g.arts[0]._combined){
const btn=document.createElement('button');
btn.className='btn';btn.style.padding='2px 8px';btn.style.fontSize='.7em';
btn.textContent='Combine';
btn.onclick=()=>{
const bonus=g.arts.length*10;
score+=bonus;
for(const a of g.arts)a._combined=true;
playSound('find');
updateUI();
};
div.appendChild(btn);
}else if(g.arts[0]&&g.arts[0]._combined){
const d=document.createElement('span');d.textContent='‚úì Combined';d.style.color='#60a060';d.style.fontSize='.72em';
div.appendChild(d);
}
el.appendChild(div);
}
if(!hasGroups)el.innerHTML='<span style="color:#8a7a60">Find 3+ pottery shards of the same style to combine.</span>';
}
function renderLoop(){
drawGrid();
updateParticles();
animFrame=requestAnimationFrame(renderLoop);
}
function resizeCanvas(){
const wrap=document.getElementById('gridWrap');
const sz=Math.min(wrap.clientWidth,wrap.clientHeight)-4;
cellSize=Math.floor(sz/W)|0;
const cw=cellSize*W,ch=cellSize*H;
gridCanvas.width=cw;gridCanvas.height=ch;
partCanvas.width=cw;partCanvas.height=ch;
}
function getCellFromEvent(e){
const rect=gridCanvas.getBoundingClientRect();
const mx=e.clientX-rect.left,my=e.clientY-rect.top;
const sx=gridCanvas.width/rect.width,sy=gridCanvas.height/rect.height;
const cx=Math.floor(mx*sx/cellSize)|0,cy=Math.floor(my*sy/cellSize)|0;
if(cx>=0&&cx<W&&cy>=0&&cy<H)return{x:cx,y:cy};
return null;
}
function onGridClick(e){
const pos=getCellFromEvent(e);
if(!pos)return;
audioCtx.resume();
if(currentTool===0)useTrowel(pos.x,pos.y);
else if(currentTool===1)useShovel(pos.x,pos.y);
else if(currentTool===2)useBrush(pos.x,pos.y);
}
function onGridMove(e){
const pos=getCellFromEvent(e);
const el=document.getElementById('cellInfo');
if(!pos){el.textContent='';return;}
const c=grid[pos.y][pos.x];
const layerName=c.layers>0?LAYER_NAMES[LAYERS-c.layers]+' ('+c.layers+' left)':'Fully excavated';
let artInfo='';
if(c.artifact&&c.artifact._found){
artInfo=' | '+c.artifact.name+(c.artifact.damaged?' (damaged)':'');
}
el.textContent='['+pos.x+','+pos.y+'] '+layerName+artInfo;
}
window.G={
setTool(t){
currentTool=t;
document.querySelectorAll('.tool-ind').forEach(el=>{
el.classList.toggle('active',parseInt(el.dataset.t)===t);
});
},
startNewDig(){
seed=Date.now()%2147483647;
initGrid();
found=[];inventory=[];actions=MAX_ACTIONS;score=0;currentTool=0;
shimmerCells=new Set();particles=[];selectedArtifact=null;datingDone=0;
placeArtifacts();
gridCanvas=document.getElementById('gridCanvas');
gridCtx=gridCanvas.getContext('2d');
partCanvas=document.getElementById('particleCanvas');
partCtx=partCanvas.getContext('2d');
document.getElementById('seedDisp').textContent=seed;
G.setTool(0);
G.showScreen('gameScreen');
resizeCanvas();
if(animFrame)cancelAnimationFrame(animFrame);
renderLoop();
gridCanvas.onclick=onGridClick;
gridCanvas.onmousemove=onGridMove;
updateUI();
},
showScreen(id){
document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
document.getElementById(id).classList.add('active');
if(id==='gameScreen')resizeCanvas();
},
endDig(){
if(animFrame){cancelAnimationFrame(animFrame);animFrame=null;}
const totalPts=score;
const artCount=found.length;
const damaged=found.filter(a=>a.damaged).length;
const dated=found.filter(a=>a.dated).length;
const datedCorrect=found.filter(a=>a.datingCorrect).length;
const rarest=found.length>0?found.reduce((a,b)=>{
const rank={common:0,uncommon:1,rare:2,very_rare:3,legendary:4};
return(rank[b.rarity]||0)>(rank[a.rarity]||0)?b:a;
}):null;
const combined=found.filter(a=>a._combined).length;
const el=document.getElementById('reportContent');
el.innerHTML=''+
'<div class="stat"><span class="stat-label">Site Seed</span><span class="stat-value">'+seed+'</span></div>'+
'<div class="stat"><span class="stat-label">Artifacts Found</span><span class="stat-value">'+artCount+'</span></div>'+
'<div class="stat"><span class="stat-label">Artifacts Damaged</span><span class="stat-value">'+damaged+'</span></div>'+
'<div class="stat"><span class="stat-label">Actions Used</span><span class="stat-value">'+(MAX_ACTIONS-actions)+'/'+MAX_ACTIONS+'</span></div>'+
'<div class="stat"><span class="stat-label">Dating Attempts</span><span class="stat-value">'+dated+'</span></div>'+
'<div class="stat"><span class="stat-label">Dating Accuracy</span><span class="stat-value">'+(dated>0?Math.round(datedCorrect/dated*100):0)+'%</span></div>'+
'<div class="stat"><span class="stat-label">Fragments Combined</span><span class="stat-value">'+combined+'</span></div>'+
'<div class="stat"><span class="stat-label">Rarest Find</span><span class="stat-value">'+(rarest?rarest.name:'None')+'</span></div>'+
'<div class="stat" style="border-bottom:2px solid #c9a96e;padding:6px 0"><span class="stat-label" style="color:#c9a96e;font-weight:bold">Total Site Value</span><span class="stat-value" style="font-size:1.2em">'+totalPts+' pts</span></div>';
saveToMuseum();
G.showScreen('reportScreen');
},
showMuseum(){
const data=JSON.parse(localStorage.getItem('digsite_museum')||'[]');
const el=document.getElementById('museumGrid');
el.innerHTML='';
if(data.length===0){
el.innerHTML='<p style="color:#8a7a60">No artifacts collected yet. Start a dig!</p>';
G.showScreen('museumScreen');
return;
}
for(const item of data){
const div=document.createElement('div');
div.className='mus-item';
const cvs=document.createElement('canvas');
cvs.width=50;cvs.height=40;
drawArtifactIcon(cvs.getContext('2d'),item,50,40);
div.appendChild(cvs);
const nm=document.createElement('div');nm.style.color='#c9a96e';nm.textContent=item.name;
div.appendChild(nm);
const info=document.createElement('div');
info.style.color='#8a7a60';
info.textContent=(item.damaged?'Damaged ':'')+(item.era||'Unknown');
div.appendChild(info);
const pts=document.createElement('div');
pts.textContent=(item.damaged?Math.floor(item.points*0.5):item.points)+' pts';
div.appendChild(pts);
el.appendChild(div);
}
G.showScreen('museumScreen');
}
};
function saveToMuseum(){
const data=JSON.parse(localStorage.getItem('digsite_museum')||'[]');
for(const art of found){
data.push({name:art.name,id:art.id,color:art.color,potColor:art.potColor,potPattern:art.potPattern,
era:art.era,depth:art.depth,points:art.points,damaged:art.damaged,
datingCorrect:art.datingCorrect,rarity:art.rarity,dated:art.dated,seed:seed});
}
localStorage.setItem('digsite_museum',JSON.stringify(data));
}
window.addEventListener('keydown',e=>{
if(e.key==='1')G.setTool(0);
else if(e.key==='2')G.setTool(1);
else if(e.key==='3')G.setTool(2);
});
window.addEventListener('resize',()=>{
if(document.getElementById('gameScreen').classList.contains('active'))resizeCanvas();
});
})();
</script>
</body>
</html>
