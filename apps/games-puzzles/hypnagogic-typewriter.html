<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hypnagogic Typewriter</title>
    <meta name="description" content="A text interface that dissolves into dream-logic as consciousness slips into sleep">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #0a0510; min-height: 100vh; font-family: 'Courier New', monospace;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 40px; transition: background 5s;
        }
        #paper {
            width: 100%; max-width: 800px; min-height: 400px; background: rgba(30,25,40,0.8);
            border: 1px solid rgba(150,120,200,0.3); border-radius: 10px; padding: 30px;
            position: relative; overflow: hidden;
        }
        #text-area {
            width: 100%; min-height: 350px; background: transparent; border: none;
            color: #c0b0d0; font-size: 18px; line-height: 1.8; resize: none; outline: none;
            font-family: 'Courier New', monospace;
        }
        #consciousness {
            position: fixed; top: 20px; right: 20px; background: rgba(20,15,30,0.9);
            padding: 20px; border-radius: 10px; border: 1px solid rgba(150,120,200,0.3);
            text-align: center; color: #a090c0;
        }
        #level { font-size: 32px; color: #c0a0e0; }
        #state { font-size: 12px; opacity: 0.7; margin-top: 5px; }
        #meter {
            width: 150px; height: 8px; background: rgba(100,80,150,0.3);
            border-radius: 4px; margin-top: 10px; overflow: hidden;
        }
        #meter-fill { height: 100%; background: linear-gradient(90deg, #a060ff, #ff60a0); transition: width 0.5s; }
        .ghost-text {
            position: absolute; color: rgba(200,150,255,0.3); pointer-events: none;
            font-size: 16px; animation: drift 10s infinite;
        }
        @keyframes drift {
            0%, 100% { transform: translateY(0) rotate(0deg); opacity: 0.3; }
            50% { transform: translateY(-20px) rotate(2deg); opacity: 0.1; }
        }
        #info { position: fixed; bottom: 20px; color: rgba(150,120,200,0.5); font-size: 12px; }
        .letter { display: inline-block; transition: all 0.3s; }
        .swimming { animation: swim 2s infinite; }
        @keyframes swim { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-3px); } }
    </style>
</head>
<body>
    <div id="paper">
        <textarea id="text-area" placeholder="Begin typing... as you write, consciousness will slip away..."></textarea>
    </div>
    <div id="consciousness">
        <div id="level">100%</div>
        <div id="state">FULLY AWAKE</div>
        <div id="meter"><div id="meter-fill" style="width:100%"></div></div>
    </div>
    <div id="info">The longer you type, the deeper you dream...</div>
    <script>
        const textArea = document.getElementById('text-area');
        const paper = document.getElementById('paper');
        let consciousness = 100;
        let keystrokes = 0;
        let lastText = '';
        
        const dreamWords = [
            'floating', 'falling', 'melting', 'dissolving', 'echoing',
            'forgotten', 'impossible', 'infinite', 'elsewhere', 'never',
            'always', 'somewhere', 'nobody', 'everything', 'nothing'
        ];
        
        const ghostPhrases = [
            'you did not write this',
            'are you still awake',
            'the words remember you',
            'sleep is coming',
            'who is typing now',
            'this was always here'
        ];
        
        const states = [
            { threshold: 80, name: 'FULLY AWAKE', bg: '#0a0510' },
            { threshold: 60, name: 'DROWSY', bg: '#100818' },
            { threshold: 40, name: 'HYPNAGOGIC', bg: '#150a20' },
            { threshold: 20, name: 'DRIFTING', bg: '#1a0c28' },
            { threshold: 0, name: 'DREAMING', bg: '#200e30' }
        ];
        
        function getCurrentState() {
            for (const state of states) {
                if (consciousness >= state.threshold) return state;
            }
            return states[states.length - 1];
        }
        
        function scrambleLetter(char) {
            if (char === ' ' || char === '\n') return char;
            const drift = Math.random();
            if (drift < 0.1 && consciousness < 60) {
                return String.fromCharCode(char.charCodeAt(0) + Math.floor(Math.random() * 3) - 1);
            }
            return char;
        }
        
        function insertDreamWord() {
            if (Math.random() < 0.3 && consciousness < 50) {
                return ' ' + dreamWords[Math.floor(Math.random() * dreamWords.length)] + ' ';
            }
            return '';
        }
        
        function addGhostText() {
            if (consciousness < 40 && Math.random() < 0.2) {
                const ghost = document.createElement('div');
                ghost.className = 'ghost-text';
                ghost.textContent = ghostPhrases[Math.floor(Math.random() * ghostPhrases.length)];
                ghost.style.left = Math.random() * 80 + '%';
                ghost.style.top = Math.random() * 80 + '%';
                ghost.style.transform = 'rotate(' + (Math.random() * 20 - 10) + 'deg)';
                paper.appendChild(ghost);
                setTimeout(() => ghost.remove(), 10000);
            }
        }
        
        function predictWrongWord(text) {
            if (consciousness < 30 && text.endsWith(' ') && Math.random() < 0.2) {
                const wrongPredictions = ['the', 'always', 'never', 'but', 'sleep', 'dream', 'forgot'];
                return wrongPredictions[Math.floor(Math.random() * wrongPredictions.length)] + ' ';
            }
            return '';
        }
        
        function applySwimming() {
            if (consciousness < 40) {
                textArea.style.animation = 'none';
                textArea.offsetHeight;
                textArea.style.animation = 'swim ' + (3 - consciousness/20) + 's infinite ease-in-out';
            }
        }
        
        textArea.addEventListener('input', (e) => {
            keystrokes++;
            consciousness = Math.max(0, 100 - keystrokes * 0.5);
            
            const state = getCurrentState();
            document.getElementById('level').textContent = Math.round(consciousness) + '%';
            document.getElementById('state').textContent = state.name;
            document.getElementById('meter-fill').style.width = consciousness + '%';
            document.body.style.background = state.bg;
            
            let text = textArea.value;
            const newChars = text.slice(lastText.length);
            
            if (consciousness < 70 && newChars.length > 0) {
                let modifiedNew = '';
                for (const char of newChars) {
                    modifiedNew += scrambleLetter(char);
                }
                modifiedNew += insertDreamWord();
                text = lastText + modifiedNew;
            }
            
            text += predictWrongWord(text);
            
            if (text !== textArea.value) {
                const pos = textArea.selectionStart;
                textArea.value = text;
                textArea.selectionStart = textArea.selectionEnd = pos + (text.length - lastText.length - newChars.length);
            }
            
            lastText = textArea.value;
            addGhostText();
            applySwimming();
            
            if (consciousness < 20) {
                textArea.style.filter = 'blur(' + ((20 - consciousness) / 10) + 'px)';
            }
        });
        
        setInterval(() => {
            if (consciousness < 60 && document.activeElement === textArea) {
                textArea.style.letterSpacing = (Math.sin(Date.now() / 1000) * 2) + 'px';
            }
            if (consciousness < 30) {
                textArea.style.transform = 'skewX(' + (Math.sin(Date.now() / 2000) * 2) + 'deg)';
            }
        }, 100);
        
        textArea.addEventListener('blur', () => {
            consciousness = Math.min(100, consciousness + 20);
            keystrokes = Math.max(0, keystrokes - 40);
        });
    </script>
</body>
</html>