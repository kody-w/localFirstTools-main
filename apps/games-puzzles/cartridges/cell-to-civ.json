{
  "console": "cell-to-civ",
  "name": "Cell to Civilization",
  "year": 2026,
  "icon": "ðŸ§¬",
  "theme": {
    "bg": "#0a1628",
    "accent": "#3ddc84"
  },
  "render": {
    "width": 256,
    "height": 224,
    "scanlines": false,
    "scanlineAlpha": 0.02
  },
  "audio": {
    "type": "synth",
    "channels": 4
  },
  "games": [
    {
      "id": "cell-to-civ",
      "name": "Cell to Civilization",
      "icon": "ðŸ§¬",
      "desc": "Evolve from single cell to spacefaring civilization across 4 billion years",
      "code": "if (mode === 'init') {\nG.syllables = ['za','ri','ko','mu','tha','vel','ix','on','ar','pe','lu','shi','en','da','fi','go','na','te','wo','by'];\nG.genName = function(n) {\nvar s = '';\nfor (var i = 0; i < (n||2); i++) s += G.syllables[Math.floor(Math.random() * G.syllables.length)];\nreturn s.charAt(0).toUpperCase() + s.slice(1);\n};\nG.era = 1;\nG.time = 0;\nG.speed = 1;\nG.paused = false;\nG.over = false;\nG.won = false;\nG.speciesName = G.genName(3);\nG.history = [];\nG.shake = 0;\nG.flash = 0;\nG.flashC = '#fff';\nG.transition = 0;\nG.transMsg = '';\nG.particles = [];\nG.showStats = false;\nG.cam = { x: 128, y: 112, zoom: 1, tz: 1, tx: 128, ty: 112 };\nG.cell = {\nx: 128, y: 112,\nvx: 0, vy: 0,\nenergy: 50,\nsize: 4,\nspeed: 1.5,\narmor: 0,\nflagella: 0,\ntoxin: 0,\nphoto: 0\n};\nG.pop = 1;\nG.divCount = 0;\nG.mutations = [];\nG.mutChoice = null;\nG.food = [];\nfor (var i = 0; i < 30; i++) {\nG.food.push({\nx: Math.random() * 256,\ny: Math.random() * 224,\nsize: 1 + Math.random() * 2,\nvx: (Math.random() - 0.5) * 0.3,\nvy: (Math.random() - 0.5) * 0.3\n});\n}\nG.predators = [];\nfor (var i = 0; i < 3; i++) {\nG.predators.push({\nx: Math.random() * 256,\ny: Math.random() * 224,\nvx: (Math.random() - 0.5) * 0.8,\nvy: (Math.random() - 0.5) * 0.8,\nsize: 6,\nhp: 3\n});\n}\nG.creature = { x: 128, y: 112, vx: 0, vy: 0, stamina: 100, maxSt: 100 };\nG.organisms = [];\nG.territory = [];\nG.units = [];\nG.buildings = [];\nG.res = { food: 50, wood: 0, stone: 0 };\nG.techs = [];\nG.allTechs = ['fire','tools','pottery','weapons','agriculture','writing','wheel'];\nG.enemies = [];\nG.selected = [];\nG.buildMenu = false;\nG.buildOpts = [\n{ name: 'Hut', cost: { wood: 10 }, icon: 'H' },\n{ name: 'Fire Pit', cost: { wood: 5, stone: 2 }, icon: 'F' },\n{ name: 'Totem', cost: { stone: 8 }, icon: 'T' },\n{ name: 'Wall', cost: { stone: 5 }, icon: 'W' }\n];\nG.tribeName = G.genName(2) + ' Clan';\nG.cities = [];\nG.hexes = [];\nG.civRes = { food: 100, prod: 50, gold: 20, science: 0 };\nG.civTechs = [];\nG.allCivTechs = ['agriculture','writing','mathematics','engineering','philosophy','astronomy','rocketry'];\nG.civResearching = null;\nG.civResProgress = 0;\nG.aiCivs = [];\nG.diplomacy = {};\nG.hexW = 16;\nG.hexH = 14;\nfor (var hx = 0; hx < 16; hx++) {\nfor (var hy = 0; hy < 16; hy++) {\nvar r = Math.random();\nvar terrain = r < 0.15 ? 'water' : r < 0.3 ? 'forest' : r < 0.4 ? 'mountain' : r < 0.5 ? 'desert' : 'plains';\nvar hasRes = Math.random() < 0.15;\nG.hexes.push({\nhx: hx, hy: hy,\nterrain: terrain,\nresource: hasRes ? (Math.random() < 0.5 ? 'iron' : 'gems') : null,\nowner: null,\nbuilding: null\n});\n}\n}\nG.ship = { x: 128, y: 112, vx: 0, vy: 0, fuel: 100 };\nG.planets = [];\nG.stars = [];\nG.colonies = [];\nG.signalFound = false;\nfor (var i = 0; i < 40; i++) {\nG.stars.push({ x: Math.random() * 256, y: Math.random() * 224, b: 0.3 + Math.random() * 0.7 });\n}\nvar numPlanets = 4 + Math.floor(Math.random() * 5);\nfor (var i = 0; i < numPlanets; i++) {\nvar dist = 30 + i * 22 + Math.random() * 10;\nvar angle = Math.random() * Math.PI * 2;\nvar types = ['rocky','gas','ice','volcanic','ocean'];\nG.planets.push({\ndist: dist,\nangle: angle,\nspeed: 0.002 / (1 + i * 0.3),\ntype: types[Math.floor(Math.random() * types.length)],\nsize: 3 + Math.floor(Math.random() * 5),\nname: G.genName(2) + (Math.random() < 0.5 ? ' Prime' : ' ' + (i+1)),\ncolonized: false,\ncompatible: 0,\nhasSignal: i === numPlanets - 1\n});\n}\nG.planets.forEach(function(p) {\nvar compat = 50;\nG.mutations.forEach(function(m) {\nif (m === 'armor' && p.type === 'rocky') compat += 15;\nif (m === 'photosynthesis' && p.type === 'ocean') compat += 20;\nif (m === 'toxin' && p.type === 'volcanic') compat += 15;\nif (m === 'flagella' && p.type === 'gas') compat += 10;\nif (m === 'size' && p.type === 'ice') compat += 10;\n});\np.compatible = Math.min(100, compat);\n});\nG.mutPool = [\n{ id: 'speed', name: '+Speed', desc: 'Faster movement', icon: 'Â»' },\n{ id: 'size', name: '+Size', desc: 'Larger cells', icon: 'â—' },\n{ id: 'armor', name: 'Armor', desc: 'Resist damage', icon: 'â—†' },\n{ id: 'flagella', name: 'Flagella', desc: 'Better turning', icon: '~' },\n{ id: 'photosynthesis', name: 'Photo', desc: 'Passive energy', icon: 'â˜€' },\n{ id: 'toxin', name: 'Toxin', desc: 'Damage predators', icon: '!' }\n];\nG.kcd = 0;\nG.selIdx = 0;\nG.history.push({ era: 1, time: 0, event: G.speciesName + ' emerges in the primordial soup' });\n}\nif (mode === 'update') {\nif (G.over || G.won) return;\nif (G.transition > 0) { G.transition--; return; }\nG.kcd = Math.max(0, G.kcd - 1);\nG.shake = Math.max(0, G.shake - 0.5);\nG.flash = Math.max(0, G.flash - 2);\nvar spd = G.speed * (dt || 0.016) * 60;\nG.time += 0.00001 * spd;\nG.particles = G.particles.filter(function(p) {\np.x += p.vx; p.y += p.vy; p.vy += (p.grav || 0);\np.life--; return p.life > 0;\n});\nif (K('1')) G.speed = 1;\nif (K('2')) G.speed = 2;\nif (K('3')) G.speed = 5;\nif (K('4')) G.speed = 10;\nif (K('Tab') && G.kcd <= 0) { G.showStats = !G.showStats; G.kcd = 15; }\nif (G.mutChoice) {\nif ((K('w') || K('ArrowUp')) && G.kcd <= 0) { G.selIdx = 0; G.kcd = 10; snd.beep(); }\nif ((K('s') || K('ArrowDown')) && G.kcd <= 0) { G.selIdx = 1; G.kcd = 10; snd.beep(); }\nif ((K(' ') || K('Enter')) && G.kcd <= 0) {\nvar chosen = G.mutChoice[G.selIdx];\nG.mutations.push(chosen.id);\nG.history.push({ era: G.era, time: G.time, event: 'Mutation: ' + chosen.name });\nif (chosen.id === 'speed') G.cell.speed += 0.3;\nif (chosen.id === 'size') G.cell.size += 1;\nif (chosen.id === 'armor') G.cell.armor += 1;\nif (chosen.id === 'flagella') G.cell.flagella += 1;\nif (chosen.id === 'photosynthesis') G.cell.photo += 1;\nif (chosen.id === 'toxin') G.cell.toxin += 1;\nG.mutChoice = null;\nG.kcd = 15;\nG.flash = 20; G.flashC = '#3ddc84';\nsnd.score();\nfor (var i = 0; i < 12; i++)\nG.particles.push({ x: G.cell.x, y: G.cell.y, vx: (Math.random()-0.5)*4, vy: (Math.random()-0.5)*4, life: 20, c: '#3ddc84', s: 2, grav: 0 });\n}\nreturn;\n}\nif (G.era === 1) {\nvar c = G.cell;\nvar ms = c.speed * (1 + c.flagella * 0.15);\nif (K('a') || K('ArrowLeft')) c.vx -= ms * 0.2;\nif (K('d') || K('ArrowRight')) c.vx += ms * 0.2;\nif (K('w') || K('ArrowUp')) c.vy -= ms * 0.2;\nif (K('s') || K('ArrowDown')) c.vy += ms * 0.2;\nc.vx *= 0.92; c.vy *= 0.92;\nc.x += c.vx * spd; c.y += c.vy * spd;\nc.x = Math.max(4, Math.min(252, c.x));\nc.y = Math.max(4, Math.min(220, c.y));\nc.energy += c.photo * 0.05 * spd;\nG.food.forEach(function(f) {\nf.x += f.vx * spd; f.y += f.vy * spd;\nif (f.x < 0 || f.x > 256) f.vx *= -1;\nif (f.y < 0 || f.y > 224) f.vy *= -1;\nvar dx = c.x - f.x, dy = c.y - f.y;\nif (Math.sqrt(dx*dx + dy*dy) < c.size + f.size) {\nc.energy += 8 + f.size * 2;\nf.x = Math.random() * 256; f.y = Math.random() * 224;\nsnd.pickup();\nfor (var i = 0; i < 4; i++)\nG.particles.push({ x: f.x, y: f.y, vx: (Math.random()-0.5)*3, vy: (Math.random()-0.5)*3, life: 12, c: '#3ddc84', s: 1.5, grav: 0 });\n}\n});\nG.predators.forEach(function(p) {\nvar dx = c.x - p.x, dy = c.y - p.y;\nvar dist = Math.sqrt(dx*dx + dy*dy);\nif (dist > 0 && dist < 120) {\np.vx += (dx / dist) * 0.06 * spd;\np.vy += (dy / dist) * 0.06 * spd;\n}\np.vx *= 0.97; p.vy *= 0.97;\np.x += p.vx * spd; p.y += p.vy * spd;\nif (p.x < 0 || p.x > 256) p.vx *= -1;\nif (p.y < 0 || p.y > 224) p.vy *= -1;\nif (dist < c.size + p.size) {\nif (c.toxin > 0) {\np.hp -= c.toxin * 0.5;\nif (p.hp <= 0) {\np.x = Math.random() * 256; p.y = Math.random() * 224; p.hp = 3;\nc.energy += 15;\nG.shake = 5;\nsnd.explode();\n}\n} else {\nc.energy -= (8 - c.armor * 2);\nG.shake = 8;\nsnd.tone(150, 0.08, 0.06, 'sawtooth');\n}\n}\n});\nc.energy = Math.min(100, c.energy);\nif (c.energy <= 0) { G.over = true; snd.die(); return; }\nif (c.energy >= 100) {\nc.energy = 50;\nG.pop++;\nG.divCount++;\nsnd.tone(500, 0.06, 0.05);\nfor (var i = 0; i < 8; i++)\nG.particles.push({ x: c.x, y: c.y, vx: (Math.random()-0.5)*5, vy: (Math.random()-0.5)*5, life: 25, c: '#4af', s: 2, grav: 0 });\nif (G.divCount % 5 === 0) {\nvar pool = G.mutPool.slice();\nvar a = pool.splice(Math.floor(Math.random() * pool.length), 1)[0];\nvar b = pool.splice(Math.floor(Math.random() * pool.length), 1)[0];\nG.mutChoice = [a, b];\nG.selIdx = 0;\n}\nif (G.pop % 15 === 0 && G.predators.length < 8) {\nG.predators.push({ x: Math.random() * 256, y: Math.random() * 224, vx: 0, vy: 0, size: 6 + G.pop * 0.1, hp: 3 + Math.floor(G.pop / 10) });\n}\n}\nG.cam.tz = Math.max(0.5, 1 - G.pop * 0.005);\nif (G.pop >= 50) {\nG.era = 2;\nG.transition = 90;\nG.transMsg = 'ERA 2: ORGANISM';\nG.flash = 40; G.flashC = '#5a8a3a';\nG.history.push({ era: 2, time: G.time, event: 'Multicellular life emerges' });\nsnd.win();\nfor (var i = 0; i < 8; i++) {\nG.organisms.push({\nx: Math.random() * 256, y: Math.random() * 224,\nvx: (Math.random()-0.5)*1, vy: (Math.random()-0.5)*1,\nsize: 3 + Math.random() * 4,\ntype: Math.random() < 0.5 ? 'prey' : 'predator',\nhp: 5, energy: 50\n});\n}\nG.cam.tz = 1;\n}\n}\nif (G.era === 2) {\nvar cr = G.creature;\nvar ms = G.cell.speed * 1.2;\nvar sprint = K('f') || K('Enter');\nvar moveSpd = sprint && cr.stamina > 0 ? ms * 1.8 : ms;\nif (sprint && cr.stamina > 0) cr.stamina -= 0.3 * spd;\nelse cr.stamina = Math.min(cr.maxSt, cr.stamina + 0.1 * spd);\nif (K('a') || K('ArrowLeft')) cr.vx -= moveSpd * 0.15;\nif (K('d') || K('ArrowRight')) cr.vx += moveSpd * 0.15;\nif (K('w') || K('ArrowUp')) cr.vy -= moveSpd * 0.15;\nif (K('s') || K('ArrowDown')) cr.vy += moveSpd * 0.15;\ncr.vx *= 0.93; cr.vy *= 0.93;\ncr.x += cr.vx * spd; cr.y += cr.vy * spd;\ncr.x = Math.max(8, Math.min(248, cr.x));\ncr.y = Math.max(8, Math.min(216, cr.y));\nG.cell.energy += G.cell.photo * 0.03 * spd;\nG.cell.energy = Math.min(100, G.cell.energy);\nG.organisms.forEach(function(o) {\nvar dx = cr.x - o.x, dy = cr.y - o.y;\nvar dist = Math.sqrt(dx*dx + dy*dy);\nif (o.type === 'prey' && dist < 80) {\no.vx -= (dx / dist) * 0.04 * spd;\no.vy -= (dy / dist) * 0.04 * spd;\n} else if (o.type === 'predator' && dist < 100) {\no.vx += (dx / dist) * 0.03 * spd;\no.vy += (dy / dist) * 0.03 * spd;\n}\no.vx += (Math.random() - 0.5) * 0.1;\no.vy += (Math.random() - 0.5) * 0.1;\no.vx *= 0.96; o.vy *= 0.96;\no.x += o.vx * spd; o.y += o.vy * spd;\nif (o.x < 4 || o.x > 252) o.vx *= -1;\nif (o.y < 4 || o.y > 220) o.vy *= -1;\nif (dist < G.cell.size + o.size + 4) {\nif (o.type === 'prey') {\nG.cell.energy += 12;\nG.pop += 2;\no.x = Math.random() * 256; o.y = Math.random() * 224;\no.hp = 5;\nsnd.pickup();\nfor (var j = 0; j < 5; j++)\nG.particles.push({ x: o.x, y: o.y, vx: (Math.random()-0.5)*3, vy: (Math.random()-0.5)*3, life: 15, c: '#8B4513', s: 2, grav: 0.05 });\n} else {\nG.cell.energy -= (5 - G.cell.armor);\nG.shake = 6;\nsnd.tone(180, 0.06, 0.05, 'sawtooth');\n}\n}\n});\nif (G.cell.energy >= 100) {\nG.cell.energy = 50;\nG.pop += 5;\nsnd.tone(600, 0.05, 0.04);\nif (G.organisms.length < 16) {\nG.organisms.push({\nx: Math.random() * 256, y: Math.random() * 224,\nvx: 0, vy: 0, size: 3 + Math.random() * 3,\ntype: Math.random() < 0.6 ? 'prey' : 'predator',\nhp: 5, energy: 50\n});\n}\n}\nif (G.cell.energy <= 0) { G.over = true; snd.die(); return; }\nif (G.pop >= 100) {\nG.era = 3;\nG.transition = 90;\nG.transMsg = 'ERA 3: TRIBAL';\nG.flash = 40; G.flashC = '#ff8844';\nG.history.push({ era: 3, time: G.time, event: G.tribeName + ' forms tribal society' });\nsnd.win();\nfor (var i = 0; i < 8; i++) {\nG.units.push({\nx: 100 + Math.random() * 56, y: 90 + Math.random() * 44,\nrole: i < 3 ? 'gatherer' : i < 5 ? 'hunter' : i < 7 ? 'builder' : 'scout',\ntx: 128, ty: 112, hp: 10, maxHp: 10, carrying: 0\n});\n}\nfor (var i = 0; i < 4; i++) {\nG.enemies.push({\nx: 200 + Math.random() * 40, y: 30 + Math.random() * 40,\nhp: 8, maxHp: 8, vx: 0, vy: 0, atkCd: 0\n});\n}\nG.cam.tz = 1;\n}\n}\nif (G.era === 3) {\nif (K('b') && G.kcd <= 0) { G.buildMenu = !G.buildMenu; G.selIdx = 0; G.kcd = 15; snd.beep(); }\nif (G.buildMenu) {\nif ((K('w') || K('ArrowUp')) && G.kcd <= 0) { G.selIdx = (G.selIdx + G.buildOpts.length - 1) % G.buildOpts.length; G.kcd = 10; snd.beep(); }\nif ((K('s') || K('ArrowDown')) && G.kcd <= 0) { G.selIdx = (G.selIdx + 1) % G.buildOpts.length; G.kcd = 10; snd.beep(); }\nif ((K(' ') || K('Enter')) && G.kcd <= 0) {\nvar opt = G.buildOpts[G.selIdx];\nvar canBuild = true;\nfor (var rk in opt.cost) { if ((G.res[rk] || 0) < opt.cost[rk]) canBuild = false; }\nif (canBuild) {\nfor (var rk in opt.cost) G.res[rk] -= opt.cost[rk];\nG.buildings.push({ x: 100 + Math.random() * 56, y: 90 + Math.random() * 44, type: opt.name, icon: opt.icon });\nG.buildMenu = false;\nG.kcd = 15;\nsnd.score();\nG.history.push({ era: 3, time: G.time, event: 'Built ' + opt.name });\nif (opt.name === 'Totem') {\nvar avail = G.allTechs.filter(function(t) { return G.techs.indexOf(t) === -1; });\nif (avail.length > 0) {\nvar tech = avail[Math.floor(Math.random() * avail.length)];\nG.techs.push(tech);\nG.history.push({ era: 3, time: G.time, event: 'Discovered: ' + tech });\nG.flash = 25; G.flashC = '#ffaa00';\n}\n}\n} else {\nsnd.tone(100, 0.05, 0.05);\n}\n}\nreturn;\n}\nG.units.forEach(function(u) {\nvar dx = u.tx - u.x, dy = u.ty - u.y;\nvar dist = Math.sqrt(dx*dx + dy*dy);\nif (dist > 2) {\nu.x += (dx / dist) * 1.2 * spd;\nu.y += (dy / dist) * 1.2 * spd;\n}\nif (u.role === 'gatherer' && dist < 5) {\nG.res.food += 0.02 * spd;\nG.res.wood += 0.015 * spd;\nif (Math.random() < 0.005) {\nu.tx = 20 + Math.random() * 216;\nu.ty = 20 + Math.random() * 184;\n}\n}\nif (u.role === 'builder' && dist < 5) {\nG.res.stone += 0.01 * spd;\nG.res.wood += 0.01 * spd;\nif (Math.random() < 0.005) { u.tx = 60 + Math.random() * 136; u.ty = 60 + Math.random() * 104; }\n}\nif (u.role === 'scout') {\nif (Math.random() < 0.01) { u.tx = Math.random() * 256; u.ty = Math.random() * 224; }\nif (Math.random() < 0.0005 * spd) {\nvar avail = G.allTechs.filter(function(t) { return G.techs.indexOf(t) === -1; });\nif (avail.length > 0) {\nvar tech = avail[Math.floor(Math.random() * avail.length)];\nG.techs.push(tech);\nG.history.push({ era: 3, time: G.time, event: 'Scout discovered: ' + tech });\nG.flash = 25; G.flashC = '#ffaa00';\nsnd.score();\n}\n}\n}\nif (u.role === 'hunter') {\nvar nearest = null, nd = 999;\nG.enemies.forEach(function(e) {\nvar d2 = Math.abs(u.x-e.x) + Math.abs(u.y-e.y);\nif (d2 < nd) { nd = d2; nearest = e; }\n});\nif (nearest && nd < 100) {\nu.tx = nearest.x; u.ty = nearest.y;\nif (nd < 10) {\nnearest.hp -= 0.1 * spd;\nif (nearest.hp <= 0) {\nG.res.food += 10;\nnearest.x = 190 + Math.random() * 50; nearest.y = 20 + Math.random() * 50;\nnearest.hp = nearest.maxHp;\nsnd.hit();\n}\n}\n} else {\nif (Math.random() < 0.005) { u.tx = 20 + Math.random() * 216; u.ty = 20 + Math.random() * 184; }\n}\n}\n});\nG.enemies.forEach(function(e) {\ne.vx += (Math.random() - 0.5) * 0.2;\ne.vy += (Math.random() - 0.5) * 0.2;\ne.vx *= 0.95; e.vy *= 0.95;\nif (Math.random() < 0.002) { e.vx += (128 - e.x) * 0.01; e.vy += (112 - e.y) * 0.01; }\ne.x += e.vx * spd; e.y += e.vy * spd;\ne.x = Math.max(4, Math.min(252, e.x)); e.y = Math.max(4, Math.min(220, e.y));\nG.units.forEach(function(u) {\nif (Math.abs(e.x - u.x) + Math.abs(e.y - u.y) < 12) {\nu.hp -= 0.05 * spd;\nif (u.hp <= 0) { u.x = 128; u.y = 112; u.hp = u.maxHp; G.shake = 4; snd.tone(120, 0.06, 0.05); }\n}\n});\n});\nif (K('r') && G.kcd <= 0) {\nvar roles = ['gatherer','hunter','builder','scout'];\nG.selIdx = (G.selIdx + 1) % roles.length;\nvar role = roles[G.selIdx];\nG.units.forEach(function(u) {\nif (u.role === role) { u.tx = mx || 128; u.ty = my || 112; }\n});\nG.kcd = 15;\nsnd.beep();\n}\nif (G.res.food >= 30 && G.units.length < 20) {\nG.res.food -= 30;\nG.units.push({\nx: 128, y: 112,\nrole: ['gatherer','hunter','builder','scout'][Math.floor(Math.random()*4)],\ntx: 100 + Math.random() * 56, ty: 90 + Math.random() * 44,\nhp: 10, maxHp: 10, carrying: 0\n});\n}\nif (G.techs.length >= 5) {\nG.era = 4;\nG.transition = 90;\nG.transMsg = 'ERA 4: CIVILIZATION';\nG.flash = 40; G.flashC = '#daa520';\nG.history.push({ era: 4, time: G.time, event: G.speciesName + ' founds first city' });\nsnd.win();\nvar ch = G.hexes.find(function(h) { return h.hx === 8 && h.hy === 8; });\nif (ch) { ch.owner = 'player'; ch.building = 'city'; }\nG.cities.push({ name: G.genName(2), hx: 8, hy: 8, pop: 100 });\nG.aiCivs.push({ name: G.genName(2), hx: 2, hy: 2, cities: 1 });\nvar ah = G.hexes.find(function(h) { return h.hx === 2 && h.hy === 2; });\nif (ah) { ah.owner = 'ai'; ah.building = 'city'; }\nG.diplomacy['ai0'] = 'neutral';\nG.cam.tz = 0.6;\n}\n}\nif (G.era === 4) {\nif (K('a') || K('ArrowLeft')) G.cam.tx -= 2 * spd;\nif (K('d') || K('ArrowRight')) G.cam.tx += 2 * spd;\nif (K('w') || K('ArrowUp')) G.cam.ty -= 2 * spd;\nif (K('s') || K('ArrowDown')) G.cam.ty += 2 * spd;\nG.cam.tx = Math.max(0, Math.min(256, G.cam.tx));\nG.cam.ty = Math.max(0, Math.min(256, G.cam.ty));\nG.cities.forEach(function(c) {\nG.civRes.food += 0.03 * spd;\nG.civRes.prod += 0.02 * spd;\nG.civRes.gold += 0.01 * spd;\nc.pop += 0.01 * spd;\n});\nif (G.civResearching) {\nG.civRes.science += 0.015 * spd;\nG.civResProgress += 0.015 * spd;\nif (G.civResProgress >= 1) {\nG.civTechs.push(G.civResearching);\nG.history.push({ era: 4, time: G.time, event: 'Researched: ' + G.civResearching });\nG.flash = 25; G.flashC = '#daa520';\nsnd.score();\nif (G.civResearching === 'rocketry') {\nG.era = 5;\nG.transition = 100;\nG.transMsg = 'ERA 5: STELLAR';\nG.flash = 50; G.flashC = '#8844ff';\nG.history.push({ era: 5, time: G.time, event: G.speciesName + ' reaches for the stars' });\nsnd.win();\nG.planets.forEach(function(p) {\nvar compat = 50;\nG.mutations.forEach(function(m) {\nif (m === 'armor' && p.type === 'rocky') compat += 15;\nif (m === 'photosynthesis' && p.type === 'ocean') compat += 20;\nif (m === 'toxin' && p.type === 'volcanic') compat += 15;\nif (m === 'flagella' && p.type === 'gas') compat += 10;\nif (m === 'size' && p.type === 'ice') compat += 10;\n});\np.compatible = Math.min(100, compat);\n});\nG.cam.tz = 1;\n}\nG.civResearching = null;\nG.civResProgress = 0;\n}\n}\nif (K('b') && G.kcd <= 0 && !G.civResearching) {\nG.buildMenu = !G.buildMenu;\nG.selIdx = 0;\nG.kcd = 15;\nsnd.beep();\n}\nif (G.buildMenu && !G.civResearching) {\nvar avail = G.allCivTechs.filter(function(t) { return G.civTechs.indexOf(t) === -1; });\nif ((K('w') || K('ArrowUp')) && G.kcd <= 0) { G.selIdx = (G.selIdx + avail.length - 1) % avail.length; G.kcd = 10; snd.beep(); }\nif ((K('s') || K('ArrowDown')) && G.kcd <= 0) { G.selIdx = (G.selIdx + 1) % avail.length; G.kcd = 10; snd.beep(); }\nif ((K(' ') || K('Enter')) && G.kcd <= 0 && avail.length > 0) {\nG.civResearching = avail[G.selIdx];\nG.civResProgress = 0;\nG.buildMenu = false;\nG.kcd = 15;\nsnd.tone(400, 0.05, 0.04);\nG.history.push({ era: 4, time: G.time, event: 'Began researching: ' + G.civResearching });\n}\nreturn;\n}\nif (K('e') && G.kcd <= 0 && G.civRes.gold >= 10) {\nvar claimed = false;\nfor (var i = 0; i < G.hexes.length && !claimed; i++) {\nvar h = G.hexes[i];\nif (h.owner !== null) continue;\nfor (var j = 0; j < G.hexes.length; j++) {\nvar o = G.hexes[j];\nif (o.owner === 'player' && Math.abs(o.hx - h.hx) <= 1 && Math.abs(o.hy - h.hy) <= 1) {\nh.owner = 'player';\nG.civRes.gold -= 10;\nclaimed = true;\nsnd.pickup();\nbreak;\n}\n}\n}\nG.kcd = 15;\n}\nif (Math.random() < 0.001 * spd) {\nfor (var i = 0; i < G.hexes.length; i++) {\nvar h = G.hexes[i];\nif (h.owner !== null) continue;\nfor (var j = 0; j < G.hexes.length; j++) {\nvar o = G.hexes[j];\nif (o.owner === 'ai' && Math.abs(o.hx - h.hx) <= 1 && Math.abs(o.hy - h.hy) <= 1) {\nh.owner = 'ai'; break;\n}\n}\nif (h.owner === 'ai') break;\n}\n}\n}\nif (G.era === 5) {\nvar sh = G.ship;\nif (K('a') || K('ArrowLeft')) sh.vx -= 0.15;\nif (K('d') || K('ArrowRight')) sh.vx += 0.15;\nif (K('w') || K('ArrowUp')) sh.vy -= 0.15;\nif (K('s') || K('ArrowDown')) sh.vy += 0.15;\nsh.vx *= 0.97; sh.vy *= 0.97;\nsh.x += sh.vx * spd; sh.y += sh.vy * spd;\nsh.x = Math.max(8, Math.min(248, sh.x));\nsh.y = Math.max(8, Math.min(216, sh.y));\nG.planets.forEach(function(p) {\np.angle += p.speed * spd;\np.cx = 128 + Math.cos(p.angle) * p.dist;\np.cy = 112 + Math.sin(p.angle) * p.dist;\nvar dx = sh.x - p.cx, dy = sh.y - p.cy;\nvar dist = Math.sqrt(dx*dx + dy*dy);\nif (dist < p.size + 6 && !p.colonized) {\nif ((K(' ') || K('Enter')) && G.kcd <= 0) {\nif (p.compatible > 40) {\np.colonized = true;\nG.colonies.push(p.name);\nG.history.push({ era: 5, time: G.time, event: 'Colonized ' + p.name });\nG.flash = 20; G.flashC = '#8844ff';\nsnd.score();\nif (p.hasSignal) {\nG.signalFound = true;\nG.history.push({ era: 5, time: G.time, event: 'SIGNAL DETECTED from distant galaxy!' });\n}\n} else {\nsnd.tone(100, 0.08, 0.06);\n}\nG.kcd = 20;\n}\n}\n});\nif (G.signalFound && G.colonies.length >= 3) {\nG.won = true;\nG.history.push({ era: 5, time: G.time, event: G.speciesName + ' achieves galactic contact. Victory!' });\nsnd.win();\n}\n}\nG.cam.x += (G.cam.tx - G.cam.x) * 0.08;\nG.cam.y += (G.cam.ty - G.cam.y) * 0.08;\nG.cam.zoom += (G.cam.tz - G.cam.zoom) * 0.05;\n}\nif (mode === 'draw') {\nvar sx = G.shake > 0 ? (Math.random()-0.5) * G.shake * 2 : 0;\nvar sy = G.shake > 0 ? (Math.random()-0.5) * G.shake * 2 : 0;\nO.save();\nO.translate(sx, sy);\nvar palettes = {\n1: { bg: '#0a1e2e', bg2: '#0d2a3a', accent: '#3ddc84', dim: '#1a4a5a' },\n2: { bg: '#1a2a0a', bg2: '#2a3a1a', accent: '#8B4513', dim: '#3a4a2a' },\n3: { bg: '#2a1a0a', bg2: '#3a2a1a', accent: '#ff8844', dim: '#4a3a2a' },\n4: { bg: '#1a1a0a', bg2: '#2a2a1a', accent: '#daa520', dim: '#3a3a2a' },\n5: { bg: '#0a0a1e', bg2: '#0d0d2a', accent: '#8844ff', dim: '#1a1a3a' }\n};\nvar pal = palettes[G.era];\nif (G.era === 1) {\ncls(pal.bg);\nfor (var i = 0; i < 15; i++) {\nvar wx = (i * 40 + G.time * 8000) % (RW + 60) - 30;\nvar wy = 20 + i * 15;\nO.fillStyle = 'rgba(30,80,100,0.15)';\nO.fillRect(wx, wy, 30, 1);\n}\nG.food.forEach(function(f) {\nO.fillStyle = '#3ddc84';\nO.beginPath(); O.arc(f.x, f.y, f.size, 0, Math.PI*2); O.fill();\nO.fillStyle = 'rgba(61,220,132,0.2)';\nO.beginPath(); O.arc(f.x, f.y, f.size + 2, 0, Math.PI*2); O.fill();\n});\nG.predators.forEach(function(p) {\nO.fillStyle = '#ff4466';\nO.beginPath(); O.arc(p.x, p.y, p.size, 0, Math.PI*2); O.fill();\nO.fillStyle = 'rgba(255,68,102,0.2)';\nO.beginPath(); O.arc(p.x, p.y, p.size + 3, 0, Math.PI*2); O.fill();\nO.fillStyle = '#fff';\nO.fillRect(p.x - 2, p.y - 2, 2, 2);\nO.fillRect(p.x + 1, p.y - 2, 2, 2);\n});\nvar c = G.cell;\nO.fillStyle = 'rgba(0,180,255,0.1)';\nO.beginPath(); O.arc(c.x, c.y, c.size + 8, 0, Math.PI*2); O.fill();\nO.fillStyle = 'rgba(0,200,255,0.2)';\nO.beginPath(); O.arc(c.x, c.y, c.size + 4, 0, Math.PI*2); O.fill();\nO.fillStyle = '#00ccff';\nO.beginPath(); O.arc(c.x, c.y, c.size, 0, Math.PI*2); O.fill();\nO.fillStyle = '#0088cc';\nO.beginPath(); O.arc(c.x + 1, c.y, c.size * 0.4, 0, Math.PI*2); O.fill();\nif (c.flagella > 0) {\nO.strokeStyle = '#00aaff';\nO.lineWidth = 1;\nO.beginPath();\nO.moveTo(c.x - c.size, c.y);\nO.quadraticCurveTo(c.x - c.size - 6, c.y + Math.sin(G.time * 5000) * 4, c.x - c.size - 10, c.y);\nO.stroke();\n}\nif (c.armor > 0) {\nO.strokeStyle = 'rgba(200,200,255,0.5)';\nO.lineWidth = c.armor;\nO.beginPath(); O.arc(c.x, c.y, c.size + 2, 0, Math.PI*2); O.stroke();\n}\nfor (var i = 0; i < Math.min(G.pop - 1, 30); i++) {\nvar a = (i / 30) * Math.PI * 2 + G.time * 1000;\nvar d = 12 + i * 0.5;\nvar cx2 = c.x + Math.cos(a) * d;\nvar cy2 = c.y + Math.sin(a) * d;\nO.fillStyle = 'rgba(0,200,255,0.3)';\nO.beginPath(); O.arc(cx2, cy2, 1.5, 0, Math.PI*2); O.fill();\n}\nrect(0, 0, RW, 14, 'rgba(0,0,0,0.6)');\nrect(4, 3, 60, 6, '#1a3a4a');\nrect(4, 3, Math.floor(60 * c.energy / 100), 6, c.energy > 25 ? '#3ddc84' : '#ff4466');\ntxt('E', 2, 7, 6, '#aaa', 'left');\ntxt('Pop: ' + G.pop, 80, 7, 6, '#00ccff', 'left');\ntxt('Div: ' + G.divCount, 130, 7, 6, '#aaa', 'left');\nvar mutStr = '';\nG.mutations.forEach(function(m) { mutStr += m.charAt(0).toUpperCase(); });\nif (mutStr) txt('M:' + mutStr, RW - 4, 7, 6, '#3ddc84', 'right');\n}\nif (G.era === 2) {\ncls(pal.bg);\nfor (var i = 0; i < 20; i++) {\nO.fillStyle = 'rgba(60,80,30,0.15)';\nO.fillRect((i * 37 + 5) % RW, (i * 23 + 3) % RH, 3, 2);\n}\nG.organisms.forEach(function(o) {\nO.fillStyle = o.type === 'prey' ? '#66aa44' : '#cc4444';\nO.beginPath(); O.arc(o.x, o.y, o.size, 0, Math.PI*2); O.fill();\nO.fillStyle = '#fff';\nO.fillRect(o.x - 1, o.y - 1, 2, 1);\nO.fillRect(o.x + 1, o.y - 1, 2, 1);\n});\nvar cr = G.creature;\nvar blobSize = G.cell.size + 4;\nO.fillStyle = 'rgba(100,200,100,0.15)';\nO.beginPath(); O.arc(cr.x, cr.y, blobSize + 6, 0, Math.PI*2); O.fill();\nO.fillStyle = '#44aa66';\nO.beginPath(); O.arc(cr.x, cr.y, blobSize, 0, Math.PI*2); O.fill();\nO.fillStyle = '#338855';\nO.beginPath(); O.arc(cr.x - 2, cr.y + 2, blobSize * 0.6, 0, Math.PI*2); O.fill();\nO.fillStyle = '#fff';\nO.fillRect(cr.x - 3, cr.y - 3, 3, 2);\nO.fillRect(cr.x + 1, cr.y - 3, 3, 2);\nO.fillStyle = '#000';\nO.fillRect(cr.x - 2, cr.y - 3, 1, 1);\nO.fillRect(cr.x + 2, cr.y - 3, 1, 1);\nrect(0, 0, RW, 14, 'rgba(0,0,0,0.6)');\nrect(4, 3, 50, 3, '#1a3a1a');\nrect(4, 3, Math.floor(50 * G.cell.energy / 100), 3, '#3ddc84');\nrect(4, 8, 50, 3, '#1a1a3a');\nrect(4, 8, Math.floor(50 * G.creature.stamina / G.creature.maxSt), 3, '#4488ff');\ntxt('Pop: ' + G.pop, 70, 7, 6, '#aaa', 'left');\ntxt('F=Sprint', RW - 4, 7, 6, '#888', 'right');\n}\nif (G.era === 3) {\ncls(pal.bg);\nfor (var i = 0; i < 30; i++) {\nO.fillStyle = i % 3 === 0 ? 'rgba(80,60,30,0.2)' : 'rgba(50,80,30,0.15)';\nO.fillRect((i * 41 + 7) % RW, (i * 31 + 11) % RH, 4, 3);\n}\nG.buildings.forEach(function(b) {\nif (b.type === 'Hut') { O.fillStyle = '#8B6914'; rect(b.x-5, b.y-6, 10, 10, '#8B6914'); O.fillStyle='#654'; O.fillRect(b.x-6,b.y-8,12,3); }\nelse if (b.type === 'Fire Pit') { O.fillStyle = '#ff6600'; O.fillRect(b.x-2,b.y-2,4,4); O.fillStyle='#ff3300'; O.fillRect(b.x-1,b.y-4,2,3); }\nelse if (b.type === 'Totem') { O.fillStyle = '#aaa'; O.fillRect(b.x-1,b.y-8,3,12); O.fillStyle='#daa520'; O.fillRect(b.x-3,b.y-9,7,3); }\nelse if (b.type === 'Wall') { O.fillStyle = '#888'; O.fillRect(b.x-6,b.y-1,12,3); }\ntxt(b.icon, b.x, b.y - 12, 6, '#ddd');\n});\nG.units.forEach(function(u) {\nvar rc = u.role === 'gatherer' ? '#44aa44' : u.role === 'hunter' ? '#cc4444' : u.role === 'builder' ? '#aa8844' : '#4488cc';\nO.fillStyle = rc;\nO.fillRect(u.x - 3, u.y - 4, 6, 8);\nO.fillStyle = '#ffccaa';\nO.fillRect(u.x - 2, u.y - 7, 4, 4);\nif (u.hp < u.maxHp) {\nrect(u.x - 4, u.y - 10, 8, 2, '#333');\nrect(u.x - 4, u.y - 10, Math.floor(8 * u.hp / u.maxHp), 2, '#44ff44');\n}\n});\nG.enemies.forEach(function(e) {\nO.fillStyle = '#882222';\nO.fillRect(e.x - 3, e.y - 4, 6, 8);\nO.fillStyle = '#cc8888';\nO.fillRect(e.x - 2, e.y - 7, 4, 4);\nrect(e.x - 4, e.y - 10, 8, 2, '#333');\nrect(e.x - 4, e.y - 10, Math.floor(8 * e.hp / e.maxHp), 2, '#ff4444');\n});\nrect(0, 0, RW, 14, 'rgba(0,0,0,0.6)');\ntxt('F:' + Math.floor(G.res.food), 8, 7, 6, '#44aa44', 'left');\ntxt('W:' + Math.floor(G.res.wood), 55, 7, 6, '#8B6914', 'left');\ntxt('S:' + Math.floor(G.res.stone), 100, 7, 6, '#888', 'left');\ntxt('Tech:' + G.techs.length + '/5', 145, 7, 6, '#ffaa00', 'left');\ntxt('Units:' + G.units.length, 195, 7, 6, '#aaa', 'left');\ntxt('B=Build R=Roles', RW / 2, RH - 6, 6, '#888');\nif (G.buildMenu) {\nrect(60, 40, 136, 100, 'rgba(0,0,0,0.85)');\nO.strokeStyle = '#ff8844'; O.strokeRect(60, 40, 136, 100);\ntxt('BUILD', 128, 50, 8, '#ff8844');\nG.buildOpts.forEach(function(opt, i) {\nvar y = 66 + i * 18;\nvar sel = i === G.selIdx;\nvar costStr = '';\nfor (var rk in opt.cost) costStr += rk.charAt(0).toUpperCase() + ':' + opt.cost[rk] + ' ';\ntxt((sel ? '> ' : '  ') + opt.icon + ' ' + opt.name, 90, y, 7, sel ? '#ffcc00' : '#aaa', 'left');\ntxt(costStr, 200, y, 6, '#888', 'right');\n});\n}\nif (G.techs.length > 0) {\nrect(0, RH - 14, RW, 14, 'rgba(0,0,0,0.5)');\ntxt('Techs: ' + G.techs.join(', '), RW/2, RH - 7, 6, '#ffaa00');\n}\n}\nif (G.era === 4) {\ncls(pal.bg);\nvar ox = G.cam.x - 128, oy = G.cam.y - 112;\nG.hexes.forEach(function(h) {\nvar px = h.hx * G.hexW - ox;\nvar py = h.hy * G.hexH + (h.hx % 2 ? G.hexH/2 : 0) - oy;\nif (px < -20 || px > RW + 20 || py < -20 || py > RH + 20) return;\nvar tc = { water: '#1a3a5a', forest: '#1a4a1a', mountain: '#4a4a4a', desert: '#5a4a2a', plains: '#3a4a2a' };\nO.fillStyle = tc[h.terrain] || '#2a2a2a';\nO.fillRect(px, py, G.hexW - 1, G.hexH - 1);\nif (h.owner === 'player') { O.fillStyle = 'rgba(218,165,32,0.25)'; O.fillRect(px, py, G.hexW-1, G.hexH-1); }\nif (h.owner === 'ai') { O.fillStyle = 'rgba(255,68,68,0.2)'; O.fillRect(px, py, G.hexW-1, G.hexH-1); }\nif (h.building === 'city') { txt('âŒ‚', px + G.hexW/2, py + G.hexH/2, 8, h.owner === 'player' ? '#daa520' : '#ff4466'); }\nif (h.resource) { txt(h.resource === 'iron' ? 'â›' : 'â—†', px + G.hexW/2, py + G.hexH/2 + 4, 5, '#aaa'); }\n});\nrect(0, 0, RW, 20, 'rgba(0,0,0,0.7)');\ntxt('F:' + Math.floor(G.civRes.food), 10, 7, 6, '#44aa44', 'left');\ntxt('P:' + Math.floor(G.civRes.prod), 50, 7, 6, '#aa8844', 'left');\ntxt('G:' + Math.floor(G.civRes.gold), 90, 7, 6, '#daa520', 'left');\ntxt('S:' + Math.floor(G.civRes.science), 130, 7, 6, '#4488ff', 'left');\nif (G.civResearching) {\ntxt('Researching: ' + G.civResearching, RW/2, 15, 6, '#daa520');\nrect(170, 2, 50, 4, '#333');\nrect(170, 2, Math.floor(50 * G.civResProgress), 4, '#daa520');\n} else {\ntxt('B=Research', RW - 4, 7, 6, '#888', 'right');\n}\ntxt('E=Expand(10g) WASD=Scroll', RW/2, RH - 6, 6, '#888');\nif (G.buildMenu && !G.civResearching) {\nvar avail = G.allCivTechs.filter(function(t) { return G.civTechs.indexOf(t) === -1; });\nrect(50, 30, 156, 20 + avail.length * 16, 'rgba(0,0,0,0.9)');\nO.strokeStyle = '#daa520'; O.strokeRect(50, 30, 156, 20 + avail.length * 16);\ntxt('RESEARCH', 128, 40, 8, '#daa520');\navail.forEach(function(t, i) {\nvar y = 56 + i * 16;\nvar sel = i === G.selIdx;\nvar done = G.civTechs.indexOf(t) >= 0;\ntxt((sel ? '> ' : '  ') + t, 75, y, 7, sel ? '#ffcc00' : done ? '#666' : '#aaa', 'left');\n});\n}\nif (G.civTechs.length > 0) {\nrect(0, RH - 14, RW, 14, 'rgba(0,0,0,0.5)');\ntxt(G.civTechs.join(' â†’ '), RW/2, RH - 7, 6, '#daa520');\n}\n}\nif (G.era === 5) {\ncls(pal.bg);\nG.stars.forEach(function(s) {\nO.fillStyle = 'rgba(255,255,255,' + (s.b * 0.6) + ')';\nO.fillRect(s.x, s.y, s.b > 0.7 ? 2 : 1, s.b > 0.7 ? 2 : 1);\n});\nO.fillStyle = '#ffcc00';\nO.beginPath(); O.arc(128, 112, 8, 0, Math.PI*2); O.fill();\nO.fillStyle = 'rgba(255,200,0,0.15)';\nO.beginPath(); O.arc(128, 112, 14, 0, Math.PI*2); O.fill();\nG.planets.forEach(function(p) {\nO.strokeStyle = 'rgba(255,255,255,0.05)';\nO.beginPath(); O.arc(128, 112, p.dist, 0, Math.PI*2); O.stroke();\nvar px = p.cx || 128, py = p.cy || 112;\nvar tc = { rocky: '#aa8866', gas: '#cc8844', ice: '#88ccff', volcanic: '#ff6644', ocean: '#4488cc' };\nO.fillStyle = tc[p.type] || '#aaa';\nO.beginPath(); O.arc(px, py, p.size, 0, Math.PI*2); O.fill();\nif (p.colonized) {\nO.strokeStyle = '#3ddc84'; O.lineWidth = 1;\nO.beginPath(); O.arc(px, py, p.size + 3, 0, Math.PI*2); O.stroke();\ntxt('âœ“', px, py - p.size - 4, 5, '#3ddc84');\n}\nif (p.hasSignal && !G.signalFound) {\nO.strokeStyle = 'rgba(136,68,255,' + (0.3 + Math.sin(G.time * 10000) * 0.3) + ')';\nO.lineWidth = 1;\nO.beginPath(); O.arc(px, py, p.size + 6 + Math.sin(G.time * 5000) * 3, 0, Math.PI*2); O.stroke();\n}\nvar dx = G.ship.x - px, dy = G.ship.y - py;\nif (Math.sqrt(dx*dx+dy*dy) < p.size + 20) {\ntxt(p.name, px, py + p.size + 8, 5, '#ccc');\ntxt(p.type + ' ' + p.compatible + '%', px, py + p.size + 15, 5, p.compatible > 60 ? '#3ddc84' : p.compatible > 40 ? '#ffaa00' : '#ff4466');\n}\n});\nvar sh = G.ship;\nO.fillStyle = '#aaddff';\nO.beginPath();\nO.moveTo(sh.x, sh.y - 5);\nO.lineTo(sh.x - 4, sh.y + 4);\nO.lineTo(sh.x + 4, sh.y + 4);\nO.fill();\nO.fillStyle = 'rgba(100,200,255,0.3)';\nO.beginPath(); O.arc(sh.x, sh.y + 5, 3, 0, Math.PI*2); O.fill();\nrect(0, 0, RW, 14, 'rgba(0,0,0,0.6)');\ntxt('Colonies: ' + G.colonies.length + '/' + G.planets.length, 10, 7, 6, '#8844ff', 'left');\nif (G.signalFound) txt('SIGNAL FOUND!', RW/2, 7, 7, '#ff44ff');\ntxt('Space=Colonize', RW - 4, 7, 6, '#888', 'right');\n}\nG.particles.forEach(function(p) {\nO.fillStyle = p.c || '#fff';\nO.fillRect(p.x - (p.s||1)/2, p.y - (p.s||1)/2, p.s || 1, p.s || 1);\n});\nif (G.flash > 0) {\nO.fillStyle = G.flashC + Math.floor(G.flash * 4).toString(16).padStart(2,'0');\nO.fillRect(0, 0, RW, RH);\n}\nif (G.transition > 0) {\nvar alpha = Math.min(1, G.transition / 30);\nO.fillStyle = 'rgba(0,0,0,' + (alpha * 0.85) + ')';\nO.fillRect(0, 0, RW, RH);\nvar tAlpha = G.transition > 60 ? (90 - G.transition) / 30 : G.transition > 30 ? 1 : G.transition / 30;\ntxt(G.transMsg, RW/2, RH/2 - 10, 14, 'rgba(255,255,255,' + tAlpha + ')');\nvar eraYear = G.time * 4;\ntxt(eraYear.toFixed(1) + ' billion years', RW/2, RH/2 + 10, 8, 'rgba(200,200,200,' + tAlpha * 0.7 + ')');\n}\nif (G.mutChoice) {\nO.fillStyle = 'rgba(0,0,0,0.8)';\nO.fillRect(0, 0, RW, RH);\ntxt('MUTATION', RW/2, 50, 12, '#3ddc84');\ntxt('Choose an adaptation:', RW/2, 65, 7, '#aaa');\nfor (var i = 0; i < 2; i++) {\nvar m = G.mutChoice[i];\nvar y = 90 + i * 40;\nvar sel = i === G.selIdx;\nrect(50, y - 12, 156, 30, sel ? 'rgba(61,220,132,0.2)' : 'rgba(50,50,80,0.5)');\nif (sel) { O.strokeStyle = '#3ddc84'; O.strokeRect(50, y - 12, 156, 30); }\ntxt(m.icon + ' ' + m.name, 90, y - 2, 9, sel ? '#3ddc84' : '#aaa', 'left');\ntxt(m.desc, 90, y + 10, 6, '#888', 'left');\n}\ntxt('W/S + Enter', RW/2, 175, 6, '#666');\n}\nif (!G.mutChoice && G.transition <= 0) {\nrect(0, RH - 3, RW, 3, '#111');\nvar progress = Math.min(1, G.era / 5);\nvar barC = pal.accent;\nrect(0, RH - 3, Math.floor(RW * progress), 3, barC);\nfor (var e = 1; e <= 5; e++) {\nvar ex = Math.floor((e / 5) * RW);\nO.fillStyle = G.era >= e ? barC : '#333';\nO.fillRect(ex - 1, RH - 4, 2, 5);\n}\n}\nif (G.showStats) {\nrect(20, 20, 216, 150, 'rgba(0,0,0,0.9)');\nO.strokeStyle = pal.accent; O.strokeRect(20, 20, 216, 150);\ntxt(G.speciesName, 128, 32, 10, pal.accent);\ntxt('Era ' + G.era + ' | Pop: ' + G.pop, 128, 46, 7, '#aaa');\ntxt('Time: ' + (G.time * 4).toFixed(2) + ' Byr', 128, 58, 7, '#888');\ntxt('Mutations: ' + G.mutations.join(', '), 128, 70, 6, '#3ddc84');\ntxt('Speed: ' + G.speed + 'x', 128, 82, 7, '#888');\nvar startY = 96;\nvar recent = G.history.slice(-6);\nrecent.forEach(function(h, i) {\ntxt(h.event, 128, startY + i * 10, 5, '#777');\n});\ntxt('Tab=Close | 1-4=Speed', 128, 164, 6, '#555');\n}\nif (G.over) {\nO.fillStyle = 'rgba(0,0,0,0.7)';\nO.fillRect(0, 0, RW, RH);\ntxt('EXTINCTION', RW/2, RH/2 - 15, 16, '#ff4466');\ntxt(G.speciesName + ' perished', RW/2, RH/2 + 5, 8, '#aaa');\ntxt('Era ' + G.era + ' | ' + (G.time * 4).toFixed(1) + ' Byr', RW/2, RH/2 + 20, 7, '#888');\n}\nif (G.won) {\nO.fillStyle = 'rgba(0,0,0,0.75)';\nO.fillRect(0, 0, RW, RH);\ntxt('GALACTIC CONTACT', RW/2, 30, 14, '#8844ff');\ntxt(G.speciesName + ' has reached the stars', RW/2, 48, 7, '#ccc');\ntxt('â”â”â” EVOLUTIONARY TIMELINE â”â”â”', RW/2, 65, 6, '#888');\nvar hy = 78;\nG.history.forEach(function(h, i) {\nif (i > 12) return;\ntxt('Era ' + h.era + ': ' + h.event, RW/2, hy + i * 10, 5, '#aaa');\n});\nif (G.history.length > 13) txt('... and ' + (G.history.length - 13) + ' more events', RW/2, hy + 130, 5, '#666');\ntxt('Mutations: ' + G.mutations.join(' â†’ '), RW/2, RH - 20, 6, '#3ddc84');\n}\nO.restore();\nvar eraNames = { 1: 'Primordial', 2: 'Organism', 3: 'Tribal', 4: 'Civilization', 5: 'Stellar' };\nhud(G.speciesName + ' | Era ' + G.era + ': ' + eraNames[G.era] + ' | ' + (G.time * 4).toFixed(1) + ' Byr | Pop: ' + G.pop + ' | ' + G.speed + 'x');\ncontrols('WASD Move Â· Tab Stats Â· 1-4 Speed Â· B Build Â· Space/Enter Action');\n}"
    }
  ]
}