<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Interactive tutorial teaching localStorage API with live code examples, exercises, and visual localStorage inspector">
    <title>LocalStorage Academy Tutorial</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --accent: #3b82f6;
            --accent-hover: #2563eb;
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
            --code-bg: #1e1e1e;
            --border: #475569;
            --shadow: rgba(0, 0, 0, 0.4);
        }

        [data-theme="light"] {
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-tertiary: #e2e8f0;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --accent: #2563eb;
            --accent-hover: #1d4ed8;
            --success: #059669;
            --error: #dc2626;
            --warning: #d97706;
            --code-bg: #f1f5f9;
            --border: #cbd5e0;
            --shadow: rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow: hidden;
            height: 100vh;
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        header {
            background: var(--bg-secondary);
            padding: 1rem 1.5rem;
            border-bottom: 2px solid var(--border);
            box-shadow: 0 2px 10px var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        h1 {
            font-size: 1.5rem;
            font-weight: 600;
            background: linear-gradient(135deg, var(--accent), var(--success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .progress-bar {
            width: 200px;
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--success));
            transition: width 0.3s;
            box-shadow: 0 0 10px var(--accent);
        }

        .progress-text {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .controls {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        button {
            padding: 0.5rem 1rem;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        button:hover {
            background: var(--accent-hover);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px var(--shadow);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .secondary-btn {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .secondary-btn:hover {
            background: var(--bg-secondary);
        }

        .main-layout {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .sidebar {
            width: 250px;
            background: var(--bg-secondary);
            border-right: 2px solid var(--border);
            overflow-y: auto;
            padding: 1rem;
        }

        .lesson-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .lesson-item {
            padding: 0.75rem 1rem;
            background: var(--bg-tertiary);
            border: 2px solid transparent;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .lesson-item:hover {
            border-color: var(--accent);
            transform: translateX(4px);
        }

        .lesson-item.active {
            background: var(--accent);
            color: white;
            font-weight: 600;
        }

        .lesson-item.completed::before {
            content: '‚úì';
            color: var(--success);
            font-weight: bold;
        }

        .lesson-number {
            font-weight: 600;
            opacity: 0.7;
        }

        .content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .lesson-content {
            flex: 1;
            overflow-y: auto;
            padding: 2rem;
        }

        .lesson-header {
            margin-bottom: 2rem;
        }

        .lesson-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--accent);
        }

        .lesson-subtitle {
            font-size: 1.1rem;
            color: var(--text-secondary);
        }

        .section {
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .theory-box {
            background: var(--bg-secondary);
            border-left: 4px solid var(--accent);
            padding: 1.5rem;
            border-radius: 6px;
            margin-bottom: 1.5rem;
        }

        .code-editor {
            background: var(--code-bg);
            border: 1px solid var(--border);
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .editor-header {
            background: var(--bg-tertiary);
            padding: 0.5rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
        }

        .editor-title {
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-weight: 600;
        }

        textarea.code {
            width: 100%;
            background: var(--code-bg);
            color: var(--text-primary);
            border: none;
            padding: 1rem;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
            resize: vertical;
            min-height: 150px;
            line-height: 1.6;
        }

        textarea.code:focus {
            outline: none;
        }

        .output-box {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 1rem;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
            min-height: 100px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .output-box.error {
            background: rgba(239, 68, 68, 0.1);
            border-color: var(--error);
            color: var(--error);
        }

        .exercise-box {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(16, 185, 129, 0.1));
            border: 2px solid var(--accent);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .exercise-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--accent);
        }

        .quiz-box {
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .quiz-question {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .quiz-option {
            padding: 1rem;
            background: var(--bg-tertiary);
            border: 2px solid transparent;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quiz-option:hover {
            border-color: var(--accent);
        }

        .quiz-option.correct {
            background: rgba(16, 185, 129, 0.2);
            border-color: var(--success);
        }

        .quiz-option.incorrect {
            background: rgba(239, 68, 68, 0.2);
            border-color: var(--error);
        }

        .inspector-panel {
            background: var(--bg-secondary);
            border-top: 2px solid var(--border);
            padding: 1rem;
            max-height: 250px;
            overflow-y: auto;
        }

        .inspector-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .inspector-title {
            font-weight: 600;
            font-size: 1rem;
        }

        .storage-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        .storage-table th {
            background: var(--bg-tertiary);
            padding: 0.5rem;
            text-align: left;
            border: 1px solid var(--border);
            font-weight: 600;
        }

        .storage-table td {
            padding: 0.5rem;
            border: 1px solid var(--border);
            font-family: 'Consolas', 'Monaco', monospace;
        }

        .storage-table tr:hover {
            background: var(--bg-tertiary);
        }

        .empty-state {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            padding: 1.5rem 2rem;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border);
        }

        .success-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--success);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-weight: 600;
            animation: bounceIn 0.5s;
        }

        @keyframes bounceIn {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }

        .hint-box {
            background: rgba(245, 158, 11, 0.1);
            border-left: 4px solid var(--warning);
            padding: 1rem;
            border-radius: 6px;
            margin-top: 1rem;
        }

        .code-inline {
            background: var(--code-bg);
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
            border: 1px solid var(--border);
        }

        kbd {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 3px;
            padding: 0.1rem 0.4rem;
            font-family: monospace;
            font-size: 0.85rem;
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 2px solid var(--border);
            }

            .main-layout {
                flex-direction: column;
            }

            .lesson-content {
                padding: 1rem;
            }

            .nav-buttons {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-left">
                <h1>üìö LocalStorage Academy</h1>
                <div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-text" id="progressText">0% Complete</div>
                </div>
            </div>
            <div class="controls">
                <button id="resetBtn" class="secondary-btn">
                    <span>üîÑ</span> Reset Progress
                </button>
                <button id="inspectorBtn" class="secondary-btn">
                    <span>üîç</span> <span id="inspectorText">Show</span> Inspector
                </button>
                <button id="themeBtn" class="secondary-btn">
                    <span id="themeIcon">üåô</span>
                </button>
            </div>
        </header>

        <div class="main-layout">
            <aside class="sidebar">
                <div class="lesson-list" id="lessonList"></div>
            </aside>

            <div class="content-area">
                <div class="lesson-content" id="lessonContent"></div>

                <div class="inspector-panel" id="inspectorPanel" style="display: none;">
                    <div class="inspector-header">
                        <h3 class="inspector-title">üîç LocalStorage Inspector</h3>
                        <button id="refreshInspector" class="secondary-btn">Refresh</button>
                    </div>
                    <div id="inspectorContent"></div>
                </div>

                <div class="nav-buttons">
                    <button id="prevBtn" class="secondary-btn">
                        ‚Üê Previous Lesson
                    </button>
                    <button id="nextBtn">
                        Next Lesson ‚Üí
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Lesson data structure
        const lessons = [
            {
                id: 1,
                title: 'Introduction to LocalStorage',
                subtitle: 'Understanding browser storage and its capabilities',
                theory: `
                    <p><strong>What is localStorage?</strong></p>
                    <p>LocalStorage is a web storage API that allows you to store data locally in the user's browser. Unlike cookies, this data:</p>
                    <ul>
                        <li>Never expires (persists even after closing the browser)</li>
                        <li>Has a much larger storage limit (typically 5-10MB)</li>
                        <li>Is not sent to the server with every request</li>
                        <li>Is accessible only by the same origin (domain + protocol + port)</li>
                    </ul>
                    <p><strong>When to use localStorage:</strong></p>
                    <ul>
                        <li>Saving user preferences (theme, language, settings)</li>
                        <li>Caching data for offline functionality</li>
                        <li>Storing form data to prevent loss on refresh</li>
                        <li>Keeping shopping cart data</li>
                        <li>Tracking user progress in games or tutorials</li>
                    </ul>
                    <p><strong>Important limitations:</strong></p>
                    <ul>
                        <li>Only stores strings (objects must be serialized)</li>
                        <li>Synchronous operations (can block UI for large data)</li>
                        <li>Accessible via JavaScript (not secure for sensitive data)</li>
                        <li>Can be cleared by users</li>
                    </ul>
                `,
                codeExample: `// Check if localStorage is available
if (typeof(Storage) !== "undefined") {
    console.log("localStorage is supported!");
} else {
    console.log("localStorage is NOT supported");
}

// Get the storage quota info
if (navigator.storage && navigator.storage.estimate) {
    navigator.storage.estimate().then(estimate => {
        console.log(\`Used: \${estimate.usage} bytes\`);
        console.log(\`Quota: \${estimate.quota} bytes\`);
    });
}`,
                exercise: {
                    title: 'Try It Yourself',
                    instructions: 'Run the code to check if your browser supports localStorage and see the storage quota.',
                    starterCode: `// Your turn! Check localStorage support
if (typeof(Storage) !== "undefined") {
    console.log("‚úì localStorage is available");
    console.log("Let's start learning!");
} else {
    console.log("‚úó localStorage not supported");
}`
                },
                quiz: {
                    question: 'What is the main advantage of localStorage over cookies?',
                    options: [
                        'localStorage data never expires and has larger storage capacity',
                        'localStorage is faster than cookies',
                        'localStorage works in all browsers',
                        'localStorage can store images directly'
                    ],
                    correct: 0
                }
            },
            {
                id: 2,
                title: 'Storing Simple Data',
                subtitle: 'Using setItem() and getItem() methods',
                theory: `
                    <p><strong>Basic Operations:</strong></p>
                    <p>The localStorage API provides simple methods to store and retrieve data:</p>
                    <ul>
                        <li><code class="code-inline">localStorage.setItem(key, value)</code> - Stores a value</li>
                        <li><code class="code-inline">localStorage.getItem(key)</code> - Retrieves a value</li>
                    </ul>
                    <p><strong>Important notes:</strong></p>
                    <ul>
                        <li>Both key and value must be strings</li>
                        <li>Non-string values are automatically converted to strings</li>
                        <li>Keys are case-sensitive</li>
                        <li>Existing keys are overwritten when you use setItem() again</li>
                    </ul>
                    <p><strong>Alternative syntax:</strong></p>
                    <ul>
                        <li><code class="code-inline">localStorage.key = value</code> (setter)</li>
                        <li><code class="code-inline">localStorage.key</code> (getter)</li>
                        <li><code class="code-inline">localStorage['key']</code> (bracket notation)</li>
                    </ul>
                `,
                codeExample: `// Storing data
localStorage.setItem('username', 'Alice');
localStorage.setItem('favoriteColor', 'blue');
localStorage.setItem('loginCount', '5');

// Retrieving data
const username = localStorage.getItem('username');
const color = localStorage.getItem('favoriteColor');
const count = localStorage.getItem('loginCount');

console.log('Username:', username);
console.log('Color:', color);
console.log('Login count:', count);

// Alternative syntax
localStorage.theme = 'dark';
console.log('Theme:', localStorage.theme);`,
                exercise: {
                    title: 'Store Your Information',
                    instructions: 'Use setItem() to store your name, age, and favorite hobby. Then retrieve and log them.',
                    starterCode: `// Store your information
localStorage.setItem('myName', 'Your Name');
// Add age and hobby here

// Retrieve and display
const name = localStorage.getItem('myName');
// Retrieve age and hobby
console.log('Name:', name);
// Log age and hobby`
                },
                quiz: {
                    question: 'Which method is used to retrieve data from localStorage?',
                    options: [
                        'localStorage.getData(key)',
                        'localStorage.getItem(key)',
                        'localStorage.retrieve(key)',
                        'localStorage.fetch(key)'
                    ],
                    correct: 1
                }
            },
            {
                id: 3,
                title: 'Removing and Clearing Data',
                subtitle: 'Managing localStorage content',
                theory: `
                    <p><strong>Removal Methods:</strong></p>
                    <ul>
                        <li><code class="code-inline">localStorage.removeItem(key)</code> - Removes a specific item</li>
                        <li><code class="code-inline">localStorage.clear()</code> - Removes all items</li>
                        <li><code class="code-inline">delete localStorage.key</code> - Alternative removal syntax</li>
                    </ul>
                    <p><strong>Checking for existence:</strong></p>
                    <ul>
                        <li><code class="code-inline">localStorage.getItem(key) === null</code> - Returns null if key doesn't exist</li>
                        <li><code class="code-inline">localStorage.hasOwnProperty(key)</code> - Check if key exists</li>
                        <li><code class="code-inline">localStorage.length</code> - Number of items stored</li>
                        <li><code class="code-inline">localStorage.key(index)</code> - Get key name by index</li>
                    </ul>
                    <p><strong>Best Practices:</strong></p>
                    <ul>
                        <li>Always check if a key exists before using its value</li>
                        <li>Use removeItem() instead of setting to null or empty string</li>
                        <li>Be careful with clear() - it removes ALL localStorage data</li>
                        <li>Consider namespacing your keys (e.g., 'myApp_username')</li>
                    </ul>
                `,
                codeExample: `// Add some data
localStorage.setItem('temp1', 'temporary data');
localStorage.setItem('temp2', 'another temp');
localStorage.setItem('important', 'keep this');

console.log('Items:', localStorage.length);

// Remove a specific item
localStorage.removeItem('temp1');
console.log('After removing temp1:', localStorage.length);

// Check if item exists
if (localStorage.getItem('temp1') === null) {
    console.log('temp1 was removed');
}

// Iterate through all keys
for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    console.log(key + ':', localStorage.getItem(key));
}

// Clear all (use with caution!)
// localStorage.clear();`,
                exercise: {
                    title: 'Data Management Practice',
                    instructions: 'Store 3 items, remove one, check if it exists, then log the remaining count.',
                    starterCode: `// Store 3 items
localStorage.setItem('item1', 'value1');
// Add item2 and item3

// Remove item2
// Write your code here

// Check if item2 exists
// Write your code here

// Log the total count
console.log('Total items:', localStorage.length);`
                },
                quiz: {
                    question: 'What does localStorage.clear() do?',
                    options: [
                        'Removes the most recent item',
                        'Removes all items from localStorage',
                        'Clears the browser cache',
                        'Resets localStorage to default values'
                    ],
                    correct: 1
                }
            },
            {
                id: 4,
                title: 'Storing Complex Objects',
                subtitle: 'Using JSON.stringify() and JSON.parse()',
                theory: `
                    <p><strong>The Problem:</strong></p>
                    <p>LocalStorage can only store strings. If you try to store an object directly, it will be converted to "[object Object]".</p>
                    <p><strong>The Solution:</strong></p>
                    <ul>
                        <li><code class="code-inline">JSON.stringify(object)</code> - Converts object to JSON string</li>
                        <li><code class="code-inline">JSON.parse(string)</code> - Converts JSON string back to object</li>
                    </ul>
                    <p><strong>What can be serialized:</strong></p>
                    <ul>
                        <li>Objects and arrays</li>
                        <li>Strings, numbers, booleans, null</li>
                        <li>Nested structures</li>
                    </ul>
                    <p><strong>What cannot be serialized:</strong></p>
                    <ul>
                        <li>Functions</li>
                        <li>undefined values</li>
                        <li>Symbols</li>
                        <li>Circular references</li>
                    </ul>
                    <p><strong>Best Practices:</strong></p>
                    <ul>
                        <li>Always use try-catch when parsing JSON</li>
                        <li>Validate data structure after parsing</li>
                        <li>Consider data size (stringify increases size)</li>
                        <li>Use pretty print for debugging: JSON.stringify(obj, null, 2)</li>
                    </ul>
                `,
                codeExample: `// Store an object
const user = {
    name: 'Alice',
    age: 30,
    preferences: {
        theme: 'dark',
        notifications: true
    },
    hobbies: ['reading', 'coding', 'gaming']
};

// Convert to JSON and store
localStorage.setItem('user', JSON.stringify(user));

// Retrieve and parse
const storedUser = localStorage.getItem('user');
const parsedUser = JSON.parse(storedUser);

console.log('User object:', parsedUser);
console.log('Name:', parsedUser.name);
console.log('Theme:', parsedUser.preferences.theme);
console.log('Hobbies:', parsedUser.hobbies);

// Store an array
const todos = [
    { id: 1, text: 'Learn localStorage', done: true },
    { id: 2, text: 'Build an app', done: false }
];
localStorage.setItem('todos', JSON.stringify(todos));`,
                exercise: {
                    title: 'Store and Retrieve an Object',
                    instructions: 'Create an object with your information, store it, then retrieve and log specific properties.',
                    starterCode: `// Create your profile object
const profile = {
    name: 'Your Name',
    // Add: age, city, skills (array)
};

// Store it
localStorage.setItem('profile', JSON.stringify(profile));

// Retrieve and parse
const saved = localStorage.getItem('profile');
const myProfile = JSON.parse(saved);

// Log specific properties
console.log('Profile:', myProfile);`
                },
                quiz: {
                    question: 'Why do we need JSON.stringify() when storing objects?',
                    options: [
                        'To make the data more secure',
                        'Because localStorage only stores strings',
                        'To compress the data',
                        'To make the data readable'
                    ],
                    correct: 1
                }
            },
            {
                id: 5,
                title: 'Storage Events',
                subtitle: 'Cross-tab communication and synchronization',
                theory: `
                    <p><strong>Storage Events:</strong></p>
                    <p>When localStorage is modified in one tab, other tabs from the same origin can detect the change via storage events.</p>
                    <p><strong>Event Properties:</strong></p>
                    <ul>
                        <li><code class="code-inline">event.key</code> - The key that was changed</li>
                        <li><code class="code-inline">event.oldValue</code> - The old value (null if new key)</li>
                        <li><code class="code-inline">event.newValue</code> - The new value (null if removed)</li>
                        <li><code class="code-inline">event.url</code> - The URL where change occurred</li>
                        <li><code class="code-inline">event.storageArea</code> - Reference to localStorage</li>
                    </ul>
                    <p><strong>Important Notes:</strong></p>
                    <ul>
                        <li>Events fire in OTHER tabs, not the tab that made the change</li>
                        <li>Only works for same-origin pages</li>
                        <li>Useful for synchronizing state across tabs</li>
                        <li>Can be used for cross-tab messaging</li>
                    </ul>
                    <p><strong>Use Cases:</strong></p>
                    <ul>
                        <li>Sync theme changes across tabs</li>
                        <li>Logout from all tabs simultaneously</li>
                        <li>Share shopping cart updates</li>
                        <li>Real-time notifications</li>
                    </ul>
                `,
                codeExample: `// Listen for storage events
window.addEventListener('storage', (event) => {
    console.log('Storage changed!');
    console.log('Key:', event.key);
    console.log('Old value:', event.oldValue);
    console.log('New value:', event.newValue);
    console.log('URL:', event.url);

    // React to specific changes
    if (event.key === 'theme') {
        console.log('Theme changed to:', event.newValue);
        // Update UI accordingly
    }

    if (event.key === 'logout' && event.newValue === 'true') {
        console.log('User logged out in another tab');
        // Redirect to login page
    }
});

// Trigger a change (won't fire event in this tab)
localStorage.setItem('theme', 'dark');
localStorage.setItem('lastUpdate', new Date().toISOString());`,
                exercise: {
                    title: 'Setup Storage Event Listener',
                    instructions: 'Create a storage event listener that logs changes. Try opening this page in multiple tabs and changing localStorage in one.',
                    starterCode: `// Setup storage event listener
window.addEventListener('storage', (event) => {
    console.log('=== Storage Event ===');
    // Log the key, old value, and new value
    console.log('Key:', event.key);
    // Add more logging here
});

// Test it (open in another tab and run this)
localStorage.setItem('testKey', 'Hello from another tab!');
console.log('Set testKey. Check other tabs!');`
                },
                quiz: {
                    question: 'When do storage events fire?',
                    options: [
                        'In the same tab where localStorage was modified',
                        'In all tabs including the one that made the change',
                        'In other tabs from the same origin, not the tab that made the change',
                        'Only when the page is refreshed'
                    ],
                    correct: 2
                }
            },
            {
                id: 6,
                title: 'Quota Management',
                subtitle: 'Handling storage limits and errors',
                theory: `
                    <p><strong>Storage Limits:</strong></p>
                    <p>Different browsers have different storage limits:</p>
                    <ul>
                        <li>Chrome, Edge, Opera: ~10MB</li>
                        <li>Firefox: ~10MB</li>
                        <li>Safari: ~5MB</li>
                        <li>Mobile browsers: Often less than desktop</li>
                    </ul>
                    <p><strong>Handling QuotaExceededError:</strong></p>
                    <p>When storage is full, setItem() throws a QuotaExceededError. Always wrap in try-catch.</p>
                    <p><strong>Checking Available Space:</strong></p>
                    <ul>
                        <li>Use <code class="code-inline">navigator.storage.estimate()</code> (modern browsers)</li>
                        <li>Calculate data size manually</li>
                        <li>Implement data cleanup strategies</li>
                    </ul>
                    <p><strong>Strategies to Manage Space:</strong></p>
                    <ul>
                        <li>Remove old/unused data periodically</li>
                        <li>Use compression for large data</li>
                        <li>Implement LRU (Least Recently Used) cache</li>
                        <li>Store only essential data</li>
                        <li>Consider using IndexedDB for larger data</li>
                    </ul>
                `,
                codeExample: `// Safe storage with error handling
function safeSetItem(key, value) {
    try {
        localStorage.setItem(key, value);
        return true;
    } catch (error) {
        if (error.name === 'QuotaExceededError') {
            console.error('Storage quota exceeded!');
            // Implement cleanup strategy
            cleanOldData();
            return false;
        }
        console.error('Error storing data:', error);
        return false;
    }
}

// Check available space
async function checkStorageSpace() {
    if (navigator.storage && navigator.storage.estimate) {
        const estimate = await navigator.storage.estimate();
        const usage = estimate.usage || 0;
        const quota = estimate.quota || 0;
        const percentage = (usage / quota * 100).toFixed(2);

        console.log(\`Used: \${usage} bytes\`);
        console.log(\`Quota: \${quota} bytes\`);
        console.log(\`Usage: \${percentage}%\`);

        return { usage, quota, percentage };
    }
}

// Cleanup old data
function cleanOldData() {
    // Remove items with 'temp_' prefix
    for (let i = localStorage.length - 1; i >= 0; i--) {
        const key = localStorage.key(i);
        if (key.startsWith('temp_')) {
            localStorage.removeItem(key);
        }
    }
}

// Use it
safeSetItem('myData', 'Important information');
checkStorageSpace();`,
                exercise: {
                    title: 'Implement Safe Storage',
                    instructions: 'Create a function that safely stores data with try-catch error handling.',
                    starterCode: `// Implement safe storage function
function safeStorage(key, value) {
    try {
        localStorage.setItem(key, value);
        console.log('‚úì Data stored successfully');
        return true;
    } catch (error) {
        // Handle the error
        console.error('‚úó Storage failed:', error.message);
        return false;
    }
}

// Test it
const success = safeStorage('test', 'Hello World');
console.log('Storage success:', success);`
                },
                quiz: {
                    question: 'What error is thrown when localStorage is full?',
                    options: [
                        'StorageFullError',
                        'QuotaExceededError',
                        'OutOfMemoryError',
                        'DOMException'
                    ],
                    correct: 1
                }
            },
            {
                id: 7,
                title: 'Data Migration & Versioning',
                subtitle: 'Handling schema changes gracefully',
                theory: `
                    <p><strong>Why Version Your Data:</strong></p>
                    <ul>
                        <li>Your app evolves and data structure changes</li>
                        <li>Need to maintain backward compatibility</li>
                        <li>Avoid errors from outdated data formats</li>
                        <li>Provide smooth user experience during updates</li>
                    </ul>
                    <p><strong>Versioning Strategy:</strong></p>
                    <ul>
                        <li>Store a version number with your data</li>
                        <li>Check version on load</li>
                        <li>Run migration functions for old versions</li>
                        <li>Update version after migration</li>
                    </ul>
                    <p><strong>Migration Best Practices:</strong></p>
                    <ul>
                        <li>Always preserve user data during migration</li>
                        <li>Provide default values for new fields</li>
                        <li>Log migration success/failure</li>
                        <li>Consider keeping backup before migration</li>
                        <li>Test migrations thoroughly</li>
                    </ul>
                    <p><strong>Handling Missing Data:</strong></p>
                    <ul>
                        <li>Always check if data exists before parsing</li>
                        <li>Provide sensible defaults</li>
                        <li>Validate data structure after loading</li>
                        <li>Implement fallback mechanisms</li>
                    </ul>
                `,
                codeExample: `const CURRENT_VERSION = 3;

// Load data with versioning
function loadData() {
    const stored = localStorage.getItem('appData');
    if (!stored) {
        return initializeData();
    }

    let data = JSON.parse(stored);
    const version = data.version || 1;

    // Run migrations if needed
    if (version < CURRENT_VERSION) {
        data = migrateData(data, version);
    }

    return data;
}

// Migration function
function migrateData(data, fromVersion) {
    console.log(\`Migrating from v\${fromVersion} to v\${CURRENT_VERSION}\`);

    // v1 to v2: Add user preferences
    if (fromVersion < 2) {
        data.preferences = {
            theme: 'light',
            notifications: true
        };
    }

    // v2 to v3: Restructure user data
    if (fromVersion < 3) {
        data.user = {
            name: data.username || 'Anonymous',
            email: data.email || ''
        };
        delete data.username;
    }

    data.version = CURRENT_VERSION;
    saveData(data);
    return data;
}

// Initialize with current version
function initializeData() {
    return {
        version: CURRENT_VERSION,
        user: { name: 'Guest', email: '' },
        preferences: { theme: 'light' },
        data: []
    };
}

// Save with version
function saveData(data) {
    data.version = CURRENT_VERSION;
    localStorage.setItem('appData', JSON.stringify(data));
}

// Use it
const myData = loadData();
console.log('Loaded data:', myData);`,
                exercise: {
                    title: 'Implement Data Versioning',
                    instructions: 'Create a versioned data structure with migration support.',
                    starterCode: `const APP_VERSION = 2;

function loadVersionedData() {
    const stored = localStorage.getItem('myApp');

    if (!stored) {
        // Return initial structure
        return {
            version: APP_VERSION,
            settings: { theme: 'dark' },
            created: new Date().toISOString()
        };
    }

    let data = JSON.parse(stored);

    // Check version and migrate if needed
    if (data.version < APP_VERSION) {
        console.log('Migrating data...');
        // Add migration logic here
        data.version = APP_VERSION;
    }

    return data;
}

// Test it
const data = loadVersionedData();
console.log('Data:', data);
localStorage.setItem('myApp', JSON.stringify(data));`
                },
                quiz: {
                    question: 'Why is data versioning important?',
                    options: [
                        'To make the code run faster',
                        'To handle data structure changes and maintain backward compatibility',
                        'To reduce storage space',
                        'To encrypt the data'
                    ],
                    correct: 1
                }
            },
            {
                id: 8,
                title: 'Best Practices & Patterns',
                subtitle: 'Professional localStorage usage',
                theory: `
                    <p><strong>1. Namespace Your Keys:</strong></p>
                    <p>Prefix keys with your app name to avoid conflicts:</p>
                    <p><code class="code-inline">myApp_user</code>, <code class="code-inline">myApp_settings</code></p>

                    <p><strong>2. Create Abstraction Layer:</strong></p>
                    <p>Wrap localStorage in a utility class or module for:</p>
                    <ul>
                        <li>Automatic JSON handling</li>
                        <li>Error handling</li>
                        <li>Versioning</li>
                        <li>Type safety</li>
                    </ul>

                    <p><strong>3. Security Considerations:</strong></p>
                    <ul>
                        <li>Never store passwords or sensitive data</li>
                        <li>Don't store authentication tokens (use httpOnly cookies)</li>
                        <li>Be aware of XSS vulnerabilities</li>
                        <li>Validate and sanitize data</li>
                    </ul>

                    <p><strong>4. Performance Tips:</strong></p>
                    <ul>
                        <li>Minimize storage operations (batch updates)</li>
                        <li>Use debouncing for frequent updates</li>
                        <li>Cache parsed objects in memory</li>
                        <li>Consider lazy loading large datasets</li>
                    </ul>

                    <p><strong>5. Testing Strategies:</strong></p>
                    <ul>
                        <li>Mock localStorage in tests</li>
                        <li>Test quota exceeded scenarios</li>
                        <li>Test with disabled localStorage</li>
                        <li>Test cross-browser compatibility</li>
                    </ul>
                `,
                codeExample: `// Professional storage utility
class StorageManager {
    constructor(namespace = 'app') {
        this.namespace = namespace;
        this.cache = new Map();
    }

    // Generate namespaced key
    _key(key) {
        return \`\${this.namespace}_\${key}\`;
    }

    // Set with automatic JSON handling
    set(key, value) {
        try {
            const data = JSON.stringify(value);
            localStorage.setItem(this._key(key), data);
            this.cache.set(key, value);
            return true;
        } catch (error) {
            console.error('Storage set error:', error);
            return false;
        }
    }

    // Get with automatic parsing and fallback
    get(key, defaultValue = null) {
        // Check memory cache first
        if (this.cache.has(key)) {
            return this.cache.get(key);
        }

        try {
            const data = localStorage.getItem(this._key(key));
            if (data === null) return defaultValue;

            const parsed = JSON.parse(data);
            this.cache.set(key, parsed);
            return parsed;
        } catch (error) {
            console.error('Storage get error:', error);
            return defaultValue;
        }
    }

    // Remove
    remove(key) {
        localStorage.removeItem(this._key(key));
        this.cache.delete(key);
    }

    // Clear all namespaced items
    clear() {
        for (let i = localStorage.length - 1; i >= 0; i--) {
            const key = localStorage.key(i);
            if (key.startsWith(\`\${this.namespace}_\`)) {
                localStorage.removeItem(key);
            }
        }
        this.cache.clear();
    }
}

// Usage
const storage = new StorageManager('myApp');

// Simple usage
storage.set('user', { name: 'Alice', role: 'admin' });
const user = storage.get('user', { name: 'Guest' });
console.log('User:', user);

storage.set('settings', { theme: 'dark', lang: 'en' });
const settings = storage.get('settings');
console.log('Settings:', settings);`,
                exercise: {
                    title: 'Build a Storage Utility',
                    instructions: 'Extend the StorageManager class with a method to check if a key exists.',
                    starterCode: `class SimpleStorage {
    constructor(prefix = 'app') {
        this.prefix = prefix;
    }

    key(k) {
        return \`\${this.prefix}_\${k}\`;
    }

    set(key, value) {
        try {
            localStorage.setItem(
                this.key(key),
                JSON.stringify(value)
            );
            return true;
        } catch (e) {
            return false;
        }
    }

    get(key, defaultVal = null) {
        try {
            const data = localStorage.getItem(this.key(key));
            return data ? JSON.parse(data) : defaultVal;
        } catch (e) {
            return defaultVal;
        }
    }

    // Add a 'has' method here
    has(key) {
        // Check if key exists
        return localStorage.getItem(this.key(key)) !== null;
    }
}

// Test it
const store = new SimpleStorage('test');
store.set('name', 'Alice');
console.log('Has name:', store.has('name'));
console.log('Has age:', store.has('age'));`
                },
                quiz: {
                    question: 'Which of these should NOT be stored in localStorage?',
                    options: [
                        'User preferences and settings',
                        'Passwords and authentication tokens',
                        'Shopping cart data',
                        'Application state'
                    ],
                    correct: 1
                }
            }
        ];

        // State
        const state = {
            currentLesson: 1,
            completedLessons: new Set(JSON.parse(localStorage.getItem('lsAcademy_completed') || '[]')),
            theme: localStorage.getItem('lsAcademy_theme') || 'dark',
            inspectorVisible: false
        };

        // Initialize
        function init() {
            applyTheme();
            renderLessonList();
            loadLesson(state.currentLesson);
            updateProgress();
            setupEventListeners();
            updateInspector();
        }

        // Event listeners
        function setupEventListeners() {
            document.getElementById('themeBtn').addEventListener('click', toggleTheme);
            document.getElementById('nextBtn').addEventListener('click', nextLesson);
            document.getElementById('prevBtn').addEventListener('click', prevLesson);
            document.getElementById('resetBtn').addEventListener('click', resetProgress);
            document.getElementById('inspectorBtn').addEventListener('click', toggleInspector);
            document.getElementById('refreshInspector').addEventListener('click', updateInspector);
        }

        // Render lesson list
        function renderLessonList() {
            const list = document.getElementById('lessonList');
            list.innerHTML = lessons.map(lesson => {
                const isActive = lesson.id === state.currentLesson;
                const isCompleted = state.completedLessons.has(lesson.id);
                return `
                    <div class="lesson-item ${isActive ? 'active' : ''} ${isCompleted ? 'completed' : ''}"
                         onclick="loadLesson(${lesson.id})">
                        <span class="lesson-number">${lesson.id}.</span>
                        <span>${lesson.title}</span>
                    </div>
                `;
            }).join('');
        }

        // Load lesson
        function loadLesson(lessonId) {
            state.currentLesson = lessonId;
            const lesson = lessons.find(l => l.id === lessonId);

            const content = document.getElementById('lessonContent');
            const isCompleted = state.completedLessons.has(lessonId);

            content.innerHTML = `
                <div class="lesson-header">
                    <h2 class="lesson-title">${lesson.title}</h2>
                    <p class="lesson-subtitle">${lesson.subtitle}</p>
                    ${isCompleted ? '<div class="success-badge"><span>‚úì</span> Completed</div>' : ''}
                </div>

                <div class="section">
                    <h3 class="section-title">üìñ Theory</h3>
                    <div class="theory-box">
                        ${lesson.theory}
                    </div>
                </div>

                <div class="section">
                    <h3 class="section-title">üíª Code Example</h3>
                    <div class="code-editor">
                        <div class="editor-header">
                            <span class="editor-title">Live Code Editor</span>
                            <button onclick="runCode('example')" class="secondary-btn">‚ñ∂ Run</button>
                        </div>
                        <textarea class="code" id="exampleCode">${lesson.codeExample}</textarea>
                    </div>
                    <div class="output-box" id="exampleOutput">Click "Run" to execute the code</div>
                </div>

                <div class="section">
                    <h3 class="section-title">‚úèÔ∏è Exercise</h3>
                    <div class="exercise-box">
                        <div class="exercise-title">${lesson.exercise.title}</div>
                        <p>${lesson.exercise.instructions}</p>
                        <div class="hint-box">
                            <strong>üí° Hint:</strong> Check the localStorage Inspector below to see your stored data!
                        </div>
                    </div>
                    <div class="code-editor">
                        <div class="editor-header">
                            <span class="editor-title">Your Code</span>
                            <button onclick="runCode('exercise')" class="secondary-btn">‚ñ∂ Run Exercise</button>
                        </div>
                        <textarea class="code" id="exerciseCode">${lesson.exercise.starterCode}</textarea>
                    </div>
                    <div class="output-box" id="exerciseOutput">Write your code and click "Run Exercise"</div>
                </div>

                <div class="section">
                    <h3 class="section-title">üéØ Quiz</h3>
                    <div class="quiz-box">
                        <div class="quiz-question">${lesson.quiz.question}</div>
                        <div class="quiz-options" id="quizOptions">
                            ${lesson.quiz.options.map((option, idx) => `
                                <div class="quiz-option" onclick="checkAnswer(${idx}, ${lesson.quiz.correct})">
                                    ${option}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;

            renderLessonList();
            updateNavButtons();
            content.scrollTop = 0;
        }
        window.loadLesson = loadLesson;

        // Run code
        function runCode(type) {
            const codeId = type === 'example' ? 'exampleCode' : 'exerciseCode';
            const outputId = type === 'example' ? 'exampleOutput' : 'exerciseOutput';

            const code = document.getElementById(codeId).value;
            const output = document.getElementById(outputId);

            // Capture console.log
            const logs = [];
            const originalLog = console.log;
            console.log = (...args) => {
                logs.push(args.map(arg =>
                    typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
                ).join(' '));
                originalLog(...args);
            };

            try {
                eval(code);
                output.className = 'output-box';
                output.textContent = logs.length > 0 ? logs.join('\n') : 'Code executed successfully (no output)';

                if (type === 'exercise') {
                    markLessonComplete(state.currentLesson);
                }
            } catch (error) {
                output.className = 'output-box error';
                output.textContent = `Error: ${error.message}`;
            } finally {
                console.log = originalLog;
                updateInspector();
            }
        }
        window.runCode = runCode;

        // Check quiz answer
        function checkAnswer(selected, correct) {
            const options = document.querySelectorAll('.quiz-option');
            options.forEach((option, idx) => {
                if (idx === selected) {
                    if (idx === correct) {
                        option.className = 'quiz-option correct';
                        markLessonComplete(state.currentLesson);
                    } else {
                        option.className = 'quiz-option incorrect';
                    }
                }
                if (idx === correct) {
                    option.className = 'quiz-option correct';
                }
                option.style.pointerEvents = 'none';
            });
        }
        window.checkAnswer = checkAnswer;

        // Mark lesson complete
        function markLessonComplete(lessonId) {
            if (!state.completedLessons.has(lessonId)) {
                state.completedLessons.add(lessonId);
                localStorage.setItem('lsAcademy_completed', JSON.stringify([...state.completedLessons]));
                updateProgress();
                renderLessonList();
            }
        }

        // Update progress
        function updateProgress() {
            const percentage = (state.completedLessons.size / lessons.length * 100).toFixed(0);
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('progressText').textContent = `${percentage}% Complete (${state.completedLessons.size}/${lessons.length})`;
        }

        // Navigation
        function nextLesson() {
            if (state.currentLesson < lessons.length) {
                loadLesson(state.currentLesson + 1);
            }
        }

        function prevLesson() {
            if (state.currentLesson > 1) {
                loadLesson(state.currentLesson - 1);
            }
        }

        function updateNavButtons() {
            document.getElementById('prevBtn').disabled = state.currentLesson === 1;
            document.getElementById('nextBtn').disabled = state.currentLesson === lessons.length;
        }

        // Reset progress
        function resetProgress() {
            if (confirm('Reset all progress? This cannot be undone.')) {
                state.completedLessons.clear();
                localStorage.removeItem('lsAcademy_completed');
                updateProgress();
                renderLessonList();
            }
        }

        // Inspector
        function toggleInspector() {
            state.inspectorVisible = !state.inspectorVisible;
            const panel = document.getElementById('inspectorPanel');
            const text = document.getElementById('inspectorText');

            if (state.inspectorVisible) {
                panel.style.display = 'block';
                text.textContent = 'Hide';
                updateInspector();
            } else {
                panel.style.display = 'none';
                text.textContent = 'Show';
            }
        }

        function updateInspector() {
            const content = document.getElementById('inspectorContent');

            if (localStorage.length === 0) {
                content.innerHTML = '<div class="empty-state">No data in localStorage</div>';
                return;
            }

            const items = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const value = localStorage.getItem(key);
                items.push({ key, value });
            }

            content.innerHTML = `
                <table class="storage-table">
                    <thead>
                        <tr>
                            <th>Key</th>
                            <th>Value</th>
                            <th>Size</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${items.map(item => `
                            <tr>
                                <td>${item.key}</td>
                                <td title="${item.value}">${item.value.substring(0, 50)}${item.value.length > 50 ? '...' : ''}</td>
                                <td>${new Blob([item.value]).size} B</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        // Theme
        function toggleTheme() {
            state.theme = state.theme === 'dark' ? 'light' : 'dark';
            localStorage.setItem('lsAcademy_theme', state.theme);
            applyTheme();
        }

        function applyTheme() {
            const icon = document.getElementById('themeIcon');
            if (state.theme === 'light') {
                document.documentElement.setAttribute('data-theme', 'light');
                icon.textContent = '‚òÄÔ∏è';
            } else {
                document.documentElement.removeAttribute('data-theme');
                icon.textContent = 'üåô';
            }
        }

        // Start
        init();
    </script>
</body>
</html>