<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chart Builder Pro</title>
<meta name="description" content="Advanced interactive data visualization studio with 8 chart types, challenges, animations, scoring, and procedural data generation">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',system-ui,sans-serif;background:#0a0e1a;color:#c8d0e0;height:100vh;overflow:hidden;user-select:none}
#app{display:flex;height:100vh}
#sidebar{width:320px;background:linear-gradient(180deg,#10152a 0%,#0d1220 100%);padding:0;overflow-y:auto;border-right:2px solid #1a2548;flex-shrink:0;display:flex;flex-direction:column}
.sidebar-header{padding:16px 20px;background:linear-gradient(135deg,#141b36,#0d1220);border-bottom:1px solid #1a2548}
.sidebar-header h1{font-size:16px;color:#00e88f;letter-spacing:1px}
.sidebar-header .sub{font-size:11px;color:#5a6888;margin-top:4px}
.sidebar-scroll{flex:1;overflow-y:auto;padding:12px}
.section{margin-bottom:14px;padding:14px;background:rgba(255,255,255,0.03);border-radius:10px;border:1px solid rgba(255,255,255,0.05)}
.section h3{font-size:11px;color:#00e88f;margin-bottom:10px;text-transform:uppercase;letter-spacing:1.5px}
.chart-types{display:grid;grid-template-columns:1fr 1fr;gap:6px}
.chart-type{padding:8px 6px;background:rgba(0,232,143,0.06);border:1px solid rgba(0,232,143,0.15);border-radius:6px;cursor:pointer;text-align:center;font-size:11px;transition:all .2s}
.chart-type:hover{background:rgba(0,232,143,0.12);transform:translateY(-1px)}
.chart-type.active{background:rgba(0,232,143,0.2);border-color:#00e88f;color:#fff;box-shadow:0 0 12px rgba(0,232,143,0.15)}
textarea{width:100%;padding:10px;background:rgba(0,0,0,0.3);border:1px solid #1a2548;color:#c8d0e0;border-radius:6px;font-family:'Cascadia Code','Fira Code',monospace;font-size:11px;resize:vertical;transition:border-color .2s}
textarea:focus{outline:none;border-color:#00e88f}
select,input[type="color"],input[type="range"]{width:100%;padding:6px 8px;background:rgba(0,0,0,0.3);border:1px solid #1a2548;color:#c8d0e0;border-radius:6px;font-size:12px}
select:focus,input:focus{outline:none;border-color:#00e88f}
.ctrl-row{display:flex;gap:8px;align-items:center;margin-bottom:8px}
.ctrl-row label{font-size:11px;color:#5a6888;min-width:60px}
.ctrl-row input[type="color"]{width:36px;height:28px;padding:2px;cursor:pointer}
button{width:100%;padding:10px;background:linear-gradient(135deg,#00e88f,#00c878);color:#0a0e1a;border:none;border-radius:6px;cursor:pointer;font-weight:700;font-size:12px;letter-spacing:.5px;transition:all .2s;margin-bottom:6px}
button:hover{transform:translateY(-1px);box-shadow:0 4px 15px rgba(0,232,143,0.3)}
button:active{transform:translateY(0)}
button.secondary{background:rgba(0,232,143,0.1);color:#00e88f;border:1px solid rgba(0,232,143,0.3)}
button.danger{background:rgba(255,60,60,0.1);color:#ff5050;border:1px solid rgba(255,60,60,0.3)}
#main{flex:1;display:flex;flex-direction:column;min-width:0}
#toolbar{background:linear-gradient(90deg,#10152a,#141b36);padding:10px 20px;border-bottom:1px solid #1a2548;display:flex;justify-content:space-between;align-items:center;flex-shrink:0}
#toolbar .left{display:flex;gap:16px;align-items:center}
.stat{font-size:12px;color:#5a6888}
.stat span{color:#00e88f;font-weight:700}
#hud{display:flex;gap:20px;align-items:center}
.hud-item{text-align:center}
.hud-label{font-size:9px;color:#5a6888;text-transform:uppercase;letter-spacing:1px}
.hud-value{font-size:16px;font-weight:700;color:#00e88f}
#canvas-area{flex:1;display:flex;align-items:center;justify-content:center;background:radial-gradient(ellipse at center,#0f1528 0%,#080c18 100%);position:relative;overflow:hidden}
canvas{box-shadow:0 8px 40px rgba(0,0,0,0.5);border-radius:8px;transition:transform .1s}
#title-screen{position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,#080c18 0%,#0f1528 50%,#0a1020 100%);z-index:1000;display:flex;flex-direction:column;align-items:center;justify-content:center}
#title-screen h1{font-size:48px;color:#00e88f;text-shadow:0 0 30px rgba(0,232,143,0.3);margin-bottom:8px}
#title-screen .tagline{color:#5a6888;font-size:16px;margin-bottom:40px}
.title-btn{width:240px;padding:14px;margin:6px;font-size:14px;border-radius:8px}
.diff-select{display:flex;gap:8px;margin:20px 0}
.diff-btn{width:100px;padding:10px;font-size:12px;background:rgba(0,232,143,0.08);color:#00e88f;border:1px solid rgba(0,232,143,0.2);border-radius:6px;cursor:pointer;transition:all .2s}
.diff-btn:hover,.diff-btn.active{background:rgba(0,232,143,0.2);border-color:#00e88f}
#pause-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(8,12,24,0.92);z-index:999;display:none;flex-direction:column;align-items:center;justify-content:center}
#pause-overlay h2{font-size:36px;color:#00e88f;margin-bottom:24px}
#game-over{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(8,12,24,0.95);z-index:999;display:none;flex-direction:column;align-items:center;justify-content:center}
#game-over h2{font-size:36px;margin-bottom:8px}
#game-over .final-score{font-size:60px;color:#00e88f;font-weight:700;margin:16px 0}
#game-over .stats-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:20px 0;text-align:center}
#game-over .stat-box{background:rgba(0,232,143,0.05);border:1px solid rgba(0,232,143,0.1);border-radius:8px;padding:12px}
#toast{position:fixed;top:20px;left:50%;transform:translateX(-50%);background:rgba(0,232,143,0.15);border:1px solid #00e88f;color:#00e88f;padding:10px 24px;border-radius:8px;font-weight:700;opacity:0;transition:opacity .3s;z-index:2000;pointer-events:none}
#combo-display{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);font-size:48px;font-weight:900;color:#00e88f;text-shadow:0 0 20px rgba(0,232,143,0.5);opacity:0;z-index:500;pointer-events:none;transition:opacity .3s,transform .3s}
.particles-container{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:400}
#leaderboard{margin-top:16px;max-height:200px;overflow-y:auto}
.lb-entry{display:flex;justify-content:space-between;padding:6px 10px;border-radius:4px;font-size:12px;margin-bottom:2px}
.lb-entry:nth-child(odd){background:rgba(255,255,255,0.02)}
.lb-entry .rank{color:#00e88f;font-weight:700;width:24px}
.lb-entry .name{flex:1;color:#8a94b0}
.lb-entry .score{color:#fff;font-weight:600}
@media(max-width:900px){#sidebar{width:260px}.chart-types{grid-template-columns:1fr}}
@media(max-width:600px){#app{flex-direction:column}#sidebar{width:100%;height:auto;max-height:40vh}#canvas-area{min-height:50vh}}
@keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.6}}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-4px)}75%{transform:translateX(4px)}}
.animate-in{animation:fadeIn .5s ease}
</style>
</head>
<body>
<div id="title-screen">
<h1>Chart Builder Pro</h1>
<p class="tagline">Interactive Data Visualization Studio</p>
<div class="diff-select">
<div class="diff-btn active" data-diff="casual" onclick="setDifficulty('casual')">Casual</div>
<div class="diff-btn" data-diff="normal" onclick="setDifficulty('normal')">Normal</div>
<div class="diff-btn" data-diff="expert" onclick="setDifficulty('expert')">Expert</div>
</div>
<button class="title-btn" onclick="startFreeMode()">Free Build Mode</button>
<button class="title-btn secondary" onclick="startChallengeMode()">Challenge Mode</button>
<button class="title-btn secondary" onclick="showHighScores()">High Scores</button>
<div id="title-leaderboard" style="margin-top:20px;width:300px;display:none">
<h3 style="color:#00e88f;margin-bottom:8px;font-size:13px;text-align:center">TOP SCORES</h3>
<div id="title-lb"></div>
</div>
</div>
<div id="pause-overlay">
<h2>PAUSED</h2>
<p style="color:#5a6888;margin-bottom:24px">Press ESC or click Resume to continue</p>
<button class="title-btn" onclick="togglePause()">Resume</button>
<button class="title-btn secondary" onclick="returnToTitle()">Main Menu</button>
</div>
<div id="game-over">
<h2 style="color:#5a6888">CHALLENGE COMPLETE</h2>
<div class="final-score" id="final-score">0</div>
<div class="stats-grid" id="final-stats"></div>
<button class="title-btn" onclick="startChallengeMode()">Play Again</button>
<button class="title-btn secondary" onclick="returnToTitle()">Main Menu</button>
</div>
<div id="toast"></div>
<div id="combo-display"></div>
<div class="particles-container" id="particles"></div>
<div id="app" style="display:none">
<div id="sidebar">
<div class="sidebar-header">
<h1>CHART STUDIO</h1>
<div class="sub" id="mode-label">Free Build Mode</div>
</div>
<div class="sidebar-scroll">
<div class="section">
<h3>Chart Type</h3>
<div class="chart-types" id="chart-types"></div>
</div>
<div class="section">
<h3>Data Source</h3>
<textarea id="dataInput" rows="6"></textarea>
<button onclick="updateChart()">Apply Data</button>
<button class="secondary" onclick="generateRandomData()">Random Data</button>
<button class="secondary" onclick="generateProceduralData()">Procedural Gen</button>
</div>
<div class="section">
<h3>Style</h3>
<div class="ctrl-row"><label>Title</label><input type="text" id="chartTitle" value="My Chart" style="flex:1"></div>
<div class="ctrl-row"><label>Accent</label><input type="color" id="accentColor" value="#00e88f"></div>
<div class="ctrl-row"><label>BG</label><input type="color" id="bgColor" value="#ffffff"></div>
<div class="ctrl-row"><label>Animate</label><select id="animStyle"><option value="none">None</option><option value="grow" selected>Grow</option><option value="bounce">Bounce</option><option value="wave">Wave</option></select></div>
<div class="ctrl-row"><label>Grid</label><select id="gridStyle"><option value="full">Full</option><option value="horizontal">H-Lines</option><option value="dots">Dots</option><option value="none">None</option></select></div>
<div class="ctrl-row"><label>Theme</label><select id="colorTheme" onchange="applyColorTheme()"><option value="neon">Neon</option><option value="pastel">Pastel</option><option value="earth">Earth</option><option value="ocean">Ocean</option><option value="sunset">Sunset</option><option value="mono">Mono</option></select></div>
</div>
<div class="section" id="challenge-section" style="display:none">
<h3>Current Challenge</h3>
<div id="challenge-desc" style="font-size:12px;color:#8a94b0;margin-bottom:8px"></div>
<div id="challenge-timer" style="font-size:20px;color:#00e88f;font-weight:700;text-align:center"></div>
<button onclick="submitChallenge()">Submit Chart</button>
</div>
<div class="section">
<h3>Actions</h3>
<button onclick="downloadImage()">Download PNG</button>
<button class="secondary" onclick="exportData()">Export JSON</button>
<button class="secondary" onclick="importDataFile()">Import JSON</button>
<button class="secondary" onclick="saveToLibrary()">Save to Library</button>
<input type="file" id="importFileInput" accept=".json" style="display:none">
</div>
<div class="section">
<h3>Saved Charts</h3>
<div id="library-list" style="max-height:150px;overflow-y:auto;font-size:12px"></div>
</div>
</div>
</div>
<div id="main">
<div id="toolbar">
<div class="left">
<div class="stat">Charts: <span id="stat-charts">0</span></div>
<div class="stat">Points: <span id="stat-points">0</span></div>
<div class="stat" id="stat-combo-wrap" style="display:none">Combo: <span id="stat-combo">x1</span></div>
</div>
<div id="hud">
<div class="hud-item"><div class="hud-label">Score</div><div class="hud-value" id="hud-score">0</div></div>
<div class="hud-item"><div class="hud-label">Level</div><div class="hud-value" id="hud-level">1</div></div>
<div class="hud-item"><div class="hud-label">Streak</div><div class="hud-value" id="hud-streak">0</div></div>
</div>
</div>
<div id="canvas-area">
<canvas id="chart" width="900" height="600"></canvas>
</div>
</div>
</div>
<script>
const canvas=document.getElementById('chart'),ctx=canvas.getContext('2d');
const CHART_TYPES=[
{id:'bar',name:'Bar',icon:'||'},
{id:'line',name:'Line',icon:'/\\'},
{id:'pie',name:'Pie',icon:'O'},
{id:'scatter',name:'Scatter',icon:'..'},
{id:'area',name:'Area',icon:'/='},
{id:'radar',name:'Radar',icon:'*'},
{id:'donut',name:'Donut',icon:'()'},
{id:'polar',name:'Polar',icon:'@'}
];
const COLOR_THEMES={
neon:['#00e88f','#ff006e','#00d4ff','#ffea00','#ff6600','#b744ff','#00ff9f','#ff3366'],
pastel:['#a8d8ea','#aa96da','#fcbad3','#ffffd2','#b5eaa5','#f6c4a4','#d4a5ff','#a5d4ff'],
earth:['#8d6e63','#a1887f','#bcaaa4','#6d4c41','#795548','#4e342e','#d7ccc8','#3e2723'],
ocean:['#006994','#00a8cc','#00d2d3','#48dbfb','#0abde3','#2e86de','#54a0ff','#5f27cd'],
sunset:['#ff6b6b','#feca57','#ff9ff3','#48dbfb','#ff9f43','#ee5a24','#f368e0','#0abde3'],
mono:['#2d3436','#636e72','#b2bec3','#dfe6e9','#74b9ff','#a29bfe','#55efc4','#ffeaa7']
};
let chartType='bar',chartData={labels:['Jan','Feb','Mar','Apr','May','Jun'],values:[12,19,3,5,2,15]};
let accentColor='#00e88f',bgColor='#ffffff',animStyle='grow',gridStyle='full';
let colorTheme='neon',currentColors=COLOR_THEMES.neon;
let gameState={mode:'title',score:0,level:1,streak:0,combo:1,chartsCreated:0,challengeIndex:0,timer:0,timerInterval:null,paused:false,difficulty:'normal',totalTime:0,bestCombo:1,perfectCharts:0};
let animProgress=0,animFrame=0,shakeX=0,shakeY=0,shakeIntensity=0;
let audioCtx=null;
const CHALLENGES=[
{desc:'Create a bar chart showing monthly sales data',type:'bar',time:45,minBars:4,bonus:'Use at least 6 data points for a bonus!'},
{desc:'Build a line chart tracking temperature changes',type:'line',time:40,minBars:5,bonus:'Create a smooth trend for extra points!'},
{desc:'Design a pie chart of market share',type:'pie',time:35,minBars:3,bonus:'Use exactly 5 segments for a bonus!'},
{desc:'Plot a scatter diagram of height vs weight',type:'scatter',time:50,minBars:6,bonus:'Generate random data for variety!'},
{desc:'Create an area chart of revenue over time',type:'area',time:40,minBars:4,bonus:'Overlay multiple gradients!'},
{desc:'Build a radar chart comparing skills',type:'radar',time:45,minBars:5,bonus:'Use 6+ categories for full marks!'},
{desc:'Design a donut chart of budget allocation',type:'donut',time:35,minBars:4,bonus:'Balance the proportions!'},
{desc:'Create a polar area chart of seasonal data',type:'polar',time:50,minBars:4,bonus:'Make it symmetrical for a bonus!'}
];
function initAudio(){if(audioCtx)return;try{audioCtx=new(window.AudioContext||window.webkitAudioContext)()}catch(e){}}
function playSound(type){
if(!audioCtx)return;
const osc=audioCtx.createOscillator(),gain=audioCtx.createGain();
osc.connect(gain);gain.connect(audioCtx.destination);
const now=audioCtx.currentTime;
switch(type){
case'click':osc.frequency.setValueAtTime(800,now);osc.frequency.exponentialRampToValueAtTime(400,now+.08);gain.gain.setValueAtTime(.15,now);gain.gain.exponentialRampToValueAtTime(.001,now+.1);osc.type='sine';osc.start(now);osc.stop(now+.1);break;
case'success':osc.frequency.setValueAtTime(523,now);osc.frequency.setValueAtTime(659,now+.1);osc.frequency.setValueAtTime(784,now+.2);gain.gain.setValueAtTime(.12,now);gain.gain.exponentialRampToValueAtTime(.001,now+.4);osc.type='sine';osc.start(now);osc.stop(now+.4);break;
case'combo':osc.frequency.setValueAtTime(880,now);osc.frequency.exponentialRampToValueAtTime(1760,now+.15);gain.gain.setValueAtTime(.1,now);gain.gain.exponentialRampToValueAtTime(.001,now+.2);osc.type='triangle';osc.start(now);osc.stop(now+.2);break;
case'fail':osc.frequency.setValueAtTime(300,now);osc.frequency.exponentialRampToValueAtTime(100,now+.3);gain.gain.setValueAtTime(.12,now);gain.gain.exponentialRampToValueAtTime(.001,now+.3);osc.type='sawtooth';osc.start(now);osc.stop(now+.3);break;
case'levelup':osc.frequency.setValueAtTime(440,now);osc.frequency.setValueAtTime(554,now+.1);osc.frequency.setValueAtTime(659,now+.2);osc.frequency.setValueAtTime(880,now+.3);gain.gain.setValueAtTime(.1,now);gain.gain.exponentialRampToValueAtTime(.001,now+.5);osc.type='sine';osc.start(now);osc.stop(now+.5);break;
case'generate':{const osc2=audioCtx.createOscillator(),g2=audioCtx.createGain();osc2.connect(g2);g2.connect(audioCtx.destination);osc2.frequency.setValueAtTime(200,now);osc2.frequency.exponentialRampToValueAtTime(800,now+.15);g2.gain.setValueAtTime(.08,now);g2.gain.exponentialRampToValueAtTime(.001,now+.15);osc2.type='sine';osc2.start(now);osc2.stop(now+.15);break}
case'menu':osc.frequency.setValueAtTime(600,now);gain.gain.setValueAtTime(.06,now);gain.gain.exponentialRampToValueAtTime(.001,now+.05);osc.type='sine';osc.start(now);osc.stop(now+.05);break;
}
}
function triggerShake(intensity){shakeIntensity=intensity;setTimeout(()=>shakeIntensity=0,200)}
function showToast(msg){const t=document.getElementById('toast');t.textContent=msg;t.style.opacity='1';setTimeout(()=>t.style.opacity='0',2000)}
function showCombo(text){const c=document.getElementById('combo-display');c.textContent=text;c.style.opacity='1';c.style.transform='translate(-50%,-50%) scale(1.5)';setTimeout(()=>{c.style.opacity='0';c.style.transform='translate(-50%,-50%) scale(1)'},800)}
function spawnParticles(x,y,color,count){
const container=document.getElementById('particles');
for(let i=0;i<count;i++){
const p=document.createElement('div');
const angle=Math.random()*Math.PI*2,speed=2+Math.random()*4,size=3+Math.random()*5;
p.style.cssText=`position:absolute;left:${x}px;top:${y}px;width:${size}px;height:${size}px;background:${color};border-radius:50%;pointer-events:none;z-index:500`;
container.appendChild(p);
const vx=Math.cos(angle)*speed,vy=Math.sin(angle)*speed;
let px=x,py=y,life=1;
const anim=()=>{life-=.02;px+=vx;py+=vy+1;p.style.left=px+'px';p.style.top=py+'px';p.style.opacity=life;if(life>0)requestAnimationFrame(anim);else p.remove()};
requestAnimationFrame(anim);
}
}
function setDifficulty(d){
gameState.difficulty=d;
document.querySelectorAll('.diff-btn').forEach(b=>{b.classList.toggle('active',b.dataset.diff===d)});
playSound('click');
}
function startFreeMode(){
initAudio();playSound('menu');
gameState.mode='free';
document.getElementById('title-screen').style.display='none';
document.getElementById('app').style.display='flex';
document.getElementById('mode-label').textContent='Free Build Mode';
document.getElementById('challenge-section').style.display='none';
generateRandomData();renderChart();
}
function startChallengeMode(){
initAudio();playSound('levelup');
gameState.mode='challenge';gameState.score=0;gameState.level=1;gameState.streak=0;gameState.combo=1;
gameState.chartsCreated=0;gameState.challengeIndex=0;gameState.totalTime=0;gameState.bestCombo=1;gameState.perfectCharts=0;
document.getElementById('title-screen').style.display='none';
document.getElementById('game-over').style.display='none';
document.getElementById('app').style.display='flex';
document.getElementById('mode-label').textContent='Challenge Mode';
document.getElementById('challenge-section').style.display='block';
document.getElementById('stat-combo-wrap').style.display='inline';
updateHUD();loadChallenge();
}
function loadChallenge(){
const ch=CHALLENGES[gameState.challengeIndex%CHALLENGES.length];
const timeMulti=gameState.difficulty==='casual'?1.5:gameState.difficulty==='expert'?.7:1;
gameState.timer=Math.floor(ch.time*timeMulti);
document.getElementById('challenge-desc').innerHTML=`<strong>Level ${gameState.level}:</strong> ${ch.desc}<br><em style="color:#00e88f;font-size:11px">${ch.bonus}</em>`;
selectChartType(ch.type);generateRandomData();
if(gameState.timerInterval)clearInterval(gameState.timerInterval);
gameState.timerInterval=setInterval(()=>{
if(gameState.paused)return;
gameState.timer--;gameState.totalTime++;
document.getElementById('challenge-timer').textContent=gameState.timer+'s';
if(gameState.timer<=10)document.getElementById('challenge-timer').style.color='#ff5050';
else document.getElementById('challenge-timer').style.color='#00e88f';
if(gameState.timer<=0){clearInterval(gameState.timerInterval);failChallenge()}
},1000);
document.getElementById('challenge-timer').textContent=gameState.timer+'s';
renderChart();
}
function submitChallenge(){
if(gameState.mode!=='challenge')return;
clearInterval(gameState.timerInterval);
const ch=CHALLENGES[gameState.challengeIndex%CHALLENGES.length];
let points=100;
const timeBonus=gameState.timer*5;
points+=timeBonus;
if(chartData.labels.length>=6)points+=50;
if(chartType===ch.type)points+=30;
const diffMulti=gameState.difficulty==='casual'?.8:gameState.difficulty==='expert'?1.5:1;
points=Math.floor(points*diffMulti*gameState.combo);
if(points>200)gameState.perfectCharts++;
gameState.score+=points;gameState.chartsCreated++;gameState.streak++;
if(gameState.streak%3===0){gameState.combo=Math.min(gameState.combo+1,8);playSound('combo');showCombo(`x${gameState.combo} COMBO!`);spawnParticles(canvas.offsetLeft+canvas.width/2,canvas.offsetTop+canvas.height/2,'#00e88f',30)}
if(gameState.combo>gameState.bestCombo)gameState.bestCombo=gameState.combo;
playSound('success');showToast(`+${points} points! (x${gameState.combo})`);triggerShake(3);
spawnParticles(canvas.offsetLeft+canvas.width/2,canvas.offsetTop+canvas.height/2,accentColor,15);
gameState.level++;gameState.challengeIndex++;
if(gameState.challengeIndex>=CHALLENGES.length*2){endChallenge();return}
updateHUD();loadChallenge();
}
function failChallenge(){
gameState.streak=0;gameState.combo=1;
playSound('fail');showToast('Time up! Streak broken');triggerShake(6);
gameState.challengeIndex++;gameState.level++;
if(gameState.challengeIndex>=CHALLENGES.length*2){endChallenge();return}
updateHUD();loadChallenge();
}
function endChallenge(){
clearInterval(gameState.timerInterval);
document.getElementById('app').style.display='none';
document.getElementById('game-over').style.display='flex';
document.getElementById('final-score').textContent=gameState.score;
document.getElementById('final-stats').innerHTML=`
<div class="stat-box"><div class="hud-label">Charts</div><div class="hud-value">${gameState.chartsCreated}</div></div>
<div class="stat-box"><div class="hud-label">Best Combo</div><div class="hud-value">x${gameState.bestCombo}</div></div>
<div class="stat-box"><div class="hud-label">Perfect</div><div class="hud-value">${gameState.perfectCharts}</div></div>
<div class="stat-box"><div class="hud-label">Time</div><div class="hud-value">${gameState.totalTime}s</div></div>`;
saveHighScore(gameState.score);playSound('levelup');
}
function updateHUD(){
document.getElementById('hud-score').textContent=gameState.score;
document.getElementById('hud-level').textContent=gameState.level;
document.getElementById('hud-streak').textContent=gameState.streak;
document.getElementById('stat-charts').textContent=gameState.chartsCreated;
document.getElementById('stat-points').textContent=gameState.score;
document.getElementById('stat-combo').textContent='x'+gameState.combo;
}
function togglePause(){
gameState.paused=!gameState.paused;
document.getElementById('pause-overlay').style.display=gameState.paused?'flex':'none';
playSound('menu');
}
function returnToTitle(){
gameState.paused=false;
if(gameState.timerInterval)clearInterval(gameState.timerInterval);
document.getElementById('pause-overlay').style.display='none';
document.getElementById('game-over').style.display='none';
document.getElementById('app').style.display='none';
document.getElementById('title-screen').style.display='flex';
}
document.addEventListener('keydown',e=>{
if(e.key==='Escape'){e.preventDefault();if(gameState.mode!=='title')togglePause()}
if(e.key==='r'||e.key==='R'){if(gameState.mode==='challenge'&&!gameState.paused){startChallengeMode()}}
});
function selectChartType(type){
chartType=type;
document.querySelectorAll('.chart-type').forEach(b=>b.classList.toggle('active',b.dataset.type===type));
playSound('click');animProgress=0;renderChart();
}
function initChartTypes(){
const container=document.getElementById('chart-types');
container.innerHTML=CHART_TYPES.map(t=>`<div class="chart-type${t.id==='bar'?' active':''}" data-type="${t.id}" onclick="selectChartType('${t.id}')">${t.icon} ${t.name}</div>`).join('');
}
function generateRandomData(){
const n=4+Math.floor(Math.random()*6);
const labels=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'].slice(0,n);
const values=Array.from({length:n},()=>Math.floor(Math.random()*100)+5);
chartData={labels,values};
document.getElementById('dataInput').value=JSON.stringify(chartData,null,2);
playSound('generate');animProgress=0;renderChart();
}
function generateProceduralData(){
const categories=[['Alpha','Beta','Gamma','Delta','Epsilon','Zeta','Eta','Theta'],['Q1','Q2','Q3','Q4'],['Mon','Tue','Wed','Thu','Fri','Sat','Sun'],['Red','Blue','Green','Yellow','Purple','Orange'],['Physics','Math','Chem','Bio','CS','Art']];
const cat=categories[Math.floor(Math.random()*categories.length)];
const n=3+Math.floor(Math.random()*Math.min(cat.length,8));
const labels=cat.slice(0,n);
const pattern=Math.random();
let values;
if(pattern<.25){values=labels.map((_,i)=>Math.floor(10+i*15+Math.random()*20))}
else if(pattern<.5){values=labels.map((_,i)=>Math.floor(50+Math.sin(i*1.2)*40+Math.random()*10))}
else if(pattern<.75){values=labels.map(()=>Math.floor(Math.random()*100+5))}
else{const peak=Math.floor(Math.random()*n);values=labels.map((_,i)=>Math.floor(100-Math.abs(i-peak)*20+Math.random()*15))}
chartData={labels,values:values.map(v=>Math.max(1,v))};
document.getElementById('dataInput').value=JSON.stringify(chartData,null,2);
playSound('generate');animProgress=0;renderChart();
}
function updateChart(){
try{chartData=JSON.parse(document.getElementById('dataInput').value);animProgress=0;renderChart();playSound('success');if(gameState.mode==='free'){gameState.chartsCreated++;updateHUD()}}
catch(e){playSound('fail');showToast('Invalid JSON data');triggerShake(4)}
}
function applyColorTheme(){currentColors=COLOR_THEMES[document.getElementById('colorTheme').value]||COLOR_THEMES.neon;renderChart()}
function getColor(i){return currentColors[i%currentColors.length]}
function easeOut(t){return 1-Math.pow(1-t,3)}
function drawGrid(pad,cw,ch,maxVal){
ctx.strokeStyle='rgba(0,0,0,0.08)';ctx.lineWidth=.5;
const gs=document.getElementById('gridStyle').value;
const steps=5;
for(let i=0;i<=steps;i++){
const y=pad+ch-(i/steps)*ch;
const val=Math.round((i/steps)*maxVal);
if(gs==='full'||gs==='horizontal'){ctx.beginPath();ctx.moveTo(pad,y);ctx.lineTo(pad+cw,y);ctx.stroke()}
if(gs==='dots'){for(let x=pad;x<=pad+cw;x+=20){ctx.beginPath();ctx.arc(x,y,1,0,Math.PI*2);ctx.fill()}}
ctx.fillStyle='rgba(0,0,0,0.4)';ctx.font='10px sans-serif';ctx.textAlign='right';ctx.fillText(val,pad-8,y+3);
}
if(gs==='full'){for(let i=0;i<chartData.labels.length;i++){const x=pad+((i+.5)/chartData.labels.length)*cw;ctx.beginPath();ctx.moveTo(x,pad);ctx.lineTo(x,pad+ch);ctx.stroke()}}
}
function drawTitle(){
const title=document.getElementById('chartTitle').value||'';
if(title){ctx.fillStyle='rgba(0,0,0,0.8)';ctx.font='bold 16px sans-serif';ctx.textAlign='center';ctx.fillText(title,canvas.width/2,30)}
}
function drawBar(progress){
const bg=bgColor;ctx.fillStyle=bg;ctx.fillRect(0,0,canvas.width,canvas.height);
const pad=70,cw=canvas.width-pad*2,ch=canvas.height-pad*2;
const maxVal=Math.max(...chartData.values)*1.1;
drawGrid(pad,cw,ch,maxVal);drawTitle();
const bw=cw/chartData.labels.length;
chartData.values.forEach((v,i)=>{
const p=animStyle==='wave'?easeOut(Math.min(1,progress*2-i*.15)):easeOut(progress);
const h=(v/maxVal)*ch*Math.max(0,p);
const x=pad+i*bw+bw*.15;
const y=pad+ch-h;
const w=bw*.7;
const g=ctx.createLinearGradient(x,y,x,pad+ch);
g.addColorStop(0,getColor(i));g.addColorStop(1,adjustColor(getColor(i),-.3));
ctx.fillStyle=g;
if(animStyle==='bounce'){const bounce=Math.sin(progress*Math.PI*2+i)*3*(1-progress);ctx.fillRect(x,y+bounce,w,h)}
else{ctx.fillRect(x,y,w,h)}
ctx.shadowColor=getColor(i);ctx.shadowBlur=8;ctx.fillRect(x,y,w,2);ctx.shadowBlur=0;
ctx.fillStyle='rgba(0,0,0,0.7)';ctx.font='11px sans-serif';ctx.textAlign='center';
ctx.fillText(chartData.labels[i],x+w/2,pad+ch+18);
ctx.fillText(Math.round(v*Math.max(0,p)),x+w/2,y-8);
});
}
function drawLine(progress){
ctx.fillStyle=bgColor;ctx.fillRect(0,0,canvas.width,canvas.height);
const pad=70,cw=canvas.width-pad*2,ch=canvas.height-pad*2;
const maxVal=Math.max(...chartData.values)*1.1;
drawGrid(pad,cw,ch,maxVal);drawTitle();
const pts=chartData.values.map((v,i)=>({x:pad+(i/(chartData.labels.length-1))*cw,y:pad+ch-(v/maxVal)*ch}));
const areaG=ctx.createLinearGradient(0,pad,0,pad+ch);
areaG.addColorStop(0,getColor(0)+'40');areaG.addColorStop(1,getColor(0)+'05');
ctx.beginPath();ctx.moveTo(pts[0].x,pad+ch);
pts.forEach((p,i)=>{const px=p.x,py=pad+ch-(pad+ch-p.y)*easeOut(Math.min(1,progress*1.5-i*.1));ctx.lineTo(px,py)});
ctx.lineTo(pts[pts.length-1].x,pad+ch);ctx.closePath();ctx.fillStyle=areaG;ctx.fill();
ctx.beginPath();
pts.forEach((p,i)=>{const px=p.x,py=pad+ch-(pad+ch-p.y)*easeOut(Math.min(1,progress*1.5-i*.1));if(i===0)ctx.moveTo(px,py);else{const prev=pts[i-1];const cpx=(prev.x+px)/2;const prevY=pad+ch-(pad+ch-prev.y)*easeOut(Math.min(1,progress*1.5-(i-1)*.1));ctx.bezierCurveTo(cpx,prevY,cpx,py,px,py)}});
ctx.strokeStyle=getColor(0);ctx.lineWidth=3;ctx.shadowColor=getColor(0);ctx.shadowBlur=10;ctx.stroke();ctx.shadowBlur=0;
pts.forEach((p,i)=>{const py=pad+ch-(pad+ch-p.y)*easeOut(Math.min(1,progress*1.5-i*.1));ctx.beginPath();ctx.arc(p.x,py,5,0,Math.PI*2);ctx.fillStyle='#fff';ctx.fill();ctx.strokeStyle=getColor(i);ctx.lineWidth=2;ctx.stroke();
ctx.fillStyle='rgba(0,0,0,0.6)';ctx.font='10px sans-serif';ctx.textAlign='center';ctx.fillText(chartData.labels[i],p.x,pad+ch+18);ctx.fillText(chartData.values[i],p.x,py-12);
});
}
function drawPie(progress){
ctx.fillStyle=bgColor;ctx.fillRect(0,0,canvas.width,canvas.height);drawTitle();
const cx=canvas.width/2,cy=canvas.height/2+10,r=Math.min(canvas.width,canvas.height)/3;
const total=chartData.values.reduce((a,b)=>a+b,0);
let angle=-Math.PI/2;
chartData.values.forEach((v,i)=>{
const slice=(v/total)*Math.PI*2*easeOut(progress);
ctx.beginPath();ctx.moveTo(cx,cy);ctx.arc(cx,cy,r,angle,angle+slice);ctx.closePath();
ctx.fillStyle=getColor(i);ctx.fill();
ctx.strokeStyle=bgColor;ctx.lineWidth=2;ctx.stroke();
if(progress>.8){const mid=angle+slice/2;const lx=cx+Math.cos(mid)*(r*.65);const ly=cy+Math.sin(mid)*(r*.65);ctx.fillStyle='rgba(0,0,0,0.7)';ctx.font='bold 11px sans-serif';ctx.textAlign='center';ctx.fillText(Math.round(v/total*100)+'%',lx,ly);
const llx=cx+Math.cos(mid)*(r+20);const lly=cy+Math.sin(mid)*(r+20);ctx.fillText(chartData.labels[i],llx,lly)}
angle+=slice;
});
}
function drawScatter(progress){
ctx.fillStyle=bgColor;ctx.fillRect(0,0,canvas.width,canvas.height);
const pad=70,cw=canvas.width-pad*2,ch=canvas.height-pad*2;
const maxVal=Math.max(...chartData.values)*1.1;
drawGrid(pad,cw,ch,maxVal);drawTitle();
chartData.values.forEach((v,i)=>{
const x=pad+(i/(chartData.values.length-1||1))*cw;
const y=pad+ch-(v/maxVal)*ch;
const p=easeOut(Math.min(1,progress*2-i*.15));
const sz=6+v/maxVal*8;
ctx.beginPath();ctx.arc(x,y,sz*p,0,Math.PI*2);
ctx.fillStyle=getColor(i)+'aa';ctx.fill();
ctx.strokeStyle=getColor(i);ctx.lineWidth=2;ctx.stroke();
ctx.shadowColor=getColor(i);ctx.shadowBlur=12;ctx.fill();ctx.shadowBlur=0;
ctx.fillStyle='rgba(0,0,0,0.6)';ctx.font='10px sans-serif';ctx.textAlign='center';ctx.fillText(chartData.labels[i],x,pad+ch+18);
});
}
function drawArea(progress){
ctx.fillStyle=bgColor;ctx.fillRect(0,0,canvas.width,canvas.height);
const pad=70,cw=canvas.width-pad*2,ch=canvas.height-pad*2;
const maxVal=Math.max(...chartData.values)*1.1;
drawGrid(pad,cw,ch,maxVal);drawTitle();
const pts=chartData.values.map((v,i)=>({x:pad+(i/(chartData.labels.length-1))*cw,y:pad+ch-(v/maxVal)*ch*easeOut(Math.min(1,progress*1.5-i*.08))}));
for(let layer=2;layer>=0;layer--){
const opacity=[.15,.25,.5][layer];const offset=[20,10,0][layer];
ctx.beginPath();ctx.moveTo(pts[0].x,pad+ch);
pts.forEach(p=>ctx.lineTo(p.x,p.y+offset));
ctx.lineTo(pts[pts.length-1].x,pad+ch);ctx.closePath();
const g=ctx.createLinearGradient(0,pad,0,pad+ch);
g.addColorStop(0,getColor(layer)+Math.round(opacity*255).toString(16).padStart(2,'0'));
g.addColorStop(1,getColor(layer)+'10');
ctx.fillStyle=g;ctx.fill();
}
ctx.beginPath();pts.forEach((p,i)=>{if(i===0)ctx.moveTo(p.x,p.y);else ctx.lineTo(p.x,p.y)});
ctx.strokeStyle=getColor(0);ctx.lineWidth=2;ctx.stroke();
pts.forEach((p,i)=>{ctx.beginPath();ctx.arc(p.x,p.y,4,0,Math.PI*2);ctx.fillStyle=getColor(i);ctx.fill();
ctx.fillStyle='rgba(0,0,0,0.6)';ctx.font='10px sans-serif';ctx.textAlign='center';ctx.fillText(chartData.labels[i],p.x,pad+ch+18)});
}
function drawRadar(progress){
ctx.fillStyle=bgColor;ctx.fillRect(0,0,canvas.width,canvas.height);drawTitle();
const cx=canvas.width/2,cy=canvas.height/2+10,r=Math.min(canvas.width,canvas.height)/3;
const n=chartData.labels.length,maxVal=Math.max(...chartData.values)*1.1;
for(let ring=5;ring>=1;ring--){ctx.beginPath();for(let i=0;i<=n;i++){const angle=-Math.PI/2+(i%n)*(Math.PI*2/n);const rr=r*(ring/5);const x=cx+Math.cos(angle)*rr;const y=cy+Math.sin(angle)*rr;if(i===0)ctx.moveTo(x,y);else ctx.lineTo(x,y)}ctx.closePath();ctx.strokeStyle='rgba(0,0,0,0.1)';ctx.stroke()}
for(let i=0;i<n;i++){const angle=-Math.PI/2+i*(Math.PI*2/n);ctx.beginPath();ctx.moveTo(cx,cy);ctx.lineTo(cx+Math.cos(angle)*r,cy+Math.sin(angle)*r);ctx.strokeStyle='rgba(0,0,0,0.1)';ctx.stroke();
ctx.fillStyle='rgba(0,0,0,0.6)';ctx.font='11px sans-serif';ctx.textAlign='center';ctx.fillText(chartData.labels[i],cx+Math.cos(angle)*(r+20),cy+Math.sin(angle)*(r+20)+4)}
ctx.beginPath();chartData.values.forEach((v,i)=>{const angle=-Math.PI/2+i*(Math.PI*2/n);const vr=(v/maxVal)*r*easeOut(Math.min(1,progress*1.5-i*.1));const x=cx+Math.cos(angle)*vr;const y=cy+Math.sin(angle)*vr;if(i===0)ctx.moveTo(x,y);else ctx.lineTo(x,y)});ctx.closePath();
ctx.fillStyle=getColor(0)+'40';ctx.fill();ctx.strokeStyle=getColor(0);ctx.lineWidth=2;ctx.stroke();
chartData.values.forEach((v,i)=>{const angle=-Math.PI/2+i*(Math.PI*2/n);const vr=(v/maxVal)*r*easeOut(Math.min(1,progress*1.5-i*.1));ctx.beginPath();ctx.arc(cx+Math.cos(angle)*vr,cy+Math.sin(angle)*vr,4,0,Math.PI*2);ctx.fillStyle=getColor(i);ctx.fill()});
}
function drawDonut(progress){
ctx.fillStyle=bgColor;ctx.fillRect(0,0,canvas.width,canvas.height);drawTitle();
const cx=canvas.width/2,cy=canvas.height/2+10,outerR=Math.min(canvas.width,canvas.height)/3,innerR=outerR*.55;
const total=chartData.values.reduce((a,b)=>a+b,0);let angle=-Math.PI/2;
chartData.values.forEach((v,i)=>{
const slice=(v/total)*Math.PI*2*easeOut(progress);
ctx.beginPath();ctx.arc(cx,cy,outerR,angle,angle+slice);ctx.arc(cx,cy,innerR,angle+slice,angle,true);ctx.closePath();
ctx.fillStyle=getColor(i);ctx.fill();ctx.strokeStyle=bgColor;ctx.lineWidth=2;ctx.stroke();
if(progress>.8){const mid=angle+slice/2;const lr=(outerR+innerR)/2;ctx.fillStyle='rgba(0,0,0,0.7)';ctx.font='bold 10px sans-serif';ctx.textAlign='center';
ctx.fillText(Math.round(v/total*100)+'%',cx+Math.cos(mid)*lr,cy+Math.sin(mid)*lr)}
angle+=slice;
});
ctx.fillStyle='rgba(0,0,0,0.7)';ctx.font='bold 18px sans-serif';ctx.textAlign='center';ctx.fillText(total,cx,cy+6);
ctx.font='10px sans-serif';ctx.fillText('Total',cx,cy-10);
}
function drawPolar(progress){
ctx.fillStyle=bgColor;ctx.fillRect(0,0,canvas.width,canvas.height);drawTitle();
const cx=canvas.width/2,cy=canvas.height/2+10,maxR=Math.min(canvas.width,canvas.height)/3;
const n=chartData.labels.length,maxVal=Math.max(...chartData.values);
for(let ring=4;ring>=1;ring--){ctx.beginPath();ctx.arc(cx,cy,maxR*(ring/4),0,Math.PI*2);ctx.strokeStyle='rgba(0,0,0,0.08)';ctx.stroke()}
chartData.values.forEach((v,i)=>{
const startAngle=-Math.PI/2+i*(Math.PI*2/n);
const endAngle=startAngle+Math.PI*2/n;
const vr=(v/maxVal)*maxR*easeOut(Math.min(1,progress*1.5-i*.15));
ctx.beginPath();ctx.moveTo(cx,cy);ctx.arc(cx,cy,vr,startAngle,endAngle);ctx.closePath();
ctx.fillStyle=getColor(i)+'cc';ctx.fill();ctx.strokeStyle=bgColor;ctx.lineWidth=1;ctx.stroke();
const mid=(startAngle+endAngle)/2;ctx.fillStyle='rgba(0,0,0,0.6)';ctx.font='10px sans-serif';ctx.textAlign='center';
ctx.fillText(chartData.labels[i],cx+Math.cos(mid)*(maxR+18),cy+Math.sin(mid)*(maxR+18)+4);
});
}
function adjustColor(hex,amt){
let r=parseInt(hex.slice(1,3),16),g=parseInt(hex.slice(3,5),16),b=parseInt(hex.slice(5,7),16);
r=Math.max(0,Math.min(255,Math.floor(r*(1+amt))));g=Math.max(0,Math.min(255,Math.floor(g*(1+amt))));b=Math.max(0,Math.min(255,Math.floor(b*(1+amt))));
return '#'+[r,g,b].map(c=>c.toString(16).padStart(2,'0')).join('');
}
function renderChart(){
if(animStyle==='none'){animProgress=1;drawFrame();return}
animProgress=0;
function step(){
animProgress=Math.min(1,animProgress+.03);
drawFrame();
if(animProgress<1)requestAnimationFrame(step);
}
requestAnimationFrame(step);
}
function drawFrame(){
accentColor=document.getElementById('accentColor').value;
bgColor=document.getElementById('bgColor').value;
if(shakeIntensity>0){shakeX=(Math.random()-.5)*shakeIntensity;shakeY=(Math.random()-.5)*shakeIntensity}else{shakeX=shakeY=0}
ctx.save();ctx.translate(shakeX,shakeY);
const drawFn={bar:drawBar,line:drawLine,pie:drawPie,scatter:drawScatter,area:drawArea,radar:drawRadar,donut:drawDonut,polar:drawPolar}[chartType]||drawBar;
drawFn(animProgress);
ctx.restore();
}
function downloadImage(){
const link=document.createElement('a');link.download='chart-'+Date.now()+'.png';link.href=canvas.toDataURL();link.click();
playSound('success');showToast('Chart downloaded!');
if(gameState.mode==='free'){gameState.score+=10;updateHUD()}
}
function exportData(){
const blob=new Blob([JSON.stringify({chartType,chartData,style:{accent:accentColor,bg:bgColor,theme:colorTheme,anim:animStyle,grid:gridStyle,title:document.getElementById('chartTitle').value}},null,2)],{type:'application/json'});
const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='chart-data.json';a.click();URL.revokeObjectURL(url);
playSound('success');showToast('Data exported!');
}
function importDataFile(){document.getElementById('importFileInput').click()}
document.getElementById('importFileInput').addEventListener('change',e=>{
const file=e.target.files[0];if(!file)return;
const reader=new FileReader();reader.onload=()=>{
try{const d=JSON.parse(reader.result);if(d.chartData)chartData=d.chartData;if(d.chartType)selectChartType(d.chartType);
if(d.style){if(d.style.accent){accentColor=d.style.accent;document.getElementById('accentColor').value=d.style.accent}
if(d.style.bg){bgColor=d.style.bg;document.getElementById('bgColor').value=d.style.bg}}
document.getElementById('dataInput').value=JSON.stringify(chartData,null,2);
animProgress=0;renderChart();playSound('success');showToast('Data imported!')}
catch(e){playSound('fail');showToast('Invalid file')}};
reader.readAsText(file);e.target.value='';
});
function saveToLibrary(){
const lib=JSON.parse(localStorage.getItem('chartbuilder:library')||'[]');
lib.push({name:document.getElementById('chartTitle').value||'Untitled',type:chartType,data:chartData,style:{accent:accentColor,bg:bgColor},date:new Date().toISOString()});
localStorage.setItem('chartbuilder:library',JSON.stringify(lib));
playSound('success');showToast('Saved to library!');renderLibrary();
}
function renderLibrary(){
const lib=JSON.parse(localStorage.getItem('chartbuilder:library')||'[]');
const container=document.getElementById('library-list');
if(lib.length===0){container.innerHTML='<div style="color:#5a6888;text-align:center;padding:12px">No saved charts yet</div>';return}
container.innerHTML=lib.map((c,i)=>`<div style="display:flex;justify-content:space-between;padding:6px;border-bottom:1px solid rgba(255,255,255,0.05);align-items:center">
<span style="cursor:pointer;color:#00e88f" onclick="loadFromLibrary(${i})">${c.name}</span>
<span style="color:#5a6888;font-size:10px">${c.type}</span></div>`).join('');
}
window.loadFromLibrary=function(i){
const lib=JSON.parse(localStorage.getItem('chartbuilder:library')||'[]');
if(!lib[i])return;const c=lib[i];chartData=c.data;selectChartType(c.type);
if(c.style){accentColor=c.style.accent||accentColor;bgColor=c.style.bg||bgColor;
document.getElementById('accentColor').value=accentColor;document.getElementById('bgColor').value=bgColor}
document.getElementById('dataInput').value=JSON.stringify(chartData,null,2);
document.getElementById('chartTitle').value=c.name;
animProgress=0;renderChart();playSound('click');showToast('Loaded: '+c.name);
};
function saveHighScore(score){
const hs=JSON.parse(localStorage.getItem('chartbuilder:highscores')||'[]');
hs.push({score,date:new Date().toISOString(),difficulty:gameState.difficulty,charts:gameState.chartsCreated});
hs.sort((a,b)=>b.score-a.score);
localStorage.setItem('chartbuilder:highscores',JSON.stringify(hs.slice(0,20)));
}
function showHighScores(){
const hs=JSON.parse(localStorage.getItem('chartbuilder:highscores')||'[]');
const container=document.getElementById('title-lb');
const wrap=document.getElementById('title-leaderboard');
wrap.style.display=wrap.style.display==='none'?'block':'none';
if(hs.length===0){container.innerHTML='<div style="text-align:center;color:#5a6888;padding:12px">No scores yet</div>';return}
container.innerHTML=hs.slice(0,10).map((h,i)=>`<div class="lb-entry"><span class="rank">#${i+1}</span><span class="name">${h.difficulty} - ${h.charts} charts</span><span class="score">${h.score}</span></div>`).join('');
playSound('menu');
}
function loadSettings(){
try{const s=JSON.parse(localStorage.getItem('chartbuilder:settings'));
if(s){if(s.accent){accentColor=s.accent;document.getElementById('accentColor').value=s.accent}
if(s.bg){bgColor=s.bg;document.getElementById('bgColor').value=s.bg}
if(s.theme){document.getElementById('colorTheme').value=s.theme;currentColors=COLOR_THEMES[s.theme]||COLOR_THEMES.neon}}}catch(e){}
}
function saveSettings(){
localStorage.setItem('chartbuilder:settings',JSON.stringify({accent:accentColor,bg:bgColor,theme:document.getElementById('colorTheme').value}));
}
['accentColor','bgColor','chartTitle','animStyle','gridStyle'].forEach(id=>{
document.getElementById(id).addEventListener('change',()=>{saveSettings();renderChart()})});
let resizeTimeout;
window.addEventListener('resize',()=>{clearTimeout(resizeTimeout);resizeTimeout=setTimeout(()=>{
const area=document.getElementById('canvas-area');
if(area){const w=Math.min(900,area.clientWidth-40);const h=Math.min(600,area.clientHeight-40);
canvas.width=w;canvas.height=h;renderChart()}
},200)});
canvas.addEventListener('mousemove',e=>{
if(chartType!=='bar'&&chartType!=='scatter')return;
const rect=canvas.getBoundingClientRect();
const mx=(e.clientX-rect.left)*(canvas.width/rect.width);
const my=(e.clientY-rect.top)*(canvas.height/rect.height);
const pad=70,cw=canvas.width-pad*2;
const bw=cw/chartData.labels.length;
const idx=Math.floor((mx-pad)/bw);
if(idx>=0&&idx<chartData.labels.length){
canvas.title=chartData.labels[idx]+': '+chartData.values[idx];
canvas.style.cursor='pointer';
}else{canvas.title='';canvas.style.cursor='default'}
});
canvas.addEventListener('touchstart',e=>{e.preventDefault()},{passive:false});
canvas.addEventListener('touchmove',e=>{e.preventDefault()},{passive:false});
initChartTypes();loadSettings();renderLibrary();
document.getElementById('dataInput').value=JSON.stringify(chartData,null,2);
</script>
</body>
</html>