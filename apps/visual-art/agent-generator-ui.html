<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Agent Generator - Local-First Agent Creator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Create and manage Python AI agents locally with this visual interface. Part of the localFirstTools collection.">

<style>
:root {
  --bg: #ffffff;
  --card: #f8fafc;
  --fg: #0f172a;
  --muted: #64748b;
  --accent: #6366f1;
  --accent-hover: #4f46e5;
  --border: #e2e8f0;
  --success: #22c55e;
  --danger: #ef4444;
  --code-bg: #1e293b;
  --code-fg: #e2e8f0;
}

[data-theme="dark"] {
  --bg: #0b1120;
  --card: #1e293b;
  --fg: #e2e8f0;
  --muted: #94a3b8;
  --border: #334155;
  --code-bg: #0f172a;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  background: var(--bg);
  color: var(--fg);
  font-family: system-ui, -apple-system, sans-serif;
  line-height: 1.6;
}

header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 1.5rem;
  border-bottom: 1px solid var(--border);
  background: var(--card);
}

header h1 {
  font-size: 1.25rem;
  font-weight: 600;
}

.header-actions {
  display: flex;
  gap: 0.5rem;
}

main {
  max-width: 1200px;
  margin: 0 auto;
  padding: 1.5rem;
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1.5rem;
}

@media (max-width: 900px) {
  main { grid-template-columns: 1fr; }
}

.card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 1.25rem;
}

.card h2 {
  font-size: 1rem;
  font-weight: 600;
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.card h2 .count {
  background: var(--accent);
  color: white;
  font-size: 0.75rem;
  padding: 0.125rem 0.5rem;
  border-radius: 9999px;
}

label {
  display: block;
  font-size: 0.875rem;
  font-weight: 500;
  color: var(--muted);
  margin-bottom: 0.375rem;
  margin-top: 1rem;
}

label:first-of-type { margin-top: 0; }

input, textarea {
  width: 100%;
  background: var(--bg);
  color: var(--fg);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 0.625rem 0.75rem;
  font-size: 0.875rem;
  font-family: inherit;
  transition: border-color 0.2s;
}

input:focus, textarea:focus {
  outline: none;
  border-color: var(--accent);
}

textarea {
  min-height: 100px;
  font-family: ui-monospace, 'SF Mono', monospace;
  font-size: 0.8125rem;
  resize: vertical;
}

textarea.code {
  min-height: 150px;
  background: var(--code-bg);
  color: var(--code-fg);
}

.btn-group {
  display: flex;
  gap: 0.5rem;
  margin-top: 1.25rem;
  flex-wrap: wrap;
}

button {
  display: inline-flex;
  align-items: center;
  gap: 0.375rem;
  padding: 0.5rem 1rem;
  font-size: 0.875rem;
  font-weight: 500;
  border: 1px solid var(--border);
  border-radius: 8px;
  background: transparent;
  color: var(--fg);
  cursor: pointer;
  transition: all 0.2s;
}

button:hover {
  background: var(--border);
}

button.primary {
  background: var(--accent);
  border-color: var(--accent);
  color: white;
}

button.primary:hover {
  background: var(--accent-hover);
  border-color: var(--accent-hover);
}

button.danger {
  color: var(--danger);
  border-color: var(--danger);
}

button.danger:hover {
  background: var(--danger);
  color: white;
}

button.small {
  padding: 0.375rem 0.625rem;
  font-size: 0.75rem;
}

.agents-list {
  max-height: 600px;
  overflow-y: auto;
}

.agent-item {
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 1rem;
  margin-bottom: 0.75rem;
  background: var(--bg);
}

.agent-item:last-child { margin-bottom: 0; }

.agent-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 0.5rem;
}

.agent-name {
  font-weight: 600;
  color: var(--accent);
}

.agent-desc {
  font-size: 0.875rem;
  color: var(--muted);
  margin-bottom: 0.75rem;
}

.agent-meta {
  font-size: 0.75rem;
  color: var(--muted);
}

.agent-code {
  background: var(--code-bg);
  color: var(--code-fg);
  padding: 0.75rem;
  border-radius: 6px;
  font-family: ui-monospace, 'SF Mono', monospace;
  font-size: 0.75rem;
  overflow-x: auto;
  white-space: pre;
  margin-top: 0.75rem;
  max-height: 200px;
  overflow-y: auto;
}

.preview-section {
  margin-top: 1.5rem;
  padding-top: 1.5rem;
  border-top: 1px solid var(--border);
}

.preview-section h3 {
  font-size: 0.875rem;
  font-weight: 600;
  margin-bottom: 0.75rem;
  color: var(--muted);
}

.status {
  padding: 0.75rem;
  border-radius: 8px;
  font-size: 0.875rem;
  margin-top: 1rem;
}

.status.success {
  background: rgba(34, 197, 94, 0.1);
  border: 1px solid var(--success);
  color: var(--success);
}

.status.error {
  background: rgba(239, 68, 68, 0.1);
  border: 1px solid var(--danger);
  color: var(--danger);
}

.empty-state {
  text-align: center;
  padding: 2rem;
  color: var(--muted);
}

/* Syntax highlighting classes */
.kw { color: #c678dd; }
.str { color: #98c379; }
.fn { color: #61afef; }
.cls { color: #e5c07b; }
.cmt { color: #5c6370; font-style: italic; }
.num { color: #d19a66; }

footer {
  text-align: center;
  padding: 1rem;
  font-size: 0.75rem;
  color: var(--muted);
  border-top: 1px solid var(--border);
  margin-top: 2rem;
}

/* Hidden file input */
#importFile { display: none; }
</style>
</head>

<body>
<header>
  <h1>Agent Generator</h1>
  <div class="header-actions">
    <button id="exportBtn" title="Export Registry">Export</button>
    <button id="importBtn" title="Import Registry">Import</button>
    <button id="themeBtn" title="Toggle Theme">Toggle Theme</button>
  </div>
</header>
<input type="file" id="importFile" accept=".json">

<main>
  <div class="card">
    <h2>Create New Agent</h2>

    <label for="agentName">Agent Name</label>
    <input type="text" id="agentName" placeholder="MyCustomAgent" autocomplete="off">

    <label for="agentDesc">Description</label>
    <input type="text" id="agentDesc" placeholder="What this agent does and when to use it">

    <label for="agentParams">Parameters (JSON)</label>
    <textarea id="agentParams" placeholder='{
  "type": "object",
  "properties": {
    "input": {
      "type": "string",
      "description": "The input to process"
    }
  },
  "required": ["input"]
}'></textarea>

    <label for="agentImpl">Implementation (perform method body)</label>
    <textarea id="agentImpl" class="code" placeholder="# Access parameters via kwargs
input_value = kwargs.get('input', '')
result = input_value.upper()
return f'Processed: {result}'"></textarea>

    <div class="btn-group">
      <button class="primary" id="createBtn">Create Agent</button>
      <button id="previewBtn">Preview Code</button>
      <button id="clearBtn">Clear Form</button>
    </div>

    <div id="status"></div>

    <div class="preview-section" id="previewSection" style="display: none;">
      <h3>Generated Python Code</h3>
      <div class="agent-code" id="previewCode"></div>
    </div>
  </div>

  <div class="card">
    <h2>Registered Agents <span class="count" id="agentCount">0</span></h2>
    <div class="agents-list" id="agentsList">
      <div class="empty-state">No agents created yet</div>
    </div>
  </div>
</main>

<footer>
  Agent Generator - Part of localFirstTools - Local-First, Zero Dependencies
</footer>

<script>
const STORAGE_KEY = 'agent-generator:registry';
const THEME_KEY = 'agent-generator:theme';

// DOM Elements
const agentName = document.getElementById('agentName');
const agentDesc = document.getElementById('agentDesc');
const agentParams = document.getElementById('agentParams');
const agentImpl = document.getElementById('agentImpl');
const createBtn = document.getElementById('createBtn');
const previewBtn = document.getElementById('previewBtn');
const clearBtn = document.getElementById('clearBtn');
const exportBtn = document.getElementById('exportBtn');
const importBtn = document.getElementById('importBtn');
const importFile = document.getElementById('importFile');
const themeBtn = document.getElementById('themeBtn');
const statusEl = document.getElementById('status');
const previewSection = document.getElementById('previewSection');
const previewCode = document.getElementById('previewCode');
const agentsList = document.getElementById('agentsList');
const agentCount = document.getElementById('agentCount');

// Load/Save Registry
function loadRegistry() {
  try {
    return JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
  } catch {
    return {};
  }
}

function saveRegistry(registry) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(registry, null, 2));
}

// Generate Python Code
function generatePythonCode(name, description, params, implementation) {
  const safeName = sanitizeName(name);
  const safeDesc = escapeString(description);
  const paramsJson = formatParams(params);
  const indentedImpl = indentCode(implementation || "return 'Agent executed'");

  return `"""
${safeName} - Auto-generated agent

${description}
"""

from basic_agent import BasicAgent


class ${safeName}(BasicAgent):
    """
    ${description}
    """

    def __init__(self):
        self.name = "${safeName}"
        self.metadata = {
            "name": self.name,
            "description": "${safeDesc}",
            "parameters": ${paramsJson}
        }
        super().__init__()

    def perform(self, **kwargs):
${indentedImpl}
`;
}

function sanitizeName(name) {
  let sanitized = name.replace(/[^a-zA-Z0-9_]/g, '');
  if (sanitized && !/^[a-zA-Z]/.test(sanitized)) {
    sanitized = 'Agent' + sanitized;
  }
  // Convert to PascalCase
  if (sanitized.includes('_')) {
    sanitized = sanitized.split('_')
      .map(p => p.charAt(0).toUpperCase() + p.slice(1).toLowerCase())
      .join('');
  } else if (sanitized) {
    sanitized = sanitized.charAt(0).toUpperCase() + sanitized.slice(1);
  }
  return sanitized || 'UnnamedAgent';
}

function escapeString(str) {
  return str.replace(/\\/g, '\\\\').replace(/"/g, '\\"').replace(/\n/g, '\\n');
}

function formatParams(paramsStr) {
  try {
    const parsed = JSON.parse(paramsStr || '{}');
    return JSON.stringify(parsed, null, 12).split('\n').map((line, i) =>
      i === 0 ? line : '            ' + line
    ).join('\n');
  } catch {
    return '{}';
  }
}

function indentCode(code, spaces = 8) {
  const indent = ' '.repeat(spaces);
  return code.split('\n').map(line => indent + line).join('\n');
}

// Syntax Highlighting
function highlightPython(code) {
  const keywords = ['from', 'import', 'class', 'def', 'return', 'if', 'else', 'elif', 'for', 'while', 'try', 'except', 'with', 'as', 'None', 'True', 'False', 'self', 'super'];

  let html = code
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;');

  // Comments
  html = html.replace(/(#.*$)/gm, '<span class="cmt">$1</span>');

  // Triple-quoted strings
  html = html.replace(/("""[\s\S]*?""")/g, '<span class="str">$1</span>');

  // Strings
  html = html.replace(/("(?:[^"\\]|\\.)*")/g, '<span class="str">$1</span>');
  html = html.replace(/('(?:[^'\\]|\\.)*')/g, '<span class="str">$1</span>');

  // Keywords
  keywords.forEach(kw => {
    const regex = new RegExp(`\\b(${kw})\\b`, 'g');
    html = html.replace(regex, '<span class="kw">$1</span>');
  });

  // Function definitions
  html = html.replace(/\b(def)\s+(\w+)/g, '<span class="kw">$1</span> <span class="fn">$2</span>');

  // Class definitions
  html = html.replace(/\b(class)\s+(\w+)/g, '<span class="kw">$1</span> <span class="cls">$2</span>');

  // Numbers
  html = html.replace(/\b(\d+)\b/g, '<span class="num">$1</span>');

  return html;
}

// Render Agents List
function renderAgents() {
  const registry = loadRegistry();
  const agents = Object.entries(registry);

  agentCount.textContent = agents.length;

  if (agents.length === 0) {
    agentsList.innerHTML = '<div class="empty-state">No agents created yet</div>';
    return;
  }

  agentsList.innerHTML = agents.map(([name, agent]) => `
    <div class="agent-item">
      <div class="agent-header">
        <span class="agent-name">${name}</span>
        <button class="small danger" onclick="deleteAgent('${name}')">Delete</button>
      </div>
      <div class="agent-desc">${agent.description || 'No description'}</div>
      <div class="agent-meta">Created: ${new Date(agent.created_at).toLocaleString()}</div>
      <details>
        <summary style="cursor: pointer; color: var(--accent); font-size: 0.75rem; margin-top: 0.5rem;">View Code</summary>
        <div class="agent-code">${highlightPython(agent.code)}</div>
      </details>
    </div>
  `).join('');
}

// Create Agent
function createAgent() {
  const name = agentName.value.trim();
  const desc = agentDesc.value.trim();
  const params = agentParams.value.trim();
  const impl = agentImpl.value.trim();

  if (!name) {
    showStatus('Agent name is required', 'error');
    return;
  }

  const safeName = sanitizeName(name);
  const registry = loadRegistry();

  if (registry[safeName]) {
    showStatus(`Agent "${safeName}" already exists`, 'error');
    return;
  }

  // Validate params JSON
  if (params) {
    try {
      JSON.parse(params);
    } catch {
      showStatus('Invalid JSON in parameters', 'error');
      return;
    }
  }

  const code = generatePythonCode(name, desc, params, impl);

  registry[safeName] = {
    description: desc,
    parameters: params ? JSON.parse(params) : {},
    implementation: impl,
    code: code,
    created_at: new Date().toISOString()
  };

  saveRegistry(registry);
  renderAgents();
  showStatus(`Agent "${safeName}" created successfully!`, 'success');
  clearForm();
}

// Delete Agent
window.deleteAgent = function(name) {
  if (!confirm(`Delete agent "${name}"?`)) return;

  const registry = loadRegistry();
  delete registry[name];
  saveRegistry(registry);
  renderAgents();
  showStatus(`Agent "${name}" deleted`, 'success');
};

// Preview Code
function previewAgentCode() {
  const name = agentName.value.trim() || 'MyAgent';
  const desc = agentDesc.value.trim() || 'Description';
  const params = agentParams.value.trim();
  const impl = agentImpl.value.trim();

  const code = generatePythonCode(name, desc, params, impl);
  previewCode.innerHTML = highlightPython(code);
  previewSection.style.display = 'block';
}

// Clear Form
function clearForm() {
  agentName.value = '';
  agentDesc.value = '';
  agentParams.value = '';
  agentImpl.value = '';
  previewSection.style.display = 'none';
  statusEl.innerHTML = '';
}

// Status Message
function showStatus(message, type) {
  statusEl.innerHTML = `<div class="status ${type}">${message}</div>`;
  setTimeout(() => statusEl.innerHTML = '', 5000);
}

// Export Registry
function exportRegistry() {
  const registry = loadRegistry();
  const blob = new Blob([JSON.stringify(registry, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'agent-registry.json';
  a.click();
  URL.revokeObjectURL(url);
}

// Import Registry
function importRegistry(file) {
  const reader = new FileReader();
  reader.onload = () => {
    try {
      const imported = JSON.parse(reader.result);
      const current = loadRegistry();
      Object.assign(current, imported);
      saveRegistry(current);
      renderAgents();
      showStatus(`Imported ${Object.keys(imported).length} agents`, 'success');
    } catch {
      showStatus('Invalid JSON file', 'error');
    }
  };
  reader.readAsText(file);
}

// Theme Toggle
function loadTheme() {
  const theme = localStorage.getItem(THEME_KEY) || 'dark';
  document.documentElement.dataset.theme = theme;
}

function toggleTheme() {
  const current = document.documentElement.dataset.theme;
  const next = current === 'dark' ? 'light' : 'dark';
  document.documentElement.dataset.theme = next;
  localStorage.setItem(THEME_KEY, next);
}

// Event Listeners
createBtn.addEventListener('click', createAgent);
previewBtn.addEventListener('click', previewAgentCode);
clearBtn.addEventListener('click', clearForm);
exportBtn.addEventListener('click', exportRegistry);
importBtn.addEventListener('click', () => importFile.click());
importFile.addEventListener('change', (e) => {
  if (e.target.files[0]) importRegistry(e.target.files[0]);
  e.target.value = '';
});
themeBtn.addEventListener('click', toggleTheme);

// Initialize
loadTheme();
renderAgents();
</script>
</body>
</html>
