<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Local-First App Builder</title>
<meta name="description" content="Interactive template builder with live preview, scoring challenges, canvas-based code visualization, Web Audio feedback, and localStorage persistence">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:system-ui,-apple-system,sans-serif;background:#0b1020;color:#e5e7eb;height:100vh;overflow:hidden;user-select:none}
:root{--accent:#818cf8;--accent2:#6366f1;--bg:#0b1020;--surface:#111827;--card:#1e293b;--border:#334155;--text:#e5e7eb;--muted:#94a3b8;--success:#22c55e;--danger:#ef4444;--warning:#f59e0b}
#title-screen{position:fixed;top:0;left:0;width:100%;height:100%;background:radial-gradient(ellipse at center,#111827 0%,#0b1020 100%);z-index:1000;display:flex;flex-direction:column;align-items:center;justify-content:center}
#title-screen h1{font-size:44px;color:var(--accent);margin-bottom:6px;text-shadow:0 0 30px rgba(129,140,248,.3)}
#title-screen .sub{color:var(--muted);font-size:15px;margin-bottom:36px}
.tbtn{width:240px;padding:13px;margin:5px;font-size:14px;border-radius:8px;background:var(--accent);color:#fff;border:none;cursor:pointer;font-weight:600;transition:all .2s}
.tbtn:hover{transform:translateY(-2px);box-shadow:0 4px 20px rgba(129,140,248,.3)}
.tbtn.sec{background:transparent;border:1px solid var(--border);color:var(--text)}
.diff-row{display:flex;gap:8px;margin:16px 0}
.dopt{padding:8px 20px;border-radius:6px;background:rgba(129,140,248,.08);border:1px solid rgba(129,140,248,.2);color:var(--accent);cursor:pointer;font-size:13px;transition:all .2s}
.dopt.active{background:rgba(129,140,248,.2);border-color:var(--accent)}
#pause-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(11,16,32,.92);z-index:999;display:none;flex-direction:column;align-items:center;justify-content:center}
#pause-overlay h2{font-size:36px;color:var(--accent);margin-bottom:20px}
#game-over{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(11,16,32,.95);z-index:999;display:none;flex-direction:column;align-items:center;justify-content:center}
.final-score{font-size:56px;color:var(--accent);font-weight:800;margin:12px 0}
.end-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:16px 0;width:300px}
.end-box{background:rgba(129,140,248,.05);border:1px solid rgba(129,140,248,.1);border-radius:8px;padding:10px;text-align:center}
.end-box .lbl{font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:1px}
.end-box .val{font-size:20px;color:var(--accent);font-weight:700}
#app{display:grid;grid-template-columns:1fr 1fr;height:100vh;display:none}
#editor-side{display:flex;flex-direction:column;border-right:1px solid var(--border);background:var(--surface)}
#preview-side{display:flex;flex-direction:column;background:var(--bg)}
.header-bar{padding:10px 16px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;background:var(--card);flex-shrink:0}
.header-bar h2{font-size:14px;color:var(--accent);font-weight:600}
.hud{display:flex;gap:14px}
.hud-item{text-align:center}
.hud-lbl{font-size:9px;color:var(--muted);text-transform:uppercase;letter-spacing:1px}
.hud-val{font-size:16px;font-weight:700;color:var(--accent)}
.editor-area{flex:1;overflow-y:auto;padding:12px}
.field{margin-bottom:12px}
.field label{display:block;font-size:11px;color:var(--muted);margin-bottom:4px;font-weight:600;text-transform:uppercase;letter-spacing:.5px}
input[type="text"],textarea,select{width:100%;padding:8px 10px;background:rgba(0,0,0,.3);border:1px solid var(--border);border-radius:6px;color:var(--text);font-size:12px;font-family:inherit;transition:border-color .2s}
input:focus,textarea:focus,select:focus{outline:none;border-color:var(--accent)}
textarea{font-family:'SF Mono',Monaco,monospace;font-size:11px;resize:vertical;min-height:80px}
.btn{width:100%;padding:9px;background:var(--accent);color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:600;font-size:12px;transition:all .2s;margin-bottom:5px}
.btn:hover{transform:translateY(-1px);box-shadow:0 3px 12px rgba(129,140,248,.3)}
.btn.sec{background:transparent;border:1px solid var(--border);color:var(--text)}
.btn.suc{background:var(--success)}
.btn-row{display:flex;gap:6px}
.btn-row .btn{flex:1}
.tabs{display:flex;gap:0;border-bottom:1px solid var(--border);flex-shrink:0}
.tab{padding:8px 16px;background:transparent;border:none;border-bottom:2px solid transparent;color:var(--muted);cursor:pointer;font-size:12px;font-weight:500;transition:all .2s}
.tab.active{color:var(--accent);border-bottom-color:var(--accent)}
.tab-content{display:none}
.tab-content.active{display:block}
.preview-frame{flex:1;background:#fff;border-radius:6px;margin:12px;overflow:hidden;position:relative}
.preview-frame iframe{width:100%;height:100%;border:none}
canvas#code-viz{width:100%;height:200px;background:var(--card);border-radius:6px;margin-bottom:12px;display:block}
.template-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px}
.template-card{background:var(--card);border:1px solid var(--border);border-radius:8px;padding:10px;cursor:pointer;text-align:center;transition:all .2s;font-size:12px}
.template-card:hover{border-color:var(--accent);transform:translateY(-2px)}
.template-card.active{border-color:var(--accent);background:rgba(129,140,248,.1)}
.template-card .name{font-weight:600;color:var(--text);margin-bottom:4px}
.template-card .desc{font-size:10px;color:var(--muted)}
#challenge-box{display:none;background:rgba(129,140,248,.05);border:1px solid rgba(129,140,248,.1);border-radius:8px;padding:12px;margin-bottom:12px}
#challenge-box h3{font-size:11px;color:var(--accent);margin-bottom:6px;text-transform:uppercase;letter-spacing:1px}
.saved-list{max-height:150px;overflow-y:auto;font-size:11px}
.saved-item{display:flex;justify-content:space-between;padding:6px 8px;border-bottom:1px solid rgba(255,255,255,.03);cursor:pointer}
.saved-item:hover{background:rgba(129,140,248,.05)}
.saved-item .name{color:var(--accent)}
.saved-item .date{color:var(--muted);font-size:10px}
#toast{position:fixed;top:20px;left:50%;transform:translateX(-50%);background:rgba(129,140,248,.15);border:1px solid var(--accent);color:var(--accent);padding:10px 24px;border-radius:8px;font-weight:700;font-size:13px;opacity:0;transition:opacity .3s;z-index:2000;pointer-events:none}
#combo-display{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);font-size:48px;font-weight:900;color:var(--accent);text-shadow:0 0 20px rgba(129,140,248,.5);opacity:0;z-index:500;pointer-events:none;transition:opacity .3s,transform .3s}
.particles{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:400}
@media(max-width:768px){#app{grid-template-columns:1fr}#preview-side{display:none}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.6}}
</style>
</head>
<body>
<div id="title-screen">
<h1>App Builder</h1>
<p class="sub">Local-First Template Studio</p>
<div class="diff-row">
<div class="dopt active" data-d="casual" onclick="setDiff('casual')">Casual</div>
<div class="dopt" data-d="normal" onclick="setDiff('normal')">Normal</div>
<div class="dopt" data-d="expert" onclick="setDiff('expert')">Expert</div>
</div>
<button class="tbtn" onclick="startFree()">Free Build</button>
<button class="tbtn sec" onclick="startChallenge()">Build Challenge</button>
<button class="tbtn sec" onclick="toggleHS()">High Scores</button>
<div id="title-hs" style="margin-top:16px;width:300px;display:none"></div>
</div>
<div id="pause-overlay">
<h2>PAUSED</h2>
<p style="color:var(--muted);margin-bottom:20px">Press ESC to resume</p>
<button class="tbtn" onclick="togglePause()">Resume</button>
<button class="tbtn sec" onclick="toTitle()">Main Menu</button>
</div>
<div id="game-over">
<h2 style="color:var(--muted)">BUILD COMPLETE</h2>
<div class="final-score" id="final-score">0</div>
<div class="end-grid" id="end-stats"></div>
<button class="tbtn" onclick="startChallenge()">Retry</button>
<button class="tbtn sec" onclick="toTitle()">Main Menu</button>
</div>
<div id="toast"></div>
<div id="combo-display"></div>
<div class="particles" id="particles"></div>
<div id="app">
<div id="editor-side">
<div class="header-bar">
<h2>EDITOR</h2>
<div id="mode-lbl" style="font-size:11px;color:var(--muted)">Free Build</div>
</div>
<div class="tabs">
<button class="tab active" onclick="switchTab('build')">Build</button>
<button class="tab" onclick="switchTab('templates')">Templates</button>
<button class="tab" onclick="switchTab('saved')">Saved</button>
</div>
<div class="editor-area">
<div id="build-tab" class="tab-content active">
<div id="challenge-box">
<h3>Challenge</h3>
<div id="ch-desc" style="font-size:12px;color:var(--muted);margin-bottom:6px"></div>
<div id="ch-timer" style="font-size:20px;color:var(--accent);font-weight:700;text-align:center;margin-bottom:8px"></div>
<button class="btn suc" onclick="submitBuild()">Submit Build</button>
</div>
<canvas id="code-viz" width="400" height="180"></canvas>
<div class="field"><label>App Title</label><input type="text" id="appTitle" value="My Local App" oninput="updatePreview()"></div>
<div class="field"><label>Description</label><input type="text" id="appDesc" value="A self-contained local-first tool" oninput="updatePreview()"></div>
<div class="field"><label>Theme</label><select id="appTheme" onchange="updatePreview()"><option value="dark">Dark</option><option value="light">Light</option><option value="ocean">Ocean</option><option value="forest">Forest</option><option value="sunset">Sunset</option></select></div>
<div class="field"><label>Layout</label><select id="appLayout" onchange="updatePreview()"><option value="centered">Centered</option><option value="sidebar">Sidebar</option><option value="split">Split</option><option value="full">Full Width</option></select></div>
<div class="field"><label>Components</label>
<div style="display:flex;flex-wrap:wrap;gap:6px;margin-top:4px">
<label style="font-size:11px;display:flex;align-items:center;gap:4px;cursor:pointer;margin:0"><input type="checkbox" id="comp-editor" checked onchange="updatePreview()"> Editor</label>
<label style="font-size:11px;display:flex;align-items:center;gap:4px;cursor:pointer;margin:0"><input type="checkbox" id="comp-export" checked onchange="updatePreview()"> Export</label>
<label style="font-size:11px;display:flex;align-items:center;gap:4px;cursor:pointer;margin:0"><input type="checkbox" id="comp-import" checked onchange="updatePreview()"> Import</label>
<label style="font-size:11px;display:flex;align-items:center;gap:4px;cursor:pointer;margin:0"><input type="checkbox" id="comp-theme" checked onchange="updatePreview()"> Theme Toggle</label>
<label style="font-size:11px;display:flex;align-items:center;gap:4px;cursor:pointer;margin:0"><input type="checkbox" id="comp-search" onchange="updatePreview()"> Search</label>
<label style="font-size:11px;display:flex;align-items:center;gap:4px;cursor:pointer;margin:0"><input type="checkbox" id="comp-stats" onchange="updatePreview()"> Stats</label>
</div>
</div>
<div class="field"><label>Custom CSS</label><textarea id="customCSS" rows="4" placeholder=".custom { color: red; }" oninput="updatePreview()"></textarea></div>
<div class="field"><label>Custom JS</label><textarea id="customJS" rows="4" placeholder="console.log('Hello!');" oninput="updatePreview()"></textarea></div>
<div class="btn-row">
<button class="btn" onclick="downloadApp()">Download HTML</button>
<button class="btn sec" onclick="saveApp()">Save</button>
</div>
<button class="btn sec" onclick="exportJSON()">Export JSON</button>
<button class="btn sec" onclick="importJSON()">Import JSON</button>
<input type="file" id="importFile" accept=".json" style="display:none">
</div>
<div id="templates-tab" class="tab-content">
<div class="template-grid" id="template-grid"></div>
</div>
<div id="saved-tab" class="tab-content">
<div class="saved-list" id="saved-list"></div>
</div>
</div>
</div>
<div id="preview-side">
<div class="header-bar">
<h2>PREVIEW</h2>
<div class="hud">
<div class="hud-item"><div class="hud-lbl">Score</div><div class="hud-val" id="hud-score">0</div></div>
<div class="hud-item"><div class="hud-lbl">Level</div><div class="hud-val" id="hud-level">1</div></div>
<div class="hud-item"><div class="hud-lbl">Streak</div><div class="hud-val" id="hud-streak">0</div></div>
</div>
</div>
<div class="preview-frame"><iframe id="preview-iframe"></iframe></div>
</div>
</div>
<script>
const vizCanvas=document.getElementById('code-viz'),vCtx=vizCanvas.getContext('2d');
let audioCtx=null;
let GS={mode:'title',score:0,level:1,streak:0,combo:1,builds:0,timer:0,interval:null,paused:false,diff:'normal',totalTime:0,bestCombo:1,perfects:0};
let vizAngle=0,vizData=[];
const THEMES={dark:{bg:'#0b1020',fg:'#e5e7eb',card:'#1e293b',accent:'#818cf8',border:'#334155'},light:{bg:'#fff',fg:'#0f172a',card:'#f8fafc',accent:'#6366f1',border:'#e5e7eb'},ocean:{bg:'#0a192f',fg:'#ccd6f6',card:'#112240',accent:'#64ffda',border:'#233554'},forest:{bg:'#1a2f1a',fg:'#d4e6d4',card:'#243524',accent:'#7bc67b',border:'#345634'},sunset:{bg:'#2d1b2e',fg:'#f0d0f0',card:'#3d2b3e',accent:'#ff7eb3',border:'#5d4b5e'}};
const TEMPLATES=[
{name:'Note Pad',desc:'Simple text editor',title:'Quick Notes',layout:'centered',theme:'dark',components:['editor','export','theme']},
{name:'Todo List',desc:'Task manager',title:'My Tasks',layout:'sidebar',theme:'dark',components:['editor','export','import','theme','stats']},
{name:'JSON Viewer',desc:'Data inspector',title:'JSON Inspector',layout:'split',theme:'ocean',components:['editor','export','import','search']},
{name:'Markdown',desc:'MD preview',title:'Markdown Editor',layout:'split',theme:'dark',components:['editor','export','import','theme']},
{name:'Color Picker',desc:'Color palette',title:'Color Studio',layout:'centered',theme:'dark',components:['editor','export','stats']},
{name:'Timer',desc:'Countdown clock',title:'Focus Timer',layout:'centered',theme:'forest',components:['editor','theme','stats']},
{name:'Calculator',desc:'Quick math',title:'Quick Calc',layout:'centered',theme:'dark',components:['editor','stats']},
{name:'Diary',desc:'Daily journal',title:'My Diary',layout:'sidebar',theme:'sunset',components:['editor','export','import','search','theme']}
];
const CHALLENGES=[
{desc:'Build a note-taking app with dark theme and export',reqs:['editor','export'],theme:'dark',time:45},
{desc:'Create a sidebar layout app with search and import',reqs:['editor','search','import'],layout:'sidebar',time:50},
{desc:'Design an ocean-themed tool with all components',reqs:['editor','export','import','theme','search','stats'],theme:'ocean',time:60},
{desc:'Build a minimal app with only editor - under 30 seconds',reqs:['editor'],time:30},
{desc:'Create a split-layout JSON tool with stats',reqs:['editor','stats'],layout:'split',time:40},
{desc:'Design a sunset-themed diary with full features',reqs:['editor','export','import','search','theme'],theme:'sunset',time:55},
{desc:'Build a forest-themed timer app',reqs:['editor','theme','stats'],theme:'forest',time:35},
{desc:'Create a light-theme full-width app',reqs:['editor','export','import'],theme:'light',layout:'full',time:45}
];
let chIdx=0;
function initAudio(){if(audioCtx)return;try{audioCtx=new(window.AudioContext||window.webkitAudioContext)()}catch(e){}}
function snd(type){
if(!audioCtx)return;const o=audioCtx.createOscillator(),g=audioCtx.createGain();o.connect(g);g.connect(audioCtx.destination);const t=audioCtx.currentTime;
switch(type){
case'click':o.frequency.setValueAtTime(600,t);o.frequency.exponentialRampToValueAtTime(300,t+.06);g.gain.setValueAtTime(.1,t);g.gain.exponentialRampToValueAtTime(.001,t+.07);o.type='sine';o.start(t);o.stop(t+.07);break;
case'build':o.frequency.setValueAtTime(523,t);o.frequency.setValueAtTime(659,t+.1);o.frequency.setValueAtTime(784,t+.2);g.gain.setValueAtTime(.08,t);g.gain.exponentialRampToValueAtTime(.001,t+.35);o.type='sine';o.start(t);o.stop(t+.35);break;
case'combo':o.frequency.setValueAtTime(880,t);o.frequency.exponentialRampToValueAtTime(1760,t+.1);g.gain.setValueAtTime(.07,t);g.gain.exponentialRampToValueAtTime(.001,t+.12);o.type='triangle';o.start(t);o.stop(t+.12);break;
case'fail':o.frequency.setValueAtTime(200,t);o.frequency.exponentialRampToValueAtTime(80,t+.2);g.gain.setValueAtTime(.08,t);g.gain.exponentialRampToValueAtTime(.001,t+.2);o.type='sawtooth';o.start(t);o.stop(t+.2);break;
case'save':o.frequency.setValueAtTime(440,t);o.frequency.setValueAtTime(880,t+.15);g.gain.setValueAtTime(.06,t);g.gain.exponentialRampToValueAtTime(.001,t+.25);o.type='sine';o.start(t);o.stop(t+.25);break;
case'menu':o.frequency.setValueAtTime(500,t);g.gain.setValueAtTime(.04,t);g.gain.exponentialRampToValueAtTime(.001,t+.03);o.type='sine';o.start(t);o.stop(t+.03);break;
}
}
function toast(msg){const el=document.getElementById('toast');el.textContent=msg;el.style.opacity='1';setTimeout(()=>el.style.opacity='0',2000)}
function showCombo(txt){const el=document.getElementById('combo-display');el.textContent=txt;el.style.opacity='1';el.style.transform='translate(-50%,-50%) scale(1.4)';setTimeout(()=>{el.style.opacity='0';el.style.transform='translate(-50%,-50%) scale(1)'},700)}
function particles(x,y,col,n){const c=document.getElementById('particles');for(let i=0;i<n;i++){const p=document.createElement('div');const a=Math.random()*Math.PI*2,s=2+Math.random()*3,sz=3+Math.random()*4;p.style.cssText=`position:absolute;left:${x}px;top:${y}px;width:${sz}px;height:${sz}px;background:${col};border-radius:50%;pointer-events:none`;c.appendChild(p);let px=x,py=y,vx=Math.cos(a)*s,vy=Math.sin(a)*s,life=1;const anim=()=>{life-=.025;px+=vx;py+=vy+.8;p.style.left=px+'px';p.style.top=py+'px';p.style.opacity=life;if(life>0)requestAnimationFrame(anim);else p.remove()};requestAnimationFrame(anim)}}
function setDiff(d){GS.diff=d;document.querySelectorAll('.dopt').forEach(e=>e.classList.toggle('active',e.dataset.d===d));snd('click')}
function startFree(){initAudio();snd('menu');GS.mode='free';document.getElementById('title-screen').style.display='none';document.getElementById('app').style.display='grid';document.getElementById('mode-lbl').textContent='Free Build';document.getElementById('challenge-box').style.display='none';updatePreview();startViz();renderTemplates();renderSaved()}
function startChallenge(){initAudio();snd('build');GS={...GS,mode:'challenge',score:0,level:1,streak:0,combo:1,builds:0,totalTime:0,bestCombo:1,perfects:0};chIdx=0;
document.getElementById('title-screen').style.display='none';document.getElementById('game-over').style.display='none';document.getElementById('app').style.display='grid';
document.getElementById('mode-lbl').textContent='Challenge Mode';document.getElementById('challenge-box').style.display='block';
updateHUD();loadChallenge();startViz();renderTemplates();renderSaved()}
function loadChallenge(){
const ch=CHALLENGES[chIdx%CHALLENGES.length];const tm=GS.diff==='casual'?1.4:GS.diff==='expert'?.7:1;
GS.timer=Math.floor(ch.time*tm);
document.getElementById('ch-desc').innerHTML='<strong>Level '+GS.level+':</strong> '+ch.desc;
document.getElementById('ch-timer').textContent=GS.timer+'s';
if(GS.interval)clearInterval(GS.interval);
GS.interval=setInterval(()=>{if(GS.paused)return;GS.timer--;GS.totalTime++;
document.getElementById('ch-timer').textContent=GS.timer+'s';
document.getElementById('ch-timer').style.color=GS.timer<=10?'var(--danger)':'var(--accent)';
if(GS.timer<=0){clearInterval(GS.interval);failBuild()}},1000);
updatePreview()
}
function submitBuild(){
if(GS.mode!=='challenge')return;clearInterval(GS.interval);
const ch=CHALLENGES[chIdx%CHALLENGES.length];
let pts=100+GS.timer*5;
const comps=getActiveComponents();
const hasAll=ch.reqs.every(r=>comps.includes(r));
if(hasAll)pts+=50;
if(ch.theme&&document.getElementById('appTheme').value===ch.theme)pts+=20;
if(ch.layout&&document.getElementById('appLayout').value===ch.layout)pts+=20;
const dm=GS.diff==='casual'?.8:GS.diff==='expert'?1.5:1;
pts=Math.floor(pts*dm*GS.combo);
if(pts>200)GS.perfects++;
GS.score+=pts;GS.builds++;GS.streak++;
if(GS.streak%3===0){GS.combo=Math.min(GS.combo+1,8);snd('combo');showCombo('x'+GS.combo+' COMBO!');particles(window.innerWidth/2,window.innerHeight/2,'var(--accent)',25)}
if(GS.combo>GS.bestCombo)GS.bestCombo=GS.combo;
snd('build');toast('+'+pts+' pts (x'+GS.combo+')');
GS.level++;chIdx++;
if(chIdx>=CHALLENGES.length*2){endChallenge();return}
updateHUD();loadChallenge()
}
function failBuild(){GS.streak=0;GS.combo=1;snd('fail');toast('Time up!');GS.level++;chIdx++;if(chIdx>=CHALLENGES.length*2){endChallenge();return}updateHUD();loadChallenge()}
function endChallenge(){
clearInterval(GS.interval);document.getElementById('app').style.display='none';document.getElementById('game-over').style.display='flex';
document.getElementById('final-score').textContent=GS.score;
document.getElementById('end-stats').innerHTML=`<div class="end-box"><div class="lbl">Builds</div><div class="val">${GS.builds}</div></div><div class="end-box"><div class="lbl">Best Combo</div><div class="val">x${GS.bestCombo}</div></div><div class="end-box"><div class="lbl">Perfect</div><div class="val">${GS.perfects}</div></div><div class="end-box"><div class="lbl">Time</div><div class="val">${GS.totalTime}s</div></div>`;
saveHS(GS.score);snd('build')
}
function updateHUD(){document.getElementById('hud-score').textContent=GS.score;document.getElementById('hud-level').textContent=GS.level;document.getElementById('hud-streak').textContent=GS.streak}
function togglePause(){GS.paused=!GS.paused;document.getElementById('pause-overlay').style.display=GS.paused?'flex':'none';snd('menu')}
function toTitle(){GS.paused=false;if(GS.interval)clearInterval(GS.interval);document.getElementById('pause-overlay').style.display='none';document.getElementById('game-over').style.display='none';document.getElementById('app').style.display='none';document.getElementById('title-screen').style.display='flex'}
document.addEventListener('keydown',e=>{if(e.key==='Escape'){e.preventDefault();if(GS.mode!=='title')togglePause()}if((e.key==='r'||e.key==='R')&&GS.mode==='challenge'&&!GS.paused)startChallenge()});
function switchTab(name){document.querySelectorAll('.tab').forEach((t,i)=>t.classList.toggle('active',['build','templates','saved'][i]===name));document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));document.getElementById(name+'-tab').classList.add('active');snd('click')}
function getActiveComponents(){const ids=['editor','export','import','theme','search','stats'];return ids.filter(id=>document.getElementById('comp-'+id).checked)}
function generateHTML(){
const title=document.getElementById('appTitle').value||'My App';
const desc=document.getElementById('appDesc').value||'A local-first tool';
const theme=THEMES[document.getElementById('appTheme').value]||THEMES.dark;
const layout=document.getElementById('appLayout').value;
const comps=getActiveComponents();
const customCSS=document.getElementById('customCSS').value;
const customJS=document.getElementById('customJS').value;
let bodyHTML='';
if(layout==='sidebar')bodyHTML='<div style="display:flex;height:100vh"><aside style="width:280px;padding:1rem;background:'+theme.card+';border-right:1px solid '+theme.border+'"><h2 style="font-size:1rem;margin-bottom:1rem">Navigation</h2></aside><main style="flex:1;padding:1.5rem">';
else if(layout==='split')bodyHTML='<div style="display:grid;grid-template-columns:1fr 1fr;height:100vh"><div style="padding:1.5rem;border-right:1px solid '+theme.border+'">';
else if(layout==='full')bodyHTML='<main style="padding:1.5rem;max-width:100%">';
else bodyHTML='<main style="max-width:800px;margin:0 auto;padding:1.5rem">';
bodyHTML+='<header style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;padding-bottom:1rem;border-bottom:1px solid '+theme.border+'"><h1 style="font-size:1.2rem;color:'+theme.accent+'">'+title+'</h1><div>';
if(comps.includes('theme'))bodyHTML+='<button onclick="toggleTheme()" style="padding:6px 12px;border:1px solid '+theme.border+';background:transparent;color:'+theme.fg+';border-radius:6px;cursor:pointer">Theme</button>';
bodyHTML+='</div></header>';
if(comps.includes('search'))bodyHTML+='<input type="text" placeholder="Search..." style="width:100%;padding:8px 12px;margin-bottom:1rem;background:'+theme.bg+';border:1px solid '+theme.border+';border-radius:6px;color:'+theme.fg+';font-size:14px">';
if(comps.includes('editor'))bodyHTML+='<section style="background:'+theme.card+';border:1px solid '+theme.border+';border-radius:12px;padding:1rem;margin-bottom:1rem"><h2 style="font-size:0.9rem;margin-bottom:0.75rem">Data Editor</h2><textarea id="editor" style="width:100%;min-height:120px;padding:8px;border:1px solid '+theme.border+';background:'+theme.bg+';color:'+theme.fg+';border-radius:6px;font-family:monospace;font-size:13px" placeholder="Enter data..."></textarea></section>';
if(comps.includes('stats'))bodyHTML+='<section style="background:'+theme.card+';border:1px solid '+theme.border+';border-radius:12px;padding:1rem;margin-bottom:1rem"><h2 style="font-size:0.9rem;margin-bottom:0.75rem">Statistics</h2><div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;text-align:center"><div style="padding:12px;background:'+theme.bg+';border-radius:8px"><div style="font-size:10px;color:'+theme.accent+';text-transform:uppercase">Items</div><div style="font-size:20px;font-weight:700">0</div></div><div style="padding:12px;background:'+theme.bg+';border-radius:8px"><div style="font-size:10px;color:'+theme.accent+';text-transform:uppercase">Size</div><div style="font-size:20px;font-weight:700">0 KB</div></div><div style="padding:12px;background:'+theme.bg+';border-radius:8px"><div style="font-size:10px;color:'+theme.accent+';text-transform:uppercase">Saved</div><div style="font-size:20px;font-weight:700">0</div></div></div></section>';
let btns='<div style="display:flex;gap:8px;flex-wrap:wrap">';
if(comps.includes('export'))btns+='<button style="padding:8px 16px;background:'+theme.accent+';color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:600">Export</button>';
if(comps.includes('import'))btns+='<button style="padding:8px 16px;background:transparent;border:1px solid '+theme.border+';color:'+theme.fg+';border-radius:6px;cursor:pointer">Import</button>';
btns+='</div>';
bodyHTML+=btns;
if(layout==='sidebar')bodyHTML+='</main></div>';
else if(layout==='split')bodyHTML+='</div><div style="padding:1.5rem"><h2 style="font-size:1rem;margin-bottom:1rem;color:'+theme.accent+'">Preview</h2><div style="background:'+theme.card+';border:1px solid '+theme.border+';border-radius:12px;padding:1rem;min-height:300px"><p style="color:'+theme.fg+'">Preview content appears here</p></div></div></div>';
else bodyHTML+='</main>';
bodyHTML+='<footer style="text-align:center;padding:1rem;font-size:0.75rem;color:'+theme.accent+'">'+title+' - Local-First, Zero Dependencies</footer>';
return '<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>'+title+'</title><meta name="description" content="'+desc+'"><style>*{margin:0;padding:0;box-sizing:border-box}body{background:'+theme.bg+';color:'+theme.fg+';font-family:system-ui,sans-serif;line-height:1.5}'+customCSS+'</style></head><body>'+bodyHTML+'<script>const SK="app:data";function load(){try{const d=localStorage.getItem(SK);if(d&&document.getElementById("editor"))document.getElementById("editor").value=d}catch(e){}}function save(){if(document.getElementById("editor"))localStorage.setItem(SK,document.getElementById("editor").value)}function toggleTheme(){document.body.style.filter=document.body.style.filter?"":"invert(1) hue-rotate(180deg)"}if(document.getElementById("editor"))document.getElementById("editor").addEventListener("input",save);load();'+customJS+'<\/script></body></html>';
}
function updatePreview(){
const html=generateHTML();
const iframe=document.getElementById('preview-iframe');
iframe.srcdoc=html;
vizData=[];
const lines=html.split('\n');
for(let i=0;i<Math.min(lines.length,100);i++){vizData.push({len:lines[i].length,type:lines[i].includes('<style')?'css':lines[i].includes('<script')?'js':'html'})}
if(GS.mode==='free'){GS.score+=2;GS.builds++;updateHUD()}
}
function startViz(){
function draw(){
const w=vizCanvas.width,h=vizCanvas.height;
vCtx.fillStyle='#1e293b';vCtx.fillRect(0,0,w,h);
vizAngle+=.01;
if(vizData.length>0){
const barW=w/vizData.length;
vizData.forEach((d,i)=>{
const barH=Math.min(h-20,(d.len/200)*h)*(.7+Math.sin(vizAngle+i*.3)*.3);
const colors={css:'#818cf8',js:'#22c55e',html:'#f59e0b'};
vCtx.fillStyle=colors[d.type]||'#818cf8';
vCtx.fillRect(i*barW+1,h-barH-10,Math.max(1,barW-2),barH);
vCtx.shadowColor=colors[d.type]||'#818cf8';vCtx.shadowBlur=4;
vCtx.fillRect(i*barW+1,h-barH-10,Math.max(1,barW-2),2);vCtx.shadowBlur=0
})
}
vCtx.fillStyle='#94a3b8';vCtx.font='10px sans-serif';vCtx.textAlign='left';
vCtx.fillText('Code Structure Visualization',8,14);
vCtx.fillStyle='#818cf8';vCtx.fillText('HTML',8,h-4);
vCtx.fillStyle='#22c55e';vCtx.fillText('JS',50,h-4);
vCtx.fillStyle='#f59e0b';vCtx.fillText('CSS',80,h-4);
requestAnimationFrame(draw)
}
requestAnimationFrame(draw)
}
function renderTemplates(){
document.getElementById('template-grid').innerHTML=TEMPLATES.map((t,i)=>`<div class="template-card" onclick="applyTemplate(${i})"><div class="name">${t.name}</div><div class="desc">${t.desc}</div></div>`).join('')
}
window.applyTemplate=function(i){
const t=TEMPLATES[i];
document.getElementById('appTitle').value=t.title;
document.getElementById('appTheme').value=t.theme;
document.getElementById('appLayout').value=t.layout;
['editor','export','import','theme','search','stats'].forEach(c=>{document.getElementById('comp-'+c).checked=t.components.includes(c)});
snd('click');updatePreview();toast('Template applied: '+t.name);switchTab('build')
};
function downloadApp(){
const html=generateHTML();const b=new Blob([html],{type:'text/html'});const u=URL.createObjectURL(b);
const a=document.createElement('a');a.href=u;a.download=(document.getElementById('appTitle').value||'app').replace(/\s+/g,'-').toLowerCase()+'.html';a.click();URL.revokeObjectURL(u);
snd('save');toast('App downloaded!');if(GS.mode==='free'){GS.score+=20;updateHUD()}
}
function saveApp(){
const lib=JSON.parse(localStorage.getItem('appbuilder:saved')||'[]');
lib.push({title:document.getElementById('appTitle').value,desc:document.getElementById('appDesc').value,theme:document.getElementById('appTheme').value,layout:document.getElementById('appLayout').value,components:getActiveComponents(),css:document.getElementById('customCSS').value,js:document.getElementById('customJS').value,date:new Date().toISOString()});
localStorage.setItem('appbuilder:saved',JSON.stringify(lib));
snd('save');toast('Saved!');renderSaved();if(GS.mode==='free'){GS.score+=10;updateHUD()}
}
function renderSaved(){
const lib=JSON.parse(localStorage.getItem('appbuilder:saved')||'[]');
const list=document.getElementById('saved-list');
if(lib.length===0){list.innerHTML='<div style="text-align:center;color:var(--muted);padding:12px">No saved apps</div>';return}
list.innerHTML=lib.map((s,i)=>`<div class="saved-item" onclick="loadSaved(${i})"><span class="name">${s.title}</span><span class="date">${new Date(s.date).toLocaleDateString()}</span></div>`).join('')
}
window.loadSaved=function(i){
const lib=JSON.parse(localStorage.getItem('appbuilder:saved')||'[]');if(!lib[i])return;const s=lib[i];
document.getElementById('appTitle').value=s.title||'';document.getElementById('appDesc').value=s.desc||'';
document.getElementById('appTheme').value=s.theme||'dark';document.getElementById('appLayout').value=s.layout||'centered';
['editor','export','import','theme','search','stats'].forEach(c=>{document.getElementById('comp-'+c).checked=(s.components||[]).includes(c)});
document.getElementById('customCSS').value=s.css||'';document.getElementById('customJS').value=s.js||'';
snd('click');updatePreview();toast('Loaded: '+s.title);switchTab('build')
};
function exportJSON(){
const cfg={title:document.getElementById('appTitle').value,desc:document.getElementById('appDesc').value,theme:document.getElementById('appTheme').value,layout:document.getElementById('appLayout').value,components:getActiveComponents(),css:document.getElementById('customCSS').value,js:document.getElementById('customJS').value};
const b=new Blob([JSON.stringify(cfg,null,2)],{type:'application/json'});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download='app-config.json';a.click();URL.revokeObjectURL(u);snd('save');toast('Config exported')
}
function importJSON(){document.getElementById('importFile').click()}
document.getElementById('importFile').addEventListener('change',e=>{
const f=e.target.files[0];if(!f)return;const r=new FileReader();r.onload=()=>{try{const d=JSON.parse(r.result);if(d.title)document.getElementById('appTitle').value=d.title;if(d.theme)document.getElementById('appTheme').value=d.theme;if(d.layout)document.getElementById('appLayout').value=d.layout;if(d.components)['editor','export','import','theme','search','stats'].forEach(c=>{document.getElementById('comp-'+c).checked=d.components.includes(c)});if(d.css)document.getElementById('customCSS').value=d.css;if(d.js)document.getElementById('customJS').value=d.js;updatePreview();snd('save');toast('Config imported')}catch(e){snd('fail');toast('Invalid JSON')}};r.readAsText(f);e.target.value=''
});
function saveHS(score){const hs=JSON.parse(localStorage.getItem('appbuilder:hs')||'[]');hs.push({score,date:new Date().toISOString(),diff:GS.diff,builds:GS.builds});hs.sort((a,b)=>b.score-a.score);localStorage.setItem('appbuilder:hs',JSON.stringify(hs.slice(0,20)))}
function toggleHS(){
const el=document.getElementById('title-hs');el.style.display=el.style.display==='none'?'block':'none';
const hs=JSON.parse(localStorage.getItem('appbuilder:hs')||'[]');
if(hs.length===0){el.innerHTML='<div style="text-align:center;color:var(--muted);padding:12px">No scores yet</div>';return}
el.innerHTML=hs.slice(0,10).map((h,i)=>`<div style="display:flex;justify-content:space-between;padding:5px 8px;font-size:12px"><span style="color:var(--accent);font-weight:700">#${i+1}</span><span style="color:var(--muted)">${h.diff} - ${h.builds} builds</span><span style="color:#fff;font-weight:600">${h.score}</span></div>`).join('');snd('menu')
}
vizCanvas.addEventListener('touchstart',e=>e.preventDefault(),{passive:false});
</script>
</body>
</html>