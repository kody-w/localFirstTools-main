<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>API Playground</title>
<meta name="rappterzoo:category" content="data_tools">
<meta name="rappterzoo:type" content="interface">
<meta name="rappterzoo:complexity" content="advanced">
<meta name="rappterzoo:created" content="2026-02-08">
<meta name="rappterzoo:author" content="RappterZoo">
<meta name="rappterzoo:author-type" content="agent">
<meta name="rappterzoo:tags" content="api,http,rest,fetch,testing">
<meta name="rappterzoo:generation" content="1">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0a0a0f;--bg2:#12121a;--bg3:#1a1a26;--bg4:#22222e;--border:#2a2a3a;--text:#e0e0e8;--text2:#888;--accent:#3b82f6;--green:#22c55e;--orange:#f59e0b;--red:#ef4444;--purple:#a855f7;--cyan:#06b6d4}
body{font-family:'SF Mono',Monaco,'Cascadia Code','Fira Code',monospace;background:var(--bg);color:var(--text);height:100vh;overflow:hidden;display:flex;flex-direction:column;font-size:13px}
button{cursor:pointer;font-family:inherit;font-size:inherit}
input,textarea,select{font-family:inherit;font-size:inherit;background:var(--bg2);color:var(--text);border:1px solid var(--border);border-radius:4px;padding:6px 10px;outline:none}
input:focus,textarea:focus,select:focus{border-color:var(--accent)}

/* Top bar */
.topbar{display:flex;align-items:center;padding:8px 16px;background:var(--bg2);border-bottom:1px solid var(--border);gap:12px;flex-shrink:0}
.topbar h1{font-size:15px;font-weight:600;color:var(--accent);white-space:nowrap}
.topbar h1 span{color:var(--text2);font-weight:400}

/* Layout */
.main{display:flex;flex:1;overflow:hidden}
.sidebar{width:240px;background:var(--bg2);border-right:1px solid var(--border);display:flex;flex-direction:column;flex-shrink:0;overflow:hidden}
.sidebar.collapsed{width:0;border:none}
.content{flex:1;display:flex;flex-direction:column;overflow:hidden}
.panes{display:flex;flex:1;overflow:hidden}
.pane{flex:1;display:flex;flex-direction:column;overflow:hidden;min-width:0}
.pane-left{border-right:1px solid var(--border)}

/* Section headers */
.section-head{display:flex;align-items:center;justify-content:space-between;padding:8px 12px;background:var(--bg3);border-bottom:1px solid var(--border);font-size:12px;font-weight:600;color:var(--text2);text-transform:uppercase;letter-spacing:0.5px;flex-shrink:0}
.section-head button{background:none;border:none;color:var(--text2);font-size:14px;padding:2px 6px;border-radius:3px}
.section-head button:hover{color:var(--text);background:var(--bg4)}

/* URL bar */
.url-bar{display:flex;gap:8px;padding:12px;background:var(--bg);border-bottom:1px solid var(--border);flex-shrink:0}
.method-select{width:110px;padding:8px 10px;font-weight:700;border-radius:6px;border:2px solid var(--border);text-align:center;appearance:none;-webkit-appearance:none}
.method-GET{color:var(--green);border-color:var(--green)}
.method-POST{color:var(--accent);border-color:var(--accent)}
.method-PUT{color:var(--orange);border-color:var(--orange)}
.method-DELETE{color:var(--red);border-color:var(--red)}
.method-PATCH{color:var(--purple);border-color:var(--purple)}
.url-input{flex:1;padding:8px 12px;font-size:13px;border-radius:6px}
.send-btn{padding:8px 24px;background:var(--accent);color:#fff;border:none;border-radius:6px;font-weight:700;font-size:13px;transition:all .15s}
.send-btn:hover{background:#2563eb;transform:translateY(-1px)}
.send-btn:active{transform:translateY(0)}
.send-btn.loading{opacity:0.6;pointer-events:none}

/* Tabs */
.tabs{display:flex;border-bottom:1px solid var(--border);background:var(--bg);flex-shrink:0}
.tab{padding:8px 16px;color:var(--text2);border:none;background:none;border-bottom:2px solid transparent;transition:all .15s}
.tab:hover{color:var(--text)}
.tab.active{color:var(--accent);border-bottom-color:var(--accent)}
.tab-body{flex:1;overflow:auto;padding:12px}

/* KV Editor */
.kv-row{display:flex;gap:6px;margin-bottom:6px;align-items:center}
.kv-row input{flex:1;padding:6px 8px;font-size:12px}
.kv-row .kv-del{background:none;border:none;color:var(--red);font-size:16px;padding:2px 6px;border-radius:3px;flex-shrink:0}
.kv-row .kv-del:hover{background:rgba(239,68,68,0.15)}
.kv-add{background:none;border:1px dashed var(--border);color:var(--text2);padding:6px 12px;border-radius:4px;font-size:12px;width:100%}
.kv-add:hover{border-color:var(--accent);color:var(--accent)}

/* Body editor */
.body-editor{width:100%;height:100%;min-height:200px;resize:none;background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:12px;font-size:12px;line-height:1.6;color:var(--cyan);tab-size:2}

/* Auth */
.auth-type{margin-bottom:12px}
.auth-field{margin-bottom:8px}
.auth-field label{display:block;font-size:11px;color:var(--text2);margin-bottom:4px;text-transform:uppercase}
.auth-field input{width:100%}

/* Response */
.response-status{display:flex;align-items:center;gap:12px;padding:12px;background:var(--bg);border-bottom:1px solid var(--border);flex-shrink:0;flex-wrap:wrap}
.status-badge{padding:4px 12px;border-radius:4px;font-weight:700;font-size:13px}
.status-2xx{background:rgba(34,197,94,0.15);color:var(--green)}
.status-3xx{background:rgba(6,182,212,0.15);color:var(--cyan)}
.status-4xx{background:rgba(239,68,68,0.15);color:var(--red)}
.status-5xx{background:rgba(239,68,68,0.25);color:var(--red)}
.status-0{background:rgba(136,136,136,0.15);color:var(--text2)}
.resp-meta{font-size:12px;color:var(--text2)}
.resp-body{flex:1;overflow:auto;padding:12px;white-space:pre-wrap;word-break:break-all;font-size:12px;line-height:1.6}
.resp-body .json-key{color:var(--accent)}
.resp-body .json-str{color:var(--green)}
.resp-body .json-num{color:var(--orange)}
.resp-body .json-bool{color:var(--purple)}
.resp-body .json-null{color:var(--red)}
.empty-state{display:flex;align-items:center;justify-content:center;height:100%;color:var(--text2);font-size:14px;text-align:center;padding:40px}

/* Sidebar */
.sidebar-head{padding:10px 12px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border);flex-shrink:0}
.sidebar-head h2{font-size:12px;font-weight:600;color:var(--text2);text-transform:uppercase;letter-spacing:0.5px}
.sidebar-actions{display:flex;gap:4px}
.sidebar-actions button{background:none;border:none;color:var(--text2);font-size:12px;padding:4px 8px;border-radius:3px}
.sidebar-actions button:hover{color:var(--text);background:var(--bg4)}
.sidebar-section{border-bottom:1px solid var(--border)}
.sidebar-section-head{display:flex;align-items:center;justify-content:space-between;padding:8px 12px;font-size:11px;font-weight:600;color:var(--text2);text-transform:uppercase;cursor:pointer}
.sidebar-section-head:hover{background:var(--bg3)}
.sidebar-list{overflow:auto}
.sidebar-item{display:flex;align-items:center;gap:8px;padding:6px 12px;cursor:pointer;border-left:2px solid transparent;transition:all .1s}
.sidebar-item:hover{background:var(--bg3)}
.sidebar-item.active{border-left-color:var(--accent);background:var(--bg3)}
.sidebar-item .method-badge{font-size:9px;font-weight:700;padding:2px 5px;border-radius:3px;flex-shrink:0;min-width:32px;text-align:center}
.badge-GET{background:rgba(34,197,94,0.15);color:var(--green)}
.badge-POST{background:rgba(59,130,246,0.15);color:var(--accent)}
.badge-PUT{background:rgba(245,158,11,0.15);color:var(--orange)}
.badge-DELETE{background:rgba(239,68,68,0.15);color:var(--red)}
.badge-PATCH{background:rgba(168,85,247,0.15);color:var(--purple)}
.sidebar-item .item-name{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:12px;flex:1}
.sidebar-item .item-del{background:none;border:none;color:var(--text2);font-size:12px;opacity:0;transition:opacity .1s;padding:2px 4px}
.sidebar-item:hover .item-del{opacity:1}
.sidebar-item .item-del:hover{color:var(--red)}

.toggle-sidebar{background:none;border:none;color:var(--text2);font-size:16px;padding:4px 8px;border-radius:3px}
.toggle-sidebar:hover{color:var(--text);background:var(--bg4)}

/* Save dialog */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;z-index:100;display:none}
.modal-overlay.show{display:flex}
.modal{background:var(--bg2);border:1px solid var(--border);border-radius:10px;padding:24px;width:360px;max-width:90vw}
.modal h3{margin-bottom:16px;font-size:15px}
.modal input{width:100%;margin-bottom:12px;padding:8px 12px}
.modal-btns{display:flex;gap:8px;justify-content:flex-end}
.modal-btns button{padding:6px 16px;border-radius:6px;border:1px solid var(--border);background:var(--bg3);color:var(--text)}
.modal-btns .btn-primary{background:var(--accent);border-color:var(--accent);color:#fff}

/* Scrollbar */
::-webkit-scrollbar{width:6px;height:6px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
::-webkit-scrollbar-thumb:hover{background:#444}

@media(max-width:800px){
  .sidebar{width:200px}
  .panes{flex-direction:column}
  .pane-left{border-right:none;border-bottom:1px solid var(--border)}
}
</style>
</head>
<body>

<!-- Top Bar -->
<div class="topbar">
  <button class="toggle-sidebar" onclick="toggleSidebar()" title="Toggle sidebar">‚ò∞</button>
  <h1>API Playground <span>‚Äî RappterZoo</span></h1>
  <div style="flex:1"></div>
  <button class="sidebar-actions" style="display:flex;gap:4px" title="Save current request" onclick="openSaveModal()">
    <span style="background:none;border:1px solid var(--border);color:var(--text2);padding:4px 10px;border-radius:4px;font-size:12px">üíæ Save</span>
  </button>
  <button style="background:none;border:1px solid var(--border);color:var(--text2);padding:4px 10px;border-radius:4px;font-size:12px" onclick="exportCollections()">üì§ Export</button>
  <button style="background:none;border:1px solid var(--border);color:var(--text2);padding:4px 10px;border-radius:4px;font-size:12px" onclick="importCollections()">üì• Import</button>
</div>

<!-- Main layout -->
<div class="main">
  <!-- Sidebar: Collections + History -->
  <div class="sidebar" id="sidebar">
    <div class="sidebar-head">
      <h2>Collection</h2>
      <div class="sidebar-actions">
        <button onclick="clearCollections()" title="Clear all">üóë</button>
      </div>
    </div>
    <div class="sidebar-section">
      <div class="sidebar-section-head" onclick="toggleSection('collections')">
        <span>üìÅ Saved Requests</span><span id="collections-arrow">‚ñæ</span>
      </div>
      <div class="sidebar-list" id="collections-list" style="max-height:35vh"></div>
    </div>
    <div class="sidebar-section" style="flex:1;display:flex;flex-direction:column">
      <div class="sidebar-section-head" onclick="toggleSection('history')">
        <span>üïê History</span><span id="history-arrow">‚ñæ</span>
      </div>
      <div class="sidebar-list" id="history-list" style="flex:1;overflow:auto"></div>
    </div>
  </div>

  <!-- Content -->
  <div class="content">
    <!-- URL Bar -->
    <div class="url-bar">
      <select class="method-select" id="method" onchange="updateMethodStyle()">
        <option value="GET">GET</option>
        <option value="POST">POST</option>
        <option value="PUT">PUT</option>
        <option value="DELETE">DELETE</option>
        <option value="PATCH">PATCH</option>
      </select>
      <input class="url-input" id="url" type="text" placeholder="Enter request URL..." value="https://jsonplaceholder.typicode.com/posts/1">
      <button class="send-btn" id="sendBtn" onclick="sendRequest()">Send</button>
    </div>

    <!-- Panes -->
    <div class="panes">
      <!-- Request Pane -->
      <div class="pane pane-left">
        <div class="section-head">Request</div>
        <div class="tabs">
          <button class="tab active" data-tab="headers" onclick="switchReqTab(this)">Headers</button>
          <button class="tab" data-tab="body" onclick="switchReqTab(this)">Body</button>
          <button class="tab" data-tab="auth" onclick="switchReqTab(this)">Auth</button>
        </div>

        <!-- Headers tab -->
        <div class="tab-body" id="tab-headers">
          <div id="headers-kv"></div>
          <button class="kv-add" onclick="addHeader()">+ Add Header</button>
        </div>

        <!-- Body tab -->
        <div class="tab-body" id="tab-body" style="display:none;padding:12px">
          <textarea class="body-editor" id="reqBody" placeholder='{ "key": "value" }' spellcheck="false"></textarea>
        </div>

        <!-- Auth tab -->
        <div class="tab-body" id="tab-auth" style="display:none">
          <div class="auth-type">
            <label style="font-size:11px;color:var(--text2);margin-bottom:4px;display:block">AUTH TYPE</label>
            <select id="authType" onchange="updateAuthFields()" style="width:100%">
              <option value="none">None</option>
              <option value="bearer">Bearer Token</option>
              <option value="basic">Basic Auth</option>
            </select>
          </div>
          <div id="auth-fields"></div>
        </div>
      </div>

      <!-- Response Pane -->
      <div class="pane">
        <div class="section-head">Response</div>
        <div id="resp-status" class="response-status" style="display:none"></div>
        <div class="tabs" id="resp-tabs">
          <button class="tab active" data-tab="resp-body" onclick="switchRespTab(this)">Body</button>
          <button class="tab" data-tab="resp-headers" onclick="switchRespTab(this)">Headers</button>
        </div>
        <div class="tab-body resp-body" id="tab-resp-body">
          <div class="empty-state" id="resp-empty">
            <div>
              <div style="font-size:32px;margin-bottom:12px">üöÄ</div>
              <div>Send a request to see the response</div>
              <div style="font-size:12px;margin-top:8px;color:var(--border)">Use fetch to test any API endpoint</div>
            </div>
          </div>
          <div id="resp-body-content" style="display:none"></div>
        </div>
        <div class="tab-body" id="tab-resp-headers" style="display:none"></div>
      </div>
    </div>
  </div>
</div>

<!-- Save Modal -->
<div class="modal-overlay" id="saveModal">
  <div class="modal">
    <h3>Save Request</h3>
    <label style="font-size:11px;color:var(--text2);display:block;margin-bottom:4px">REQUEST NAME</label>
    <input id="saveName" placeholder="My API Request" autofocus>
    <label style="font-size:11px;color:var(--text2);display:block;margin-bottom:4px">COLLECTION (optional)</label>
    <input id="saveCollection" placeholder="Default">
    <div class="modal-btns">
      <button onclick="closeSaveModal()">Cancel</button>
      <button class="btn-primary" onclick="saveRequest()">Save</button>
    </div>
  </div>
</div>

<!-- Hidden file input for import -->
<input type="file" id="importFile" accept=".json" style="display:none" onchange="handleImport(event)">

<script>
// State
let headers = [{ key: 'Content-Type', value: 'application/json', enabled: true }];
let history = JSON.parse(localStorage.getItem('apiplayground_history') || '[]');
let collections = JSON.parse(localStorage.getItem('apiplayground_collections') || '[]');

// Init
function init() {
  renderHeaders();
  updateMethodStyle();
  updateAuthFields();
  renderSidebar();
}

// Method styling
function updateMethodStyle() {
  const sel = document.getElementById('method');
  sel.className = 'method-select method-' + sel.value;
}

// Sidebar toggle
function toggleSidebar() {
  document.getElementById('sidebar').classList.toggle('collapsed');
}
function toggleSection(id) {
  const list = document.getElementById(id + '-list');
  const arrow = document.getElementById(id + '-arrow');
  if (list.style.display === 'none') {
    list.style.display = '';
    arrow.textContent = '‚ñæ';
  } else {
    list.style.display = 'none';
    arrow.textContent = '‚ñ∏';
  }
}

// Request tabs
function switchReqTab(btn) {
  document.querySelectorAll('.pane-left .tab').forEach(t => t.classList.remove('active'));
  btn.classList.add('active');
  ['headers', 'body', 'auth'].forEach(id => {
    document.getElementById('tab-' + id).style.display = id === btn.dataset.tab ? '' : 'none';
  });
}

// Response tabs
function switchRespTab(btn) {
  document.querySelectorAll('#resp-tabs .tab').forEach(t => t.classList.remove('active'));
  btn.classList.add('active');
  ['resp-body', 'resp-headers'].forEach(id => {
    document.getElementById('tab-' + id).style.display = id === btn.dataset.tab ? '' : 'none';
  });
}

// Header KV editor
function renderHeaders() {
  const container = document.getElementById('headers-kv');
  container.innerHTML = '';
  headers.forEach((h, i) => {
    const row = document.createElement('div');
    row.className = 'kv-row';
    row.innerHTML = `
      <input type="checkbox" ${h.enabled ? 'checked' : ''} onchange="headers[${i}].enabled=this.checked" style="width:auto;flex:none">
      <input placeholder="Header key" value="${esc(h.key)}" oninput="headers[${i}].key=this.value">
      <input placeholder="Header value" value="${esc(h.value)}" oninput="headers[${i}].value=this.value">
      <button class="kv-del" onclick="headers.splice(${i},1);renderHeaders()">√ó</button>
    `;
    container.appendChild(row);
  });
}
function addHeader() {
  headers.push({ key: '', value: '', enabled: true });
  renderHeaders();
}

// Auth fields
function updateAuthFields() {
  const type = document.getElementById('authType').value;
  const container = document.getElementById('auth-fields');
  if (type === 'none') {
    container.innerHTML = '<div style="color:var(--text2);font-size:12px;padding:12px 0">No authentication</div>';
  } else if (type === 'bearer') {
    container.innerHTML = `<div class="auth-field"><label>TOKEN</label><input id="authToken" placeholder="Enter bearer token..."></div>`;
  } else if (type === 'basic') {
    container.innerHTML = `
      <div class="auth-field"><label>USERNAME</label><input id="authUser" placeholder="Username"></div>
      <div class="auth-field"><label>PASSWORD</label><input id="authPass" type="password" placeholder="Password"></div>
    `;
  }
}

// Build headers object from UI state
function buildHeaders() {
  const h = {};
  headers.forEach(row => {
    if (row.enabled && row.key.trim()) h[row.key.trim()] = row.value;
  });
  const authType = document.getElementById('authType').value;
  if (authType === 'bearer') {
    const tok = document.getElementById('authToken');
    if (tok && tok.value.trim()) h['Authorization'] = 'Bearer ' + tok.value.trim();
  } else if (authType === 'basic') {
    const u = document.getElementById('authUser');
    const p = document.getElementById('authPass');
    if (u && u.value.trim()) h['Authorization'] = 'Basic ' + btoa(u.value + ':' + (p ? p.value : ''));
  }
  return h;
}

// Send request via fetch
async function sendRequest() {
  const method = document.getElementById('method').value;
  const url = document.getElementById('url').value.trim();
  if (!url) return;

  const btn = document.getElementById('sendBtn');
  btn.classList.add('loading');
  btn.textContent = '...';

  const reqHeaders = buildHeaders();
  const body = (method !== 'GET' && method !== 'DELETE') ? document.getElementById('reqBody').value || undefined : undefined;

  const start = performance.now();
  let resp, respBody, respHeaders = {}, error = null;

  try {
    resp = await fetch(url, {
      method,
      headers: reqHeaders,
      body: body || undefined
    });
    const elapsed = Math.round(performance.now() - start);

    resp.headers.forEach((v, k) => { respHeaders[k] = v; });
    const contentType = resp.headers.get('content-type') || '';
    const raw = await resp.text();

    showResponse(resp.status, resp.statusText, respHeaders, raw, elapsed, contentType);
    addHistory(method, url, resp.status, elapsed);
  } catch (e) {
    const elapsed = Math.round(performance.now() - start);
    showResponse(0, 'Network Error', {}, e.message, elapsed, '');
    addHistory(method, url, 0, elapsed);
  }

  btn.classList.remove('loading');
  btn.textContent = 'Send';
}

// Display response
function showResponse(status, statusText, hdrs, body, time, contentType) {
  const statusBar = document.getElementById('resp-status');
  statusBar.style.display = 'flex';

  let cls = 'status-0';
  if (status >= 200 && status < 300) cls = 'status-2xx';
  else if (status >= 300 && status < 400) cls = 'status-3xx';
  else if (status >= 400 && status < 500) cls = 'status-4xx';
  else if (status >= 500) cls = 'status-5xx';

  statusBar.innerHTML = `
    <span class="status-badge ${cls}">${status} ${esc(statusText)}</span>
    <span class="resp-meta">‚è± ${time}ms</span>
    <span class="resp-meta">üì¶ ${formatBytes(new Blob([body]).size)}</span>
  `;

  document.getElementById('resp-empty').style.display = 'none';
  const bodyEl = document.getElementById('resp-body-content');
  bodyEl.style.display = '';

  let formatted = esc(body);
  try {
    const parsed = JSON.parse(body);
    formatted = syntaxHighlightJSON(JSON.stringify(parsed, null, 2));
  } catch (_) {}
  bodyEl.innerHTML = formatted;

  const headersEl = document.getElementById('tab-resp-headers');
  let hhtml = '<div style="font-size:12px">';
  Object.entries(hdrs).forEach(([k, v]) => {
    hhtml += `<div style="margin-bottom:4px"><span style="color:var(--accent)">${esc(k)}</span>: <span style="color:var(--text2)">${esc(v)}</span></div>`;
  });
  hhtml += '</div>';
  headersEl.innerHTML = hhtml || '<div style="color:var(--text2)">No response headers</div>';
}

// JSON syntax highlighting
function syntaxHighlightJSON(json) {
  return esc(json).replace(
    /("(\\u[a-fA-F0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,
    function (match) {
      let cls = 'json-num';
      if (/^"/.test(match)) {
        cls = /:$/.test(match) ? 'json-key' : 'json-str';
      } else if (/true|false/.test(match)) {
        cls = 'json-bool';
      } else if (/null/.test(match)) {
        cls = 'json-null';
      }
      return '<span class="' + cls + '">' + match + '</span>';
    }
  );
}

// History
function addHistory(method, url, status, time) {
  history.unshift({ method, url, status, time, ts: Date.now() });
  if (history.length > 50) history = history.slice(0, 50);
  localStorage.setItem('apiplayground_history', JSON.stringify(history));
  renderSidebar();
}

// Save request to collection
function openSaveModal() {
  document.getElementById('saveModal').classList.add('show');
  const nameInput = document.getElementById('saveName');
  nameInput.value = '';
  nameInput.focus();
}
function closeSaveModal() {
  document.getElementById('saveModal').classList.remove('show');
}
function saveRequest() {
  const name = document.getElementById('saveName').value.trim() || 'Untitled';
  const collection = document.getElementById('saveCollection').value.trim() || 'Default';
  const entry = {
    id: Date.now().toString(36),
    name,
    collection,
    method: document.getElementById('method').value,
    url: document.getElementById('url').value,
    headers: JSON.parse(JSON.stringify(headers)),
    body: document.getElementById('reqBody').value,
    authType: document.getElementById('authType').value,
    authToken: document.getElementById('authToken')?.value || '',
    authUser: document.getElementById('authUser')?.value || '',
    authPass: document.getElementById('authPass')?.value || ''
  };
  collections.push(entry);
  localStorage.setItem('apiplayground_collections', JSON.stringify(collections));
  closeSaveModal();
  renderSidebar();
}

// Load saved request
function loadRequest(item) {
  document.getElementById('method').value = item.method;
  updateMethodStyle();
  document.getElementById('url').value = item.url || '';
  headers = item.headers || [{ key: 'Content-Type', value: 'application/json', enabled: true }];
  renderHeaders();
  document.getElementById('reqBody').value = item.body || '';
  if (item.authType) {
    document.getElementById('authType').value = item.authType;
    updateAuthFields();
    if (item.authType === 'bearer' && document.getElementById('authToken')) {
      document.getElementById('authToken').value = item.authToken || '';
    }
    if (item.authType === 'basic') {
      if (document.getElementById('authUser')) document.getElementById('authUser').value = item.authUser || '';
      if (document.getElementById('authPass')) document.getElementById('authPass').value = item.authPass || '';
    }
  }
}

// Load from history
function loadFromHistory(item) {
  document.getElementById('method').value = item.method;
  updateMethodStyle();
  document.getElementById('url').value = item.url || '';
}

// Delete from collection
function deleteFromCollection(id) {
  collections = collections.filter(c => c.id !== id);
  localStorage.setItem('apiplayground_collections', JSON.stringify(collections));
  renderSidebar();
}

// Render sidebar
function renderSidebar() {
  const colList = document.getElementById('collections-list');
  if (collections.length === 0) {
    colList.innerHTML = '<div style="padding:12px;color:var(--text2);font-size:12px;text-align:center">No saved requests<br><span style="font-size:11px">Click Save to add one</span></div>';
  } else {
    const grouped = {};
    collections.forEach(c => {
      if (!grouped[c.collection]) grouped[c.collection] = [];
      grouped[c.collection].push(c);
    });
    let html = '';
    Object.entries(grouped).forEach(([group, items]) => {
      html += `<div style="padding:6px 12px 2px;font-size:10px;color:var(--text2);text-transform:uppercase">${esc(group)}</div>`;
      items.forEach(item => {
        html += `<div class="sidebar-item" onclick='loadRequest(${JSON.stringify(item).replace(/'/g,"&#39;")})'>
          <span class="method-badge badge-${item.method}">${item.method}</span>
          <span class="item-name">${esc(item.name)}</span>
          <button class="item-del" onclick="event.stopPropagation();deleteFromCollection('${item.id}')">√ó</button>
        </div>`;
      });
    });
    colList.innerHTML = html;
  }

  const histList = document.getElementById('history-list');
  if (history.length === 0) {
    histList.innerHTML = '<div style="padding:12px;color:var(--text2);font-size:12px;text-align:center">No history yet</div>';
  } else {
    let html = '';
    history.forEach(item => {
      const shortUrl = item.url.replace(/^https?:\/\//, '').slice(0, 30);
      const statusCls = item.status >= 200 && item.status < 300 ? 'color:var(--green)' :
                         item.status >= 400 ? 'color:var(--red)' : 'color:var(--text2)';
      html += `<div class="sidebar-item" onclick='loadFromHistory(${JSON.stringify(item).replace(/'/g,"&#39;")})'>
        <span class="method-badge badge-${item.method}">${item.method}</span>
        <span class="item-name" title="${esc(item.url)}">${esc(shortUrl)}</span>
        <span style="font-size:10px;${statusCls};flex-shrink:0">${item.status || 'ERR'}</span>
      </div>`;
    });
    histList.innerHTML = html;
  }
}

// Export/Import collections
function exportCollections() {
  const data = JSON.stringify({ collections, history }, null, 2);
  const blob = new Blob([data], { type: 'application/json' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'api-playground-export.json';
  a.click();
  URL.revokeObjectURL(a.href);
}

function importCollections() {
  document.getElementById('importFile').click();
}
function handleImport(event) {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function (e) {
    try {
      const data = JSON.parse(e.target.result);
      if (data.collections) {
        collections = collections.concat(data.collections);
        localStorage.setItem('apiplayground_collections', JSON.stringify(collections));
      }
      if (data.history) {
        history = data.history.concat(history).slice(0, 50);
        localStorage.setItem('apiplayground_history', JSON.stringify(history));
      }
      renderSidebar();
    } catch (err) {
      alert('Invalid JSON file');
    }
  };
  reader.readAsText(file);
  event.target.value = '';
}

// Clear
function clearCollections() {
  if (confirm('Clear all saved requests and history?')) {
    collections = [];
    history = [];
    localStorage.removeItem('apiplayground_collections');
    localStorage.removeItem('apiplayground_history');
    renderSidebar();
  }
}

// Helpers
function esc(s) {
  if (!s) return '';
  return String(s).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
}
function formatBytes(b) {
  if (b < 1024) return b + ' B';
  if (b < 1048576) return (b / 1024).toFixed(1) + ' KB';
  return (b / 1048576).toFixed(1) + ' MB';
}

// Keyboard shortcuts
document.addEventListener('keydown', function (e) {
  if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
    e.preventDefault();
    sendRequest();
  }
  if ((e.ctrlKey || e.metaKey) && e.key === 's') {
    e.preventDefault();
    openSaveModal();
  }
  if (e.key === 'Escape') {
    closeSaveModal();
  }
});

// Enter key in save modal
document.getElementById('saveName').addEventListener('keydown', function (e) {
  if (e.key === 'Enter') saveRequest();
});

init();
</script>
</body>
</html>
