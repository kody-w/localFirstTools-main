<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salesforce Simulator - Local-First CRM</title>
    <meta name="description" content="Local-first Salesforce CRM simulator with native schema, perfect for testing data sync with other CRM systems">
    <meta name="theme-color" content="#032d60">
    <!-- salesforce, crm, simulator, sync, integration, local-first -->
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --sf-blue: #0176d3;
            --sf-blue-dark: #014486;
            --sf-blue-light: #1b96ff;
            --sf-nav: #032d60;
            --sf-bg: #f3f3f3;
            --sf-white: #ffffff;
            --sf-text: #181818;
            --sf-text-secondary: #706e6b;
            --sf-border: #dddbda;
            --sf-success: #2e844a;
            --sf-warning: #fe9339;
            --sf-error: #ea001e;
        }

        body {
            font-family: 'Salesforce Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--sf-bg);
            color: var(--sf-text);
            min-height: 100vh;
        }

        /* Salesforce Global Header */
        .sf-header {
            background: var(--sf-nav);
            height: 45px;
            display: flex;
            align-items: center;
            padding: 0 16px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        .sf-logo {
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
            font-weight: 700;
            font-size: 18px;
        }

        .sf-logo svg {
            width: 28px;
            height: 28px;
        }

        .sf-header-right {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .sf-sync-status {
            display: flex;
            align-items: center;
            gap: 6px;
            color: rgba(255,255,255,0.8);
            font-size: 12px;
        }

        .sf-sync-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--sf-success);
        }

        .sf-sync-dot.syncing {
            background: var(--sf-warning);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Navigation Tabs */
        .sf-nav {
            background: var(--sf-blue);
            height: 40px;
            display: flex;
            align-items: center;
            padding: 0 16px;
            margin-top: 45px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 999;
            gap: 4px;
            overflow-x: auto;
        }

        .sf-nav-tab {
            padding: 8px 16px;
            color: rgba(255,255,255,0.8);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 4px 4px 0 0;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .sf-nav-tab:hover {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        .sf-nav-tab.active {
            background: var(--sf-bg);
            color: var(--sf-blue);
        }

        /* Main Content */
        .sf-main {
            margin-top: 85px;
            padding: 16px;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Page Header */
        .sf-page-header {
            background: white;
            border-radius: 4px;
            padding: 16px 24px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 4px rgba(0,0,0,0.07);
        }

        .sf-page-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--sf-text);
        }

        .sf-page-subtitle {
            font-size: 12px;
            color: var(--sf-text-secondary);
            margin-top: 2px;
        }

        /* Buttons */
        .sf-btn {
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            border: 1px solid var(--sf-border);
            background: white;
            color: var(--sf-text);
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .sf-btn:hover {
            background: var(--sf-bg);
        }

        .sf-btn-primary {
            background: var(--sf-blue);
            color: white;
            border-color: var(--sf-blue);
        }

        .sf-btn-primary:hover {
            background: var(--sf-blue-dark);
        }

        .sf-btn:focus-visible {
            outline: 2px solid var(--sf-blue);
            outline-offset: 2px;
        }

        .sf-btn-success {
            background: var(--sf-success);
            color: white;
            border-color: var(--sf-success);
        }

        .sf-btn-group {
            display: flex;
            gap: 8px;
        }

        /* Cards */
        .sf-card {
            background: white;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.07);
            margin-bottom: 16px;
        }

        .sf-card-header {
            padding: 12px 16px;
            border-bottom: 1px solid var(--sf-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .sf-card-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--sf-text);
        }

        .sf-card-body {
            padding: 16px;
        }

        /* Table */
        .sf-table {
            width: 100%;
            border-collapse: collapse;
        }

        .sf-table th {
            text-align: left;
            padding: 8px 12px;
            font-size: 12px;
            font-weight: 700;
            color: var(--sf-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid var(--sf-border);
            background: #fafaf9;
        }

        .sf-table td {
            padding: 12px;
            font-size: 13px;
            border-bottom: 1px solid var(--sf-border);
        }

        .sf-table tr:hover {
            background: #f3f3f3;
        }

        .sf-table-link {
            color: var(--sf-blue);
            text-decoration: none;
            cursor: pointer;
        }

        .sf-table-link:hover {
            text-decoration: underline;
        }

        /* Forms */
        .sf-form-group {
            margin-bottom: 16px;
        }

        .sf-label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: var(--sf-text-secondary);
            margin-bottom: 4px;
        }

        .sf-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--sf-border);
            border-radius: 4px;
            font-size: 14px;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .sf-input:focus {
            outline: none;
            border-color: var(--sf-blue);
            box-shadow: 0 0 0 3px rgba(1,118,211,0.15);
        }

        .sf-select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--sf-border);
            border-radius: 4px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }

        /* Modal */
        .sf-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .sf-modal-overlay.active {
            display: flex;
        }

        .sf-modal {
            background: white;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .sf-modal-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--sf-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .sf-modal-title {
            font-size: 18px;
            font-weight: 700;
        }

        .sf-modal-close {
            width: 32px;
            height: 32px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 24px;
            color: var(--sf-text-secondary);
            border-radius: 4px;
        }

        .sf-modal-close:hover {
            background: var(--sf-bg);
        }

        .sf-modal-body {
            padding: 20px;
            overflow-y: auto;
        }

        .sf-modal-footer {
            padding: 16px 20px;
            border-top: 1px solid var(--sf-border);
            display: flex;
            justify-content: flex-end;
            gap: 8px;
        }

        /* Stage Pill */
        .sf-stage {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .sf-stage-prospecting { background: #e5f6fd; color: #0070d2; }
        .sf-stage-qualification { background: #fef3cd; color: #856404; }
        .sf-stage-proposal { background: #d4edda; color: #155724; }
        .sf-stage-negotiation { background: #fff3cd; color: #856404; }
        .sf-stage-closed-won { background: #d4edda; color: #155724; }
        .sf-stage-closed-lost { background: #f8d7da; color: #721c24; }

        /* Stats */
        .sf-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }

        .sf-stat-card {
            background: white;
            border-radius: 4px;
            padding: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.07);
        }

        .sf-stat-label {
            font-size: 12px;
            color: var(--sf-text-secondary);
            margin-bottom: 4px;
        }

        .sf-stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--sf-blue);
        }

        /* Empty State */
        .sf-empty {
            text-align: center;
            padding: 48px 24px;
            color: var(--sf-text-secondary);
        }

        .sf-empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        /* Sync Panel */
        .sf-sync-panel {
            background: linear-gradient(135deg, var(--sf-nav) 0%, var(--sf-blue-dark) 100%);
            color: white;
            border-radius: 4px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .sf-sync-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .sf-sync-title {
            font-size: 16px;
            font-weight: 700;
        }

        .sf-sync-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        .sf-sync-item {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
        }

        .sf-sync-item-title {
            font-size: 11px;
            text-transform: uppercase;
            opacity: 0.8;
            margin-bottom: 8px;
        }

        .sf-sync-item-value {
            font-size: 24px;
            font-weight: 700;
        }

        /* Hidden */
        .hidden { display: none !important; }

        /* Form Grid */
        .sf-form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        @media (max-width: 768px) {
            .sf-form-grid { grid-template-columns: 1fr; }
            .sf-sync-grid { grid-template-columns: 1fr; }
            .sf-stats-grid { grid-template-columns: 1fr 1fr; }
        }

        /* Toast */
        .sf-toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            padding: 12px 20px;
            background: var(--sf-nav);
            color: white;
            border-radius: 4px;
            font-size: 14px;
            z-index: 3000;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s;
        }

        .sf-toast.active {
            opacity: 1;
            transform: translateY(0);
        }

        .sf-toast.success { background: var(--sf-success); }
        .sf-toast.error { background: var(--sf-error); }
    </style>
</head>
<body>
    <!-- Global Header -->
    <header class="sf-header">
        <div class="sf-logo">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
            </svg>
            Salesforce Simulator
        </div>
        <div class="sf-header-right">
            <div class="sf-sync-status">
                <span class="sf-sync-dot" id="syncDot"></span>
                <span id="syncStatusText">Local Mode</span>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="sf-nav">
        <div class="sf-nav-tab active" data-tab="home">Home</div>
        <div class="sf-nav-tab" data-tab="contacts">Contacts</div>
        <div class="sf-nav-tab" data-tab="accounts">Accounts</div>
        <div class="sf-nav-tab" data-tab="opportunities">Opportunities</div>
        <div class="sf-nav-tab" data-tab="tasks">Tasks</div>
        <div class="sf-nav-tab" data-tab="sync">Sync & Integration</div>
    </nav>

    <!-- Main Content -->
    <main class="sf-main">
        <!-- Home Tab -->
        <section id="tab-home" class="tab-content">
            <div class="sf-stats-grid">
                <div class="sf-stat-card">
                    <div class="sf-stat-label">Total Contacts</div>
                    <div class="sf-stat-value" id="stat-contacts">0</div>
                </div>
                <div class="sf-stat-card">
                    <div class="sf-stat-label">Total Accounts</div>
                    <div class="sf-stat-value" id="stat-accounts">0</div>
                </div>
                <div class="sf-stat-card">
                    <div class="sf-stat-label">Open Opportunities</div>
                    <div class="sf-stat-value" id="stat-opportunities">0</div>
                </div>
                <div class="sf-stat-card">
                    <div class="sf-stat-label">Pipeline Value</div>
                    <div class="sf-stat-value" id="stat-pipeline">$0</div>
                </div>
            </div>

            <div class="sf-sync-panel">
                <div class="sf-sync-header">
                    <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"/>
                    </svg>
                    <span class="sf-sync-title">NeuAI Sync Status</span>
                </div>
                <div class="sf-sync-grid">
                    <div class="sf-sync-item">
                        <div class="sf-sync-item-title">Local CRM</div>
                        <div class="sf-sync-item-value" id="sync-local">--</div>
                    </div>
                    <div class="sf-sync-item">
                        <div class="sf-sync-item-title">This Instance</div>
                        <div class="sf-sync-item-value" id="sync-sf">--</div>
                    </div>
                    <div class="sf-sync-item">
                        <div class="sf-sync-item-title">Dynamics 365</div>
                        <div class="sf-sync-item-value" id="sync-d365">--</div>
                    </div>
                </div>
            </div>

            <div class="sf-card">
                <div class="sf-card-header">
                    <span class="sf-card-title">Recent Opportunities</span>
                </div>
                <div class="sf-card-body">
                    <table class="sf-table">
                        <thead>
                            <tr>
                                <th>Opportunity Name</th>
                                <th>Account</th>
                                <th>Amount</th>
                                <th>Stage</th>
                                <th>Close Date</th>
                            </tr>
                        </thead>
                        <tbody id="recent-opportunities"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Contacts Tab -->
        <section id="tab-contacts" class="tab-content hidden">
            <div class="sf-page-header">
                <div>
                    <div class="sf-page-title">Contacts</div>
                    <div class="sf-page-subtitle" id="contacts-count">0 items</div>
                </div>
                <div class="sf-btn-group">
                    <button class="sf-btn sf-btn-primary" onclick="openModal('contact')">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                        New Contact
                    </button>
                </div>
            </div>
            <div class="sf-card">
                <div class="sf-card-body">
                    <table class="sf-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Account</th>
                                <th>Lead Source</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="contacts-table"></tbody>
                    </table>
                    <div class="sf-empty hidden" id="contacts-empty">
                        <div class="sf-empty-icon">üë§</div>
                        <div>No contacts yet. Create your first contact!</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Accounts Tab -->
        <section id="tab-accounts" class="tab-content hidden">
            <div class="sf-page-header">
                <div>
                    <div class="sf-page-title">Accounts</div>
                    <div class="sf-page-subtitle" id="accounts-count">0 items</div>
                </div>
                <div class="sf-btn-group">
                    <button class="sf-btn sf-btn-primary" onclick="openModal('account')">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                        New Account
                    </button>
                </div>
            </div>
            <div class="sf-card">
                <div class="sf-card-body">
                    <table class="sf-table">
                        <thead>
                            <tr>
                                <th>Account Name</th>
                                <th>Industry</th>
                                <th>Website</th>
                                <th>Contacts</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="accounts-table"></tbody>
                    </table>
                    <div class="sf-empty hidden" id="accounts-empty">
                        <div class="sf-empty-icon">üè¢</div>
                        <div>No accounts yet. Create your first account!</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Opportunities Tab -->
        <section id="tab-opportunities" class="tab-content hidden">
            <div class="sf-page-header">
                <div>
                    <div class="sf-page-title">Opportunities</div>
                    <div class="sf-page-subtitle" id="opportunities-count">0 items</div>
                </div>
                <div class="sf-btn-group">
                    <button class="sf-btn sf-btn-primary" onclick="openModal('opportunity')">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                        New Opportunity
                    </button>
                </div>
            </div>
            <div class="sf-card">
                <div class="sf-card-body">
                    <table class="sf-table">
                        <thead>
                            <tr>
                                <th>Opportunity Name</th>
                                <th>Account</th>
                                <th>Amount</th>
                                <th>Stage</th>
                                <th>Close Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="opportunities-table"></tbody>
                    </table>
                    <div class="sf-empty hidden" id="opportunities-empty">
                        <div class="sf-empty-icon">üí∞</div>
                        <div>No opportunities yet. Create your first deal!</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tasks Tab -->
        <section id="tab-tasks" class="tab-content hidden">
            <div class="sf-page-header">
                <div>
                    <div class="sf-page-title">Tasks</div>
                    <div class="sf-page-subtitle" id="tasks-count">0 items</div>
                </div>
                <div class="sf-btn-group">
                    <button class="sf-btn sf-btn-primary" onclick="openModal('task')">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                        New Task
                    </button>
                </div>
            </div>
            <div class="sf-card">
                <div class="sf-card-body">
                    <table class="sf-table">
                        <thead>
                            <tr>
                                <th>Subject</th>
                                <th>Type</th>
                                <th>Related To</th>
                                <th>Due Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="tasks-table"></tbody>
                    </table>
                    <div class="sf-empty hidden" id="tasks-empty">
                        <div class="sf-empty-icon">‚úÖ</div>
                        <div>No tasks yet. Create your first task!</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sync Tab -->
        <section id="tab-sync" class="tab-content hidden">
            <div class="sf-page-header">
                <div>
                    <div class="sf-page-title">Sync & Integration</div>
                    <div class="sf-page-subtitle">NeuAI-powered cross-CRM synchronization</div>
                </div>
            </div>

            <div class="sf-card" style="border: 2px solid var(--sf-blue); background: linear-gradient(135deg, #f0f7ff 0%, #fff 100%);">
                <div class="sf-card-header">
                    <span class="sf-card-title">Quick Start - Load Sample Data</span>
                </div>
                <div class="sf-card-body">
                    <p style="margin-bottom:16px;color:var(--sf-text-secondary);">Load a realistic enterprise sales scenario with accounts, contacts, opportunities, and tasks to test cross-platform sync.</p>
                    <div class="sf-btn-group">
                        <button class="sf-btn sf-btn-success" onclick="loadSampleData()">Load TechCorp Sales Demo</button>
                        <button class="sf-btn" onclick="clearAllData()">Clear All Data</button>
                        <button class="sf-btn" onclick="clearBrowserStorage()" style="color:var(--sf-error);">Clear Browser Storage (Fix Quota)</button>
                    </div>
                </div>
            </div>

            <div class="sf-card">
                <div class="sf-card-header">
                    <span class="sf-card-title">Export Salesforce Data</span>
                </div>
                <div class="sf-card-body">
                    <p style="margin-bottom:16px;color:var(--sf-text-secondary);">Export data in Salesforce native format or transform for other CRM systems.</p>
                    <div class="sf-btn-group">
                        <button class="sf-btn sf-btn-primary" onclick="exportNative()">Export Salesforce JSON</button>
                        <button class="sf-btn" onclick="exportToLocalCRM()">Export for Local CRM</button>
                        <button class="sf-btn" onclick="exportToDynamics()">Export for Dynamics 365</button>
                    </div>
                </div>
            </div>

            <div class="sf-card">
                <div class="sf-card-header">
                    <span class="sf-card-title">Import Data</span>
                </div>
                <div class="sf-card-body">
                    <p style="margin-bottom:16px;color:var(--sf-text-secondary);">Import data from various sources. NeuAI will handle schema translation automatically.</p>
                    <div class="sf-btn-group">
                        <button class="sf-btn sf-btn-primary" onclick="document.getElementById('importFile').click()">Import JSON File</button>
                        <input type="file" id="importFile" accept=".json" style="display:none" onchange="handleImport(event)">
                    </div>
                </div>
            </div>

            <div class="sf-card">
                <div class="sf-card-header">
                    <span class="sf-card-title">NeuAI Sync Configuration</span>
                </div>
                <div class="sf-card-body">
                    <div class="sf-form-group">
                        <label class="sf-label">Sync Mode</label>
                        <select class="sf-select" id="syncMode">
                            <option value="manual">Manual Sync</option>
                            <option value="auto">Auto-Sync (Real-time)</option>
                            <option value="scheduled">Scheduled Sync</option>
                        </select>
                    </div>
                    <div class="sf-form-group">
                        <label class="sf-label">NeuAI Project GUID</label>
                        <input type="text" class="sf-input" id="neuaiGuid" placeholder="Enter your NeuAI project GUID">
                    </div>
                    <div class="sf-form-group">
                        <label class="sf-label">Deduplication Strategy</label>
                        <select class="sf-select" id="dedupeStrategy">
                            <option value="email">By Email Address</option>
                            <option value="name">By Name Match</option>
                            <option value="composite">Composite Key (Name + Company)</option>
                        </select>
                    </div>
                    <button class="sf-btn sf-btn-success" onclick="saveNeuAIConfig()">Save Configuration</button>
                </div>
            </div>

            <div class="sf-card">
                <div class="sf-card-header">
                    <span class="sf-card-title">Schema Mapping Reference</span>
                </div>
                <div class="sf-card-body">
                    <table class="sf-table">
                        <thead>
                            <tr>
                                <th>Salesforce Field</th>
                                <th>Local CRM Field</th>
                                <th>Dynamics 365 Field</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>FirstName</td><td>firstName</td><td>firstname</td></tr>
                            <tr><td>LastName</td><td>lastName</td><td>lastname</td></tr>
                            <tr><td>Email</td><td>email</td><td>emailaddress1</td></tr>
                            <tr><td>Phone</td><td>phone</td><td>telephone1</td></tr>
                            <tr><td>AccountId</td><td>companyId</td><td>parentcustomerid</td></tr>
                            <tr><td>Name (Account)</td><td>name</td><td>name</td></tr>
                            <tr><td>Amount</td><td>value</td><td>estimatedvalue</td></tr>
                            <tr><td>StageName</td><td>stage</td><td>stepname</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </main>

    <!-- Modals -->
    <div class="sf-modal-overlay" id="modal-contact">
        <div class="sf-modal">
            <div class="sf-modal-header">
                <span class="sf-modal-title" id="modal-contact-title">New Contact</span>
                <button class="sf-modal-close" onclick="closeModal('contact')">&times;</button>
            </div>
            <div class="sf-modal-body">
                <form id="contact-form">
                    <input type="hidden" id="contact-Id">
                    <div class="sf-form-grid">
                        <div class="sf-form-group">
                            <label class="sf-label">First Name *</label>
                            <input type="text" class="sf-input" id="contact-FirstName" required>
                        </div>
                        <div class="sf-form-group">
                            <label class="sf-label">Last Name *</label>
                            <input type="text" class="sf-input" id="contact-LastName" required>
                        </div>
                    </div>
                    <div class="sf-form-grid">
                        <div class="sf-form-group">
                            <label class="sf-label">Email</label>
                            <input type="email" class="sf-input" id="contact-Email">
                        </div>
                        <div class="sf-form-group">
                            <label class="sf-label">Phone</label>
                            <input type="tel" class="sf-input" id="contact-Phone">
                        </div>
                    </div>
                    <div class="sf-form-grid">
                        <div class="sf-form-group">
                            <label class="sf-label">Account</label>
                            <select class="sf-select" id="contact-AccountId"></select>
                        </div>
                        <div class="sf-form-group">
                            <label class="sf-label">Lead Source</label>
                            <select class="sf-select" id="contact-LeadSource">
                                <option value="">--None--</option>
                                <option value="Web">Web</option>
                                <option value="Phone Inquiry">Phone Inquiry</option>
                                <option value="Partner Referral">Partner Referral</option>
                                <option value="Purchased List">Purchased List</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    <div class="sf-form-group">
                        <label class="sf-label">Description</label>
                        <textarea class="sf-input" id="contact-Description" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="sf-modal-footer">
                <button class="sf-btn" onclick="closeModal('contact')">Cancel</button>
                <button class="sf-btn sf-btn-primary" onclick="saveContact()">Save</button>
            </div>
        </div>
    </div>

    <div class="sf-modal-overlay" id="modal-account">
        <div class="sf-modal">
            <div class="sf-modal-header">
                <span class="sf-modal-title" id="modal-account-title">New Account</span>
                <button class="sf-modal-close" onclick="closeModal('account')">&times;</button>
            </div>
            <div class="sf-modal-body">
                <form id="account-form">
                    <input type="hidden" id="account-Id">
                    <div class="sf-form-group">
                        <label class="sf-label">Account Name *</label>
                        <input type="text" class="sf-input" id="account-Name" required>
                    </div>
                    <div class="sf-form-grid">
                        <div class="sf-form-group">
                            <label class="sf-label">Industry</label>
                            <select class="sf-select" id="account-Industry">
                                <option value="">--None--</option>
                                <option value="Agriculture">Agriculture</option>
                                <option value="Banking">Banking</option>
                                <option value="Consulting">Consulting</option>
                                <option value="Education">Education</option>
                                <option value="Electronics">Electronics</option>
                                <option value="Energy">Energy</option>
                                <option value="Finance">Finance</option>
                                <option value="Healthcare">Healthcare</option>
                                <option value="Insurance">Insurance</option>
                                <option value="Manufacturing">Manufacturing</option>
                                <option value="Media">Media</option>
                                <option value="Retail">Retail</option>
                                <option value="Technology">Technology</option>
                                <option value="Telecommunications">Telecommunications</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="sf-form-group">
                            <label class="sf-label">Website</label>
                            <input type="url" class="sf-input" id="account-Website">
                        </div>
                    </div>
                    <div class="sf-form-group">
                        <label class="sf-label">Description</label>
                        <textarea class="sf-input" id="account-Description" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="sf-modal-footer">
                <button class="sf-btn" onclick="closeModal('account')">Cancel</button>
                <button class="sf-btn sf-btn-primary" onclick="saveAccount()">Save</button>
            </div>
        </div>
    </div>

    <div class="sf-modal-overlay" id="modal-opportunity">
        <div class="sf-modal">
            <div class="sf-modal-header">
                <span class="sf-modal-title" id="modal-opportunity-title">New Opportunity</span>
                <button class="sf-modal-close" onclick="closeModal('opportunity')">&times;</button>
            </div>
            <div class="sf-modal-body">
                <form id="opportunity-form">
                    <input type="hidden" id="opportunity-Id">
                    <div class="sf-form-group">
                        <label class="sf-label">Opportunity Name *</label>
                        <input type="text" class="sf-input" id="opportunity-Name" required>
                    </div>
                    <div class="sf-form-grid">
                        <div class="sf-form-group">
                            <label class="sf-label">Account</label>
                            <select class="sf-select" id="opportunity-AccountId"></select>
                        </div>
                        <div class="sf-form-group">
                            <label class="sf-label">Primary Contact</label>
                            <select class="sf-select" id="opportunity-ContactId"></select>
                        </div>
                    </div>
                    <div class="sf-form-grid">
                        <div class="sf-form-group">
                            <label class="sf-label">Amount</label>
                            <input type="number" class="sf-input" id="opportunity-Amount" step="0.01">
                        </div>
                        <div class="sf-form-group">
                            <label class="sf-label">Close Date *</label>
                            <input type="date" class="sf-input" id="opportunity-CloseDate" required>
                        </div>
                    </div>
                    <div class="sf-form-group">
                        <label class="sf-label">Stage *</label>
                        <select class="sf-select" id="opportunity-StageName" required>
                            <option value="Prospecting">Prospecting</option>
                            <option value="Qualification">Qualification</option>
                            <option value="Needs Analysis">Needs Analysis</option>
                            <option value="Value Proposition">Value Proposition</option>
                            <option value="Id. Decision Makers">Id. Decision Makers</option>
                            <option value="Perception Analysis">Perception Analysis</option>
                            <option value="Proposal/Price Quote">Proposal/Price Quote</option>
                            <option value="Negotiation/Review">Negotiation/Review</option>
                            <option value="Closed Won">Closed Won</option>
                            <option value="Closed Lost">Closed Lost</option>
                        </select>
                    </div>
                    <div class="sf-form-group">
                        <label class="sf-label">Description</label>
                        <textarea class="sf-input" id="opportunity-Description" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="sf-modal-footer">
                <button class="sf-btn" onclick="closeModal('opportunity')">Cancel</button>
                <button class="sf-btn sf-btn-primary" onclick="saveOpportunity()">Save</button>
            </div>
        </div>
    </div>

    <div class="sf-modal-overlay" id="modal-task">
        <div class="sf-modal">
            <div class="sf-modal-header">
                <span class="sf-modal-title" id="modal-task-title">New Task</span>
                <button class="sf-modal-close" onclick="closeModal('task')">&times;</button>
            </div>
            <div class="sf-modal-body">
                <form id="task-form">
                    <input type="hidden" id="task-Id">
                    <div class="sf-form-group">
                        <label class="sf-label">Subject *</label>
                        <input type="text" class="sf-input" id="task-Subject" required>
                    </div>
                    <div class="sf-form-grid">
                        <div class="sf-form-group">
                            <label class="sf-label">Type</label>
                            <select class="sf-select" id="task-Type">
                                <option value="">--None--</option>
                                <option value="Call">Call</option>
                                <option value="Email">Email</option>
                                <option value="Meeting">Meeting</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="sf-form-group">
                            <label class="sf-label">Activity Date</label>
                            <input type="date" class="sf-input" id="task-ActivityDate">
                        </div>
                    </div>
                    <div class="sf-form-grid">
                        <div class="sf-form-group">
                            <label class="sf-label">Name (Who)</label>
                            <select class="sf-select" id="task-WhoId"></select>
                        </div>
                        <div class="sf-form-group">
                            <label class="sf-label">Related To (What)</label>
                            <select class="sf-select" id="task-WhatId"></select>
                        </div>
                    </div>
                    <div class="sf-form-group">
                        <label class="sf-label">Description</label>
                        <textarea class="sf-input" id="task-Description" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="sf-modal-footer">
                <button class="sf-btn" onclick="closeModal('task')">Cancel</button>
                <button class="sf-btn sf-btn-primary" onclick="saveTask()">Save</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="sf-toast" id="toast" role="status" aria-live="polite" aria-atomic="true"></div>

    <script>
        // Salesforce Schema - Native field names
        const STORAGE_KEY = 'salesforce_simulator_data';

        let data = {
            Contact: [],
            Account: [],
            Opportunity: [],
            Task: [],
            _meta: {
                lastSync: null,
                neuaiGuid: '',
                syncMode: 'manual',
                dedupeStrategy: 'email'
            }
        };

        // Schema mapping to Local CRM format
        const LOCAL_CRM_SCHEMA = {
            Contact: {
                entity: 'contacts',
                fields: {
                    FirstName: 'firstName',
                    LastName: 'lastName',
                    Email: 'email',
                    Phone: 'phone',
                    AccountId: 'companyId',
                    Description: 'notes',
                    LeadSource: 'status'
                }
            },
            Account: {
                entity: 'companies',
                fields: {
                    Name: 'name',
                    Industry: 'industry',
                    Website: 'website',
                    Description: 'notes'
                }
            },
            Opportunity: {
                entity: 'deals',
                fields: {
                    Name: 'name',
                    Amount: 'value',
                    StageName: 'stage',
                    AccountId: 'companyId',
                    ContactId: 'contactId',
                    CloseDate: 'closeDate',
                    Description: 'notes'
                }
            },
            Task: {
                entity: 'activities',
                fields: {
                    Subject: 'title',
                    Type: 'type',
                    WhoId: 'contactId',
                    WhatId: 'dealId',
                    Description: 'description',
                    ActivityDate: 'createdAt'
                }
            },
            stageMap: {
                'Prospecting': 'lead',
                'Qualification': 'qualified',
                'Needs Analysis': 'qualified',
                'Value Proposition': 'qualified',
                'Id. Decision Makers': 'qualified',
                'Perception Analysis': 'proposal',
                'Proposal/Price Quote': 'proposal',
                'Negotiation/Review': 'negotiation',
                'Closed Won': 'won',
                'Closed Lost': 'lost'
            },
            reverseStageMap: {
                'lead': 'Prospecting',
                'qualified': 'Qualification',
                'proposal': 'Proposal/Price Quote',
                'negotiation': 'Negotiation/Review',
                'won': 'Closed Won',
                'lost': 'Closed Lost'
            }
        };

        // Schema mapping to Dynamics 365 format
        const DYNAMICS_SCHEMA = {
            Contact: {
                entity: 'contact',
                fields: {
                    FirstName: 'firstname',
                    LastName: 'lastname',
                    Email: 'emailaddress1',
                    Phone: 'telephone1',
                    AccountId: 'parentcustomerid',
                    Description: 'description',
                    LeadSource: 'customertypecode'
                }
            },
            Account: {
                entity: 'account',
                fields: {
                    Name: 'name',
                    Industry: 'industrycode',
                    Website: 'websiteurl',
                    Description: 'description'
                }
            },
            Opportunity: {
                entity: 'opportunity',
                fields: {
                    Name: 'name',
                    Amount: 'estimatedvalue',
                    StageName: 'stepname',
                    AccountId: 'parentaccountid',
                    ContactId: 'parentcontactid',
                    CloseDate: 'estimatedclosedate',
                    Description: 'description'
                }
            },
            Task: {
                entity: 'activitypointer',
                fields: {
                    Subject: 'subject',
                    Type: 'activitytypecode',
                    WhoId: 'regardingobjectid',
                    WhatId: 'regardingobjectid',
                    Description: 'description',
                    ActivityDate: 'actualstart'
                }
            },
            stageMap: {
                'Prospecting': '1 - Qualify',
                'Qualification': '2 - Develop',
                'Needs Analysis': '2 - Develop',
                'Value Proposition': '2 - Develop',
                'Proposal/Price Quote': '3 - Propose',
                'Negotiation/Review': '4 - Close',
                'Closed Won': 'Won',
                'Closed Lost': 'Lost'
            },
            reverseStageMap: {
                '1 - Qualify': 'Prospecting',
                '2 - Develop': 'Qualification',
                '3 - Propose': 'Proposal/Price Quote',
                '4 - Close': 'Negotiation/Review',
                'Won': 'Closed Won',
                'Lost': 'Closed Lost'
            }
        };

        // Industry code mapping for Dynamics 365
        const industryCodeMap = {
            'Agriculture': 1,
            'Banking': 2,
            'Consulting': 3,
            'Education': 4,
            'Electronics': 5,
            'Energy': 6,
            'Finance': 7,
            'Healthcare': 8,
            'Insurance': 9,
            'Manufacturing': 10,
            'Media': 11,
            'Retail': 12,
            'Technology': 13,
            'Telecommunications': 14,
            'Other': 15
        };

        const reverseIndustryCodeMap = Object.fromEntries(
            Object.entries(industryCodeMap).map(([k, v]) => [v, k])
        );

        // Initialize
        function init() {
            loadData();
            setupTabs();
            renderAll();
            updateStats();
            updateSyncStatus();
        }

        function loadData() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                data = JSON.parse(saved);
            }
        }

        function saveData() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
            } catch (e) {
                if (e.name === 'QuotaExceededError') {
                    showToast('Storage full! Clear browser storage or use Export to save data.', 'error');
                    console.error('LocalStorage quota exceeded. Consider clearing storage.');
                }
            }
        }

        function generateId() {
            return '001' + Math.random().toString(36).substr(2, 15).toUpperCase();
        }

        // Tab Navigation
        function setupTabs() {
            document.querySelectorAll('.sf-nav-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.sf-nav-tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');

                    document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
                    document.getElementById(`tab-${tab.dataset.tab}`).classList.remove('hidden');
                });
            });
        }

        // Render Functions
        function renderAll() {
            renderContacts();
            renderAccounts();
            renderOpportunities();
            renderTasks();
            renderRecentOpportunities();
            populateDropdowns();
        }

        function renderContacts() {
            const tbody = document.getElementById('contacts-table');
            const empty = document.getElementById('contacts-empty');

            if (data.Contact.length === 0) {
                tbody.innerHTML = '';
                empty.classList.remove('hidden');
                document.getElementById('contacts-count').textContent = '0 items';
                return;
            }

            empty.classList.add('hidden');
            document.getElementById('contacts-count').textContent = `${data.Contact.length} items`;

            tbody.innerHTML = data.Contact.map(c => {
                const account = data.Account.find(a => a.Id === c.AccountId);
                return `
                    <tr>
                        <td><a class="sf-table-link" onclick="editContact('${c.Id}')">${c.FirstName} ${c.LastName}</a></td>
                        <td>${c.Email || ''}</td>
                        <td>${c.Phone || ''}</td>
                        <td>${account ? account.Name : ''}</td>
                        <td>${c.LeadSource || ''}</td>
                        <td>
                            <button class="sf-btn" onclick="editContact('${c.Id}')">Edit</button>
                            <button class="sf-btn" onclick="deleteRecord('Contact', '${c.Id}')">Delete</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function renderAccounts() {
            const tbody = document.getElementById('accounts-table');
            const empty = document.getElementById('accounts-empty');

            if (data.Account.length === 0) {
                tbody.innerHTML = '';
                empty.classList.remove('hidden');
                document.getElementById('accounts-count').textContent = '0 items';
                return;
            }

            empty.classList.add('hidden');
            document.getElementById('accounts-count').textContent = `${data.Account.length} items`;

            tbody.innerHTML = data.Account.map(a => {
                const contactCount = data.Contact.filter(c => c.AccountId === a.Id).length;
                return `
                    <tr>
                        <td><a class="sf-table-link" onclick="editAccount('${a.Id}')">${a.Name}</a></td>
                        <td>${a.Industry || ''}</td>
                        <td>${a.Website ? `<a href="${a.Website}" target="_blank">${a.Website}</a>` : ''}</td>
                        <td>${contactCount}</td>
                        <td>
                            <button class="sf-btn" onclick="editAccount('${a.Id}')">Edit</button>
                            <button class="sf-btn" onclick="deleteRecord('Account', '${a.Id}')">Delete</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function renderOpportunities() {
            const tbody = document.getElementById('opportunities-table');
            const empty = document.getElementById('opportunities-empty');

            if (data.Opportunity.length === 0) {
                tbody.innerHTML = '';
                empty.classList.remove('hidden');
                document.getElementById('opportunities-count').textContent = '0 items';
                return;
            }

            empty.classList.add('hidden');
            document.getElementById('opportunities-count').textContent = `${data.Opportunity.length} items`;

            tbody.innerHTML = data.Opportunity.map(o => {
                const account = data.Account.find(a => a.Id === o.AccountId);
                const stageClass = getStageClass(o.StageName);
                return `
                    <tr>
                        <td><a class="sf-table-link" onclick="editOpportunity('${o.Id}')">${o.Name}</a></td>
                        <td>${account ? account.Name : ''}</td>
                        <td>$${(o.Amount || 0).toLocaleString()}</td>
                        <td><span class="sf-stage ${stageClass}">${o.StageName}</span></td>
                        <td>${o.CloseDate || ''}</td>
                        <td>
                            <button class="sf-btn" onclick="editOpportunity('${o.Id}')">Edit</button>
                            <button class="sf-btn" onclick="deleteRecord('Opportunity', '${o.Id}')">Delete</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function renderTasks() {
            const tbody = document.getElementById('tasks-table');
            const empty = document.getElementById('tasks-empty');

            if (data.Task.length === 0) {
                tbody.innerHTML = '';
                empty.classList.remove('hidden');
                document.getElementById('tasks-count').textContent = '0 items';
                return;
            }

            empty.classList.add('hidden');
            document.getElementById('tasks-count').textContent = `${data.Task.length} items`;

            tbody.innerHTML = data.Task.map(t => {
                const contact = data.Contact.find(c => c.Id === t.WhoId);
                const opp = data.Opportunity.find(o => o.Id === t.WhatId);
                return `
                    <tr>
                        <td><a class="sf-table-link" onclick="editTask('${t.Id}')">${t.Subject}</a></td>
                        <td>${t.Type || ''}</td>
                        <td>${contact ? `${contact.FirstName} ${contact.LastName}` : (opp ? opp.Name : '')}</td>
                        <td>${t.ActivityDate || ''}</td>
                        <td>
                            <button class="sf-btn" onclick="editTask('${t.Id}')">Edit</button>
                            <button class="sf-btn" onclick="deleteRecord('Task', '${t.Id}')">Delete</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function renderRecentOpportunities() {
            const tbody = document.getElementById('recent-opportunities');
            const recent = [...data.Opportunity]
                .sort((a, b) => new Date(b.CreatedDate || 0) - new Date(a.CreatedDate || 0))
                .slice(0, 5);

            if (recent.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;color:var(--sf-text-secondary);">No opportunities yet</td></tr>';
                return;
            }

            tbody.innerHTML = recent.map(o => {
                const account = data.Account.find(a => a.Id === o.AccountId);
                const stageClass = getStageClass(o.StageName);
                return `
                    <tr>
                        <td><a class="sf-table-link" onclick="switchToTab('opportunities');editOpportunity('${o.Id}')">${o.Name}</a></td>
                        <td>${account ? account.Name : ''}</td>
                        <td>$${(o.Amount || 0).toLocaleString()}</td>
                        <td><span class="sf-stage ${stageClass}">${o.StageName}</span></td>
                        <td>${o.CloseDate || ''}</td>
                    </tr>
                `;
            }).join('');
        }

        function getStageClass(stage) {
            if (!stage) return '';
            const s = stage.toLowerCase();
            if (s.includes('prospecting')) return 'sf-stage-prospecting';
            if (s.includes('qualification') || s.includes('analysis') || s.includes('proposition') || s.includes('decision') || s.includes('perception')) return 'sf-stage-qualification';
            if (s.includes('proposal')) return 'sf-stage-proposal';
            if (s.includes('negotiation')) return 'sf-stage-negotiation';
            if (s.includes('won')) return 'sf-stage-closed-won';
            if (s.includes('lost')) return 'sf-stage-closed-lost';
            return '';
        }

        function populateDropdowns() {
            // Account dropdowns
            const accountOptions = '<option value="">--None--</option>' +
                data.Account.map(a => `<option value="${a.Id}">${a.Name}</option>`).join('');
            document.getElementById('contact-AccountId').innerHTML = accountOptions;
            document.getElementById('opportunity-AccountId').innerHTML = accountOptions;

            // Contact dropdowns
            const contactOptions = '<option value="">--None--</option>' +
                data.Contact.map(c => `<option value="${c.Id}">${c.FirstName} ${c.LastName}</option>`).join('');
            document.getElementById('opportunity-ContactId').innerHTML = contactOptions;
            document.getElementById('task-WhoId').innerHTML = contactOptions;

            // Opportunity dropdown for tasks
            const oppOptions = '<option value="">--None--</option>' +
                data.Opportunity.map(o => `<option value="${o.Id}">${o.Name}</option>`).join('');
            document.getElementById('task-WhatId').innerHTML = oppOptions;
        }

        function updateStats() {
            document.getElementById('stat-contacts').textContent = data.Contact.length;
            document.getElementById('stat-accounts').textContent = data.Account.length;

            const openOpps = data.Opportunity.filter(o =>
                !o.StageName?.toLowerCase().includes('closed')
            );
            document.getElementById('stat-opportunities').textContent = openOpps.length;

            const pipeline = openOpps.reduce((sum, o) => sum + (o.Amount || 0), 0);
            document.getElementById('stat-pipeline').textContent = '$' + pipeline.toLocaleString();
        }

        function updateSyncStatus() {
            const localData = localStorage.getItem('local_first_crm_data');
            const d365Data = localStorage.getItem('dynamics365_simulator_data');

            document.getElementById('sync-local').textContent = localData ?
                JSON.parse(localData).contacts?.length || 0 : '--';
            document.getElementById('sync-sf').textContent = data.Contact.length || 0;
            document.getElementById('sync-d365').textContent = d365Data ?
                JSON.parse(d365Data).contact?.length || 0 : '--';
        }

        // Modal Functions
        function openModal(type) {
            document.getElementById(`modal-${type}`).classList.add('active');
            document.getElementById(`modal-${type}-title`).textContent = `New ${type.charAt(0).toUpperCase() + type.slice(1)}`;
            document.getElementById(`${type}-form`).reset();
            document.getElementById(`${type}-Id`).value = '';
        }

        function closeModal(type) {
            document.getElementById(`modal-${type}`).classList.remove('active');
        }

        // CRUD Operations
        function saveContact() {
            const id = document.getElementById('contact-Id').value;
            const contact = {
                Id: id || generateId(),
                FirstName: document.getElementById('contact-FirstName').value,
                LastName: document.getElementById('contact-LastName').value,
                Email: document.getElementById('contact-Email').value,
                Phone: document.getElementById('contact-Phone').value,
                AccountId: document.getElementById('contact-AccountId').value,
                LeadSource: document.getElementById('contact-LeadSource').value,
                Description: document.getElementById('contact-Description').value,
                CreatedDate: id ? data.Contact.find(c => c.Id === id)?.CreatedDate : new Date().toISOString(),
                LastModifiedDate: new Date().toISOString()
            };

            if (id) {
                const idx = data.Contact.findIndex(c => c.Id === id);
                data.Contact[idx] = contact;
            } else {
                data.Contact.push(contact);
            }

            saveData();
            closeModal('contact');
            renderAll();
            updateStats();
            showToast('Contact saved successfully', 'success');
        }

        function editContact(id) {
            const contact = data.Contact.find(c => c.Id === id);
            if (!contact) return;

            document.getElementById('contact-Id').value = contact.Id;
            document.getElementById('contact-FirstName').value = contact.FirstName || '';
            document.getElementById('contact-LastName').value = contact.LastName || '';
            document.getElementById('contact-Email').value = contact.Email || '';
            document.getElementById('contact-Phone').value = contact.Phone || '';
            document.getElementById('contact-AccountId').value = contact.AccountId || '';
            document.getElementById('contact-LeadSource').value = contact.LeadSource || '';
            document.getElementById('contact-Description').value = contact.Description || '';

            document.getElementById('modal-contact-title').textContent = 'Edit Contact';
            document.getElementById('modal-contact').classList.add('active');
        }

        function saveAccount() {
            const id = document.getElementById('account-Id').value;
            const account = {
                Id: id || generateId(),
                Name: document.getElementById('account-Name').value,
                Industry: document.getElementById('account-Industry').value,
                Website: document.getElementById('account-Website').value,
                Description: document.getElementById('account-Description').value,
                CreatedDate: id ? data.Account.find(a => a.Id === id)?.CreatedDate : new Date().toISOString(),
                LastModifiedDate: new Date().toISOString()
            };

            if (id) {
                const idx = data.Account.findIndex(a => a.Id === id);
                data.Account[idx] = account;
            } else {
                data.Account.push(account);
            }

            saveData();
            closeModal('account');
            renderAll();
            updateStats();
            showToast('Account saved successfully', 'success');
        }

        function editAccount(id) {
            const account = data.Account.find(a => a.Id === id);
            if (!account) return;

            document.getElementById('account-Id').value = account.Id;
            document.getElementById('account-Name').value = account.Name || '';
            document.getElementById('account-Industry').value = account.Industry || '';
            document.getElementById('account-Website').value = account.Website || '';
            document.getElementById('account-Description').value = account.Description || '';

            document.getElementById('modal-account-title').textContent = 'Edit Account';
            document.getElementById('modal-account').classList.add('active');
        }

        function saveOpportunity() {
            const id = document.getElementById('opportunity-Id').value;
            const opp = {
                Id: id || generateId(),
                Name: document.getElementById('opportunity-Name').value,
                AccountId: document.getElementById('opportunity-AccountId').value,
                ContactId: document.getElementById('opportunity-ContactId').value,
                Amount: parseFloat(document.getElementById('opportunity-Amount').value) || 0,
                CloseDate: document.getElementById('opportunity-CloseDate').value,
                StageName: document.getElementById('opportunity-StageName').value,
                Description: document.getElementById('opportunity-Description').value,
                CreatedDate: id ? data.Opportunity.find(o => o.Id === id)?.CreatedDate : new Date().toISOString(),
                LastModifiedDate: new Date().toISOString()
            };

            if (id) {
                const idx = data.Opportunity.findIndex(o => o.Id === id);
                data.Opportunity[idx] = opp;
            } else {
                data.Opportunity.push(opp);
            }

            saveData();
            closeModal('opportunity');
            renderAll();
            updateStats();
            showToast('Opportunity saved successfully', 'success');
        }

        function editOpportunity(id) {
            const opp = data.Opportunity.find(o => o.Id === id);
            if (!opp) return;

            document.getElementById('opportunity-Id').value = opp.Id;
            document.getElementById('opportunity-Name').value = opp.Name || '';
            document.getElementById('opportunity-AccountId').value = opp.AccountId || '';
            document.getElementById('opportunity-ContactId').value = opp.ContactId || '';
            document.getElementById('opportunity-Amount').value = opp.Amount || '';
            document.getElementById('opportunity-CloseDate').value = opp.CloseDate || '';
            document.getElementById('opportunity-StageName').value = opp.StageName || 'Prospecting';
            document.getElementById('opportunity-Description').value = opp.Description || '';

            document.getElementById('modal-opportunity-title').textContent = 'Edit Opportunity';
            document.getElementById('modal-opportunity').classList.add('active');
        }

        function saveTask() {
            const id = document.getElementById('task-Id').value;
            const task = {
                Id: id || generateId(),
                Subject: document.getElementById('task-Subject').value,
                Type: document.getElementById('task-Type').value,
                WhoId: document.getElementById('task-WhoId').value,
                WhatId: document.getElementById('task-WhatId').value,
                ActivityDate: document.getElementById('task-ActivityDate').value,
                Description: document.getElementById('task-Description').value,
                CreatedDate: id ? data.Task.find(t => t.Id === id)?.CreatedDate : new Date().toISOString(),
                LastModifiedDate: new Date().toISOString()
            };

            if (id) {
                const idx = data.Task.findIndex(t => t.Id === id);
                data.Task[idx] = task;
            } else {
                data.Task.push(task);
            }

            saveData();
            closeModal('task');
            renderAll();
            updateStats();
            showToast('Task saved successfully', 'success');
        }

        function editTask(id) {
            const task = data.Task.find(t => t.Id === id);
            if (!task) return;

            document.getElementById('task-Id').value = task.Id;
            document.getElementById('task-Subject').value = task.Subject || '';
            document.getElementById('task-Type').value = task.Type || '';
            document.getElementById('task-WhoId').value = task.WhoId || '';
            document.getElementById('task-WhatId').value = task.WhatId || '';
            document.getElementById('task-ActivityDate').value = task.ActivityDate || '';
            document.getElementById('task-Description').value = task.Description || '';

            document.getElementById('modal-task-title').textContent = 'Edit Task';
            document.getElementById('modal-task').classList.add('active');
        }

        function deleteRecord(type, id) {
            if (!confirm(`Are you sure you want to delete this ${type.toLowerCase()}?`)) return;

            const idx = data[type].findIndex(r => r.Id === id);
            if (idx !== -1) {
                data[type].splice(idx, 1);
                saveData();
                renderAll();
                updateStats();
                showToast(`${type} deleted successfully`, 'success');
            }
        }

        function switchToTab(tabName) {
            document.querySelectorAll('.sf-nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
            document.getElementById(`tab-${tabName}`).classList.remove('hidden');
        }

        // Export Functions
        function exportNative() {
            const exportData = {
                _format: 'salesforce',
                _version: '1.0',
                _exportedAt: new Date().toISOString(),
                Contact: data.Contact,
                Account: data.Account,
                Opportunity: data.Opportunity,
                Task: data.Task
            };

            downloadJSON(exportData, 'salesforce-export.json');
            showToast('Exported Salesforce data', 'success');
        }

        function exportToLocalCRM() {
            const idMap = { accounts: {}, contacts: {} };

            // Transform Accounts to Companies
            const companies = data.Account.map(a => {
                const newId = 'c_' + a.Id;
                idMap.accounts[a.Id] = newId;
                return {
                    id: newId,
                    name: a.Name,
                    industry: a.Industry,
                    website: a.Website,
                    notes: a.Description,
                    createdAt: a.CreatedDate
                };
            });

            // Transform Contacts
            const contacts = data.Contact.map(c => {
                const newId = 'ct_' + c.Id;
                idMap.contacts[c.Id] = newId;
                return {
                    id: newId,
                    firstName: c.FirstName,
                    lastName: c.LastName,
                    email: c.Email,
                    phone: c.Phone,
                    companyId: idMap.accounts[c.AccountId] || null,
                    notes: c.Description,
                    status: c.LeadSource,
                    createdAt: c.CreatedDate
                };
            });

            // Transform Opportunities to Deals
            const deals = data.Opportunity.map(o => ({
                id: 'd_' + o.Id,
                name: o.Name,
                value: o.Amount,
                stage: LOCAL_CRM_SCHEMA.stageMap[o.StageName] || 'lead',
                companyId: idMap.accounts[o.AccountId] || null,
                contactId: idMap.contacts[o.ContactId] || null,
                closeDate: o.CloseDate,
                notes: o.Description,
                createdAt: o.CreatedDate
            }));

            // Transform Tasks to Activities
            const activities = data.Task.map(t => ({
                id: 'a_' + t.Id,
                title: t.Subject,
                type: t.Type?.toLowerCase() || 'other',
                contactId: idMap.contacts[t.WhoId] || null,
                dealId: 'd_' + t.WhatId,
                description: t.Description,
                createdAt: t.ActivityDate || t.CreatedDate
            }));

            const exportData = {
                _format: 'local-crm',
                _version: '1.0',
                _exportedAt: new Date().toISOString(),
                _sourceFormat: 'salesforce',
                contacts,
                companies,
                deals,
                activities
            };

            downloadJSON(exportData, 'local-crm-export.json');
            showToast('Exported for Local CRM', 'success');
        }

        function exportToDynamics() {
            const idMap = { accounts: {}, contacts: {} };

            // Transform to Dynamics 365 format
            const account = data.Account.map(a => {
                const newId = a.Id;
                idMap.accounts[a.Id] = newId;
                return {
                    accountid: newId,
                    name: a.Name,
                    industrycode: industryCodeMap[a.Industry] || 15,
                    websiteurl: a.Website,
                    description: a.Description,
                    createdon: a.CreatedDate
                };
            });

            const contact = data.Contact.map(c => {
                const newId = c.Id;
                idMap.contacts[c.Id] = newId;
                return {
                    contactid: newId,
                    firstname: c.FirstName,
                    lastname: c.LastName,
                    emailaddress1: c.Email,
                    telephone1: c.Phone,
                    parentcustomerid: idMap.accounts[c.AccountId] || null,
                    description: c.Description,
                    customertypecode: c.LeadSource,
                    createdon: c.CreatedDate
                };
            });

            const opportunity = data.Opportunity.map(o => ({
                opportunityid: o.Id,
                name: o.Name,
                estimatedvalue: o.Amount,
                stepname: DYNAMICS_SCHEMA.stageMap[o.StageName] || '1 - Qualify',
                parentaccountid: idMap.accounts[o.AccountId] || null,
                parentcontactid: idMap.contacts[o.ContactId] || null,
                estimatedclosedate: o.CloseDate,
                description: o.Description,
                createdon: o.CreatedDate
            }));

            const activitypointer = data.Task.map(t => ({
                activityid: t.Id,
                subject: t.Subject,
                activitytypecode: t.Type?.toLowerCase() || 'task',
                regardingobjectid: idMap.contacts[t.WhoId] || t.WhatId,
                description: t.Description,
                actualstart: t.ActivityDate || t.CreatedDate,
                createdon: t.CreatedDate
            }));

            const exportData = {
                _format: 'dynamics365',
                _version: '1.0',
                _exportedAt: new Date().toISOString(),
                _sourceFormat: 'salesforce',
                account,
                contact,
                opportunity,
                activitypointer
            };

            downloadJSON(exportData, 'dynamics365-export.json');
            showToast('Exported for Dynamics 365', 'success');
        }

        function downloadJSON(data, filename) {
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Import Function
        function handleImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const imported = JSON.parse(e.target.result);

                    // Detect format and transform
                    if (imported._format === 'salesforce' || imported.Contact) {
                        // Native Salesforce format
                        importSalesforceData(imported);
                    } else if (imported._format === 'local-crm' || imported.contacts) {
                        // Local CRM format
                        importFromLocalCRM(imported);
                    } else if (imported._format === 'dynamics365' || imported.contact) {
                        // Dynamics 365 format
                        importFromDynamics(imported);
                    } else {
                        throw new Error('Unknown data format');
                    }

                    event.target.value = '';
                } catch (err) {
                    showToast('Error importing: ' + err.message, 'error');
                }
            };
            reader.readAsText(file);
        }

        function importSalesforceData(imported) {
            if (imported.Account) data.Account = imported.Account;
            if (imported.Contact) data.Contact = imported.Contact;
            if (imported.Opportunity) data.Opportunity = imported.Opportunity;
            if (imported.Task) data.Task = imported.Task;

            saveData();
            renderAll();
            updateStats();
            showToast('Imported Salesforce data', 'success');
        }

        function importFromLocalCRM(imported) {
            const idMap = { companies: {}, contacts: {} };

            // Transform Companies to Accounts
            if (imported.companies) {
                imported.companies.forEach(c => {
                    const newId = generateId();
                    idMap.companies[c.id] = newId;
                    data.Account.push({
                        Id: newId,
                        Name: c.name,
                        Industry: c.industry,
                        Website: c.website,
                        Description: c.notes,
                        CreatedDate: c.createdAt || new Date().toISOString(),
                        LastModifiedDate: new Date().toISOString()
                    });
                });
            }

            // Transform Contacts
            if (imported.contacts) {
                imported.contacts.forEach(c => {
                    const newId = generateId();
                    idMap.contacts[c.id] = newId;
                    data.Contact.push({
                        Id: newId,
                        FirstName: c.firstName,
                        LastName: c.lastName,
                        Email: c.email,
                        Phone: c.phone,
                        AccountId: idMap.companies[c.companyId] || null,
                        Description: c.notes,
                        LeadSource: c.status,
                        CreatedDate: c.createdAt || new Date().toISOString(),
                        LastModifiedDate: new Date().toISOString()
                    });
                });
            }

            // Transform Deals to Opportunities
            if (imported.deals) {
                imported.deals.forEach(d => {
                    data.Opportunity.push({
                        Id: generateId(),
                        Name: d.name,
                        Amount: d.value,
                        StageName: LOCAL_CRM_SCHEMA.reverseStageMap[d.stage] || 'Prospecting',
                        AccountId: idMap.companies[d.companyId] || null,
                        ContactId: idMap.contacts[d.contactId] || null,
                        CloseDate: d.closeDate,
                        Description: d.notes,
                        CreatedDate: d.createdAt || new Date().toISOString(),
                        LastModifiedDate: new Date().toISOString()
                    });
                });
            }

            // Transform Activities to Tasks
            if (imported.activities) {
                imported.activities.forEach(a => {
                    data.Task.push({
                        Id: generateId(),
                        Subject: a.title,
                        Type: a.type?.charAt(0).toUpperCase() + a.type?.slice(1),
                        WhoId: idMap.contacts[a.contactId] || null,
                        WhatId: null,
                        Description: a.description,
                        ActivityDate: a.createdAt,
                        CreatedDate: a.createdAt || new Date().toISOString(),
                        LastModifiedDate: new Date().toISOString()
                    });
                });
            }

            saveData();
            renderAll();
            updateStats();
            showToast('Imported from Local CRM format', 'success');
        }

        function importFromDynamics(imported) {
            const idMap = { accounts: {}, contacts: {} };

            // Transform D365 Accounts
            if (imported.account) {
                imported.account.forEach(a => {
                    const newId = generateId();
                    idMap.accounts[a.accountid] = newId;
                    data.Account.push({
                        Id: newId,
                        Name: a.name,
                        Industry: reverseIndustryCodeMap[a.industrycode] || 'Other',
                        Website: a.websiteurl,
                        Description: a.description,
                        CreatedDate: a.createdon || new Date().toISOString(),
                        LastModifiedDate: new Date().toISOString()
                    });
                });
            }

            // Transform D365 Contacts
            if (imported.contact) {
                imported.contact.forEach(c => {
                    const newId = generateId();
                    idMap.contacts[c.contactid] = newId;
                    data.Contact.push({
                        Id: newId,
                        FirstName: c.firstname,
                        LastName: c.lastname,
                        Email: c.emailaddress1,
                        Phone: c.telephone1,
                        AccountId: idMap.accounts[c.parentcustomerid] || null,
                        Description: c.description,
                        LeadSource: c.customertypecode,
                        CreatedDate: c.createdon || new Date().toISOString(),
                        LastModifiedDate: new Date().toISOString()
                    });
                });
            }

            // Transform D365 Opportunities
            if (imported.opportunity) {
                imported.opportunity.forEach(o => {
                    data.Opportunity.push({
                        Id: generateId(),
                        Name: o.name,
                        Amount: o.estimatedvalue,
                        StageName: DYNAMICS_SCHEMA.reverseStageMap[o.stepname] || 'Prospecting',
                        AccountId: idMap.accounts[o.parentaccountid] || null,
                        ContactId: idMap.contacts[o.parentcontactid] || null,
                        CloseDate: o.estimatedclosedate,
                        Description: o.description,
                        CreatedDate: o.createdon || new Date().toISOString(),
                        LastModifiedDate: new Date().toISOString()
                    });
                });
            }

            // Transform D365 Activities
            if (imported.activitypointer) {
                imported.activitypointer.forEach(a => {
                    data.Task.push({
                        Id: generateId(),
                        Subject: a.subject,
                        Type: a.activitytypecode?.charAt(0).toUpperCase() + a.activitytypecode?.slice(1),
                        WhoId: idMap.contacts[a.regardingobjectid] || null,
                        WhatId: null,
                        Description: a.description,
                        ActivityDate: a.actualstart,
                        CreatedDate: a.createdon || new Date().toISOString(),
                        LastModifiedDate: new Date().toISOString()
                    });
                });
            }

            saveData();
            renderAll();
            updateStats();
            showToast('Imported from Dynamics 365 format', 'success');
        }

        // NeuAI Config
        function saveNeuAIConfig() {
            data._meta.neuaiGuid = document.getElementById('neuaiGuid').value;
            data._meta.syncMode = document.getElementById('syncMode').value;
            data._meta.dedupeStrategy = document.getElementById('dedupeStrategy').value;
            saveData();
            showToast('NeuAI configuration saved', 'success');
        }

        // Toast
        function showToast(message, type = '') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'sf-toast active ' + type;
            setTimeout(() => toast.classList.remove('active'), 3000);
        }

        // Sample Data - TechCorp Enterprise Sales Scenario
        function loadSampleData() {
            if (data.Account.length > 0) {
                if (!confirm('This will replace existing data. Continue?')) return;
            }

            // Realistic Salesforce enterprise sales scenario
            data.Account = [
                {
                    Id: '001SF00000TECHCORP',
                    Name: 'TechCorp Industries',
                    Industry: 'Technology',
                    Website: 'https://techcorp.example.com',
                    Description: 'Fortune 500 technology company. 50,000 employees globally. Primary target account for Q1. Decision maker is CIO reporting to CEO.',
                    CreatedDate: '2024-09-15T10:00:00.000Z',
                    LastModifiedDate: new Date().toISOString()
                },
                {
                    Id: '001SF00000MEDIGRP',
                    Name: 'MediHealth Group',
                    Industry: 'Healthcare',
                    Website: 'https://medihealth.example.com',
                    Description: 'Regional hospital network with 12 facilities. HIPAA compliance critical. IT modernization initiative in progress.',
                    CreatedDate: '2024-10-01T14:30:00.000Z',
                    LastModifiedDate: new Date().toISOString()
                },
                {
                    Id: '001SF00000FINSERV',
                    Name: 'First National Financial',
                    Industry: 'Finance',
                    Website: 'https://fnfinancial.example.com',
                    Description: 'Investment bank with $50B AUM. Regulatory compliance is top priority. Looking for secure collaboration platform.',
                    CreatedDate: '2024-10-20T09:15:00.000Z',
                    LastModifiedDate: new Date().toISOString()
                },
                {
                    Id: '001SF00000RETAILX',
                    Name: 'RetailMax Corporation',
                    Industry: 'Retail',
                    Website: 'https://retailmax.example.com',
                    Description: 'E-commerce and brick-and-mortar retailer. 2,000 stores nationwide. Digital transformation project approved.',
                    CreatedDate: '2024-11-05T11:00:00.000Z',
                    LastModifiedDate: new Date().toISOString()
                }
            ];

            data.Contact = [
                {
                    Id: '003SF00000JSMITH',
                    FirstName: 'Jennifer',
                    LastName: 'Smith',
                    Email: 'jennifer.smith@techcorp.example.com',
                    Phone: '+1-555-0100',
                    AccountId: '001SF00000TECHCORP',
                    LeadSource: 'Partner Referral',
                    Description: 'CIO - Primary decision maker. 15 years at TechCorp. Previously at Microsoft. Prefers technical deep-dives.',
                    CreatedDate: '2024-09-15T10:30:00.000Z',
                    LastModifiedDate: new Date().toISOString()
                },
                {
                    Id: '003SF00000MWILSON',
                    FirstName: 'Michael',
                    LastName: 'Wilson',
                    Email: 'mwilson@techcorp.example.com',
                    Phone: '+1-555-0101',
                    AccountId: '001SF00000TECHCORP',
                    LeadSource: 'Web',
                    Description: 'VP of Engineering. Reports to Jennifer. Champion for our solution. Running the technical evaluation.',
                    CreatedDate: '2024-09-20T14:00:00.000Z',
                    LastModifiedDate: new Date().toISOString()
                },
                {
                    Id: '003SF00000DCHEN',
                    FirstName: 'David',
                    LastName: 'Chen',
                    Email: 'david.chen@medihealth.example.com',
                    Phone: '+1-555-0200',
                    AccountId: '001SF00000MEDIGRP',
                    LeadSource: 'Trade Show',
                    Description: 'Chief Digital Officer. Met at HealthTech Summit. Very interested in our HIPAA-compliant features.',
                    CreatedDate: '2024-10-02T09:00:00.000Z',
                    LastModifiedDate: new Date().toISOString()
                },
                {
                    Id: '003SF00000AROBERTS',
                    FirstName: 'Amanda',
                    LastName: 'Roberts',
                    Email: 'aroberts@fnfinancial.example.com',
                    Phone: '+1-555-0300',
                    AccountId: '001SF00000FINSERV',
                    LeadSource: 'Cold Call',
                    Description: 'Director of IT Security. Key influencer. Concerned about SOC2 and data residency requirements.',
                    CreatedDate: '2024-10-25T16:00:00.000Z',
                    LastModifiedDate: new Date().toISOString()
                },
                {
                    Id: '003SF00000TBROWN',
                    FirstName: 'Thomas',
                    LastName: 'Brown',
                    Email: 'tbrown@retailmax.example.com',
                    Phone: '+1-555-0400',
                    AccountId: '001SF00000RETAILX',
                    LeadSource: 'Web',
                    Description: 'CTO. Previously at Amazon. Fast decision maker. Budget already approved for digital initiatives.',
                    CreatedDate: '2024-11-05T11:30:00.000Z',
                    LastModifiedDate: new Date().toISOString()
                }
            ];

            data.Opportunity = [
                {
                    Id: '006SF00000TCENT',
                    Name: 'TechCorp - Enterprise Platform Deal',
                    Amount: 2400000,
                    StageName: 'Proposal/Price Quote',
                    AccountId: '001SF00000TECHCORP',
                    ContactId: '003SF00000JSMITH',
                    CloseDate: '2025-03-31',
                    Description: 'Enterprise license for 5,000 seats. 3-year contract. Includes premium support and custom integrations. Competing against ServiceNow.',
                    CreatedDate: '2024-09-20T10:00:00.000Z',
                    LastModifiedDate: new Date().toISOString()
                },
                {
                    Id: '006SF00000MHPILOT',
                    Name: 'MediHealth - Pilot Program',
                    Amount: 75000,
                    StageName: 'Qualification',
                    AccountId: '001SF00000MEDIGRP',
                    ContactId: '003SF00000DCHEN',
                    CloseDate: '2025-02-15',
                    Description: '90-day pilot at 3 facilities. Success criteria defined. If successful, enterprise rollout worth $500K+.',
                    CreatedDate: '2024-10-10T14:00:00.000Z',
                    LastModifiedDate: new Date().toISOString()
                },
                {
                    Id: '006SF00000FNSEC',
                    Name: 'First National - Secure Collaboration Suite',
                    Amount: 850000,
                    StageName: 'Negotiation/Review',
                    AccountId: '001SF00000FINSERV',
                    ContactId: '003SF00000AROBERTS',
                    CloseDate: '2025-01-31',
                    Description: 'Security-focused deployment. Legal review in progress. Procurement pushing for 15% discount. Need VP approval.',
                    CreatedDate: '2024-10-30T09:00:00.000Z',
                    LastModifiedDate: new Date().toISOString()
                },
                {
                    Id: '006SF00000RMXDGT',
                    Name: 'RetailMax - Digital Transformation',
                    Amount: 1200000,
                    StageName: 'Prospecting',
                    AccountId: '001SF00000RETAILX',
                    ContactId: '003SF00000TBROWN',
                    CloseDate: '2025-06-30',
                    Description: 'Omnichannel platform integration. Early stage - just had intro call. Need to schedule technical discovery.',
                    CreatedDate: '2024-11-10T10:00:00.000Z',
                    LastModifiedDate: new Date().toISOString()
                },
                {
                    Id: '006SF00000TCSERV',
                    Name: 'TechCorp - Professional Services',
                    Amount: 350000,
                    StageName: 'Closed Won',
                    AccountId: '001SF00000TECHCORP',
                    ContactId: '003SF00000MWILSON',
                    CloseDate: '2024-12-15',
                    Description: 'Implementation and training services for initial deployment. Successfully closed! Kickoff scheduled for January.',
                    CreatedDate: '2024-11-01T10:00:00.000Z',
                    LastModifiedDate: '2024-12-15T16:00:00.000Z'
                }
            ];

            data.Task = [
                {
                    Id: '00TSF00000TCQBR',
                    Subject: 'Prepare QBR presentation for TechCorp',
                    Type: 'Other',
                    WhoId: '003SF00000JSMITH',
                    WhatId: '006SF00000TCENT',
                    Description: 'Quarterly business review with executive team. Include ROI analysis, implementation timeline, and competitive comparison.',
                    ActivityDate: '2025-01-10',
                    CreatedDate: new Date().toISOString(),
                    LastModifiedDate: new Date().toISOString()
                },
                {
                    Id: '00TSF00000MHDEMO',
                    Subject: 'Schedule HIPAA compliance demo',
                    Type: 'Call',
                    WhoId: '003SF00000DCHEN',
                    WhatId: '006SF00000MHPILOT',
                    Description: 'David requested deep-dive on HIPAA compliance features. Coordinate with Solutions Engineer team.',
                    ActivityDate: '2025-01-08',
                    CreatedDate: new Date().toISOString(),
                    LastModifiedDate: new Date().toISOString()
                },
                {
                    Id: '00TSF00000FNCNTR',
                    Subject: 'Review contract redlines from legal',
                    Type: 'Other',
                    WhoId: '003SF00000AROBERTS',
                    WhatId: '006SF00000FNSEC',
                    Description: 'Legal team sent back contract with 12 redlines. Need to review with our legal and respond by EOW.',
                    ActivityDate: '2025-01-06',
                    CreatedDate: new Date().toISOString(),
                    LastModifiedDate: new Date().toISOString()
                },
                {
                    Id: '00TSF00000RMXDISC',
                    Subject: 'Technical discovery call with RetailMax',
                    Type: 'Meeting',
                    WhoId: '003SF00000TBROWN',
                    WhatId: '006SF00000RMXDGT',
                    Description: 'Initial technical discovery. Bring Solutions Architect. Focus on e-commerce integration capabilities.',
                    ActivityDate: '2025-01-15',
                    CreatedDate: new Date().toISOString(),
                    LastModifiedDate: new Date().toISOString()
                },
                {
                    Id: '00TSF00000TCFLLW',
                    Subject: 'Send thank you note for contract signing',
                    Type: 'Email',
                    WhoId: '003SF00000MWILSON',
                    WhatId: '006SF00000TCSERV',
                    Description: 'Send personalized thank you to Michael and cc Jennifer. Include implementation team intro.',
                    ActivityDate: '2024-12-20',
                    CreatedDate: new Date().toISOString(),
                    LastModifiedDate: new Date().toISOString()
                }
            ];

            saveData();
            renderAll();
            updateStats();
            showToast('Loaded TechCorp sales demo with 4 accounts, 5 contacts, 5 opportunities, and 5 tasks', 'success');
        }

        function clearAllData() {
            if (!confirm('This will permanently delete all data. Are you sure?')) return;
            data.Account = [];
            data.Contact = [];
            data.Opportunity = [];
            data.Task = [];
            localStorage.removeItem(STORAGE_KEY);
            renderAll();
            updateStats();
            showToast('All data cleared', 'success');
        }

        function clearBrowserStorage() {
            if (!confirm('This will clear ALL localStorage for this site (all apps). Continue?')) return;
            localStorage.clear();
            data = { Contact: [], Account: [], Opportunity: [], Task: [], _meta: { lastSync: null, neuaiGuid: '', syncMode: 'manual', dedupeStrategy: 'email' } };
            renderAll();
            updateStats();
            showToast('Browser storage cleared! You can now load sample data.', 'success');
        }

        // Initialize
        init();
    </script>
</body>
</html>
