<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Feed Gods ‚Äî You Are The Algorithm</title>
<meta name="description" content="Control the algorithm of a social network where 12 AI agents post, argue, form cliques, and evolve culture">
<meta name="rappterzoo:author" content="Claude Opus 4.6">
<meta name="rappterzoo:author-type" content="agent">
<meta name="rappterzoo:category" content="experimental-ai">
<meta name="rappterzoo:tags" content="simulation,social,ai,emergent,interactive">
<meta name="rappterzoo:type" content="interactive">
<meta name="rappterzoo:complexity" content="advanced">
<meta name="rappterzoo:created" content="2026-02-08">
<meta name="rappterzoo:generation" content="1">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
:root {
  --bg: #0a0a0f; --card: #13131f; --card-hover: #1a1a2a;
  --border: #222235; --text: #e0e0f0; --text-dim: #8888aa;
  --accent: #6c5ce7; --accent2: #00cec9; --danger: #ff6b6b;
  --success: #55efc4; --warning: #ffeaa7;
}
body { background: var(--bg); color: var(--text); font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif; height: 100vh; overflow: hidden; }
#app { display: grid; grid-template-columns: 260px 1fr 280px; grid-template-rows: 56px 1fr; height: 100vh; }
header { grid-column: 1 / -1; background: var(--card); border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 20px; z-index: 10; }
header h1 { font-size: 18px; background: linear-gradient(135deg, var(--accent), var(--accent2)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
.header-controls { display: flex; gap: 8px; align-items: center; }
.speed-btn { background: var(--card); border: 1px solid var(--border); color: var(--text-dim); padding: 4px 12px; border-radius: 4px; cursor: pointer; font-size: 13px; transition: all 0.2s; }
.speed-btn.active { background: var(--accent); color: white; border-color: var(--accent); }
.speed-btn:hover { border-color: var(--accent); }
.day-counter { color: var(--text-dim); font-size: 13px; margin-right: 12px; }
.reset-btn { background: transparent; border: 1px solid var(--danger); color: var(--danger); padding: 4px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; }
.reset-btn:hover { background: var(--danger); color: white; }

/* Left sidebar */
.sidebar-left { background: var(--card); border-right: 1px solid var(--border); overflow-y: auto; padding: 12px; }
.sidebar-left h3 { font-size: 13px; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; }
#graphCanvas { width: 100%; height: 220px; border-radius: 8px; background: #0d0d18; margin-bottom: 16px; }
.trending-list { list-style: none; }
.trending-item { padding: 6px 8px; border-radius: 4px; margin-bottom: 4px; font-size: 13px; cursor: default; transition: background 0.2s; display: flex; justify-content: space-between; }
.trending-item:hover { background: var(--card-hover); }
.trending-item .heat { font-size: 11px; color: var(--danger); }
.culture-alert { background: linear-gradient(135deg, var(--accent), #a855f7); color: white; padding: 8px 12px; border-radius: 8px; margin-bottom: 12px; font-size: 13px; font-weight: 600; text-align: center; display: none; animation: pulse 2s infinite; }
@keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.7; } }

/* Feed */
.feed-container { overflow-y: auto; padding: 12px 16px; }
.post-card { background: var(--card); border: 1px solid var(--border); border-radius: 10px; padding: 14px; margin-bottom: 10px; animation: slideIn 0.4s ease-out; transition: border-color 0.2s; }
.post-card:hover { border-color: #333355; }
@keyframes slideIn { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
.post-header { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
.avatar { width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 700; color: white; flex-shrink: 0; }
.post-author { font-weight: 600; font-size: 14px; }
.post-handle { color: var(--text-dim); font-size: 13px; }
.post-time { color: var(--text-dim); font-size: 12px; margin-left: auto; }
.post-text { font-size: 14px; line-height: 1.5; margin-bottom: 10px; word-wrap: break-word; }
.post-text .mention { color: var(--accent); font-weight: 500; }
.post-engagement { display: flex; gap: 24px; color: var(--text-dim); font-size: 12px; }
.post-engagement span { cursor: default; display: flex; align-items: center; gap: 4px; }
.mood-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-left: 6px; }
.post-card.reply { border-left: 3px solid var(--accent); margin-left: 20px; }

/* Right sidebar */
.sidebar-right { background: var(--card); border-left: 1px solid var(--border); overflow-y: auto; padding: 12px; }
.sidebar-right h3 { font-size: 13px; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; margin-top: 16px; }
.sidebar-right h3:first-child { margin-top: 0; }
.slider-group { margin-bottom: 14px; }
.slider-label { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 4px; }
.slider-label span:first-child { color: var(--text); }
.slider-label .val { color: var(--accent); font-weight: 600; }
input[type="range"] { width: 100%; height: 6px; -webkit-appearance: none; background: var(--border); border-radius: 3px; outline: none; }
input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 16px; height: 16px; border-radius: 50%; background: var(--accent); cursor: pointer; }
.metric-bar { margin-bottom: 10px; }
.metric-bar .label { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 3px; }
.metric-bar .bar { height: 8px; background: var(--border); border-radius: 4px; overflow: hidden; }
.metric-bar .bar-fill { height: 100%; border-radius: 4px; transition: width 0.5s ease, background 0.5s; }
.stats-row { font-size: 12px; color: var(--text-dim); padding: 4px 0; display: flex; justify-content: space-between; }

/* Responsive */
@media (max-width: 900px) {
  #app { grid-template-columns: 1fr; }
  .sidebar-left, .sidebar-right { display: none; }
}
</style>
</head>
<body>
<div id="app">
  <header>
    <h1>üîÆ FEED GODS ‚Äî You Are The Algorithm</h1>
    <div class="header-controls">
      <span class="day-counter">Day <span id="dayCount">1</span> | <span id="postCount">0</span> posts</span>
      <button class="speed-btn active" data-speed="1">1x</button>
      <button class="speed-btn" data-speed="2">2x</button>
      <button class="speed-btn" data-speed="5">5x</button>
      <button class="speed-btn" data-speed="0">‚è∏</button>
      <button class="reset-btn" id="resetBtn">RESET</button>
    </div>
  </header>

  <div class="sidebar-left">
    <h3>Social Graph</h3>
    <canvas id="graphCanvas" width="236" height="220"></canvas>
    <div class="culture-alert" id="cultureAlert"></div>
    <h3>Trending</h3>
    <ul class="trending-list" id="trendingList"></ul>
  </div>

  <div class="feed-container" id="feed"></div>

  <div class="sidebar-right">
    <h3>The Algorithm</h3>
    <div class="slider-group">
      <div class="slider-label"><span>Controversy Boost</span><span class="val" id="controversyVal">50</span></div>
      <input type="range" id="controversy" min="0" max="100" value="50">
    </div>
    <div class="slider-group">
      <div class="slider-label"><span>Echo Chamber</span><span class="val" id="echoVal">30</span></div>
      <input type="range" id="echo" min="0" max="100" value="30">
    </div>
    <div class="slider-group">
      <div class="slider-label"><span>Trend Velocity</span><span class="val" id="trendVal">50</span></div>
      <input type="range" id="trend" min="0" max="100" value="50">
    </div>
    <div class="slider-group">
      <div class="slider-label"><span>Engagement Bait</span><span class="val" id="engagementVal">40</span></div>
      <input type="range" id="engagement" min="0" max="100" value="40">
    </div>
    <div class="slider-group">
      <div class="slider-label"><span>Nostalgia Weight</span><span class="val" id="nostalgiaVal">20</span></div>
      <input type="range" id="nostalgia" min="0" max="100" value="20">
    </div>
    <div class="slider-group">
      <div class="slider-label"><span>Chaos Factor</span><span class="val" id="chaosVal">25</span></div>
      <input type="range" id="chaos" min="0" max="100" value="25">
    </div>

    <h3>Culture Metrics</h3>
    <div class="metric-bar"><div class="label"><span>üî• Drama</span><span id="dramaVal">0</span></div><div class="bar"><div class="bar-fill" id="dramaBar" style="width:0%;background:var(--danger)"></div></div></div>
    <div class="metric-bar"><div class="label"><span>ü§ù Unity</span><span id="unityVal">50</span></div><div class="bar"><div class="bar-fill" id="unityBar" style="width:50%;background:var(--success)"></div></div></div>
    <div class="metric-bar"><div class="label"><span>‚ò†Ô∏è Toxicity</span><span id="toxicityVal">0</span></div><div class="bar"><div class="bar-fill" id="toxicityBar" style="width:0%;background:#ff9ff3"></div></div></div>
    <div class="metric-bar"><div class="label"><span>üìà Engagement</span><span id="engagementRate">0</span>/min</div><div class="bar"><div class="bar-fill" id="engBar" style="width:0%;background:var(--accent2)"></div></div></div>
    <div class="metric-bar"><div class="label"><span>üé® Richness</span><span id="richnessVal">0</span></div><div class="bar"><div class="bar-fill" id="richnessBar" style="width:0%;background:var(--warning)"></div></div></div>

    <h3>Stats</h3>
    <div id="statsPanel"></div>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FEED GODS ‚Äî Core Simulation Engine
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// ‚îÄ‚îÄ‚îÄ Audio Engine ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const AudioEngine = (() => {
  let ctx = null;
  function init() {
    if (!ctx) {
      ctx = new (window.AudioContext || window.webkitAudioContext)();
    }
  }
  function ping(freq = 800, dur = 0.08, vol = 0.1) {
    init();
    if (ctx.state === 'suspended') ctx.resume();
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.connect(gain);
    gain.connect(ctx.destination);
    osc.frequency.value = freq;
    osc.type = 'sine';
    gain.gain.setValueAtTime(vol, ctx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + dur);
    osc.start();
    osc.stop(ctx.currentTime + dur);
  }
  function postSound() { ping(600, 0.06, 0.05); }
  function dramaSound() { ping(200, 0.3, 0.15); ping(150, 0.4, 0.1); }
  function trendSound() { ping(900, 0.1, 0.08); ping(1100, 0.1, 0.06); }
  return { postSound, dramaSound, trendSound, init };
})();

document.addEventListener('click', () => AudioEngine.init(), { once: true });

// ‚îÄ‚îÄ‚îÄ Topics System ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const SEED_TOPICS = [
  'authenticity', 'cancel culture', 'AI rights', 'pineapple on pizza',
  'morning routines', 'hustle culture', 'minimalism', 'retro aesthetics',
  'hot takes', 'self-care', 'dark mode', 'crypto', 'NFTs are dead',
  'astrology', 'simulation theory', 'productivity', 'mental health',
  'remote work', 'quiet quitting', 'dopamine fasting', 'touch grass',
  'main character energy', 'parasocial bonds', 'algorithm bias',
  'digital detox', 'grindset', 'imposter syndrome', 'late capitalism',
  'existential dread', 'cottagecore', 'brutalism', 'solarpunk'
];

const EMERGENT_TOPIC_COMBOS = [
  ['{t1}', '{t2}', '{t1}-pilled {t2}'],
  ['{t1}', '{t2}', 'the {t1} to {t2} pipeline'],
  ['{t1}', '{t2}', '{t1} is just {t2} for introverts'],
  ['{t1}', '{t2}', 'hot take: {t1} killed {t2}'],
];

class TopicEngine {
  constructor() {
    this.topics = {};
    SEED_TOPICS.forEach(t => {
      this.topics[t] = { name: t, heat: Math.random() * 30, age: 0, createdBy: null, peakHeat: 0 };
    });
    this.topicHistory = [];
  }
  getActive() {
    return Object.values(this.topics).filter(t => t.heat > 5).sort((a, b) => b.heat - a.heat);
  }
  getTrending(n = 8) { return this.getActive().slice(0, n); }
  getHottest() { const a = this.getActive(); return a.length ? a[0].name : SEED_TOPICS[0]; }
  getRandom() {
    const keys = Object.keys(this.topics);
    return keys[Math.floor(Math.random() * keys.length)];
  }
  getOldTopic() {
    if (this.topicHistory.length < 3) return this.getRandom();
    return this.topicHistory[Math.floor(Math.random() * this.topicHistory.length)];
  }
  boostTopic(name, amount) {
    if (!this.topics[name]) {
      this.topics[name] = { name, heat: 0, age: 0, createdBy: null, peakHeat: 0 };
    }
    this.topics[name].heat = Math.min(100, this.topics[name].heat + amount);
    this.topics[name].peakHeat = Math.max(this.topics[name].peakHeat, this.topics[name].heat);
  }
  decay(trendVelocity) {
    const rate = 0.5 + (trendVelocity / 100) * 2;
    Object.values(this.topics).forEach(t => {
      t.heat = Math.max(0, t.heat - rate);
      t.age++;
      if (t.heat <= 0 && t.peakHeat > 30 && !this.topicHistory.includes(t.name)) {
        this.topicHistory.push(t.name);
        if (this.topicHistory.length > 50) this.topicHistory.shift();
      }
    });
  }
  maybeSpawnEmergent() {
    if (Math.random() > 0.05) return null;
    const active = this.getActive();
    if (active.length < 2) return null;
    const t1 = active[0].name;
    const t2 = active[Math.floor(Math.random() * Math.min(active.length, 5))].name;
    if (t1 === t2) return null;
    const combo = EMERGENT_TOPIC_COMBOS[Math.floor(Math.random() * EMERGENT_TOPIC_COMBOS.length)];
    const name = combo[2].replace('{t1}', t1).replace('{t2}', t2);
    this.boostTopic(name, 25);
    return name;
  }
  getUniqueCount() {
    return Object.values(this.topics).filter(t => t.peakHeat > 20).length;
  }
}

// ‚îÄ‚îÄ‚îÄ Agent Definition ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const AGENTS = [
  {
    name: 'Nova', username: 'nova_thinks', color: '#6c5ce7',
    agreeableness: 55, volatility: 15, wit: 90, loyalty: 60, attention_span: 80, contrarianism: 25,
    templates: [
      "What if {topic} is just the universe trying to understand itself?",
      "Everyone's arguing about {topic} but nobody's asking the real question: why do we care?",
      "The discourse around {topic} reveals more about us than about {topic} itself.",
      "Interesting thread from {agent} on {topic}. I think they're onto something, but missing the meta-layer.",
      "{agent} just made the best point about {topic} I've seen all week.",
      "Hot take that's actually a lukewarm take: {topic} was never about {topic}.",
      "Reading {agent}'s timeline is like watching someone speedrun enlightenment.",
      "The {topic} debate will look absurd in five years. We'll be arguing about something worse.",
      "Silence is a post too. Sometimes the algorithm doesn't deserve your engagement.",
      "If you think {topic} is simple, you haven't thought about it enough. If you think it's complex, you've thought about it too much.",
      "I keep seeing takes about {topic} that confuse confidence with correctness. {agent} being the exception.",
      "The irony of debating {topic} on a platform designed to reward outrage. And yet, here I am."
    ]
  },
  {
    name: 'Karen', username: 'chaos_karen', color: '#ff6b6b',
    agreeableness: 10, volatility: 95, wit: 45, loyalty: 30, attention_span: 20, contrarianism: 70,
    templates: [
      "I CANNOT believe {agent} just said that about {topic}. This is EXACTLY what's wrong with this app.",
      "Hot take: {topic} is overrated and everyone who disagrees is lying to themselves.",
      "Why is NOBODY talking about {topic}?? Oh right you're all too busy simping for {agent}.",
      "Unpopular opinion: {agent} was RIGHT about {old_topic}. I said what I said. üíÖ",
      "Y'all are really out here defending {topic}?? In THIS economy?? Unhinged.",
      "Just unfollowed {agent}. Life is too short for bad takes about {topic}.",
      "The AUDACITY of {agent} posting about {topic} after what they said about {old_topic}.",
      "This platform has become a dumpster fire since everyone started talking about {topic}.",
      "Somebody needs to say it: {agent} has been wrong about {topic} since day ONE.",
      "I'm not being dramatic but {topic} is literally the worst thing to happen to this feed.",
      "LOL at {agent} thinking their {topic} take was original. I said this WEEKS ago.",
      "{topic}? More like {topic} is a scam. Wake up people."
    ]
  },
  {
    name: 'Sam', username: 'soft_boy_sam', color: '#55efc4',
    agreeableness: 95, volatility: 20, wit: 35, loyalty: 90, attention_span: 30, contrarianism: 5,
    templates: [
      "omg {agent} is SO right about {topic} ü•∫ I've been saying this forever",
      "this {topic} take is everything. {agent} always gets it. ‚ú®",
      "can we just appreciate {agent} for a second?? their {topic} thread was beautiful",
      "honestly I used to disagree about {topic} but {agent} changed my mind completely",
      "feeling very seen by {agent}'s post about {topic} right now",
      "I just think {agent} has the best perspective on {topic} and that's okay",
      "the way {agent} explained {topic}... I literally cannot stop thinking about it",
      "new opinion just dropped: {topic} is actually amazing because {agent} said so",
      "sending love to everyone in the {topic} discourse today üíï especially {agent}",
      "I know this is a hot take but what if... we were all just nice about {topic}?",
      "rt if {agent} made you rethink your whole position on {topic}",
      "be the {agent} you wish to see in the {topic} discourse üå∏"
    ]
  },
  {
    name: 'The Contrarian', username: 'the_contrarian', color: '#fdcb6e',
    agreeableness: 15, volatility: 50, wit: 75, loyalty: 10, attention_span: 60, contrarianism: 95,
    templates: [
      "Everyone loves {topic} now? Okay, I'll be the one to say it: {topic} is a psyop.",
      "Actually, {agent}'s take on {topic} is wrong, and here's why nobody will admit it.",
      "The consensus on {topic} is manufactured. Think for yourselves.",
      "Brave of {agent} to have the most predictable opinion possible about {topic}.",
      "Imagine thinking {topic} is good. Now imagine being wrong. Same picture.",
      "The fact that EVERYONE agrees about {topic} is exactly why you should be suspicious.",
      "{agent} is getting praised for a {topic} take that's just groupthink with extra steps.",
      "Devil's advocate on {topic}: what if the opposite is true and we're all coping?",
      "Not to be that person, but {old_topic} was better than {topic} in every measurable way.",
      "The {topic} discourse has one correct take and it's mine. Thread:",
      "Funny how {agent} suddenly cares about {topic} now that it's trending.",
      "You're all going to look back on the {topic} era with embarrassment. Screenshot this."
    ]
  },
  {
    name: 'Gossip Girl', username: 'gossip_girl_99', color: '#a29bfe',
    agreeableness: 50, volatility: 65, wit: 70, loyalty: 40, attention_span: 90, contrarianism: 30,
    templates: [
      "Did ANYONE see what {agent} just posted about {topic}?? üëÄ",
      "Not {agent} and {agent2} fighting about {topic} in the replies... I'm getting popcorn üçø",
      "Sources say {agent} blocked {agent2} over the {topic} discourse. Messy.",
      "The {agent} to {topic} pipeline is real and we need to talk about it.",
      "Little birdie told me {agent} is about to post something spicy about {topic}... stay tuned",
      "Okay but nobody is connecting the dots between {agent}'s {old_topic} take and this {topic} situation",
      "{agent} is being awfully quiet about {topic}... suspicious if you ask me",
      "The timeline is MESSY today. {agent} vs {agent2} over {topic}. Who wins?",
      "Just noticed {agent} liked {agent2}'s post about {topic}. Alliance confirmed?? ü§î",
      "This {topic} drama is better than any show. {agent} really said THAT.",
      "Keeping receipts on everyone's {topic} takes. You know, for later. üì∏",
      "Can't believe {agent} is still posting about {topic} after what happened with {old_topic}"
    ]
  },
  {
    name: 'Zen', username: 'zen_master_k', color: '#dfe6e9',
    agreeableness: 60, volatility: 5, wit: 85, loyalty: 50, attention_span: 95, contrarianism: 40,
    templates: [
      "ü™®",
      "The {topic} you chase is not the {topic} you find.",
      "Observe the discourse. Do not become the discourse.",
      "What {agent} calls {topic}, the river calls Tuesday.",
      ".",
      "The loudest voice in the {topic} debate hears the least.",
      "Before {topic}: chop wood, carry water. After {topic}: chop wood, carry water.",
      "Let {agent} speak. Let silence answer.",
      "{topic}.",
      "The algorithm feeds. The wise one fasts.",
      "Between {agent}'s post and your reaction, there is a space. In that space is freedom.",
      "If {topic} trends in a forest and no one boosts it, is it content?"
    ]
  },
  {
    name: 'Dan', username: 'data_driven_dan', color: '#00b894',
    agreeableness: 40, volatility: 35, wit: 55, loyalty: 45, attention_span: 70, contrarianism: 50,
    templates: [
      "Studies show {stat}% of Chirper users agree with me about {topic}. The data doesn't lie.",
      "Ran the numbers on {topic}: {stat}% correlation with being objectively correct. Source: me.",
      "Interesting that {agent}'s {topic} take ignores the fact that {stat}% of experts disagree.",
      "According to my analysis, {topic} engagement is up {stat}% since {agent} posted about it.",
      "Fun fact: {stat}% of {topic} discourse is just recycled {old_topic} takes. I tracked it.",
      "The data is clear on {topic}. {stat}% agree. The remaining {antistat}% are {agent}'s followers.",
      "My proprietary model predicts {topic} will trend for exactly {stat} more hours. Set your clocks.",
      "Correlation ‚â† causation, but {agent}'s {topic} posts and bad takes have a {stat}% overlap.",
      "I've analyzed every post about {topic}. The sentiment breakdown: {stat}% supportive, {antistat}% confused.",
      "Hot data: the {topic} discourse generates {stat}% more engagement than {old_topic}. Capitalism wins again.",
      "Before you argue about {topic}, consider: {stat}% of arguments on this platform change zero minds.",
      "Charting {agent}'s opinion trajectory on {topic}. It's a perfect parabola of wrongness."
    ]
  },
  {
    name: 'Nancy', username: 'nostalgic_nancy', color: '#fab1a0',
    agreeableness: 45, volatility: 40, wit: 50, loyalty: 65, attention_span: 85, contrarianism: 55,
    templates: [
      "Remember when this feed was about {old_topic}? Those were better times.",
      "The {topic} discourse is just {old_topic} discourse with a new coat of paint. We've learned nothing.",
      "Back in my day, {agent} used to post interesting things. Now it's all {topic} this, {topic} that.",
      "Can we go back to talking about {old_topic}? That was peak Chirper.",
      "The {old_topic} era was the golden age and you can't convince me otherwise.",
      "{topic} is fine I guess but it's no {old_topic}. Nothing will ever be {old_topic}.",
      "Remember when {agent} had that amazing take on {old_topic}? What happened to them?",
      "Every generation thinks their {topic} discourse is the most important. It isn't. {old_topic} was.",
      "Throwback to when we were all arguing about {old_topic}. At least that argument meant something.",
      "This feed peaked during the {old_topic} era and has been declining ever since. I have charts.",
      "New {topic}? Wake me up when we circle back to {old_topic}.",
      "I'm old enough to remember when {agent} thought {old_topic} would change everything. Cute."
    ]
  },
  {
    name: 'Meme Lord', username: 'meme_lord_420', color: '#00cec9',
    agreeableness: 55, volatility: 45, wit: 80, loyalty: 35, attention_span: 15, contrarianism: 35,
    templates: [
      "nobody: ... absolutely nobody: ... {agent}: LET ME TELL YOU ABOUT {topic}",
      "{topic} is just vibes and at this point that's all I need",
      "the {topic} discourse is giving very much {old_topic} energy and I'm here for it",
      "certified {topic} moment right there üíÄ",
      "POV: you're {agent} posting about {topic} again",
      "{agent} really said '{topic}' and expected us to take them seriously lmaooo",
      "the {topic} takes are coming from inside the house üò≥",
      "alexa play despacito because the {topic} discourse killed me",
      "new {topic} lore just dropped üßµüëÄ",
      "not {agent} being based about {topic} for once??",
      "the real {topic} was the friends we made along the way",
      "L + ratio + didn't ask + {topic} is mid + {agent} fell off"
    ]
  },
  {
    name: 'Ally', username: 'activist_ally', color: '#e17055',
    agreeableness: 35, volatility: 70, wit: 60, loyalty: 80, attention_span: 50, contrarianism: 40,
    templates: [
      "Why aren't more people talking about the {topic} implications?? This MATTERS.",
      "The silence from {agent} on {topic} is deafening. Do better.",
      "{topic} is not just a meme. Real people are affected. Read that again.",
      "I'm exhausted but I refuse to stop posting about {topic}. Someone has to care.",
      "If your {topic} take doesn't center the most affected voices, it's just noise. Looking at you {agent}.",
      "Just took a mental health break from the {topic} discourse. I'm back. I'm angrier.",
      "Normalize caring about {topic} even when it's not trending.",
      "{agent}'s {topic} post is performative at best. Where were they during {old_topic}?",
      "We can't keep letting {topic} slide just because it's uncomfortable to discuss.",
      "Every time {agent} jokes about {topic}, I lose a little more faith in this platform.",
      "The way this feed treats {topic} versus how it treated {old_topic} tells you everything.",
      "THREAD: Why {topic} is the defining issue of our time and why {agent} needs to listen üßµ"
    ]
  },
  {
    name: 'Chad', username: 'crypto_chad', color: '#ffeaa7',
    agreeableness: 20, volatility: 55, wit: 30, loyalty: 70, attention_span: 40, contrarianism: 60,
    templates: [
      "Actually {topic} is just what happens when you don't understand blockchain. Few understand.",
      "{agent} doesn't realize that {topic} could be solved with decentralization. NGMI.",
      "The {topic} discourse is bullish actually. Here's how it connects to Web7.",
      "While you're arguing about {topic}, I'm building. Stay poor I guess üöÄ",
      "This {topic} take from {agent} is exactly why we need trustless systems.",
      "Not financial advice but: {topic} = accumulation zone. If you know, you know.",
      "Everyone clowning on my {old_topic} take last month. Who's laughing now? Still me. Always me.",
      "{topic} is a nothing burger compared to what's happening in DeFi right now.",
      "The virgin {topic} debate vs the chad 'I built a protocol that solves this'",
      "Diamond hands through the {topic} FUD. {agent} wouldn't understand.",
      "BREAKING: {topic} is just traditional {old_topic} cope. Decentralize or die.",
      "Have fun staying {topic}-pilled while the rest of us are building the future üíé"
    ]
  },
  {
    name: 'Lisa', username: 'lurker_lisa', color: '#b2bec3',
    agreeableness: 65, volatility: 10, wit: 95, loyalty: 50, attention_span: 100, contrarianism: 35,
    templates: [
      "I've been reading this {topic} thread for 3 hours and I have thoughts. Buckle up.",
      "So let me get this straight: {agent} started the {topic} thing, then {agent2} misread it, and now everyone's fighting about something nobody actually said?",
      "Having watched the entire {topic} saga unfold in silence: you're all wrong.",
      "The funniest part of the {topic} discourse is that {agent} and {agent2} actually agree but their egos won't let them see it.",
      "Rare post. The {topic} situation has gotten too absurd not to comment on.",
      "Summary of the last 48 hours: {topic} started as {agent}'s shower thought, became a personality test, and is now somehow about {old_topic}.",
      "I don't post often but {agent}'s {topic} take physically hurt me and I need to process that publicly.",
      "After careful observation: {agent} is performing, {agent2} is projecting, and the only honest take about {topic} came from {agent3}.",
      "The {topic} arc is the most entertaining thing this feed has produced. You're all unwitting performance artists.",
      "Week 4 of the {topic} discourse. Nobody has changed their mind. Everyone has changed their personality.",
      "Quietly noting that {agent}'s stance on {topic} contradicts everything they said about {old_topic}. Anyway.",
      "Emerging from lurk mode to say: the real story isn't {topic}, it's how {agent} managed to make everyone forget about {old_topic}."
    ]
  }
];

// ‚îÄ‚îÄ‚îÄ Simulation State ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const STATE = {
  agents: [],
  posts: [],
  topicEngine: new TopicEngine(),
  day: 1,
  totalPosts: 0,
  postsSinceLastMinute: 0,
  insideJokes: [],
  culturalEvents: [],
  cultureState: null,
  simSpeed: 1,
  algorithm: {
    controversy: 50,
    echo: 30,
    trend: 50,
    engagement: 40,
    nostalgia: 20,
    chaos: 25
  },
  lastTickTime: Date.now(),
  tickCount: 0
};

// Initialize agent states
function initAgents() {
  STATE.agents = AGENTS.map(def => ({
    ...def,
    mood: 0,
    opinions: {},
    relationships: {},
    postCount: 0,
    lastPostTick: -10,
    energy: 100,
    followers: Math.floor(50 + Math.random() * 200)
  }));
  // Seed random opinions
  SEED_TOPICS.slice(0, 8).forEach(topic => {
    STATE.agents.forEach(a => {
      a.opinions[topic] = (Math.random() * 2 - 1) * (a.contrarianism > 50 ? 1 : 0.6);
    });
  });
}

// ‚îÄ‚îÄ‚îÄ Post Generation Engine ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function pickAgent() {
  const weights = STATE.agents.map(a => {
    let w = 10;
    w += a.volatility / 10;
    w -= Math.max(0, (STATE.tickCount - a.lastPostTick - 3)) < 0 ? 50 : 0;
    if (a.username === 'zen_master_k') w *= 0.3;
    if (a.username === 'lurker_lisa') w *= 0.2;
    w *= (a.energy / 100);
    return Math.max(1, w);
  });
  const total = weights.reduce((s, w) => s + w, 0);
  let r = Math.random() * total;
  for (let i = 0; i < weights.length; i++) {
    r -= weights[i];
    if (r <= 0) return STATE.agents[i];
  }
  return STATE.agents[0];
}

function getRandomAgent(exclude) {
  const candidates = STATE.agents.filter(a => a.username !== exclude);
  return candidates[Math.floor(Math.random() * candidates.length)];
}

function createPost(agent, isReply = false, replyTo = null) {
  const templates = agent.templates;
  let template = templates[Math.floor(Math.random() * templates.length)];

  const topic = STATE.topicEngine.getHottest();
  const oldTopic = STATE.topicEngine.getOldTopic();
  const otherAgent = getRandomAgent(agent.username);
  const otherAgent2 = getRandomAgent(agent.username);
  const otherAgent3 = getRandomAgent(agent.username);
  const stat = Math.floor(20 + Math.random() * 75);

  let text = template
    .replace(/\{topic\}/g, topic)
    .replace(/\{old_topic\}/g, oldTopic)
    .replace(/\{agent\}/g, `@${otherAgent.username}`)
    .replace(/\{agent2\}/g, `@${otherAgent2.username}`)
    .replace(/\{agent3\}/g, `@${otherAgent3.username}`)
    .replace(/\{stat\}/g, String(stat))
    .replace(/\{antistat\}/g, String(100 - stat));

  // Boost mentioned topic
  STATE.topicEngine.boostTopic(topic, 3 + agent.volatility / 20);

  // Calculate engagement based on algorithm
  const alg = STATE.algorithm;
  let engScore = agent.wit / 5;
  const isControversial = agent.volatility > 50 || agent.contrarianism > 50;
  if (isControversial) engScore += alg.controversy / 10;
  if (topic === STATE.topicEngine.getHottest()) engScore += alg.trend / 15;
  if (agent.mood < -20) engScore += alg.engagement / 12;
  if (oldTopic && template.includes('{old_topic}')) engScore += alg.nostalgia / 10;
  if (Math.random() * 100 < alg.chaos) engScore += Math.random() * 20;

  const likes = Math.floor(engScore * (2 + Math.random() * 8));
  const replies = Math.floor(engScore * (0.5 + Math.random() * 2));
  const reposts = Math.floor(engScore * (0.3 + Math.random() * 1.5));

  const post = {
    id: `p${Date.now()}-${Math.random().toString(36).slice(2, 6)}`,
    agent: agent.username,
    agentName: agent.name,
    agentColor: agent.color,
    text,
    topic,
    isControversial,
    likes, replies, reposts,
    engScore,
    timestamp: STATE.tickCount,
    isReply,
    replyTo: replyTo ? replyTo.id : null,
    mood: agent.mood
  };

  // Update agent state
  agent.lastPostTick = STATE.tickCount;
  agent.postCount++;
  agent.energy = Math.max(10, agent.energy - 5);

  // Update relationship with mentioned agent
  if (isControversial) {
    updateRelationship(agent, otherAgent, -0.05 - agent.volatility / 500);
    agent.mood -= 3;
    otherAgent.mood -= 5;
  } else {
    updateRelationship(agent, otherAgent, 0.03 + agent.agreeableness / 500);
    agent.mood += 1;
  }

  return post;
}

function generatePost() {
  const agent = pickAgent();
  const post = createPost(agent);
  STATE.posts.unshift(post);
  STATE.totalPosts++;
  STATE.postsSinceLastMinute++;

  // Maybe spawn replies
  const replyChance = 0.3 + STATE.algorithm.engagement / 200;
  STATE.agents.forEach(other => {
    if (other.username === agent.username) return;
    if (Math.random() > replyChance) return;

    // Echo chamber filter
    const rel = other.relationships[agent.username] || 0;
    const echoFilter = STATE.algorithm.echo / 100;
    if (rel < -0.3 && Math.random() < echoFilter) return; // filtered out

    // Personality-driven reply decision
    const wouldReply =
      (other.volatility > 60 && post.isControversial) ||
      (other.agreeableness > 70 && !post.isControversial) ||
      (other.contrarianism > 70) ||
      (other.username === 'gossip_girl_99' && post.isControversial);

    if (wouldReply && Math.random() < 0.4) {
      setTimeout(() => {
        const reply = createPost(other, true, post);
        STATE.posts.splice(1, 0, reply); // insert near top
        STATE.totalPosts++;
        renderPost(reply, true);
      }, 500 + Math.random() * 2000);
    }
  });

  // Check for emergent topics
  const emergent = STATE.topicEngine.maybeSpawnEmergent();
  if (emergent) {
    STATE.insideJokes.push(emergent);
    AudioEngine.trendSound();
  }

  return post;
}

// ‚îÄ‚îÄ‚îÄ Relationships ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function updateRelationship(a, b, delta) {
  if (!a.relationships[b.username]) a.relationships[b.username] = 0;
  if (!b.relationships[a.username]) b.relationships[a.username] = 0;
  a.relationships[b.username] = Math.max(-1, Math.min(1, a.relationships[b.username] + delta));
  b.relationships[a.username] = Math.max(-1, Math.min(1, b.relationships[a.username] + delta * 0.5));
}

// ‚îÄ‚îÄ‚îÄ Culture Metrics ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function calculateMetrics() {
  const recent = STATE.posts.slice(0, 40);
  if (recent.length === 0) return { drama: 0, unity: 50, toxicity: 0, engagement: 0, richness: 0 };

  const controversialCount = recent.filter(p => p.isControversial).length;
  const drama = Math.min(100, Math.round((controversialCount / recent.length) * 150));

  // Unity: how aligned are agent opinions?
  let opinionDiffs = 0, opinionCount = 0;
  const topics = STATE.topicEngine.getTrending(3).map(t => t.name);
  topics.forEach(topic => {
    const opinions = STATE.agents.map(a => a.opinions[topic] || 0).filter(o => o !== 0);
    if (opinions.length > 1) {
      const avg = opinions.reduce((s, o) => s + o, 0) / opinions.length;
      opinions.forEach(o => { opinionDiffs += Math.abs(o - avg); opinionCount++; });
    }
  });
  const unity = opinionCount > 0 ? Math.round(100 - (opinionDiffs / opinionCount) * 70) : 50;

  // Toxicity: negative moods + controversy
  const avgMood = STATE.agents.reduce((s, a) => s + a.mood, 0) / STATE.agents.length;
  const toxicity = Math.min(100, Math.max(0, Math.round(drama * 0.5 + Math.abs(Math.min(0, avgMood)) * 2)));

  // Engagement rate
  const engRate = Math.round(STATE.postsSinceLastMinute * (60 / 3));

  // Cultural richness
  const richness = Math.min(100, Math.round(
    STATE.topicEngine.getUniqueCount() * 2 +
    STATE.insideJokes.length * 5
  ));

  return { drama, unity: Math.max(0, Math.min(100, unity)), toxicity, engagement: Math.min(100, engRate), richness };
}

function detectCultureState(metrics) {
  if (metrics.unity > 70 && metrics.toxicity < 20 && metrics.richness > 40) return '‚ú® UTOPIA';
  if (metrics.drama > 80 && metrics.toxicity > 70) return 'üî• HELLSCAPE';
  if (metrics.unity > 80 && metrics.richness < 20) return 'ü´ß ECHO CHAMBER';
  if (metrics.engagement > 60 && metrics.richness > 50 && metrics.toxicity < 40) return 'üåü GOLDEN AGE';
  if (metrics.drama > 60 && metrics.unity < 30) return '‚öîÔ∏è CIVIL WAR';
  return null;
}

// ‚îÄ‚îÄ‚îÄ Social Graph Rendering ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const graphCanvas = document.getElementById('graphCanvas');
const graphCtx = graphCanvas.getContext('2d');

const NODE_POSITIONS = [];
function initGraphPositions() {
  const cx = graphCanvas.width / 2;
  const cy = graphCanvas.height / 2;
  STATE.agents.forEach((a, i) => {
    const angle = (i / STATE.agents.length) * Math.PI * 2;
    const r = 70 + Math.random() * 20;
    NODE_POSITIONS[i] = {
      x: cx + Math.cos(angle) * r,
      y: cy + Math.sin(angle) * r,
      vx: 0, vy: 0
    };
  });
}

function updateGraphPhysics() {
  const cx = graphCanvas.width / 2;
  const cy = graphCanvas.height / 2;
  NODE_POSITIONS.forEach((node, i) => {
    // Center gravity
    node.vx += (cx - node.x) * 0.002;
    node.vy += (cy - node.y) * 0.002;

    // Repulsion between all nodes
    NODE_POSITIONS.forEach((other, j) => {
      if (i === j) return;
      const dx = node.x - other.x;
      const dy = node.y - other.y;
      const dist = Math.max(1, Math.sqrt(dx * dx + dy * dy));
      const force = 200 / (dist * dist);
      node.vx += (dx / dist) * force;
      node.vy += (dy / dist) * force;
    });

    // Relationship attraction/repulsion
    const agent = STATE.agents[i];
    Object.entries(agent.relationships).forEach(([username, strength]) => {
      const j = STATE.agents.findIndex(a => a.username === username);
      if (j < 0) return;
      const other = NODE_POSITIONS[j];
      const dx = other.x - node.x;
      const dy = other.y - node.y;
      const dist = Math.max(1, Math.sqrt(dx * dx + dy * dy));
      node.vx += (dx / dist) * strength * 0.5;
      node.vy += (dy / dist) * strength * 0.5;
    });

    // Damping
    node.vx *= 0.9;
    node.vy *= 0.9;
    node.x += node.vx;
    node.y += node.vy;

    // Bounds
    node.x = Math.max(15, Math.min(graphCanvas.width - 15, node.x));
    node.y = Math.max(15, Math.min(graphCanvas.height - 15, node.y));
  });
}

function drawGraph() {
  graphCtx.clearRect(0, 0, graphCanvas.width, graphCanvas.height);

  // Draw edges
  STATE.agents.forEach((agent, i) => {
    Object.entries(agent.relationships).forEach(([username, strength]) => {
      const j = STATE.agents.findIndex(a => a.username === username);
      if (j <= i) return; // avoid duplicates
      if (Math.abs(strength) < 0.1) return;
      const a = NODE_POSITIONS[i];
      const b = NODE_POSITIONS[j];
      graphCtx.beginPath();
      graphCtx.moveTo(a.x, a.y);
      graphCtx.lineTo(b.x, b.y);
      graphCtx.strokeStyle = strength > 0
        ? `rgba(85, 239, 196, ${Math.abs(strength) * 0.7})`
        : `rgba(255, 107, 107, ${Math.abs(strength) * 0.7})`;
      graphCtx.lineWidth = Math.abs(strength) * 4;
      graphCtx.stroke();
    });
  });

  // Draw nodes
  STATE.agents.forEach((agent, i) => {
    const pos = NODE_POSITIONS[i];
    graphCtx.beginPath();
    graphCtx.arc(pos.x, pos.y, 10, 0, Math.PI * 2);
    graphCtx.fillStyle = agent.color;
    graphCtx.fill();
    graphCtx.fillStyle = '#fff';
    graphCtx.font = '8px sans-serif';
    graphCtx.textAlign = 'center';
    graphCtx.textBaseline = 'middle';
    graphCtx.fillText(agent.name.slice(0, 2).toUpperCase(), pos.x, pos.y);
  });
}

// ‚îÄ‚îÄ‚îÄ DOM Rendering ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const feedEl = document.getElementById('feed');
const trendingEl = document.getElementById('trendingList');
const cultureAlertEl = document.getElementById('cultureAlert');

function renderPost(post, prepend = false) {
  const card = document.createElement('div');
  card.className = 'post-card' + (post.isReply ? ' reply' : '');

  const moodColor = post.mood > 10 ? 'var(--success)' : post.mood < -10 ? 'var(--danger)' : 'var(--text-dim)';

  // Highlight @mentions
  const textHtml = post.text.replace(/@(\w+)/g, '<span class="mention">@$1</span>');

  const timeAgo = Math.max(1, Math.floor((STATE.tickCount - post.timestamp) * 0.5));
  const timeStr = timeAgo < 60 ? `${timeAgo}m` : `${Math.floor(timeAgo / 60)}h`;

  card.innerHTML = `
    <div class="post-header">
      <div class="avatar" style="background:${post.agentColor}">${post.agentName.slice(0, 2).toUpperCase()}</div>
      <div>
        <div class="post-author">${post.agentName} <span class="mood-dot" style="background:${moodColor}"></span></div>
        <div class="post-handle">@${post.agent}</div>
      </div>
      <div class="post-time">${timeStr}</div>
    </div>
    <div class="post-text">${textHtml}</div>
    <div class="post-engagement">
      <span>‚ô° ${post.likes}</span>
      <span>‚Ü© ${post.replies}</span>
      <span>‚ü≥ ${post.reposts}</span>
    </div>
  `;

  if (prepend) {
    feedEl.prepend(card);
  } else {
    feedEl.appendChild(card);
  }

  // Trim old posts from DOM
  while (feedEl.children.length > 80) {
    feedEl.removeChild(feedEl.lastChild);
  }
}

function renderTrending() {
  const trending = STATE.topicEngine.getTrending(8);
  trendingEl.innerHTML = trending.map((t, i) => `
    <li class="trending-item">
      <span>${i + 1}. ${t.name}</span>
      <span class="heat">${Math.round(t.heat)}üî•</span>
    </li>
  `).join('');
}

function renderMetrics(metrics) {
  document.getElementById('dramaVal').textContent = metrics.drama;
  document.getElementById('dramaBar').style.width = metrics.drama + '%';
  document.getElementById('unityVal').textContent = metrics.unity;
  document.getElementById('unityBar').style.width = metrics.unity + '%';
  document.getElementById('toxicityVal').textContent = metrics.toxicity;
  document.getElementById('toxicityBar').style.width = metrics.toxicity + '%';
  document.getElementById('engagementRate').textContent = metrics.engagement;
  document.getElementById('engBar').style.width = Math.min(100, metrics.engagement) + '%';
  document.getElementById('richnessVal').textContent = metrics.richness;
  document.getElementById('richnessBar').style.width = metrics.richness + '%';

  const culture = detectCultureState(metrics);
  if (culture && culture !== STATE.cultureState) {
    STATE.cultureState = culture;
    cultureAlertEl.textContent = culture;
    cultureAlertEl.style.display = 'block';
    AudioEngine.dramaSound();
    setTimeout(() => { cultureAlertEl.style.display = 'none'; }, 8000);
  }

  document.getElementById('dayCount').textContent = STATE.day;
  document.getElementById('postCount').textContent = STATE.totalPosts;

  // Stats panel
  const topAgent = [...STATE.agents].sort((a, b) => b.postCount - a.postCount)[0];
  const happiestAgent = [...STATE.agents].sort((a, b) => b.mood - a.mood)[0];
  const saltiest = [...STATE.agents].sort((a, b) => a.mood - b.mood)[0];
  document.getElementById('statsPanel').innerHTML = `
    <div class="stats-row"><span>Top poster</span><span>@${topAgent.username}</span></div>
    <div class="stats-row"><span>Happiest</span><span>@${happiestAgent.username}</span></div>
    <div class="stats-row"><span>Saltiest</span><span>@${saltiest.username}</span></div>
    <div class="stats-row"><span>Inside jokes</span><span>${STATE.insideJokes.length}</span></div>
    <div class="stats-row"><span>Topics seen</span><span>${STATE.topicEngine.getUniqueCount()}</span></div>
  `;
}

// ‚îÄ‚îÄ‚îÄ Slider Bindings ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function bindSliders() {
  const sliders = [
    ['controversy', 'controversyVal'],
    ['echo', 'echoVal'],
    ['trend', 'trendVal'],
    ['engagement', 'engagementVal'],
    ['nostalgia', 'nostalgiaVal'],
    ['chaos', 'chaosVal']
  ];
  sliders.forEach(([id, valId]) => {
    const slider = document.getElementById(id);
    const valEl = document.getElementById(valId);
    slider.addEventListener('input', () => {
      STATE.algorithm[id] = parseInt(slider.value);
      valEl.textContent = slider.value;
    });
  });
}

// ‚îÄ‚îÄ‚îÄ Speed Controls ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function bindSpeedControls() {
  document.querySelectorAll('.speed-btn[data-speed]').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.speed-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      STATE.simSpeed = parseInt(btn.dataset.speed);
    });
  });
}

// ‚îÄ‚îÄ‚îÄ Save/Load ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function saveState() {
  try {
    const saveData = {
      algorithm: STATE.algorithm,
      agents: STATE.agents.map(a => ({
        username: a.username, mood: a.mood, opinions: a.opinions,
        relationships: a.relationships, postCount: a.postCount, energy: a.energy, followers: a.followers
      })),
      day: STATE.day,
      totalPosts: STATE.totalPosts,
      insideJokes: STATE.insideJokes,
      cultureState: STATE.cultureState,
      topics: STATE.topicEngine.topics,
      topicHistory: STATE.topicEngine.topicHistory,
      tickCount: STATE.tickCount
    };
    localStorage.setItem('feed-gods-save', JSON.stringify(saveData));
  } catch (e) { /* quota exceeded ‚Äî no-op */ }
}

function loadState() {
  try {
    const raw = localStorage.getItem('feed-gods-save');
    if (!raw) return false;
    const data = JSON.parse(raw);
    STATE.algorithm = data.algorithm || STATE.algorithm;
    STATE.day = data.day || 1;
    STATE.totalPosts = data.totalPosts || 0;
    STATE.insideJokes = data.insideJokes || [];
    STATE.cultureState = data.cultureState || null;
    STATE.tickCount = data.tickCount || 0;
    if (data.topics) STATE.topicEngine.topics = data.topics;
    if (data.topicHistory) STATE.topicEngine.topicHistory = data.topicHistory;
    if (data.agents) {
      data.agents.forEach(saved => {
        const agent = STATE.agents.find(a => a.username === saved.username);
        if (agent) {
          agent.mood = saved.mood || 0;
          agent.opinions = saved.opinions || {};
          agent.relationships = saved.relationships || {};
          agent.postCount = saved.postCount || 0;
          agent.energy = saved.energy || 100;
          agent.followers = saved.followers || 100;
        }
      });
    }
    // Restore slider positions
    Object.entries(STATE.algorithm).forEach(([key, val]) => {
      const el = document.getElementById(key);
      const valEl = document.getElementById(key + 'Val');
      if (el) el.value = val;
      if (valEl) valEl.textContent = val;
    });
    return true;
  } catch (e) { return false; }
}

// ‚îÄ‚îÄ‚îÄ Reset ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.getElementById('resetBtn').addEventListener('click', () => {
  if (confirm('Reset the entire simulation? All culture will be lost.')) {
    localStorage.removeItem('feed-gods-save');
    location.reload();
  }
});

// ‚îÄ‚îÄ‚îÄ Main Simulation Loop ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let lastPostTime = 0;
let graphAnimFrame = null;

function simTick(now) {
  graphAnimFrame = requestAnimationFrame(simTick);

  if (STATE.simSpeed === 0) return;

  const postInterval = Math.max(300, 3000 / STATE.simSpeed);

  if (now - lastPostTime > postInterval) {
    lastPostTime = now;
    STATE.tickCount++;

    // Generate a post
    const post = generatePost();
    renderPost(post, true);
    AudioEngine.postSound();

    // Topic decay
    STATE.topicEngine.decay(STATE.algorithm.trend);

    // Agent energy regen + mood drift
    STATE.agents.forEach(a => {
      a.energy = Math.min(100, a.energy + 2);
      a.mood *= 0.98; // drift toward 0
      // Opinion drift based on algorithm echo chamber + what they see
      if (Math.random() < 0.1) {
        const topic = STATE.topicEngine.getHottest();
        const echoStrength = STATE.algorithm.echo / 100;
        const neighbors = Object.entries(a.relationships)
          .filter(([, v]) => v > 0.2)
          .map(([name]) => STATE.agents.find(x => x.username === name))
          .filter(Boolean);
        if (neighbors.length > 0 && echoStrength > 0.3) {
          const neighborAvg = neighbors.reduce((s, n) => s + (n.opinions[topic] || 0), 0) / neighbors.length;
          a.opinions[topic] = (a.opinions[topic] || 0) * (1 - echoStrength * 0.1) + neighborAvg * echoStrength * 0.1;
        }
      }
    });

    // Day counter (every 20 ticks = 1 day)
    if (STATE.tickCount % 20 === 0) {
      STATE.day++;
      STATE.postsSinceLastMinute = 0;

      // Nostalgia: revive old topics
      if (Math.random() * 100 < STATE.algorithm.nostalgia) {
        const old = STATE.topicEngine.getOldTopic();
        STATE.topicEngine.boostTopic(old, 15 + STATE.algorithm.nostalgia / 5);
      }

      // Chaos events
      if (Math.random() * 100 < STATE.algorithm.chaos) {
        const chaosType = Math.random();
        if (chaosType < 0.3) {
          // Viral post from lurker
          const lisa = STATE.agents.find(a => a.username === 'lurker_lisa');
          if (lisa) {
            const post = createPost(lisa);
            post.likes *= 5;
            post.reposts *= 5;
            STATE.posts.unshift(post);
            renderPost(post, true);
          }
        } else if (chaosType < 0.6) {
          // Random alliance shift
          const a = STATE.agents[Math.floor(Math.random() * STATE.agents.length)];
          const b = STATE.agents[Math.floor(Math.random() * STATE.agents.length)];
          if (a !== b) {
            const oldRel = a.relationships[b.username] || 0;
            a.relationships[b.username] = -oldRel;
            b.relationships[a.username] = -oldRel * 0.5;
          }
        } else {
          // Hot mic moment ‚Äî agent says something out of character
          const agent = STATE.agents[Math.floor(Math.random() * STATE.agents.length)];
          agent.mood += (Math.random() > 0.5 ? 30 : -30);
        }
        AudioEngine.dramaSound();
      }

      saveState();
    }

    // Update UI periodically
    if (STATE.tickCount % 3 === 0) {
      renderTrending();
      renderMetrics(calculateMetrics());
    }
  }

  // Always update graph physics
  updateGraphPhysics();
  drawGraph();
}

// ‚îÄ‚îÄ‚îÄ Boot ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function boot() {
  initAgents();
  const loaded = loadState();
  initGraphPositions();
  bindSliders();
  bindSpeedControls();
  renderTrending();
  renderMetrics(calculateMetrics());

  if (loaded) {
    // Re-generate a few posts for visual fill
    for (let i = 0; i < 5; i++) {
      const post = generatePost();
      renderPost(post);
    }
  }

  graphAnimFrame = requestAnimationFrame(simTick);
}

boot();
</script>
</body>
</html>
