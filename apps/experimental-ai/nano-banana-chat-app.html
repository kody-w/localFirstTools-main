<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Local-first AI chat application using Nano Banana (Gemini) API">
    <meta name="theme-color" content="#FFC107">
    <title>Nano Banana AI Chat - Local First Application</title>
    
    <!-- Favicon as inline SVG data URI -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçå</text></svg>">
    
    <style>
        /* ============================================
           CSS RESET AND CUSTOM PROPERTIES
           ============================================ */
        
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            /* Light theme colors */
            --primary-color: #FFC107;
            --primary-dark: #FFA000;
            --primary-light: #FFECB3;
            --secondary-color: #03DAC6;
            --background: #FAFAFA;
            --surface: #FFFFFF;
            --surface-elevated: #F5F5F5;
            --text-primary: #212121;
            --text-secondary: #757575;
            --text-on-primary: #000000;
            --border-color: #E0E0E0;
            --error-color: #B00020;
            --success-color: #4CAF50;
            --warning-color: #FF9800;
            --info-color: #2196F3;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
            --shadow-md: 0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23);
            --shadow-lg: 0 10px 20px rgba(0,0,0,0.19), 0 6px 6px rgba(0,0,0,0.23);
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-normal: 300ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 500ms cubic-bezier(0.4, 0, 0.2, 1);
            --border-radius: 8px;
            --border-radius-lg: 16px;
            --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            --font-mono: 'Courier New', Courier, monospace;
        }
        
        /* Dark theme */
        body.dark-theme {
            --primary-color: #FFC107;
            --primary-dark: #FFA000;
            --primary-light: #FFE082;
            --secondary-color: #03DAC6;
            --background: #121212;
            --surface: #1E1E1E;
            --surface-elevated: #2C2C2C;
            --text-primary: #E0E0E0;
            --text-secondary: #A0A0A0;
            --text-on-primary: #000000;
            --border-color: #333333;
            --error-color: #CF6679;
            --success-color: #81C784;
            --warning-color: #FFB74D;
            --info-color: #64B5F6;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.3), 0 1px 2px rgba(0,0,0,0.5);
            --shadow-md: 0 3px 6px rgba(0,0,0,0.4), 0 3px 6px rgba(0,0,0,0.5);
            --shadow-lg: 0 10px 20px rgba(0,0,0,0.5), 0 6px 6px rgba(0,0,0,0.6);
        }
        
        /* ============================================
           BASE STYLES
           ============================================ */
        
        html {
            font-size: 16px;
            height: 100%;
            scroll-behavior: smooth;
        }
        
        body {
            font-family: var(--font-family);
            background-color: var(--background);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: background-color var(--transition-normal), color var(--transition-normal);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* ============================================
           HEADER STYLES
           ============================================ */
        
        .header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: var(--text-on-primary);
            padding: 1rem 1.5rem;
            box-shadow: var(--shadow-md);
            z-index: 100;
            position: sticky;
            top: 0;
        }
        
        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .header-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.5rem;
            font-weight: 600;
            letter-spacing: -0.5px;
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        /* ============================================
           BUTTON STYLES
           ============================================ */
        
        button {
            font-family: var(--font-family);
            font-size: 0.875rem;
            font-weight: 500;
            padding: 0.625rem 1.25rem;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all var(--transition-fast);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            white-space: nowrap;
            user-select: none;
            position: relative;
            overflow: hidden;
        }
        
        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transform: translate(-50%, -50%);
            transition: width var(--transition-normal), height var(--transition-normal);
        }
        
        button:active::before {
            width: 300px;
            height: 300px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: var(--text-on-primary);
            box-shadow: var(--shadow-sm);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .btn-primary:disabled {
            background: var(--border-color);
            color: var(--text-secondary);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-secondary {
            background: var(--surface);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        
        .btn-secondary:hover {
            background: var(--surface-elevated);
            border-color: var(--primary-color);
        }
        
        .btn-icon {
            width: 40px;
            height: 40px;
            padding: 0;
            border-radius: 50%;
            background: var(--surface);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
        }
        
        .btn-icon:hover {
            background: var(--primary-light);
            border-color: var(--primary-color);
            transform: rotate(180deg);
        }
        
        /* ============================================
           CHAT CONTAINER STYLES
           ============================================ */
        
        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            max-width: 900px;
            width: 100%;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            scroll-behavior: smooth;
        }
        
        .chat-container::-webkit-scrollbar {
            width: 8px;
        }
        
        .chat-container::-webkit-scrollbar-track {
            background: var(--surface);
            border-radius: 4px;
        }
        
        .chat-container::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }
        
        .chat-container::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }
        
        /* ============================================
           MESSAGE STYLES
           ============================================ */
        
        .message {
            max-width: 70%;
            word-wrap: break-word;
            animation: messageSlideIn var(--transition-normal) ease-out;
            display: flex;
            gap: 0.75rem;
        }
        
        @keyframes messageSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .message-content {
            padding: 0.875rem 1.125rem;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-sm);
            position: relative;
            flex: 1;
        }
        
        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            flex-shrink: 0;
            box-shadow: var(--shadow-sm);
        }
        
        .user-message {
            align-self: flex-end;
            flex-direction: row-reverse;
        }
        
        .user-message .message-content {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: var(--text-on-primary);
            border-bottom-right-radius: 4px;
        }
        
        .user-message .message-avatar {
            background: var(--primary-light);
        }
        
        .ai-message {
            align-self: flex-start;
        }
        
        .ai-message .message-content {
            background: var(--surface);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-bottom-left-radius: 4px;
        }
        
        .ai-message .message-avatar {
            background: var(--surface-elevated);
            border: 1px solid var(--border-color);
        }
        
        .message-timestamp {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
            opacity: 0;
            transition: opacity var(--transition-fast);
        }
        
        .message:hover .message-timestamp {
            opacity: 1;
        }
        
        /* Loading animation */
        .loading-message .message-content::after {
            content: '';
            display: inline-block;
            animation: loadingDots 1.4s infinite;
        }
        
        @keyframes loadingDots {
            0% { content: ''; }
            25% { content: '.'; }
            50% { content: '..'; }
            75% { content: '...'; }
            100% { content: ''; }
        }
        
        /* ============================================
           MARKDOWN STYLES
           ============================================ */
        
        .message-content pre {
            background: var(--surface-elevated);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 0.75rem;
            overflow-x: auto;
            margin: 0.5rem 0;
        }
        
        .message-content code {
            background: var(--surface-elevated);
            padding: 0.125rem 0.375rem;
            border-radius: 3px;
            font-family: var(--font-mono);
            font-size: 0.875rem;
        }
        
        .message-content pre code {
            background: none;
            padding: 0;
        }
        
        .message-content a {
            color: var(--info-color);
            text-decoration: none;
            border-bottom: 1px solid transparent;
            transition: border-color var(--transition-fast);
        }
        
        .message-content a:hover {
            border-bottom-color: var(--info-color);
        }
        
        .message-content strong {
            font-weight: 600;
        }
        
        .message-content em {
            font-style: italic;
        }
        
        .message-content ul, .message-content ol {
            margin-left: 1.5rem;
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .message-content li {
            margin-bottom: 0.25rem;
        }
        
        /* ============================================
           INPUT AREA STYLES
           ============================================ */
        
        .input-area {
            background: var(--surface);
            border-top: 1px solid var(--border-color);
            padding: 1rem 1.5rem;
            box-shadow: var(--shadow-md);
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            gap: 0.75rem;
            align-items: flex-end;
        }
        
        .input-wrapper {
            flex: 1;
            position: relative;
        }
        
        .input-field {
            width: 100%;
            min-height: 44px;
            max-height: 200px;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            background: var(--background);
            color: var(--text-primary);
            font-family: var(--font-family);
            font-size: 1rem;
            resize: vertical;
            transition: border-color var(--transition-fast);
            outline: none;
        }
        
        .input-field:focus {
            border-color: var(--primary-color);
        }
        
        .input-field::placeholder {
            color: var(--text-secondary);
        }
        
        .char-counter {
            position: absolute;
            right: 1rem;
            bottom: 0.25rem;
            font-size: 0.75rem;
            color: var(--text-secondary);
            pointer-events: none;
        }
        
        /* ============================================
           MODAL STYLES
           ============================================ */
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn var(--transition-fast) ease-out;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal {
            background: var(--surface);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-lg);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp var(--transition-normal) ease-out;
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
        }
        
        /* ============================================
           FORM STYLES
           ============================================ */
        
        .form-group {
            margin-bottom: 1.25rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-primary);
            font-size: 0.875rem;
        }
        
        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background: var(--background);
            color: var(--text-primary);
            font-family: var(--font-family);
            font-size: 1rem;
            transition: border-color var(--transition-fast);
            outline: none;
        }
        
        .form-input:focus {
            border-color: var(--primary-color);
        }
        
        .form-hint {
            margin-top: 0.25rem;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        .form-select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background: var(--background);
            color: var(--text-primary);
            font-family: var(--font-family);
            font-size: 1rem;
            cursor: pointer;
            outline: none;
        }
        
        .form-checkbox {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .form-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        /* ============================================
           STATUS BAR STYLES
           ============================================ */
        
        .status-bar {
            background: var(--surface-elevated);
            padding: 0.5rem 1.5rem;
            font-size: 0.75rem;
            color: var(--text-secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 1px solid var(--border-color);
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success-color);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .status-indicator.error {
            background: var(--error-color);
            animation: none;
        }
        
        /* ============================================
           TOAST NOTIFICATION STYLES
           ============================================ */
        
        .toast-container {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            pointer-events: none;
        }
        
        .toast {
            background: var(--surface);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 1rem 1.5rem;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            animation: toastSlideIn var(--transition-normal) ease-out;
            pointer-events: auto;
            min-width: 300px;
        }
        
        @keyframes toastSlideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .toast.success {
            border-left: 4px solid var(--success-color);
        }
        
        .toast.error {
            border-left: 4px solid var(--error-color);
        }
        
        .toast.warning {
            border-left: 4px solid var(--warning-color);
        }
        
        .toast.info {
            border-left: 4px solid var(--info-color);
        }
        
        .toast-icon {
            font-size: 1.25rem;
        }
        
        .toast-message {
            flex: 1;
            font-size: 0.875rem;
            color: var(--text-primary);
        }
        
        .toast-close {
            cursor: pointer;
            opacity: 0.5;
            transition: opacity var(--transition-fast);
        }
        
        .toast-close:hover {
            opacity: 1;
        }
        
        /* ============================================
           EMPTY STATE STYLES
           ============================================ */
        
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 4rem 2rem;
            text-align: center;
            animation: fadeIn var(--transition-slow) ease-out;
        }
        
        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        
        .empty-state-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }
        
        .empty-state-description {
            color: var(--text-secondary);
            max-width: 400px;
        }
        
        /* ============================================
           UTILITY CLASSES
           ============================================ */
        
        .hidden {
            display: none !important;
        }
        
        .text-center {
            text-align: center;
        }
        
        .text-muted {
            color: var(--text-secondary);
        }
        
        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        
        /* ============================================
           RESPONSIVE DESIGN
           ============================================ */
        
        @media (max-width: 768px) {
            .header-container {
                justify-content: center;
            }
            
            .header-title {
                font-size: 1.25rem;
            }
            
            .chat-container {
                padding: 1rem;
            }
            
            .message {
                max-width: 85%;
            }
            
            .modal {
                width: 95%;
                margin: 1rem;
            }
            
            .toast-container {
                bottom: 1rem;
                right: 1rem;
                left: 1rem;
            }
            
            .toast {
                min-width: auto;
                width: 100%;
            }
        }
        
        @media (max-width: 480px) {
            .header-actions {
                width: 100%;
                justify-content: center;
            }
            
            .message {
                max-width: 95%;
            }
            
            .message-avatar {
                width: 32px;
                height: 32px;
                font-size: 1rem;
            }
            
            .input-container {
                flex-direction: column;
            }
            
            .input-wrapper {
                width: 100%;
            }
            
            button {
                width: 100%;
            }
        }
        
        /* ============================================
           PRINT STYLES
           ============================================ */
        
        @media print {
            .header,
            .input-area,
            .status-bar,
            .modal-overlay,
            .toast-container,
            button {
                display: none !important;
            }
            
            .chat-container {
                padding: 0;
                max-width: 100%;
            }
            
            .message {
                max-width: 100%;
                break-inside: avoid;
            }
        }
        
        /* ============================================
           ACCESSIBILITY
           ============================================ */
        
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        :focus-visible {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }
        
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <div class="header-title">
                <span role="img" aria-label="Banana">üçå</span>
                <span>Nano Banana AI Chat</span>
            </div>
            <div class="header-actions">
                <button class="btn-secondary" id="settingsBtn" aria-label="Settings">
                    ‚öôÔ∏è Settings
                </button>
                <button class="btn-secondary" id="exportBtn" aria-label="Export chat">
                    üì• Export
                </button>
                <button class="btn-secondary" id="clearBtn" aria-label="Clear chat">
                    üóëÔ∏è Clear
                </button>
                <button class="btn-icon" id="themeBtn" aria-label="Toggle theme">
                    <span id="themeIcon">üåô</span>
                </button>
            </div>
        </div>
    </header>
    
    <!-- Chat Container -->
    <main class="chat-container" id="chatContainer" role="log" aria-live="polite" aria-label="Chat messages">
        <div class="empty-state" id="emptyState">
            <div class="empty-state-icon">üí¨</div>
            <h2 class="empty-state-title">Start a Conversation</h2>
            <p class="empty-state-description">
                Type your message below to begin chatting with Nano Banana AI powered by Google Gemini.
            </p>
        </div>
    </main>
    
    <!-- Input Area -->
    <div class="input-area">
        <div class="input-container">
            <div class="input-wrapper">
                <textarea 
                    class="input-field" 
                    id="messageInput" 
                    placeholder="Type your message here... (Shift+Enter for new line)"
                    aria-label="Message input"
                    rows="1"
                ></textarea>
                <span class="char-counter" id="charCounter">0 / 4000</span>
            </div>
            <button class="btn-primary" id="sendButton" aria-label="Send message">
                <span>Send</span>
                <span>‚Üí</span>
            </button>
        </div>
    </div>
    
    <!-- Status Bar -->
    <div class="status-bar">
        <div class="status-item">
            <span class="status-indicator" id="statusIndicator"></span>
            <span id="statusText">Ready</span>
        </div>
        <div class="status-item">
            <span id="messageCount">0 messages</span>
        </div>
    </div>
    
    <!-- Settings Modal -->
    <div class="modal-overlay" id="settingsModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Settings</h2>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" for="apiKeyInput">API Key</label>
                    <input 
                        type="password" 
                        class="form-input" 
                        id="apiKeyInput" 
                        placeholder="Enter your Gemini API key"
                        aria-describedby="apiKeyHint"
                    >
                    <p class="form-hint" id="apiKeyHint">
                        Get your API key from <a href="https://aistudio.google.com/apikey" target="_blank" rel="noopener">Google AI Studio</a>
                    </p>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="modelSelect">Model</label>
                    <select class="form-select" id="modelSelect">
                        <option value="gemini-2.5-flash">Gemini 2.5 Flash (Fast)</option>
                        <option value="gemini-2.5-pro">Gemini 2.5 Pro (Advanced)</option>
                        <option value="gemini-2.0-flash">Gemini 2.0 Flash</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="temperatureInput">Temperature (Creativity)</label>
                    <input 
                        type="range" 
                        class="form-input" 
                        id="temperatureInput" 
                        min="0" 
                        max="2" 
                        step="0.1" 
                        value="0.9"
                    >
                    <p class="form-hint">Current: <span id="temperatureValue">0.9</span></p>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="maxTokensInput">Max Tokens</label>
                    <input 
                        type="number" 
                        class="form-input" 
                        id="maxTokensInput" 
                        min="100" 
                        max="8192" 
                        value="2048"
                    >
                </div>
                
                <div class="form-group">
                    <div class="form-checkbox">
                        <input type="checkbox" id="autoSaveCheckbox" checked>
                        <label for="autoSaveCheckbox">Auto-save conversations</label>
                    </div>
                </div>
                
                <div class="form-group">
                    <div class="form-checkbox">
                        <input type="checkbox" id="soundCheckbox">
                        <label for="soundCheckbox">Enable notification sounds</label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelSettingsBtn">Cancel</button>
                <button class="btn-primary" id="saveSettingsBtn">Save Settings</button>
            </div>
        </div>
    </div>
    
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>
    
    <!-- JavaScript -->
    <script>
        'use strict';
        
        /* ============================================
           NANO BANANA AI CHAT APPLICATION
           ============================================ */
        
        // Wait for DOM to load before initializing
        document.addEventListener('DOMContentLoaded', function() {
            
            class NanoBananaChat {
                constructor() {
                    // Configuration
                    this.config = {
                        apiEndpoint: 'https://generativelanguage.googleapis.com/v1beta/models/',
                        defaultModel: 'gemini-2.5-flash',
                        maxMessages: 100,
                        maxTokens: 2048,
                        temperature: 0.9,
                        autoSave: true,
                        enableSound: false,
                        maxRetries: 3,
                        retryDelay: 1000
                    };
                    
                    // State
                    this.state = {
                        messages: [],
                        isLoading: false,
                        apiKey: null,
                        currentModel: this.config.defaultModel,
                        theme: 'light'
                    };
                    
                    // DOM Elements
                    this.elements = {
                        chatContainer: null,
                        messageInput: null,
                        sendButton: null,
                        emptyState: null,
                        settingsModal: null,
                        statusIndicator: null,
                        statusText: null,
                        messageCount: null,
                        charCounter: null,
                        themeIcon: null
                    };
                    
                    // Initialize
                    this.init();
                }
                
                /* ============================================
                   INITIALIZATION
                   ============================================ */
                
                init() {
                    this.cacheElements();
                    this.loadState();
                    this.bindEvents();
                    this.applyTheme();
                    this.updateUI();
                    
                    // Check for API key
                    if (!this.state.apiKey) {
                        setTimeout(() => this.promptForApiKey(), 500);
                    }
                }
                
                cacheElements() {
                    this.elements.chatContainer = document.getElementById('chatContainer');
                    this.elements.messageInput = document.getElementById('messageInput');
                    this.elements.sendButton = document.getElementById('sendButton');
                    this.elements.emptyState = document.getElementById('emptyState');
                    this.elements.settingsModal = document.getElementById('settingsModal');
                    this.elements.statusIndicator = document.getElementById('statusIndicator');
                    this.elements.statusText = document.getElementById('statusText');
                    this.elements.messageCount = document.getElementById('messageCount');
                    this.elements.charCounter = document.getElementById('charCounter');
                    this.elements.themeIcon = document.getElementById('themeIcon');
                }
                
                bindEvents() {
                    // Send button
                    this.elements.sendButton.addEventListener('click', () => this.sendMessage());
                    
                    // Message input events
                    this.elements.messageInput.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' && !e.shiftKey) {
                            e.preventDefault();
                            this.sendMessage();
                        }
                    });
                    
                    this.elements.messageInput.addEventListener('input', (e) => {
                        this.updateCharCounter();
                        this.autoResizeTextarea(e.target);
                    });
                    
                    // Header buttons
                    document.getElementById('settingsBtn').addEventListener('click', () => this.showSettings());
                    document.getElementById('exportBtn').addEventListener('click', () => this.exportChat());
                    document.getElementById('clearBtn').addEventListener('click', () => this.clearChat());
                    document.getElementById('themeBtn').addEventListener('click', () => this.toggleTheme());
                    
                    // Settings modal buttons
                    document.getElementById('saveSettingsBtn').addEventListener('click', () => this.saveSettings());
                    document.getElementById('cancelSettingsBtn').addEventListener('click', () => this.closeSettings());
                    
                    // Temperature slider
                    const temperatureInput = document.getElementById('temperatureInput');
                    if (temperatureInput) {
                        temperatureInput.addEventListener('input', (e) => {
                            document.getElementById('temperatureValue').textContent = e.target.value;
                        });
                    }
                    
                    // Window events
                    window.addEventListener('beforeunload', () => this.saveState());
                    
                    // Keyboard shortcuts
                    document.addEventListener('keydown', (e) => {
                        // Ctrl/Cmd + K = clear chat
                        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                            e.preventDefault();
                            this.clearChat();
                        }
                        // Ctrl/Cmd + S = save/export
                        if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                            e.preventDefault();
                            this.exportChat();
                        }
                        // Ctrl/Cmd + , = settings
                        if ((e.ctrlKey || e.metaKey) && e.key === ',') {
                            e.preventDefault();
                            this.showSettings();
                        }
                    });
                    
                    // Modal overlay click to close
                    this.elements.settingsModal.addEventListener('click', (e) => {
                        if (e.target === this.elements.settingsModal) {
                            this.closeSettings();
                        }
                    });
                }
                
                /* ============================================
                   STATE MANAGEMENT
                   ============================================ */
                
                loadState() {
                    try {
                        // Load API key from session storage
                        const encryptedKey = sessionStorage.getItem('nano-api-key');
                        if (encryptedKey) {
                            this.state.apiKey = this.decrypt(encryptedKey);
                        }
                        
                        // Load messages from local storage
                        const savedMessages = localStorage.getItem('nano-messages');
                        if (savedMessages) {
                            this.state.messages = JSON.parse(savedMessages);
                            // Display saved messages
                            this.state.messages.forEach(msg => {
                                this.displayMessage(msg.text, msg.type, msg.timestamp);
                            });
                        }
                        
                        // Load settings
                        const savedSettings = localStorage.getItem('nano-settings');
                        if (savedSettings) {
                            const settings = JSON.parse(savedSettings);
                            Object.assign(this.config, settings);
                            this.state.currentModel = settings.model || this.config.defaultModel;
                        }
                        
                        // Load theme
                        const savedTheme = localStorage.getItem('nano-theme');
                        if (savedTheme) {
                            this.state.theme = savedTheme;
                        }
                    } catch (error) {
                        console.error('Error loading state:', error);
                        this.showToast('Failed to load saved data', 'error');
                    }
                }
                
                saveState() {
                    try {
                        if (this.config.autoSave) {
                            // Save messages (limit to last N messages to avoid storage limits)
                            const messagesToSave = this.state.messages.slice(-this.config.maxMessages);
                            localStorage.setItem('nano-messages', JSON.stringify(messagesToSave));
                        }
                        
                        // Save settings
                        const settings = {
                            model: this.state.currentModel,
                            temperature: this.config.temperature,
                            maxTokens: this.config.maxTokens,
                            autoSave: this.config.autoSave,
                            enableSound: this.config.enableSound
                        };
                        localStorage.setItem('nano-settings', JSON.stringify(settings));
                        
                        // Save theme
                        localStorage.setItem('nano-theme', this.state.theme);
                    } catch (error) {
                        console.error('Error saving state:', error);
                        if (error.name === 'QuotaExceededError') {
                            this.clearOldMessages();
                            this.saveState(); // Retry after cleanup
                        }
                    }
                }
                
                /* ============================================
                   API COMMUNICATION
                   ============================================ */
                
                async sendMessage() {
                    const message = this.elements.messageInput.value.trim();
                    if (!message || this.state.isLoading) return;
                    
                    if (!this.state.apiKey) {
                        this.promptForApiKey();
                        return;
                    }
                    
                    // Clear input and update UI
                    this.elements.messageInput.value = '';
                    this.updateCharCounter();
                    this.autoResizeTextarea(this.elements.messageInput);
                    
                    // Add user message
                    this.addMessage(message, 'user');
                    
                    // Set loading state
                    this.setLoading(true);
                    
                    try {
                        // Call API with retry logic
                        const response = await this.callApiWithRetry(message);
                        this.addMessage(response, 'ai');
                    } catch (error) {
                        console.error('API Error:', error);
                        this.handleApiError(error);
                    } finally {
                        this.setLoading(false);
                    }
                }
                
                async callApiWithRetry(prompt, retries = 0) {
                    try {
                        const response = await this.callNanoBananaApi(prompt);
                        return response;
                    } catch (error) {
                        if (retries < this.config.maxRetries) {
                            // Exponential backoff
                            const delay = this.config.retryDelay * Math.pow(2, retries);
                            await this.sleep(delay);
                            return this.callApiWithRetry(prompt, retries + 1);
                        }
                        throw error;
                    }
                }
                
                async callNanoBananaApi(prompt) {
                    const endpoint = `${this.config.apiEndpoint}${this.state.currentModel}:generateContent`;
                    
                    // Build conversation context
                    const contents = this.buildConversationContext(prompt);
                    
                    const response = await fetch(endpoint, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'x-goog-api-key': this.state.apiKey
                        },
                        body: JSON.stringify({
                            contents: contents,
                            generationConfig: {
                                temperature: this.config.temperature,
                                maxOutputTokens: this.config.maxTokens,
                                topP: 0.95,
                                topK: 40
                            },
                            safetySettings: [
                                {
                                    category: 'HARM_CATEGORY_HARASSMENT',
                                    threshold: 'BLOCK_ONLY_HIGH'
                                },
                                {
                                    category: 'HARM_CATEGORY_HATE_SPEECH',
                                    threshold: 'BLOCK_ONLY_HIGH'
                                },
                                {
                                    category: 'HARM_CATEGORY_SEXUALLY_EXPLICIT',
                                    threshold: 'BLOCK_ONLY_HIGH'
                                },
                                {
                                    category: 'HARM_CATEGORY_DANGEROUS_CONTENT',
                                    threshold: 'BLOCK_ONLY_HIGH'
                                }
                            ]
                        })
                    });
                    
                    if (!response.ok) {
                        const error = await response.json();
                        const errorObj = new Error(error.error?.message || `API Error: ${response.status}`);
                        errorObj.status = response.status;
                        throw errorObj;
                    }
                    
                    const data = await response.json();
                    
                    if (!data.candidates || data.candidates.length === 0) {
                        throw new Error('No response generated');
                    }
                    
                    return data.candidates[0].content.parts[0].text;
                }
                
                buildConversationContext(newPrompt) {
                    const contents = [];
                    
                    // Add recent conversation history for context
                    const recentMessages = this.state.messages.slice(-10);
                    recentMessages.forEach(msg => {
                        contents.push({
                            role: msg.type === 'user' ? 'user' : 'model',
                            parts: [{ text: msg.text }]
                        });
                    });
                    
                    // Add new user prompt
                    contents.push({
                        role: 'user',
                        parts: [{ text: newPrompt }]
                    });
                    
                    return contents;
                }
                
                /* ============================================
                   UI UPDATES
                   ============================================ */
                
                addMessage(text, type) {
                    // Create message object
                    const message = {
                        id: Date.now(),
                        text: text,
                        type: type,
                        timestamp: new Date().toISOString()
                    };
                    
                    // Add to state
                    this.state.messages.push(message);
                    
                    // Display message
                    this.displayMessage(text, type, message.timestamp);
                    
                    // Update UI
                    this.updateUI();
                    
                    // Save state
                    this.saveState();
                    
                    // Play sound if enabled
                    if (this.config.enableSound && type === 'ai') {
                        this.playNotificationSound();
                    }
                }
                
                displayMessage(text, type, timestamp) {
                    // Hide empty state
                    if (this.elements.emptyState) {
                        this.elements.emptyState.classList.add('hidden');
                    }
                    
                    // Create message element
                    const messageDiv = document.createElement('div');
                    messageDiv.className = `message ${type}-message`;
                    
                    // Add avatar
                    const avatarDiv = document.createElement('div');
                    avatarDiv.className = 'message-avatar';
                    avatarDiv.textContent = type === 'user' ? 'üë§' : 'ü§ñ';
                    
                    // Add content
                    const contentDiv = document.createElement('div');
                    contentDiv.className = 'message-content';
                    
                    // Render markdown if AI message
                    if (type === 'ai') {
                        contentDiv.innerHTML = this.renderMarkdown(text);
                    } else {
                        contentDiv.textContent = text;
                    }
                    
                    // Add timestamp
                    if (timestamp) {
                        const timestampDiv = document.createElement('div');
                        timestampDiv.className = 'message-timestamp';
                        timestampDiv.textContent = this.formatTimestamp(timestamp);
                        contentDiv.appendChild(timestampDiv);
                    }
                    
                    // Assemble message
                    messageDiv.appendChild(avatarDiv);
                    messageDiv.appendChild(contentDiv);
                    
                    // Add to chat
                    this.elements.chatContainer.appendChild(messageDiv);
                    
                    // Scroll to bottom
                    this.scrollToBottom();
                }
                
                renderMarkdown(text) {
                    // Basic markdown rendering
                    let html = text
                        // Headers
                        .replace(/^### (.*$)/gim, '<h3>$1</h3>')
                        .replace(/^## (.*$)/gim, '<h2>$1</h2>')
                        .replace(/^# (.*$)/gim, '<h1>$1</h1>')
                        // Bold
                        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                        // Italic
                        .replace(/\*(.*?)\*/g, '<em>$1</em>')
                        // Code blocks
                        .replace(/```(.*?)\n([\s\S]*?)```/g, '<pre><code class="language-$1">$2</code></pre>')
                        // Inline code
                        .replace(/`([^`]+)`/g, '<code>$1</code>')
                        // Links
                        .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="../../$2" target="_blank" rel="noopener">$1</a>')
                        // Lists
                        .replace(/^\* (.+)/gim, '<li>$1</li>')
                        .replace(/^- (.+)/gim, '<li>$1</li>')
                        .replace(/^\d+\. (.+)/gim, '<li>$1</li>')
                        // Line breaks
                        .replace(/\n\n/g, '</p><p>')
                        .replace(/\n/g, '<br>');
                    
                    // Wrap in paragraphs if not already structured
                    if (!html.includes('<p>') && !html.includes('<h')) {
                        html = `<p>${html}</p>`;
                    }
                    
                    // Clean up list items
                    html = html.replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>');
                    
                    return html;
                }
                
                setLoading(isLoading) {
                    this.state.isLoading = isLoading;
                    this.elements.sendButton.disabled = isLoading;
                    this.elements.messageInput.disabled = isLoading;
                    
                    if (isLoading) {
                        this.elements.statusIndicator.classList.remove('error');
                        this.elements.statusText.textContent = 'Thinking...';
                        
                        // Add loading message
                        const loadingDiv = document.createElement('div');
                        loadingDiv.className = 'message ai-message loading-message';
                        loadingDiv.id = 'loading-message';
                        loadingDiv.innerHTML = `
                            <div class="message-avatar">ü§ñ</div>
                            <div class="message-content">Thinking</div>
                        `;
                        this.elements.chatContainer.appendChild(loadingDiv);
                        this.scrollToBottom();
                    } else {
                        this.elements.statusText.textContent = 'Ready';
                        
                        // Remove loading message
                        const loadingMsg = document.getElementById('loading-message');
                        if (loadingMsg) {
                            loadingMsg.remove();
                        }
                    }
                }
                
                updateUI() {
                    // Update message count
                    if (this.elements.messageCount) {
                        this.elements.messageCount.textContent = `${this.state.messages.length} messages`;
                    }
                    
                    // Update theme icon
                    if (this.elements.themeIcon) {
                        this.elements.themeIcon.textContent = this.state.theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
                    }
                    
                    // Show/hide empty state
                    if (this.state.messages.length === 0) {
                        this.elements.emptyState?.classList.remove('hidden');
                    } else {
                        this.elements.emptyState?.classList.add('hidden');
                    }
                }
                
                updateCharCounter() {
                    const length = this.elements.messageInput.value.length;
                    this.elements.charCounter.textContent = `${length} / 4000`;
                    
                    if (length > 3800) {
                        this.elements.charCounter.style.color = 'var(--error-color)';
                    } else if (length > 3000) {
                        this.elements.charCounter.style.color = 'var(--warning-color)';
                    } else {
                        this.elements.charCounter.style.color = 'var(--text-secondary)';
                    }
                }
                
                autoResizeTextarea(textarea) {
                    textarea.style.height = 'auto';
                    textarea.style.height = Math.min(textarea.scrollHeight, 200) + 'px';
                }
                
                scrollToBottom() {
                    this.elements.chatContainer.scrollTop = this.elements.chatContainer.scrollHeight;
                }
                
                /* ============================================
                   MODAL MANAGEMENT
                   ============================================ */
                
                showSettings() {
                    // Load current settings into form
                    document.getElementById('apiKeyInput').value = this.state.apiKey || '';
                    document.getElementById('modelSelect').value = this.state.currentModel;
                    document.getElementById('temperatureInput').value = this.config.temperature;
                    document.getElementById('temperatureValue').textContent = this.config.temperature;
                    document.getElementById('maxTokensInput').value = this.config.maxTokens;
                    document.getElementById('autoSaveCheckbox').checked = this.config.autoSave;
                    document.getElementById('soundCheckbox').checked = this.config.enableSound;
                    
                    // Show modal
                    this.elements.settingsModal.classList.add('active');
                }
                
                closeSettings() {
                    this.elements.settingsModal.classList.remove('active');
                }
                
                saveSettings() {
                    // Get form values
                    const apiKey = document.getElementById('apiKeyInput').value.trim();
                    const model = document.getElementById('modelSelect').value;
                    const temperature = parseFloat(document.getElementById('temperatureInput').value);
                    const maxTokens = parseInt(document.getElementById('maxTokensInput').value);
                    const autoSave = document.getElementById('autoSaveCheckbox').checked;
                    const enableSound = document.getElementById('soundCheckbox').checked;
                    
                    // Update state and config
                    if (apiKey) {
                        this.state.apiKey = apiKey;
                        sessionStorage.setItem('nano-api-key', this.encrypt(apiKey));
                    }
                    
                    this.state.currentModel = model;
                    this.config.temperature = temperature;
                    this.config.maxTokens = maxTokens;
                    this.config.autoSave = autoSave;
                    this.config.enableSound = enableSound;
                    
                    // Save and close
                    this.saveState();
                    this.closeSettings();
                    this.showToast('Settings saved successfully', 'success');
                }
                
                promptForApiKey() {
                    const key = prompt('Please enter your Gemini API key.\n\nYou can get one for free at:\nhttps://aistudio.google.com/apikey');
                    
                    if (key && key.trim()) {
                        this.state.apiKey = key.trim();
                        sessionStorage.setItem('nano-api-key', this.encrypt(key.trim()));
                        this.showToast('API key saved successfully', 'success');
                    } else {
                        this.showToast('API key is required to use the chat', 'warning');
                    }
                }
                
                /* ============================================
                   CHAT MANAGEMENT
                   ============================================ */
                
                clearChat() {
                    if (this.state.messages.length === 0) {
                        this.showToast('Chat is already empty', 'info');
                        return;
                    }
                    
                    if (confirm('Are you sure you want to clear all messages? This action cannot be undone.')) {
                        this.state.messages = [];
                        
                        // Clear UI
                        const messages = this.elements.chatContainer.querySelectorAll('.message');
                        messages.forEach(msg => msg.remove());
                        
                        // Update UI
                        this.updateUI();
                        this.saveState();
                        this.showToast('Chat cleared successfully', 'success');
                    }
                }
                
                exportChat() {
                    if (this.state.messages.length === 0) {
                        this.showToast('No messages to export', 'warning');
                        return;
                    }
                    
                    const exportData = {
                        version: '1.0',
                        exported: new Date().toISOString(),
                        model: this.state.currentModel,
                        messages: this.state.messages,
                        config: {
                            temperature: this.config.temperature,
                            maxTokens: this.config.maxTokens
                        }
                    };
                    
                    const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `nano-banana-chat-${Date.now()}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    this.showToast('Chat exported successfully', 'success');
                }
                
                async importChat(file) {
                    try {
                        const text = await file.text();
                        const data = JSON.parse(text);
                        
                        if (!data.messages || !Array.isArray(data.messages)) {
                            throw new Error('Invalid chat file format');
                        }
                        
                        this.state.messages = data.messages;
                        
                        // Clear current chat display
                        const messages = this.elements.chatContainer.querySelectorAll('.message');
                        messages.forEach(msg => msg.remove());
                        
                        // Recreate messages
                        this.state.messages.forEach(msg => {
                            this.displayMessage(msg.text, msg.type, msg.timestamp);
                        });
                        
                        this.updateUI();
                        this.showToast('Chat imported successfully', 'success');
                    } catch (error) {
                        console.error('Import error:', error);
                        this.showToast('Failed to import chat file', 'error');
                    }
                }
                
                clearOldMessages() {
                    // Keep only recent messages
                    const keepCount = Math.floor(this.config.maxMessages / 2);
                    this.state.messages = this.state.messages.slice(-keepCount);
                    this.showToast('Cleared old messages to save space', 'info');
                }
                
                /* ============================================
                   THEME MANAGEMENT
                   ============================================ */
                
                toggleTheme() {
                    this.state.theme = this.state.theme === 'light' ? 'dark' : 'light';
                    this.applyTheme();
                    this.saveState();
                }
                
                applyTheme() {
                    if (this.state.theme === 'dark') {
                        document.body.classList.add('dark-theme');
                    } else {
                        document.body.classList.remove('dark-theme');
                    }
                    this.updateUI();
                }
                
                /* ============================================
                   UTILITY FUNCTIONS
                   ============================================ */
                
                encrypt(text) {
                    // Basic obfuscation (not secure, just to avoid plain text)
                    return btoa(encodeURIComponent(text));
                }
                
                decrypt(text) {
                    try {
                        return decodeURIComponent(atob(text));
                    } catch {
                        return null;
                    }
                }
                
                sleep(ms) {
                    return new Promise(resolve => setTimeout(resolve, ms));
                }
                
                formatTimestamp(timestamp) {
                    const date = new Date(timestamp);
                    const now = new Date();
                    const diff = now - date;
                    
                    if (diff < 60000) {
                        return 'Just now';
                    } else if (diff < 3600000) {
                        const minutes = Math.floor(diff / 60000);
                        return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;
                    } else if (diff < 86400000) {
                        const hours = Math.floor(diff / 3600000);
                        return `${hours} hour${hours > 1 ? 's' : ''} ago`;
                    } else {
                        return date.toLocaleString();
                    }
                }
                
                showToast(message, type = 'info') {
                    const toast = document.createElement('div');
                    toast.className = `toast ${type}`;
                    
                    const icon = {
                        success: '‚úÖ',
                        error: '‚ùå',
                        warning: '‚ö†Ô∏è',
                        info: '‚ÑπÔ∏è'
                    }[type];
                    
                    toast.innerHTML = `
                        <span class="toast-icon">${icon}</span>
                        <span class="toast-message">${message}</span>
                        <span class="toast-close">‚úï</span>
                    `;
                    
                    // Add click handler to close button
                    toast.querySelector('.toast-close').addEventListener('click', () => {
                        toast.remove();
                    });
                    
                    document.getElementById('toastContainer').appendChild(toast);
                    
                    // Auto remove after 5 seconds
                    setTimeout(() => {
                        toast.remove();
                    }, 5000);
                }
                
                
                playNotificationSound() {
                    // Create a simple beep sound using Web Audio API
                    try {
                        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        
                        oscillator.frequency.value = 800;
                        oscillator.type = 'sine';
                        
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                        
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.1);
                    } catch (error) {
                        console.error('Error playing sound:', error);
                    }
                }
                
                handleApiError(error) {
                    let message = 'An error occurred. Please try again.';
                    let type = 'error';
                    
                    if (error.message) {
                        if (error.message.includes('API key')) {
                            message = 'Invalid API key. Please check your settings.';
                            this.elements.statusIndicator.classList.add('error');
                        } else if (error.message.includes('quota')) {
                            message = 'API quota exceeded. Please try again later.';
                            type = 'warning';
                        } else if (error.message.includes('rate limit')) {
                            message = 'Rate limit exceeded. Please wait a moment.';
                            type = 'warning';
                        } else if (error.message.includes('network')) {
                            message = 'Network error. Please check your connection.';
                        } else if (error.status === 401) {
                            message = 'Authentication failed. Please check your API key.';
                            this.promptForApiKey();
                        } else if (error.status === 403) {
                            message = 'Access forbidden. Please check your API key permissions.';
                        } else if (error.status === 429) {
                            message = 'Too many requests. Please slow down.';
                            type = 'warning';
                        } else if (error.status >= 500) {
                            message = 'Server error. Please try again later.';
                            type = 'warning';
                        } else {
                            message = error.message;
                        }
                    }
                    
                    this.showToast(message, type);
                    this.elements.statusText.textContent = 'Error';
                    this.elements.statusIndicator.classList.add('error');
                }
            }
            
            /* ============================================
               INITIALIZE APPLICATION
               ============================================ */
            
            // Create global app instance
            window.app = new NanoBananaChat();
            
            // Log startup message
            console.log('üçå Nano Banana AI Chat initialized');
            console.log('Get your API key at: https://aistudio.google.com/apikey');
            
        }); // End of DOMContentLoaded
    </script>
</body>
</html>