<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vestigial Automata</title>
    <meta name="description" content="Watch clockwork creatures slowly rust and decay while bioluminescent fungi grow through their cracks">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #0a0806; min-height: 100vh; font-family: 'Courier New', monospace; color: #c0a060; overflow: hidden; }
        #canvas { position: fixed; top: 0; left: 0; }
        #controls {
            position: fixed; top: 20px; left: 20px; background: rgba(20,15,10,0.95);
            padding: 20px; border-radius: 10px; border: 1px solid rgba(180,140,60,0.3);
            z-index: 100;
        }
        h3 { margin-bottom: 15px; color: #d0a040; font-weight: normal; }
        .control-row { margin: 10px 0; }
        label { display: block; font-size: 11px; margin-bottom: 5px; opacity: 0.8; }
        input[type="range"] { width: 140px; }
        .value { float: right; color: #e0b050; font-size: 12px; }
        button {
            display: block; width: 100%; padding: 10px; margin: 6px 0;
            background: rgba(100,70,30,0.4); border: 1px solid rgba(180,140,60,0.4);
            color: #c0a060; cursor: pointer; border-radius: 6px;
        }
        #info { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); font-size: 12px; opacity: 0.5; z-index: 100; }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div id="controls">
        <h3>Vestigial Museum</h3>
        <div class="control-row">
            <label>Decay Rate <span class="value" id="decay-val">50</span></label>
            <input type="range" id="decay" min="10" max="100" value="50">
        </div>
        <div class="control-row">
            <label>Fungi Growth <span class="value" id="fungi-val">40</span></label>
            <input type="range" id="fungi" min="0" max="100" value="40">
        </div>
        <button id="new-btn">New Automaton</button>
        <button id="restore-btn">Attempt Restore</button>
    </div>
    <div id="info">Click to introduce damage | Watch mechanical decay unfold</div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let W, H;
        function resize() { W = canvas.width = innerWidth; H = canvas.height = innerHeight; }
        resize(); window.onresize = resize;
        
        let decayRate = 0.5;
        let fungiGrowth = 0.4;
        let time = 0;
        let automaton = null;
        let rustParticles = [];
        let fungi = [];
        
        class Gear {
            constructor(x, y, radius, teeth, speed) {
                this.x = x;
                this.y = y;
                this.radius = radius;
                this.teeth = teeth;
                this.speed = speed;
                this.rotation = Math.random() * Math.PI * 2;
                this.rust = 0;
                this.damage = [];
                this.jitter = 0;
                this.seized = false;
            }
            update() {
                if (this.seized) {
                    this.jitter = Math.sin(time * 20) * 0.02;
                } else {
                    this.rotation += this.speed * (1 - this.rust * 0.8);
                    this.jitter *= 0.95;
                }
                
                this.rust += 0.0001 * decayRate;
                if (this.rust > 0.9 && Math.random() < 0.01) {
                    this.seized = true;
                }
                
                if (this.rust > 0.3 && Math.random() < 0.02 * decayRate) {
                    rustParticles.push({
                        x: this.x + (Math.random() - 0.5) * this.radius,
                        y: this.y + (Math.random() - 0.5) * this.radius,
                        vx: (Math.random() - 0.5) * 0.5,
                        vy: Math.random() * 0.5,
                        size: 1 + Math.random() * 2,
                        life: 1
                    });
                }
            }
            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation + this.jitter);
                
                const rustColor = Math.floor(60 + this.rust * 80);
                const baseColor = "rgb(" + (180 - this.rust * 80) + "," + (150 - this.rust * 60) + "," + (80 - this.rust * 40) + ")";
                
                ctx.beginPath();
                for (let i = 0; i < this.teeth; i++) {
                    const angle = (i / this.teeth) * Math.PI * 2;
                    const nextAngle = ((i + 0.5) / this.teeth) * Math.PI * 2;
                    const outer = this.radius;
                    const inner = this.radius * 0.75;
                    
                    ctx.lineTo(Math.cos(angle) * outer, Math.sin(angle) * outer);
                    ctx.lineTo(Math.cos(nextAngle) * inner, Math.sin(nextAngle) * inner);
                }
                ctx.closePath();
                ctx.fillStyle = baseColor;
                ctx.fill();
                ctx.strokeStyle = "rgba(0,0,0,0.3)";
                ctx.lineWidth = 2;
                ctx.stroke();
                
                ctx.beginPath();
                ctx.arc(0, 0, this.radius * 0.2, 0, Math.PI * 2);
                ctx.fillStyle = "#1a1510";
                ctx.fill();
                
                if (this.rust > 0.2) {
                    for (let i = 0; i < 5; i++) {
                        const spotAngle = i * 1.3 + this.x * 0.01;
                        const spotDist = this.radius * (0.3 + Math.sin(i * 2.1) * 0.3);
                        ctx.beginPath();
                        ctx.arc(
                            Math.cos(spotAngle) * spotDist,
                            Math.sin(spotAngle) * spotDist,
                            5 + this.rust * 10,
                            0, Math.PI * 2
                        );
                        ctx.fillStyle = "rgba(" + (120 + this.rust * 40) + ", " + (60 + this.rust * 20) + ", 20, " + (this.rust * 0.5) + ")";
                        ctx.fill();
                    }
                }
                
                ctx.restore();
            }
        }
        
        class Rod {
            constructor(x1, y1, x2, y2) {
                this.x1 = x1;
                this.y1 = y1;
                this.x2 = x2;
                this.y2 = y2;
                this.rust = 0;
                this.bend = 0;
            }
            update() {
                this.rust += 0.00005 * decayRate;
                if (this.rust > 0.5) {
                    this.bend += 0.0001 * decayRate;
                }
            }
            draw() {
                const midX = (this.x1 + this.x2) / 2;
                const midY = (this.y1 + this.y2) / 2 + this.bend * 50;
                
                ctx.beginPath();
                ctx.moveTo(this.x1, this.y1);
                ctx.quadraticCurveTo(midX, midY, this.x2, this.y2);
                ctx.strokeStyle = "rgb(" + (140 - this.rust * 60) + "," + (110 - this.rust * 50) + "," + (60 - this.rust * 30) + ")";
                ctx.lineWidth = 6;
                ctx.stroke();
            }
        }
        
        class Fungus {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.size = 0;
                this.maxSize = 5 + Math.random() * 15;
                this.hue = 120 + Math.random() * 60;
                this.phase = Math.random() * Math.PI * 2;
                this.branches = [];
                for (let i = 0; i < 3; i++) {
                    this.branches.push({
                        angle: Math.random() * Math.PI * 2,
                        length: 0,
                        maxLength: 10 + Math.random() * 20
                    });
                }
            }
            update() {
                if (this.size < this.maxSize) {
                    this.size += 0.02 * fungiGrowth;
                }
                this.phase += 0.02;
                this.branches.forEach(b => {
                    if (b.length < b.maxLength && this.size > this.maxSize * 0.5) {
                        b.length += 0.03 * fungiGrowth;
                    }
                });
            }
            draw() {
                const glow = 0.5 + Math.sin(this.phase) * 0.3;
                
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size * 2, 0, Math.PI * 2);
                ctx.fillStyle = "hsla(" + this.hue + ", 80%, 50%, " + (glow * 0.2) + ")";
                ctx.fill();
                
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = "hsla(" + this.hue + ", 70%, 40%, " + glow + ")";
                ctx.fill();
                
                this.branches.forEach(b => {
                    if (b.length > 0) {
                        ctx.beginPath();
                        ctx.moveTo(this.x, this.y);
                        ctx.lineTo(
                            this.x + Math.cos(b.angle) * b.length,
                            this.y + Math.sin(b.angle) * b.length
                        );
                        ctx.strokeStyle = "hsla(" + this.hue + ", 60%, 35%, " + glow + ")";
                        ctx.lineWidth = 2;
                        ctx.stroke();
                    }
                });
            }
        }
        
        function createAutomaton() {
            automaton = {
                gears: [],
                rods: [],
                baseX: W / 2,
                baseY: H / 2
            };
            fungi = [];
            rustParticles = [];
            
            const mainGear = new Gear(W/2, H/2, 80, 20, 0.01);
            automaton.gears.push(mainGear);
            
            automaton.gears.push(new Gear(W/2 + 120, H/2 - 30, 50, 14, -0.015));
            automaton.gears.push(new Gear(W/2 - 100, H/2 + 50, 60, 16, 0.012));
            automaton.gears.push(new Gear(W/2 + 60, H/2 + 100, 40, 12, -0.02));
            automaton.gears.push(new Gear(W/2 - 60, H/2 - 80, 45, 13, 0.018));
            
            automaton.rods.push(new Rod(W/2 + 80, H/2, W/2 + 120, H/2 - 30));
            automaton.rods.push(new Rod(W/2 - 80, H/2, W/2 - 100, H/2 + 50));
            automaton.rods.push(new Rod(W/2 + 50, H/2 + 80, W/2 + 60, H/2 + 100));
        }
        
        function drawBackground() {
            const grad = ctx.createRadialGradient(W/2, H/2, 0, W/2, H/2, Math.max(W, H) * 0.7);
            grad.addColorStop(0, '#1a1510');
            grad.addColorStop(1, '#0a0806');
            ctx.fillStyle = grad;
            ctx.fillRect(0, 0, W, H);
            
            ctx.beginPath();
            ctx.arc(W * 0.8, H * 0.2, 100, 0, Math.PI * 2);
            const spotlight = ctx.createRadialGradient(W * 0.8, H * 0.2, 0, W * 0.8, H * 0.2, 200);
            spotlight.addColorStop(0, 'rgba(255, 220, 150, 0.1)');
            spotlight.addColorStop(1, 'transparent');
            ctx.fillStyle = spotlight;
            ctx.fill();
        }
        
        function animate() {
            time += 0.016;
            drawBackground();
            
            if (automaton) {
                automaton.rods.forEach(r => { r.update(); r.draw(); });
                automaton.gears.forEach(g => { g.update(); g.draw(); });
            }
            
            rustParticles = rustParticles.filter(p => {
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.02;
                p.life -= 0.01;
                
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fillStyle = "rgba(150, 80, 30, " + p.life + ")";
                ctx.fill();
                
                return p.life > 0;
            });
            
            if (fungiGrowth > 0 && automaton && Math.random() < 0.005 * fungiGrowth) {
                const gear = automaton.gears[Math.floor(Math.random() * automaton.gears.length)];
                if (gear.rust > 0.3) {
                    fungi.push(new Fungus(
                        gear.x + (Math.random() - 0.5) * gear.radius,
                        gear.y + (Math.random() - 0.5) * gear.radius
                    ));
                }
            }
            
            fungi.forEach(f => { f.update(); f.draw(); });
            
            requestAnimationFrame(animate);
        }
        
        canvas.onclick = e => {
            if (!automaton) return;
            automaton.gears.forEach(g => {
                const dist = Math.hypot(e.clientX - g.x, e.clientY - g.y);
                if (dist < g.radius) {
                    g.rust += 0.1;
                    for (let i = 0; i < 10; i++) {
                        rustParticles.push({
                            x: e.clientX,
                            y: e.clientY,
                            vx: (Math.random() - 0.5) * 3,
                            vy: (Math.random() - 0.5) * 3,
                            size: 2 + Math.random() * 3,
                            life: 1
                        });
                    }
                }
            });
        };
        
        document.getElementById('decay').oninput = e => {
            decayRate = e.target.value / 100;
            document.getElementById('decay-val').textContent = e.target.value;
        };
        
        document.getElementById('fungi').oninput = e => {
            fungiGrowth = e.target.value / 100;
            document.getElementById('fungi-val').textContent = e.target.value;
        };
        
        document.getElementById('new-btn').onclick = createAutomaton;
        
        document.getElementById('restore-btn').onclick = () => {
            if (!automaton) return;
            automaton.gears.forEach(g => {
                g.rust *= 0.7;
                g.seized = false;
            });
            automaton.rods.forEach(r => {
                r.rust *= 0.7;
                r.bend *= 0.5;
            });
        };
        
        createAutomaton();
        animate();
    </script>
</body>
</html>