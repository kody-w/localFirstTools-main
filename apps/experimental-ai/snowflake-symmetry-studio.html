<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snowflake Symmetry Studio</title>
    <meta name="description" content="Watch ice crystals grow in real-time with hexagonal symmetry based on temperature and humidity">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: linear-gradient(180deg, #0a1628 0%, #1a3050 100%); min-height: 100vh; font-family: 'Courier New', monospace; color: #a0d0ff; overflow: hidden; }
        #canvas { position: fixed; top: 0; left: 0; }
        #controls {
            position: fixed; top: 20px; left: 20px; background: rgba(10,30,60,0.8);
            padding: 20px; border-radius: 15px; border: 1px solid rgba(100,180,255,0.3); z-index: 100;
        }
        h3 { margin-bottom: 15px; color: #c0e0ff; }
        .control-row { margin: 12px 0; }
        label { display: block; font-size: 11px; margin-bottom: 5px; opacity: 0.7; }
        input[type="range"] { width: 160px; }
        #info {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            font-size: 12px; opacity: 0.5; text-align: center;
        }
        button {
            padding: 8px 16px; background: rgba(50,100,180,0.4); border: 1px solid rgba(100,180,255,0.4);
            color: #a0d0ff; cursor: pointer; border-radius: 8px; margin-top: 10px; margin-right: 5px;
        }
        #crystal-count {
            position: fixed; top: 20px; right: 20px; background: rgba(10,30,60,0.8);
            padding: 15px 25px; border-radius: 15px; border: 1px solid rgba(100,180,255,0.3);
            text-align: center;
        }
        .stat-value { font-size: 28px; color: #c0e0ff; }
        .stat-label { font-size: 10px; opacity: 0.6; }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div id="controls">
        <h3>Crystal Parameters</h3>
        <div class="control-row">
            <label>Temperature: <span id="temp-val">-15°C</span></label>
            <input type="range" id="temp" min="-40" max="0" value="-15">
        </div>
        <div class="control-row">
            <label>Humidity: <span id="humid-val">80%</span></label>
            <input type="range" id="humid" min="0" max="100" value="80">
        </div>
        <div class="control-row">
            <label>Growth Speed: <span id="speed-val">1.0x</span></label>
            <input type="range" id="speed" min="1" max="50" value="10">
        </div>
        <div class="control-row">
            <label>Branch Complexity: <span id="complex-val">3</span></label>
            <input type="range" id="complex" min="1" max="6" value="3">
        </div>
        <button id="new-btn">New Crystal</button>
        <button id="export-btn">Export PNG</button>
    </div>
    <div id="crystal-count">
        <div class="stat-value" id="branches">0</div>
        <div class="stat-label">Branches</div>
    </div>
    <div id="info">Each snowflake is unique | Adjust conditions to change crystal structure</div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let W, H, cx, cy;
        function resize() { W = canvas.width = innerWidth; H = canvas.height = innerHeight; cx = W/2; cy = H/2; }
        resize(); window.onresize = resize;

        let temp = -15, humid = 80, speed = 1, complexity = 3;
        let branches = [];
        let time = 0;
        let branchCount = 0;

        class Branch {
            constructor(x, y, angle, depth, parent) {
                this.x = x; this.y = y;
                this.angle = angle;
                this.depth = depth;
                this.length = 0;
                this.maxLength = (150 - depth * 20) * (0.7 + Math.random() * 0.6);
                this.growing = true;
                this.children = [];
                this.width = Math.max(1, 6 - depth);
                this.spawnPoints = [];
                this.parent = parent;
            }
            grow() {
                if (!this.growing) return;
                const growRate = speed * 0.1 * (1 + humid / 100) * (1 - temp / -50);
                this.length += growRate;
                if (this.length >= this.maxLength) {
                    this.growing = false;
                    this.spawnChildren();
                }
                if (this.depth < complexity && this.length > 30 && Math.random() < 0.02 * (humid / 50)) {
                    this.spawnSideBranch();
                }
            }
            spawnChildren() {
                if (this.depth >= complexity) return;
                const spreadAngle = 0.5 + (Math.abs(temp) / 40) * 0.3;
                const ex = this.x + Math.cos(this.angle) * this.length;
                const ey = this.y + Math.sin(this.angle) * this.length;
                this.children.push(new Branch(ex, ey, this.angle - spreadAngle, this.depth + 1, this));
                this.children.push(new Branch(ex, ey, this.angle + spreadAngle, this.depth + 1, this));
                if (humid > 60 && Math.random() < 0.5) {
                    this.children.push(new Branch(ex, ey, this.angle, this.depth + 1, this));
                }
                branchCount += this.children.length;
            }
            spawnSideBranch() {
                const ratio = 0.3 + Math.random() * 0.4;
                const px = this.x + Math.cos(this.angle) * this.length * ratio;
                const py = this.y + Math.sin(this.angle) * this.length * ratio;
                const side = Math.random() < 0.5 ? -1 : 1;
                const newAngle = this.angle + side * (0.8 + Math.random() * 0.4);
                this.children.push(new Branch(px, py, newAngle, this.depth + 1, this));
                branchCount++;
            }
            draw() {
                const ex = this.x + Math.cos(this.angle) * this.length;
                const ey = this.y + Math.sin(this.angle) * this.length;
                const alpha = 0.3 + (1 - this.depth / complexity) * 0.7;
                ctx.beginPath();
                ctx.moveTo(this.x, this.y);
                ctx.lineTo(ex, ey);
                ctx.strokeStyle = "rgba(180, 220, 255, " + alpha + ")";
                ctx.lineWidth = this.width;
                ctx.lineCap = 'round';
                ctx.stroke();
                if (this.length > 5) {
                    ctx.beginPath();
                    ctx.arc(ex, ey, this.width + 1, 0, Math.PI * 2);
                    ctx.fillStyle = "rgba(200, 240, 255, " + (alpha * 0.3) + ")";
                    ctx.fill();
                }
                this.children.forEach(c => { c.grow(); c.draw(); });
            }
        }

        function initSnowflake() {
            branches = [];
            branchCount = 6;
            for (let i = 0; i < 6; i++) {
                const angle = (i / 6) * Math.PI * 2 - Math.PI / 2;
                branches.push(new Branch(cx, cy, angle, 0, null));
            }
        }

        function drawBackground() {
            ctx.fillStyle = 'rgba(10, 22, 40, 0.1)';
            ctx.fillRect(0, 0, W, H);
            for (let i = 0; i < 3; i++) {
                if (Math.random() < 0.3) {
                    ctx.beginPath();
                    ctx.arc(Math.random() * W, Math.random() * H, 1, 0, Math.PI * 2);
                    ctx.fillStyle = 'rgba(255,255,255,0.3)';
                    ctx.fill();
                }
            }
        }

        function animate() {
            time++;
            drawBackground();
            ctx.save();
            ctx.shadowBlur = 15;
            ctx.shadowColor = 'rgba(150, 200, 255, 0.5)';
            branches.forEach(b => { b.grow(); b.draw(); });
            ctx.restore();
            document.getElementById('branches').textContent = branchCount;
            requestAnimationFrame(animate);
        }

        document.getElementById('temp').oninput = e => {
            temp = parseInt(e.target.value);
            document.getElementById('temp-val').textContent = temp + "°C";
        };
        document.getElementById('humid').oninput = e => {
            humid = parseInt(e.target.value);
            document.getElementById('humid-val').textContent = humid + "%";
        };
        document.getElementById('speed').oninput = e => {
            speed = e.target.value / 10;
            document.getElementById('speed-val').textContent = speed.toFixed(1) + "x";
        };
        document.getElementById('complex').oninput = e => {
            complexity = parseInt(e.target.value);
            document.getElementById('complex-val').textContent = complexity;
        };
        document.getElementById('new-btn').onclick = () => {
            ctx.fillStyle = '#0a1628';
            ctx.fillRect(0, 0, W, H);
            branchCount = 0;
            initSnowflake();
        };
        document.getElementById('export-btn').onclick = () => {
            const a = document.createElement('a');
            a.href = canvas.toDataURL('image/png');
            a.download = 'snowflake-' + Date.now() + '.png';
            a.click();
        };

        initSnowflake();
        animate();
    </script>
</body>
</html>