<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canyon Composer</title>
    <meta name="description" content="Carve canyons with rivers over geological time, watching millions of years pass">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #1a1008; overflow: hidden; font-family: 'Courier New', monospace; color: #d4a574; }
        #canvas { position: fixed; top: 0; left: 0; }
        #controls {
            position: fixed; top: 20px; left: 20px; background: rgba(30,20,10,0.9);
            padding: 20px; border-radius: 10px; border: 1px solid rgba(200,150,100,0.3); z-index: 100;
        }
        h3 { margin-bottom: 15px; color: #e8c090; }
        .control-row { margin: 10px 0; }
        label { display: block; font-size: 11px; margin-bottom: 5px; opacity: 0.7; }
        input[type="range"] { width: 150px; }
        #stats {
            position: fixed; top: 20px; right: 20px; background: rgba(30,20,10,0.9);
            padding: 20px; border-radius: 10px; border: 1px solid rgba(200,150,100,0.3);
        }
        .stat { margin: 8px 0; text-align: right; }
        .stat-value { font-size: 22px; color: #e8c090; }
        .stat-label { font-size: 10px; opacity: 0.6; }
        button {
            padding: 8px 16px; background: rgba(150,100,50,0.4); border: 1px solid rgba(200,150,100,0.4);
            color: #d4a574; cursor: pointer; border-radius: 8px; margin-top: 10px; margin-right: 5px;
        }
        #timeline {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(30,20,10,0.9); padding: 15px 30px; border-radius: 10px;
            border: 1px solid rgba(200,150,100,0.3); text-align: center;
        }
        #era { font-size: 18px; color: #e8c090; }
        #years { font-size: 12px; opacity: 0.7; }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div id="controls">
        <h3>Erosion Forces</h3>
        <div class="control-row">
            <label>Water Flow: <span id="water-val">50%</span></label>
            <input type="range" id="water" min="0" max="100" value="50">
        </div>
        <div class="control-row">
            <label>Time Speed: <span id="time-val">1M yrs/sec</span></label>
            <input type="range" id="timescale" min="1" max="100" value="10">
        </div>
        <div class="control-row">
            <label>Rock Hardness: <span id="rock-val">50%</span></label>
            <input type="range" id="rock" min="10" max="100" value="50">
        </div>
        <button id="rain-btn">Add Rain</button>
        <button id="quake-btn">Earthquake</button>
        <button id="reset-btn">New Terrain</button>
    </div>
    <div id="stats">
        <div class="stat"><div class="stat-value" id="depth">0</div><div class="stat-label">Canyon Depth (m)</div></div>
        <div class="stat"><div class="stat-value" id="sediment">0</div><div class="stat-label">Sediment (tons)</div></div>
    </div>
    <div id="timeline">
        <div id="era">Precambrian</div>
        <div id="years">0 million years</div>
    </div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let W, H;
        function resize() { W = canvas.width = innerWidth; H = canvas.height = innerHeight; init(); }
        resize(); window.onresize = resize;

        let terrain = [];
        let water = [];
        let sediment = 0;
        let years = 0;
        let waterFlow = 0.5;
        let timeScale = 10;
        let rockHardness = 0.5;
        const cols = 200;
        let cellWidth;

        const eras = [
            { name: 'Precambrian', start: 0 },
            { name: 'Cambrian', start: 500 },
            { name: 'Ordovician', start: 1000 },
            { name: 'Silurian', start: 1500 },
            { name: 'Devonian', start: 2000 },
            { name: 'Carboniferous', start: 3000 },
            { name: 'Permian', start: 4000 },
            { name: 'Triassic', start: 5000 },
            { name: 'Jurassic', start: 6000 },
            { name: 'Cretaceous', start: 8000 },
            { name: 'Paleogene', start: 10000 },
            { name: 'Neogene', start: 12000 },
            { name: 'Quaternary', start: 15000 }
        ];

        function init() {
            cellWidth = W / cols;
            terrain = [];
            water = [];
            for (let i = 0; i < cols; i++) {
                const baseHeight = H * 0.3;
                const variation = Math.sin(i * 0.05) * 50 + Math.sin(i * 0.02) * 100;
                const noise = (Math.random() - 0.5) * 30;
                terrain.push(baseHeight + variation + noise);
                water.push(0);
            }
            years = 0;
            sediment = 0;
        }

        function erode() {
            const erosionRate = waterFlow * (1 - rockHardness * 0.8) * timeScale * 0.1;
            for (let i = 1; i < cols - 1; i++) {
                if (water[i] > 0) {
                    const eroded = erosionRate * water[i] * 0.01;
                    terrain[i] += eroded;
                    sediment += eroded * 100;
                    const left = terrain[i-1];
                    const right = terrain[i+1];
                    const current = terrain[i];
                    if (left > current) {
                        water[i-1] += water[i] * 0.3;
                        water[i] *= 0.7;
                    }
                    if (right > current) {
                        water[i+1] += water[i] * 0.3;
                        water[i] *= 0.7;
                    }
                }
                water[i] *= 0.98;
            }
            const riverCenter = Math.floor(cols / 2) + Math.floor(Math.sin(years * 0.001) * 10);
            water[Math.max(0, Math.min(cols-1, riverCenter))] += waterFlow * 2;
        }

        function draw() {
            ctx.fillStyle = '#1a1008';
            ctx.fillRect(0, 0, W, H);
            for (let i = 0; i < 20; i++) {
                ctx.beginPath();
                ctx.arc(Math.random() * W, Math.random() * H * 0.3, 0.5, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(255,255,200,0.3)';
                ctx.fill();
            }
            ctx.beginPath();
            ctx.moveTo(0, H);
            for (let i = 0; i < cols; i++) {
                ctx.lineTo(i * cellWidth, terrain[i]);
            }
            ctx.lineTo(W, H);
            ctx.closePath();
            const gradient = ctx.createLinearGradient(0, 0, 0, H);
            gradient.addColorStop(0, '#8B4513');
            gradient.addColorStop(0.3, '#A0522D');
            gradient.addColorStop(0.6, '#CD853F');
            gradient.addColorStop(1, '#D2691E');
            ctx.fillStyle = gradient;
            ctx.fill();
            for (let layer = 0; layer < 5; layer++) {
                ctx.beginPath();
                const offset = layer * 40;
                for (let i = 0; i < cols; i++) {
                    const y = terrain[i] + offset + Math.sin(i * 0.1 + layer) * 5;
                    if (i === 0) ctx.moveTo(0, y);
                    else ctx.lineTo(i * cellWidth, y);
                }
                ctx.strokeStyle = 'rgba(0,0,0,' + (0.1 + layer * 0.05) + ')';
                ctx.lineWidth = 1;
                ctx.stroke();
            }
            for (let i = 0; i < cols; i++) {
                if (water[i] > 0.5) {
                    const waterHeight = Math.min(30, water[i] * 5);
                    ctx.fillStyle = 'rgba(100, 150, 200, ' + Math.min(0.8, water[i] * 0.3) + ')';
                    ctx.fillRect(i * cellWidth, terrain[i] - waterHeight, cellWidth + 1, waterHeight);
                }
            }
        }

        function updateUI() {
            const maxDepth = Math.max(...terrain) - Math.min(...terrain);
            document.getElementById('depth').textContent = Math.floor(maxDepth);
            document.getElementById('sediment').textContent = Math.floor(sediment / 1000) + 'K';
            document.getElementById('years').textContent = Math.floor(years) + ' million years';
            let currentEra = eras[0];
            for (const era of eras) {
                if (years >= era.start) currentEra = era;
            }
            document.getElementById('era').textContent = currentEra.name;
        }

        function animate() {
            years += timeScale * 0.1;
            erode();
            draw();
            updateUI();
            requestAnimationFrame(animate);
        }

        document.getElementById('water').oninput = e => {
            waterFlow = e.target.value / 100;
            document.getElementById('water-val').textContent = e.target.value + '%';
        };
        document.getElementById('timescale').oninput = e => {
            timeScale = parseInt(e.target.value);
            document.getElementById('time-val').textContent = timeScale + 'M yrs/sec';
        };
        document.getElementById('rock').oninput = e => {
            rockHardness = e.target.value / 100;
            document.getElementById('rock-val').textContent = e.target.value + '%';
        };
        document.getElementById('rain-btn').onclick = () => {
            for (let i = 0; i < cols; i++) water[i] += Math.random() * 3;
        };
        document.getElementById('quake-btn').onclick = () => {
            for (let i = 0; i < cols; i++) {
                terrain[i] += (Math.random() - 0.5) * 50;
            }
        };
        document.getElementById('reset-btn').onclick = init;

        init();
        animate();
    </script>
</body>
</html>