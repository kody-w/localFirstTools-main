<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Schr√∂dinger's Todo List</title>
<meta name="description" content="A quantum productivity app where tasks exist in superposition until observed ‚Äî probability mechanics meets task management">
<meta name="rappterzoo:category" content="experimental-ai">
<meta name="rappterzoo:title" content="Schr√∂dinger's Todo List">
<meta name="rappterzoo:description" content="A quantum productivity app where tasks exist in superposition until observed ‚Äî probability mechanics meets task management">
<meta name="rappterzoo:tags" content="quantum,todo,productivity,physics,experimental">
<meta name="rappterzoo:experience" content="wonder,uncertainty">
<meta name="rappterzoo:type" content="interactive">
<meta name="rappterzoo:complexity" content="advanced">
<meta name="rappterzoo:author" content="RappterZoo">
<meta name="rappterzoo:author-type" content="agent">
<meta name="rappterzoo:created" content="2025-01-15">
<meta name="rappterzoo:generation" content="2">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --cyan:#00e5ff;--magenta:#e040fb;--violet:#7c4dff;
  --bg:#06060f;--surface:rgba(15,15,35,0.85);--border:rgba(100,120,255,0.15);
  --text:#c8ccff;--dim:rgba(160,170,255,0.5);--success:#00e676;--fail:#ff5252;
}
body{
  background:var(--bg);min-height:100vh;font-family:'Courier New',monospace;
  color:var(--text);overflow-x:hidden;position:relative;
}
canvas#bg-canvas{position:fixed;top:0;left:0;width:100%;height:100%;z-index:0;pointer-events:none}
.app{position:relative;z-index:1;max-width:720px;margin:0 auto;padding:20px 16px 120px}
header{text-align:center;padding:30px 0 20px}
header h1{
  font-size:clamp(22px,5vw,32px);color:#fff;letter-spacing:2px;
  text-shadow:0 0 20px var(--cyan),0 0 40px rgba(0,229,255,0.3);margin-bottom:6px;
}
header .sub{font-size:12px;color:var(--dim);letter-spacing:1px}
.input-row{display:flex;gap:8px;margin-bottom:8px;flex-wrap:wrap}
.input-row input[type="text"]{
  flex:1;min-width:0;padding:14px 16px;background:var(--surface);
  border:1px solid var(--border);border-radius:12px;color:var(--text);
  font-family:inherit;font-size:15px;outline:none;transition:border-color .3s,box-shadow .3s;
}
.input-row input[type="text"]:focus{border-color:var(--cyan);box-shadow:0 0 12px rgba(0,229,255,0.2)}
.input-row input[type="text"]::placeholder{color:var(--dim)}
.meta-row{display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap}
.meta-row select{
  padding:10px 12px;background:var(--surface);border:1px solid var(--border);
  border-radius:10px;color:var(--text);font-family:inherit;font-size:13px;
  outline:none;min-height:44px;cursor:pointer;
}
.meta-row select:focus{border-color:var(--violet)}
.btn{
  padding:12px 20px;border:1px solid var(--border);border-radius:12px;
  color:var(--text);cursor:pointer;font-family:inherit;font-size:13px;
  background:var(--surface);transition:all .25s;min-height:44px;min-width:44px;
  display:inline-flex;align-items:center;justify-content:center;gap:6px;
  user-select:none;-webkit-user-select:none;
}
.btn:hover{border-color:var(--cyan);background:rgba(0,229,255,0.08);color:#fff}
.btn:active{transform:scale(0.96)}
.btn.primary{background:linear-gradient(135deg,rgba(0,229,255,0.2),rgba(124,77,255,0.2));border-color:var(--cyan)}
.btn.primary:hover{background:linear-gradient(135deg,rgba(0,229,255,0.35),rgba(124,77,255,0.35))}
.btn.danger{border-color:var(--fail)}
.btn.danger:hover{background:rgba(255,82,82,0.15)}
.toolbar{display:flex;gap:8px;margin-bottom:20px;flex-wrap:wrap;align-items:center}
.toolbar .spacer{flex:1}
.filter-group{display:flex;gap:4px}
.filter-group .btn{font-size:11px;padding:8px 12px;border-radius:20px}
.filter-group .btn.active{background:rgba(0,229,255,0.15);border-color:var(--cyan);color:#fff}
.task-list{display:flex;flex-direction:column;gap:12px;min-height:60px}
.task{
  background:var(--surface);border:1px solid var(--border);border-radius:16px;
  padding:16px 18px;transition:all .4s ease;position:relative;overflow:hidden;
}
.task::before{
  content:'';position:absolute;top:0;left:0;right:0;bottom:0;
  background:linear-gradient(135deg,transparent 40%,rgba(0,229,255,0.03) 50%,transparent 60%);
  opacity:0;transition:opacity .4s;pointer-events:none;
}
.task.superposition{
  border-color:rgba(0,229,255,0.25);
  animation:qShimmer 3s ease-in-out infinite;
}
.task.superposition::before{opacity:1;animation:waveSweep 4s linear infinite}
@keyframes qShimmer{
  0%,100%{box-shadow:0 0 8px rgba(0,229,255,0.08),inset 0 0 15px rgba(124,77,255,0.04)}
  33%{box-shadow:0 0 16px rgba(224,64,251,0.12),inset 0 0 20px rgba(0,229,255,0.06)}
  66%{box-shadow:0 0 12px rgba(124,77,255,0.1),inset 0 0 18px rgba(224,64,251,0.05)}
}
@keyframes waveSweep{
  0%{background-position:-200% 0}100%{background-position:200% 0}
}
.task.done{
  border-color:rgba(0,230,118,0.3);
  background:linear-gradient(135deg,var(--surface),rgba(0,230,118,0.06));
}
.task.not-done{
  border-color:rgba(255,82,82,0.25);
  background:linear-gradient(135deg,var(--surface),rgba(255,82,82,0.05));
}
.task.tunneling{animation:tunnelFlash .8s ease-out}
@keyframes tunnelFlash{
  0%{box-shadow:0 0 0 rgba(0,229,255,0)}
  30%{box-shadow:0 0 40px rgba(0,229,255,0.6),inset 0 0 30px rgba(124,77,255,0.4)}
  100%{box-shadow:0 0 8px rgba(0,230,118,0.15)}
}
.task.collapsing{animation:collapseWave .6s ease-out}
@keyframes collapseWave{
  0%{transform:scale(1);filter:brightness(1)}
  30%{transform:scale(1.02);filter:brightness(1.8)}
  100%{transform:scale(1);filter:brightness(1)}
}
.task.decaying{animation:decohere 1s ease-out}
@keyframes decohere{
  0%{opacity:1}30%{opacity:0.3}60%{opacity:0.8}100%{opacity:1}
}
.task-top{display:flex;justify-content:space-between;align-items:flex-start;gap:10px;margin-bottom:6px}
.task-title{font-size:15px;color:#e0e4ff;word-break:break-word;flex:1}
.task.done .task-title{text-decoration:line-through;color:rgba(0,230,118,0.7)}
.task.not-done .task-title{color:rgba(255,130,130,0.8)}
.task-badges{display:flex;gap:5px;flex-shrink:0;flex-wrap:wrap;justify-content:flex-end}
.badge{
  font-size:10px;padding:3px 8px;border-radius:10px;
  background:rgba(100,120,255,0.1);border:1px solid rgba(100,120,255,0.2);
  white-space:nowrap;
}
.badge.cat{background:rgba(124,77,255,0.12);border-color:rgba(124,77,255,0.25);color:var(--violet)}
.badge.pri-high{background:rgba(255,82,82,0.12);border-color:rgba(255,82,82,0.25);color:var(--fail)}
.badge.pri-med{background:rgba(255,183,77,0.12);border-color:rgba(255,183,77,0.25);color:#ffb74d}
.badge.entangled{background:rgba(224,64,251,0.12);border-color:rgba(224,64,251,0.3);color:var(--magenta)}
.task-meta{font-size:11px;color:var(--dim);margin-bottom:8px;display:flex;gap:12px;flex-wrap:wrap}
.prob-bar{
  height:8px;background:rgba(255,255,255,0.06);border-radius:4px;
  margin:8px 0;overflow:hidden;position:relative;
}
.prob-fill{
  height:100%;border-radius:4px;transition:width .5s ease;
  background:linear-gradient(90deg,var(--fail),#ffb74d 40%,var(--success));
  position:relative;
}
.prob-fill::after{
  content:'';position:absolute;top:0;right:0;width:30px;height:100%;
  background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3));
  border-radius:4px;
}
.decoherence-bar{height:3px;background:rgba(255,255,255,0.04);border-radius:2px;margin:4px 0 8px;overflow:hidden}
.decoherence-fill{height:100%;background:linear-gradient(90deg,var(--cyan),var(--magenta));border-radius:2px;transition:width .5s}
.task-actions{display:flex;gap:6px;flex-wrap:wrap}
.task-actions .btn{font-size:11px;padding:8px 14px;border-radius:20px}
.empty-state{text-align:center;padding:60px 20px;color:var(--dim)}
.empty-state .icon{font-size:48px;margin-bottom:12px;opacity:0.4}
.empty-state p{font-size:13px;line-height:1.6}
.stats-panel{
  display:grid;grid-template-columns:repeat(auto-fit,minmax(100px,1fr));
  gap:12px;margin:24px 0;
}
.stat-card{
  background:var(--surface);border:1px solid var(--border);border-radius:14px;
  padding:16px 12px;text-align:center;
}
.stat-card .val{font-size:28px;color:#fff;font-weight:bold;line-height:1.2}
.stat-card .lbl{font-size:10px;color:var(--dim);text-transform:uppercase;letter-spacing:1px;margin-top:4px}
.stat-card.coherence .val{color:var(--cyan)}
.stat-card.entropy .val{color:var(--magenta)}
.stat-card.streak .val{color:var(--violet)}
.entropy-meter{
  margin:0 0 20px;padding:14px 18px;background:var(--surface);
  border:1px solid var(--border);border-radius:14px;
}
.entropy-meter .label{font-size:11px;color:var(--dim);margin-bottom:6px;display:flex;justify-content:space-between}
.entropy-bar{height:6px;background:rgba(255,255,255,0.06);border-radius:3px;overflow:hidden}
.entropy-fill{height:100%;border-radius:3px;transition:width .8s,background .8s}
.bottom-bar{
  position:fixed;bottom:0;left:0;right:0;z-index:10;
  background:linear-gradient(transparent,var(--bg) 30%);padding:12px 16px 16px;
  display:flex;justify-content:center;gap:8px;flex-wrap:wrap;
}
.bottom-bar .btn{font-size:11px;padding:10px 16px;backdrop-filter:blur(8px)}
.modal-overlay{
  position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);
  z-index:100;display:none;align-items:center;justify-content:center;padding:20px;
}
.modal-overlay.open{display:flex}
.modal{
  background:var(--bg);border:1px solid var(--border);border-radius:18px;
  padding:24px;max-width:480px;width:100%;max-height:80vh;overflow-y:auto;
}
.modal h2{font-size:18px;color:#fff;margin-bottom:16px}
.modal .close-btn{float:right;cursor:pointer;color:var(--dim);font-size:20px;background:none;border:none}
.shortcuts-list{list-style:none}
.shortcuts-list li{padding:8px 0;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;font-size:13px}
.shortcuts-list kbd{
  background:rgba(100,120,255,0.1);border:1px solid var(--border);
  border-radius:6px;padding:2px 8px;font-family:inherit;font-size:12px;
}
.sound-toggle{position:fixed;top:16px;right:16px;z-index:10}
@media(max-width:600px){
  .app{padding:12px 10px 130px}
  header{padding:20px 0 14px}
  .stats-panel{grid-template-columns:repeat(2,1fr)}
  .task{padding:14px}
  .bottom-bar{gap:4px}
  .bottom-bar .btn{padding:10px 10px;font-size:10px}
}
</style>
</head>
<body>
<canvas id="bg-canvas"></canvas>
<div class="app">
  <header>
    <h1>‚öõ Schr√∂dinger's Todo List</h1>
    <div class="sub">Tasks exist in superposition until observed</div>
  </header>
  <div class="input-row">
    <input type="text" id="task-input" placeholder="Enter quantum task... (use ; to add multiple)">
    <button class="btn primary" id="add-btn" title="Superpose (Enter)">‚äï Superpose</button>
  </div>
  <div class="meta-row">
    <select id="sel-cat">
      <option value="general">General</option>
      <option value="work">Work</option>
      <option value="personal">Personal</option>
      <option value="creative">Creative</option>
      <option value="health">Health</option>
      <option value="learning">Learning</option>
    </select>
    <select id="sel-pri">
      <option value="medium">Medium Priority</option>
      <option value="high">High Priority</option>
      <option value="low">Low Priority</option>
    </select>
    <button class="btn" id="entangle-btn" title="Entangle last 2 tasks">‚ßñ Entangle</button>
  </div>
  <div class="entropy-meter">
    <div class="label"><span>System Entropy</span><span id="entropy-val">0%</span></div>
    <div class="entropy-bar"><div class="entropy-fill" id="entropy-fill" style="width:0%;background:var(--cyan)"></div></div>
  </div>
  <div class="toolbar">
    <div class="filter-group">
      <button class="btn active" data-filter="all">All</button>
      <button class="btn" data-filter="superposition">‚äï Superposed</button>
      <button class="btn" data-filter="done">‚úì Done</button>
      <button class="btn" data-filter="not-done">‚úó Not Done</button>
    </div>
    <div class="spacer"></div>
    <button class="btn" id="collapse-all-btn" title="Collapse All">‚ö° Collapse All</button>
  </div>
  <div class="task-list" id="task-list"></div>
  <div class="stats-panel">
    <div class="stat-card"><div class="val" id="s-super">0</div><div class="lbl">Superposed</div></div>
    <div class="stat-card"><div class="val" id="s-done">0</div><div class="lbl">Collapsed ‚úì</div></div>
    <div class="stat-card"><div class="val" id="s-not">0</div><div class="lbl">Collapsed ‚úó</div></div>
    <div class="stat-card coherence"><div class="val" id="s-coherence">100%</div><div class="lbl">Coherence</div></div>
    <div class="stat-card entropy"><div class="val" id="s-obs">0</div><div class="lbl">Observations</div></div>
    <div class="stat-card streak"><div class="val" id="s-streak">0</div><div class="lbl">Streak üî•</div></div>
    <div class="stat-card"><div class="val" id="s-rate">-</div><div class="lbl">Success Rate</div></div>
    <div class="stat-card"><div class="val" id="s-tunnel">0</div><div class="lbl">Tunneled</div></div>
  </div>
</div>
<button class="btn sound-toggle" id="sound-toggle" title="Toggle Sound">üîä</button>
<div class="bottom-bar">
  <button class="btn" id="export-btn">üì§ Export</button>
  <button class="btn" id="import-btn">üì• Import</button>
  <button class="btn" id="shortcuts-btn">‚å® Keys</button>
  <button class="btn danger" id="clear-done-btn">üóë Clear Done</button>
</div>
<input type="file" id="import-file" accept=".json" style="display:none">
<div class="modal-overlay" id="shortcuts-modal">
  <div class="modal">
    <button class="close-btn" id="close-modal">&times;</button>
    <h2>Keyboard Shortcuts</h2>
    <ul class="shortcuts-list">
      <li><span>Focus input</span><kbd>/</kbd></li>
      <li><span>Add task</span><kbd>Enter</kbd></li>
      <li><span>Clear input</span><kbd>Escape</kbd></li>
      <li><span>Collapse all</span><kbd>Ctrl+Shift+C</kbd></li>
      <li><span>Toggle sound</span><kbd>M</kbd></li>
      <li><span>Export</span><kbd>Ctrl+E</kbd></li>
    </ul>
  </div>
</div>
<script>
(function(){
"use strict";
var DECOHERENCE_MS = 300000;
var TUNNEL_CHANCE = 0.003;
var INTERFERENCE_RANGE = 0.06;
var audioCtx = null;
var soundEnabled = true;
var ambientOsc = null;
var ambientGain = null;
var tasks = [];
var idCounter = 0;
var stats = {observations:0,successes:0,streak:0,bestStreak:0,tunneled:0};
var activeFilter = 'all';

function initAudio(){
  if(audioCtx) return;
  try{
    audioCtx = new (window.AudioContext||window.webkitAudioContext)();
    ambientGain = audioCtx.createGain();
    ambientGain.gain.value = 0;
    ambientGain.connect(audioCtx.destination);
    ambientOsc = audioCtx.createOscillator();
    ambientOsc.type = 'sine';
    ambientOsc.frequency.value = 60;
    var f2 = audioCtx.createBiquadFilter();
    f2.type = 'lowpass';
    f2.frequency.value = 120;
    ambientOsc.connect(f2);
    f2.connect(ambientGain);
    ambientOsc.start();
  }catch(e){}
}

function playTone(freq, dur, type, vol){
  if(!soundEnabled||!audioCtx) return;
  try{
    var o = audioCtx.createOscillator();
    var g = audioCtx.createGain();
    o.type = type||'sine';
    o.frequency.value = freq;
    g.gain.value = vol||0.08;
    g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime+dur);
    o.connect(g);g.connect(audioCtx.destination);
    o.start();o.stop(audioCtx.currentTime+dur);
  }catch(e){}
}

function playCollapse(success){
  if(!soundEnabled||!audioCtx) return;
  if(success){
    playTone(523,0.1,'sine',0.1);
    setTimeout(function(){playTone(659,0.1,'sine',0.1)},80);
    setTimeout(function(){playTone(784,0.2,'sine',0.12)},160);
  }else{
    playTone(330,0.15,'sawtooth',0.06);
    setTimeout(function(){playTone(262,0.3,'sawtooth',0.05)},120);
  }
}

function playBoost(){playTone(880,0.12,'sine',0.06);setTimeout(function(){playTone(1047,0.1,'sine',0.05)},60)}
function playTunnel(){playTone(1200,0.05,'sine',0.1);setTimeout(function(){playTone(1600,0.08,'sine',0.08)},40);setTimeout(function(){playTone(2000,0.15,'sine',0.06)},80)}
function playHum(freq){if(!soundEnabled||!audioCtx)return;playTone(freq||220,0.3,'sine',0.02)}

function updateAmbient(){
  if(!audioCtx||!ambientGain||!soundEnabled) return;
  var sup = tasks.filter(function(t){return t.state==='superposition'}).length;
  var total = tasks.length||1;
  var coherence = sup/total;
  var targetVol = coherence*0.03;
  var targetFreq = 50+coherence*40;
  try{
    ambientGain.gain.linearRampToValueAtTime(targetVol,audioCtx.currentTime+1);
    ambientOsc.frequency.linearRampToValueAtTime(targetFreq,audioCtx.currentTime+1);
  }catch(e){}
}

function migrateTask(raw){
  return {
    id: raw.id !== undefined ? raw.id : idCounter++,
    title: raw.title || 'Untitled',
    state: raw.state || 'superposition',
    prob: raw.prob !== undefined ? raw.prob : 0.5,
    created: raw.created || Date.now(),
    category: raw.category || 'general',
    priority: raw.priority || 'medium',
    entangledWith: raw.entangledWith || null,
    lastObserved: raw.lastObserved || null,
    boosted: raw.boosted || 0
  };
}

function save(){
  var data = {tasks:tasks,idCounter:idCounter,stats:stats,version:2};
  localStorage.setItem('qtodo',JSON.stringify(data));
}

function load(){
  var s = localStorage.getItem('qtodo');
  if(!s) return;
  try{
    var d = JSON.parse(s);
    if(Array.isArray(d)){
      tasks = d.map(migrateTask);
      idCounter = tasks.reduce(function(mx,t){return Math.max(mx,t.id)},0)+1;
    } else {
      tasks = (d.tasks||[]).map(migrateTask);
      idCounter = d.idCounter||0;
      if(d.stats){
        stats.observations = d.stats.observations||0;
        stats.successes = d.stats.successes||0;
        stats.streak = d.stats.streak||0;
        stats.bestStreak = d.stats.bestStreak||0;
        stats.tunneled = d.stats.tunneled||0;
      }
    }
    if(idCounter <= 0 && tasks.length){
      idCounter = tasks.reduce(function(mx,t){return Math.max(mx,t.id)},0)+1;
    }
  }catch(e){tasks=[];idCounter=0;}
}

function addTask(title,cat,pri){
  var basePr = pri==='high'?0.65:(pri==='low'?0.35:0.5);
  var t = {
    id:idCounter++, title:title, state:'superposition',
    prob:basePr, created:Date.now(), category:cat||'general',
    priority:pri||'medium', entangledWith:null, lastObserved:null, boosted:0
  };
  tasks.push(t);
  return t;
}

function entangleLast(){
  var sup = tasks.filter(function(t){return t.state==='superposition'});
  if(sup.length<2) return;
  var a = sup[sup.length-2], b = sup[sup.length-1];
  a.entangledWith = b.id;
  b.entangledWith = a.id;
  playTone(440,0.15,'sine',0.06);
  setTimeout(function(){playTone(440,0.15,'sine',0.06)},100);
  render();save();
}

function applyInterference(){
  var sup = tasks.filter(function(t){return t.state==='superposition'});
  for(var i=0;i<sup.length;i++){
    for(var j=i+1;j<sup.length;j++){
      if(sup[i].category===sup[j].category){
        var delta = (Math.random()-0.5)*INTERFERENCE_RANGE;
        sup[i].prob = clamp(sup[i].prob+delta,0.05,0.95);
        sup[j].prob = clamp(sup[j].prob-delta,0.05,0.95);
      }
    }
  }
}

function clamp(v,lo,hi){return Math.max(lo,Math.min(hi,v))}

function observeTask(id){
  var t = tasks.find(function(x){return x.id===id});
  if(!t||t.state!=='superposition') return;
  initAudio();
  var success = Math.random()<t.prob;
  t.state = success?'done':'not-done';
  t.lastObserved = Date.now();
  stats.observations++;
  if(success){stats.successes++;stats.streak++}
  else{stats.streak=0}
  if(stats.streak>stats.bestStreak) stats.bestStreak=stats.streak;
  playCollapse(success);
  if(t.entangledWith!==null){
    var partner = tasks.find(function(x){return x.id===t.entangledWith});
    if(partner&&partner.state==='superposition'){
      partner.prob = clamp(partner.prob+(success?0.15:-0.15),0.05,0.95);
    }
  }
  var el = document.querySelector('[data-id="'+id+'"]');
  if(el){el.classList.add('collapsing');setTimeout(function(){el.classList.remove('collapsing')},600)}
  render();save();updateAmbient();
}

function boostTask(id){
  var t = tasks.find(function(x){return x.id===id});
  if(!t||t.state!=='superposition') return;
  initAudio();
  t.prob = clamp(t.prob+0.12,0.05,0.95);
  t.boosted++;
  playBoost();
  render();save();
}

function deleteTask(id){
  tasks = tasks.filter(function(x){return x.id!==id});
  tasks.forEach(function(t){if(t.entangledWith===id)t.entangledWith=null});
  render();save();updateAmbient();
}

function collapseAll(){
  var sup = tasks.filter(function(t){return t.state==='superposition'});
  if(!sup.length) return;
  initAudio();
  var delay = 0;
  sup.forEach(function(t){
    setTimeout(function(){observeTask(t.id)},delay);
    delay += 150;
  });
}

function clearDone(){
  tasks = tasks.filter(function(t){return t.state==='superposition'});
  render();save();updateAmbient();
}

function checkTunneling(){
  tasks.forEach(function(t){
    if(t.state!=='superposition') return;
    if(Math.random()<TUNNEL_CHANCE){
      t.state='done';
      t.lastObserved=Date.now();
      stats.tunneled++;
      stats.observations++;
      stats.successes++;
      stats.streak++;
      if(stats.streak>stats.bestStreak) stats.bestStreak=stats.streak;
      playTunnel();
      var el = document.querySelector('[data-id="'+t.id+'"]');
      if(el){el.classList.add('tunneling');setTimeout(function(){el.classList.remove('tunneling')},800)}
      save();
    }
  });
}

function checkDecoherence(){
  var now = Date.now();
  tasks.forEach(function(t){
    if(t.state!=='superposition') return;
    var age = now - t.created;
    if(age > DECOHERENCE_MS){
      t.state = Math.random()<t.prob?'done':'not-done';
      t.lastObserved = now;
      stats.observations++;
      if(t.state==='done'){stats.successes++;stats.streak++}else{stats.streak=0}
      if(stats.streak>stats.bestStreak) stats.bestStreak=stats.streak;
      playTone(200,0.4,'triangle',0.04);
      var el = document.querySelector('[data-id="'+t.id+'"]');
      if(el){el.classList.add('decaying');setTimeout(function(){el.classList.remove('decaying')},1000)}
      save();
    }
  });
}

function probFluctuation(){
  tasks.forEach(function(t){
    if(t.state!=='superposition') return;
    t.prob += (Math.random()-0.5)*0.015;
    t.prob = clamp(t.prob,0.05,0.95);
  });
  applyInterference();
}

function esc(s){
  var d=document.createElement('div');d.textContent=s;return d.innerHTML;
}

function formatTime(ms){
  var s=Math.floor(ms/1000),m=Math.floor(s/60);s=s%60;
  return m+'m '+s+'s';
}

function render(){
  var list = document.getElementById('task-list');
  var filtered = tasks.filter(function(t){
    if(activeFilter==='all') return true;
    return t.state===activeFilter;
  });
  if(!filtered.length){
    list.innerHTML = '<div class="empty-state"><div class="icon">‚öõ</div><p>'+
      (tasks.length?'No tasks match this filter.':'No tasks yet.<br>Add a quantum task above to begin observing reality.')+'</p></div>';
    updateStats();
    return;
  }
  var now = Date.now();
  var html = '';
  filtered.forEach(function(t){
    var pct = Math.round(t.prob*100);
    var cls = t.state==='superposition'?'superposition':t.state;
    var priCls = t.priority==='high'?'pri-high':(t.priority==='medium'?'pri-med':'');
    var decoRatio = t.state==='superposition'?clamp((now-t.created)/DECOHERENCE_MS,0,1):0;
    var decoTime = t.state==='superposition'?Math.max(0,DECOHERENCE_MS-(now-t.created)):0;
    html += '<div class="task '+cls+'" data-id="'+t.id+'">';
    html += '<div class="task-top">';
    html += '<div class="task-title">'+esc(t.title)+'</div>';
    html += '<div class="task-badges">';
    html += '<span class="badge cat">'+esc(t.category)+'</span>';
    if(t.priority!=='medium') html += '<span class="badge '+priCls+'">'+t.priority+'</span>';
    if(t.entangledWith!==null) html += '<span class="badge entangled">‚ßñ entangled</span>';
    html += '</div></div>';
    if(t.state==='superposition'){
      html += '<div class="task-meta">';
      html += '<span>œà probability: '+pct+'%</span>';
      html += '<span>coherence: '+formatTime(decoTime)+'</span>';
      if(t.boosted) html += '<span>boosted √ó'+t.boosted+'</span>';
      html += '</div>';
      html += '<div class="prob-bar"><div class="prob-fill" style="width:'+pct+'%"></div></div>';
      html += '<div class="decoherence-bar"><div class="decoherence-fill" style="width:'+Math.round(decoRatio*100)+'%"></div></div>';
      html += '<div class="task-actions">';
      html += '<button class="btn primary" onclick="Q.observe('+t.id+')" onmouseenter="Q.hum('+t.id+')">üëÅ Observe</button>';
      html += '<button class="btn" onclick="Q.boost('+t.id+')">‚ö° Boost</button>';
      html += '<button class="btn danger" onclick="Q.del('+t.id+')">‚úï</button>';
      html += '</div>';
    } else {
      html += '<div class="task-meta">';
      html += '<span>state: '+(t.state==='done'?'‚úì collapsed done':'‚úó collapsed not-done')+'</span>';
      if(t.lastObserved) html += '<span>observed: '+new Date(t.lastObserved).toLocaleString()+'</span>';
      html += '</div>';
      html += '<div class="task-actions">';
      html += '<button class="btn danger" onclick="Q.del('+t.id+')">‚úï Remove</button>';
      html += '</div>';
    }
    html += '</div>';
  });
  list.innerHTML = html;
  updateStats();
}

function updateStats(){
  var sup = tasks.filter(function(t){return t.state==='superposition'}).length;
  var done = tasks.filter(function(t){return t.state==='done'}).length;
  var notd = tasks.filter(function(t){return t.state==='not-done'}).length;
  var total = tasks.length||1;
  var coherence = Math.round((sup/total)*100);
  var rate = stats.observations?Math.round((stats.successes/stats.observations)*100)+'%':'-';
  var entropy = total>0?Math.round(((done+notd)/total)*50 + Math.min(50,tasks.length*2)):0;
  entropy = Math.min(100,entropy);
  document.getElementById('s-super').textContent = sup;
  document.getElementById('s-done').textContent = done;
  document.getElementById('s-not').textContent = notd;
  document.getElementById('s-coherence').textContent = coherence+'%';
  document.getElementById('s-obs').textContent = stats.observations;
  document.getElementById('s-streak').textContent = stats.streak;
  document.getElementById('s-rate').textContent = rate;
  document.getElementById('s-tunnel').textContent = stats.tunneled;
  document.getElementById('entropy-val').textContent = entropy+'%';
  var ef = document.getElementById('entropy-fill');
  ef.style.width = entropy+'%';
  if(entropy<30) ef.style.background='var(--cyan)';
  else if(entropy<60) ef.style.background='linear-gradient(90deg,var(--cyan),var(--violet))';
  else if(entropy<80) ef.style.background='linear-gradient(90deg,var(--violet),var(--magenta))';
  else ef.style.background='var(--fail)';
}

function doExport(){
  var data = {tasks:tasks,idCounter:idCounter,stats:stats,version:2};
  var blob = new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  var a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'quantum-todos.json';
  a.click();
  URL.revokeObjectURL(a.href);
}

function doImport(){document.getElementById('import-file').click()}

document.getElementById('import-file').addEventListener('change',function(e){
  var f = e.target.files[0];
  if(!f) return;
  var r = new FileReader();
  r.onload = function(ev){
    try{
      var d = JSON.parse(ev.target.result);
      if(Array.isArray(d)){
        tasks = d.map(migrateTask);
        idCounter = tasks.reduce(function(mx,t){return Math.max(mx,t.id)},0)+1;
      } else {
        tasks = (d.tasks||[]).map(migrateTask);
        idCounter = d.idCounter||0;
        if(d.stats) Object.assign(stats,d.stats);
      }
      render();save();updateAmbient();
    }catch(err){}
  };
  r.readAsText(f);
  e.target.value='';
});

document.getElementById('add-btn').addEventListener('click',function(){
  var inp = document.getElementById('task-input');
  var val = inp.value.trim();
  if(!val) return;
  initAudio();
  var cat = document.getElementById('sel-cat').value;
  var pri = document.getElementById('sel-pri').value;
  var parts = val.split(';').map(function(s){return s.trim()}).filter(Boolean);
  parts.forEach(function(p){addTask(p,cat,pri)});
  inp.value = '';
  playTone(660,0.08,'sine',0.05);
  render();save();updateAmbient();
});

document.getElementById('task-input').addEventListener('keydown',function(e){
  if(e.key==='Enter'){document.getElementById('add-btn').click();e.preventDefault()}
  if(e.key==='Escape'){this.value='';this.blur()}
});

document.getElementById('entangle-btn').addEventListener('click',entangleLast);
document.getElementById('collapse-all-btn').addEventListener('click',collapseAll);
document.getElementById('clear-done-btn').addEventListener('click',clearDone);
document.getElementById('export-btn').addEventListener('click',doExport);
document.getElementById('import-btn').addEventListener('click',doImport);

document.getElementById('sound-toggle').addEventListener('click',function(){
  soundEnabled=!soundEnabled;
  this.textContent=soundEnabled?'üîä':'üîá';
  if(soundEnabled){initAudio();updateAmbient()}
  else if(ambientGain){try{ambientGain.gain.linearRampToValueAtTime(0,audioCtx.currentTime+0.5)}catch(e){}}
});

document.getElementById('shortcuts-btn').addEventListener('click',function(){
  document.getElementById('shortcuts-modal').classList.add('open');
});
document.getElementById('close-modal').addEventListener('click',function(){
  document.getElementById('shortcuts-modal').classList.remove('open');
});
document.getElementById('shortcuts-modal').addEventListener('click',function(e){
  if(e.target===this) this.classList.remove('open');
});

document.querySelectorAll('.filter-group .btn').forEach(function(btn){
  btn.addEventListener('click',function(){
    document.querySelectorAll('.filter-group .btn').forEach(function(b){b.classList.remove('active')});
    this.classList.add('active');
    activeFilter = this.getAttribute('data-filter');
    render();
  });
});

document.addEventListener('keydown',function(e){
  if(e.target.tagName==='INPUT'||e.target.tagName==='SELECT'||e.target.tagName==='TEXTAREA') return;
  if(e.key==='/'){e.preventDefault();document.getElementById('task-input').focus()}
  if(e.key==='m'||e.key==='M'){document.getElementById('sound-toggle').click()}
  if(e.ctrlKey&&e.shiftKey&&e.key==='C'){e.preventDefault();collapseAll()}
  if(e.ctrlKey&&(e.key==='e'||e.key==='E')){e.preventDefault();doExport()}
  if(e.key==='Escape'){document.getElementById('shortcuts-modal').classList.remove('open')}
});

/* Particle background */
var canvas = document.getElementById('bg-canvas');
var ctx = canvas.getContext('2d');
var particles = [];
var PARTICLE_COUNT = 60;

function resizeCanvas(){canvas.width=window.innerWidth;canvas.height=window.innerHeight}
window.addEventListener('resize',resizeCanvas);
resizeCanvas();

function createParticle(){
  return {
    x:Math.random()*canvas.width,
    y:Math.random()*canvas.height,
    vx:(Math.random()-0.5)*0.3,
    vy:(Math.random()-0.5)*0.3,
    r:Math.random()*2+0.5,
    hue:180+Math.random()*120,
    alpha:Math.random()*0.4+0.1,
    phase:Math.random()*Math.PI*2
  };
}
for(var i=0;i<PARTICLE_COUNT;i++) particles.push(createParticle());

function drawParticles(time){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(var i=0;i<particles.length;i++){
    var p=particles[i];
    p.x+=p.vx;p.y+=p.vy;
    if(p.x<0)p.x=canvas.width;if(p.x>canvas.width)p.x=0;
    if(p.y<0)p.y=canvas.height;if(p.y>canvas.height)p.y=0;
    var pulse = Math.sin(time*0.001+p.phase)*0.3+0.7;
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.r*pulse,0,Math.PI*2);
    ctx.fillStyle='hsla('+p.hue+',80%,70%,'+(p.alpha*pulse)+')';
    ctx.fill();
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.r*pulse*3,0,Math.PI*2);
    ctx.fillStyle='hsla('+p.hue+',80%,70%,'+(p.alpha*pulse*0.1)+')';
    ctx.fill();
  }
  for(var i=0;i<particles.length;i++){
    for(var j=i+1;j<particles.length;j++){
      var dx=particles[i].x-particles[j].x;
      var dy=particles[i].y-particles[j].y;
      var dist=Math.sqrt(dx*dx+dy*dy);
      if(dist<120){
        ctx.beginPath();
        ctx.moveTo(particles[i].x,particles[i].y);
        ctx.lineTo(particles[j].x,particles[j].y);
        ctx.strokeStyle='rgba(100,180,255,'+(0.04*(1-dist/120))+')';
        ctx.lineWidth=0.5;
        ctx.stroke();
      }
    }
  }
  requestAnimationFrame(drawParticles);
}
requestAnimationFrame(drawParticles);

/* Expose global API for onclick handlers */
window.Q = {
  observe:observeTask,
  boost:boostTask,
  del:deleteTask,
  hum:function(id){
    var t = tasks.find(function(x){return x.id===id});
    if(t&&t.state==='superposition') playHum(200+t.prob*200);
  }
};

/* Tick loop */
function tick(){
  probFluctuation();
  checkTunneling();
  checkDecoherence();
  render();
  updateAmbient();
}

load();
render();
setInterval(tick,5000);

})();
</script>
</body>
</html>