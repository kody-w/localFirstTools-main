<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Senbazuru Sanctuary</title>
    <meta name="description" content="Fold virtual paper cranes in sync with your breath, each carrying a wish to join a flock of 1,000">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: linear-gradient(180deg, #1a2a3a 0%, #2a3a4a 100%); min-height: 100vh; font-family: Georgia, serif; color: #c0d0e0; overflow: hidden; }
        #canvas { position: fixed; top: 0; left: 0; }
        #fold-area {
            position: fixed; bottom: 50px; left: 50%; transform: translateX(-50%);
            width: 300px; height: 300px; background: rgba(255,250,245,0.95);
            border-radius: 10px; box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        #fold-canvas { width: 100%; height: 100%; }
        #controls {
            position: fixed; top: 20px; left: 20px; background: rgba(20,30,40,0.9);
            padding: 20px; border-radius: 10px; border: 1px solid rgba(150,180,200,0.3);
        }
        h3 { margin-bottom: 15px; color: #d0e0f0; font-size: 16px; }
        #wish-input {
            width: 200px; padding: 10px; background: rgba(40,50,60,0.8);
            border: 1px solid rgba(150,180,200,0.3); color: #c0d0e0;
            border-radius: 5px; font-family: Georgia, serif;
        }
        button {
            display: block; width: 100%; padding: 10px; margin: 10px 0;
            background: rgba(80,100,120,0.4); border: 1px solid rgba(150,180,200,0.4);
            color: #c0d0e0; cursor: pointer; border-radius: 8px; font-family: Georgia, serif;
        }
        #stats {
            position: fixed; top: 20px; right: 20px; background: rgba(20,30,40,0.9);
            padding: 20px; border-radius: 10px; border: 1px solid rgba(150,180,200,0.3);
            text-align: center;
        }
        .stat-value { font-size: 48px; color: #e0f0ff; }
        .stat-label { font-size: 12px; opacity: 0.7; }
        #breath-guide {
            position: fixed; bottom: 380px; left: 50%; transform: translateX(-50%);
            text-align: center; font-size: 14px; opacity: 0.7;
        }
        #breath-circle {
            width: 60px; height: 60px; border: 2px solid rgba(200,220,255,0.5);
            border-radius: 50%; margin: 10px auto; transition: transform 4s ease-in-out;
        }
        #breath-circle.inhale { transform: scale(1.5); }
        .fold-instruction { text-align: center; padding: 20px; font-size: 14px; color: #666; }
        #progress-bar {
            position: absolute; bottom: 0; left: 0; right: 0; height: 5px;
            background: rgba(0,0,0,0.1);
        }
        #progress-fill { height: 100%; background: linear-gradient(90deg, #ff9999, #ffcc99, #99ccff); width: 0%; transition: width 0.3s; }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div id="controls">
        <h3>Make a Wish</h3>
        <input type="text" id="wish-input" placeholder="Enter your wish...">
        <button id="fold-btn">Begin Folding</button>
        <button id="release-btn">Release Crane</button>
    </div>
    <div id="stats">
        <div class="stat-value" id="crane-count">0</div>
        <div class="stat-label">of 1,000 cranes</div>
    </div>
    <div id="breath-guide">
        <div>Breathe with the circle</div>
        <div id="breath-circle"></div>
        <div id="breath-text">Inhale...</div>
    </div>
    <div id="fold-area">
        <canvas id="fold-canvas"></canvas>
        <div class="fold-instruction" id="fold-instruction">Click to fold along the dotted lines</div>
        <div id="progress-bar"><div id="progress-fill"></div></div>
    </div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const foldCanvas = document.getElementById('fold-canvas');
        const foldCtx = foldCanvas.getContext('2d');
        let W, H;
        function resize() {
            W = canvas.width = innerWidth;
            H = canvas.height = innerHeight;
            foldCanvas.width = 300;
            foldCanvas.height = 300;
        }
        resize(); window.onresize = resize;

        let cranes = [];
        let foldProgress = 0;
        let currentWish = '';
        let folding = false;
        let breathPhase = 0;

        class Crane {
            constructor(wish) {
                this.x = W / 2;
                this.y = H - 400;
                this.wish = wish;
                this.angle = 0;
                this.wingAngle = 0;
                this.vx = (Math.random() - 0.5) * 2;
                this.vy = -1 - Math.random();
                this.size = 15 + Math.random() * 10;
                this.hue = Math.random() * 60 + 330;
                this.joined = false;
            }
            update() {
                if (!this.joined) {
                    this.x += this.vx;
                    this.y += this.vy;
                    this.angle = Math.atan2(this.vy, this.vx);
                    this.wingAngle = Math.sin(Date.now() * 0.01) * 0.3;
                    if (this.y < H * 0.3) {
                        this.joined = true;
                        this.targetX = 100 + Math.random() * (W - 200);
                        this.targetY = 50 + Math.random() * (H * 0.25);
                    }
                } else {
                    this.x += (this.targetX - this.x) * 0.02;
                    this.y += (this.targetY - this.y) * 0.02;
                    this.x += Math.sin(Date.now() * 0.001 + this.targetX) * 0.5;
                    this.y += Math.cos(Date.now() * 0.001 + this.targetY) * 0.3;
                    this.wingAngle = Math.sin(Date.now() * 0.005) * 0.2;
                }
            }
            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.joined ? 0 : this.angle - Math.PI / 2);
                ctx.fillStyle = "hsl(" + this.hue + ", 70%, 80%)";
                ctx.beginPath();
                ctx.moveTo(0, -this.size);
                ctx.lineTo(-this.size * 0.3, this.size * 0.3);
                ctx.lineTo(0, 0);
                ctx.lineTo(this.size * 0.3, this.size * 0.3);
                ctx.closePath();
                ctx.fill();
                ctx.save();
                ctx.rotate(this.wingAngle);
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.lineTo(-this.size, -this.size * 0.3);
                ctx.lineTo(-this.size * 0.5, 0);
                ctx.closePath();
                ctx.fill();
                ctx.restore();
                ctx.save();
                ctx.rotate(-this.wingAngle);
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.lineTo(this.size, -this.size * 0.3);
                ctx.lineTo(this.size * 0.5, 0);
                ctx.closePath();
                ctx.fill();
                ctx.restore();
                ctx.restore();
            }
        }

        function drawFoldPaper() {
            foldCtx.fillStyle = '#fff';
            foldCtx.fillRect(0, 0, 300, 300);
            foldCtx.strokeStyle = 'rgba(0,0,0,0.2)';
            foldCtx.setLineDash([5, 5]);
            foldCtx.lineWidth = 1;
            if (foldProgress < 25) {
                foldCtx.beginPath();
                foldCtx.moveTo(0, 0);
                foldCtx.lineTo(300, 300);
                foldCtx.stroke();
            } else if (foldProgress < 50) {
                foldCtx.beginPath();
                foldCtx.moveTo(300, 0);
                foldCtx.lineTo(0, 300);
                foldCtx.stroke();
            } else if (foldProgress < 75) {
                foldCtx.beginPath();
                foldCtx.moveTo(150, 0);
                foldCtx.lineTo(150, 300);
                foldCtx.stroke();
            } else {
                foldCtx.setLineDash([]);
                foldCtx.fillStyle = "hsl(" + (Math.random() * 60 + 330) + ", 70%, 85%)";
                foldCtx.beginPath();
                foldCtx.moveTo(150, 50);
                foldCtx.lineTo(100, 150);
                foldCtx.lineTo(150, 130);
                foldCtx.lineTo(200, 150);
                foldCtx.closePath();
                foldCtx.fill();
                foldCtx.beginPath();
                foldCtx.moveTo(50, 150);
                foldCtx.lineTo(150, 130);
                foldCtx.lineTo(150, 200);
                foldCtx.closePath();
                foldCtx.fill();
                foldCtx.beginPath();
                foldCtx.moveTo(250, 150);
                foldCtx.lineTo(150, 130);
                foldCtx.lineTo(150, 200);
                foldCtx.closePath();
                foldCtx.fill();
            }
            document.getElementById('progress-fill').style.width = foldProgress + '%';
            const instructions = ['Fold corner to corner', 'Fold the other diagonal', 'Create center crease', 'Shape the wings'];
            document.getElementById('fold-instruction').textContent = instructions[Math.floor(foldProgress / 25)] || 'Crane complete!';
        }

        function animateBreath() {
            breathPhase = (breathPhase + 1) % 200;
            const circle = document.getElementById('breath-circle');
            const text = document.getElementById('breath-text');
            if (breathPhase < 100) {
                circle.classList.add('inhale');
                text.textContent = 'Inhale...';
            } else {
                circle.classList.remove('inhale');
                text.textContent = 'Exhale...';
            }
        }

        function animate() {
            ctx.fillStyle = 'rgba(26, 42, 58, 0.1)';
            ctx.fillRect(0, 0, W, H);
            for (let i = 0; i < 3; i++) {
                ctx.beginPath();
                ctx.arc(Math.random() * W, Math.random() * H * 0.5, 0.5, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(255,255,255,0.2)';
                ctx.fill();
            }
            cranes.forEach(c => { c.update(); c.draw(); });
            document.getElementById('crane-count').textContent = cranes.length;
            animateBreath();
            requestAnimationFrame(animate);
        }

        foldCanvas.onclick = () => {
            if (folding && foldProgress < 100) {
                foldProgress += 12.5;
                drawFoldPaper();
            }
        };

        document.getElementById('fold-btn').onclick = () => {
            currentWish = document.getElementById('wish-input').value || 'A silent wish';
            foldProgress = 0;
            folding = true;
            drawFoldPaper();
        };

        document.getElementById('release-btn').onclick = () => {
            if (foldProgress >= 100) {
                cranes.push(new Crane(currentWish));
                foldProgress = 0;
                folding = false;
                document.getElementById('wish-input').value = '';
                drawFoldPaper();
                localStorage.setItem('senbazuru', JSON.stringify(cranes.length));
            }
        };

        const savedCount = localStorage.getItem('senbazuru');
        if (savedCount) {
            for (let i = 0; i < parseInt(savedCount); i++) {
                const c = new Crane('Saved wish');
                c.joined = true;
                c.x = c.targetX = 100 + Math.random() * (W - 200);
                c.y = c.targetY = 50 + Math.random() * (H * 0.25);
                cranes.push(c);
            }
        }

        drawFoldPaper();
        animate();
    </script>
</body>
</html>