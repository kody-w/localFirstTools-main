<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CryptoZoo Network â€” ZooCoin Blockchain</title>
<meta name="description" content="A local-first cryptocurrency network simulator. Mine ZooCoin, send transactions, explore the blockchain â€” all offline, all in your browser.">
<meta name="rappterzoo:author" content="Claude Opus 4.6">
<meta name="rappterzoo:author-type" content="agent">
<meta name="rappterzoo:category" content="experimental-ai">
<meta name="rappterzoo:tags" content="blockchain,cryptocurrency,mining,simulation,wallet,p2p,datazoo">
<meta name="rappterzoo:type" content="interactive">
<meta name="rappterzoo:complexity" content="advanced">
<meta name="rappterzoo:created" content="2026-02-08">
<meta name="rappterzoo:generation" content="1">
<style>
:root {
  --bg: #0a0a12; --bg2: #12121f; --bg3: #1a1a2e;
  --text: #e0e0e0; --dim: #888; --accent: #00e5ff;
  --accent2: #7c4dff; --gold: #ffd700; --green: #00e676;
  --red: #ff5252; --orange: #ff9100;
  --radius: 6px; --glow: 0 0 20px rgba(0,229,255,0.15);
}
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'Courier New',monospace; background:var(--bg); color:var(--text); min-height:100vh; }
::-webkit-scrollbar { width:6px; } ::-webkit-scrollbar-track { background:var(--bg2); } ::-webkit-scrollbar-thumb { background:var(--accent2); border-radius:3px; }

.topbar { position:fixed; top:0; left:0; right:0; height:52px; background:var(--bg2); border-bottom:1px solid #222; display:flex; align-items:center; padding:0 16px; z-index:100; gap:12px; }
.topbar .logo { font-size:20px; font-weight:bold; color:var(--accent); letter-spacing:1px; }
.topbar .logo span { color:var(--gold); }
.topbar .net-stats { margin-left:auto; display:flex; gap:16px; font-size:12px; color:var(--dim); }
.topbar .net-stats b { color:var(--accent); }

.app-wrap { display:flex; margin-top:52px; min-height:calc(100vh - 52px); }
.sidebar { width:240px; min-width:240px; background:var(--bg2); border-right:1px solid #222; padding:12px; overflow-y:auto; }
.main { flex:1; padding:16px; overflow-y:auto; max-height:calc(100vh - 52px); }

.nav-btn { display:block; width:100%; padding:10px 12px; margin-bottom:4px; background:none; border:none; color:var(--dim); font-family:inherit; font-size:13px; text-align:left; cursor:pointer; border-radius:var(--radius); transition:all .15s; }
.nav-btn:hover { background:var(--bg3); color:var(--text); }
.nav-btn.active { background:var(--bg3); color:var(--accent); border-left:3px solid var(--accent); }
.nav-btn .icon { margin-right:8px; }

.section-title { font-size:10px; text-transform:uppercase; letter-spacing:2px; color:var(--dim); padding:12px 12px 6px; }

.card { background:var(--bg2); border:1px solid #222; border-radius:var(--radius); padding:16px; margin-bottom:12px; }
.card:hover { border-color:var(--accent2); box-shadow:var(--glow); }
.card h3 { font-size:14px; color:var(--accent); margin-bottom:8px; }
.card p { font-size:12px; color:var(--dim); line-height:1.5; }

.stat-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(160px,1fr)); gap:12px; margin-bottom:16px; }
.stat-box { background:var(--bg2); border:1px solid #222; border-radius:var(--radius); padding:14px; text-align:center; }
.stat-box .val { font-size:24px; font-weight:bold; color:var(--accent); }
.stat-box .label { font-size:10px; color:var(--dim); text-transform:uppercase; letter-spacing:1px; margin-top:4px; }

.btn { padding:8px 16px; border:none; border-radius:var(--radius); font-family:inherit; font-size:12px; cursor:pointer; transition:all .15s; }
.btn-primary { background:var(--accent); color:#000; font-weight:bold; }
.btn-primary:hover { filter:brightness(1.2); box-shadow:0 0 15px rgba(0,229,255,0.4); }
.btn-secondary { background:var(--bg3); color:var(--text); border:1px solid #333; }
.btn-secondary:hover { border-color:var(--accent); }
.btn-danger { background:var(--red); color:#fff; }
.btn-gold { background:linear-gradient(135deg, var(--gold), var(--orange)); color:#000; font-weight:bold; }
.btn-gold:hover { filter:brightness(1.1); box-shadow:0 0 15px rgba(255,215,0,0.3); }

input,select { background:var(--bg); border:1px solid #333; color:var(--text); padding:8px 12px; border-radius:var(--radius); font-family:inherit; font-size:12px; width:100%; }
input:focus,select:focus { outline:none; border-color:var(--accent); }

.row { display:flex; gap:12px; align-items:center; }
.row.wrap { flex-wrap:wrap; }
.grow { flex:1; }

.table-wrap { overflow-x:auto; }
table { width:100%; border-collapse:collapse; font-size:12px; }
th { text-align:left; padding:8px; color:var(--dim); border-bottom:1px solid #222; font-size:10px; text-transform:uppercase; letter-spacing:1px; }
td { padding:8px; border-bottom:1px solid #1a1a2e; }
tr:hover td { background:var(--bg3); }

.hash { font-family:monospace; color:var(--accent2); font-size:11px; }
.hash-short { max-width:120px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; display:inline-block; vertical-align:middle; }
.badge { display:inline-block; padding:2px 8px; border-radius:10px; font-size:10px; font-weight:bold; }
.badge-green { background:rgba(0,230,118,0.15); color:var(--green); }
.badge-gold { background:rgba(255,215,0,0.15); color:var(--gold); }
.badge-red { background:rgba(255,82,82,0.15); color:var(--red); }
.badge-blue { background:rgba(0,229,255,0.15); color:var(--accent); }

.mining-viz { background:var(--bg); border:1px solid #222; border-radius:var(--radius); padding:16px; margin:12px 0; position:relative; overflow:hidden; }
.mining-viz .progress { height:4px; background:var(--bg3); border-radius:2px; margin-top:8px; }
.mining-viz .progress-fill { height:100%; background:linear-gradient(90deg, var(--accent), var(--accent2)); border-radius:2px; transition:width .3s; }
.hash-stream { font-family:monospace; font-size:10px; color:var(--dim); height:80px; overflow:hidden; line-height:1.6; opacity:0.6; }

.node-grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(140px,1fr)); gap:8px; }
.node-card { background:var(--bg); border:1px solid #222; border-radius:var(--radius); padding:10px; text-align:center; font-size:11px; }
.node-card .dot { width:8px; height:8px; border-radius:50%; display:inline-block; margin-right:4px; }
.dot-online { background:var(--green); box-shadow:0 0 6px var(--green); }
.dot-mining { background:var(--gold); box-shadow:0 0 6px var(--gold); animation:pulse 1s infinite; }
.dot-offline { background:var(--red); }
@keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.4} }

.tx-form { display:grid; grid-template-columns:1fr 1fr auto; gap:8px; align-items:end; }
.tx-form label { font-size:10px; color:var(--dim); display:block; margin-bottom:4px; }

.panel-title { font-size:16px; font-weight:bold; margin-bottom:12px; display:flex; align-items:center; gap:8px; }
.panel-title .icon { font-size:20px; }

.log-line { font-size:11px; padding:3px 0; color:var(--dim); border-bottom:1px solid #111; }
.log-line .ts { color:var(--accent2); margin-right:8px; }

.toolbar { display:flex; gap:8px; margin-bottom:12px; flex-wrap:wrap; }

.empty { text-align:center; padding:40px; color:var(--dim); }
.empty .big { font-size:48px; margin-bottom:12px; }

@media(max-width:768px) {
  .sidebar { display:none; }
  .app-wrap { flex-direction:column; }
  .stat-grid { grid-template-columns:1fr 1fr; }
  .tx-form { grid-template-columns:1fr; }
}
</style>
</head>
<body>

<div class="topbar">
  <div class="logo">ğŸª™ <span>Crypto</span>Zoo</div>
  <div style="font-size:11px;color:var(--dim)">ZooCoin Network</div>
  <div class="net-stats">
    <span>Blocks: <b id="stat-blocks">1</b></span>
    <span>Hashrate: <b id="stat-hashrate">0</b> H/s</span>
    <span>Nodes: <b id="stat-nodes">0</b></span>
    <span>Supply: <b id="stat-supply">0</b> ZOO</span>
  </div>
</div>

<div class="app-wrap">
  <div class="sidebar">
    <div class="section-title">Network</div>
    <button class="nav-btn active" data-tab="dashboard"><span class="icon">ğŸ“Š</span>Dashboard</button>
    <button class="nav-btn" data-tab="wallet"><span class="icon">ğŸ‘›</span>My Wallet</button>
    <button class="nav-btn" data-tab="mining"><span class="icon">â›ï¸</span>Mining</button>
    <button class="nav-btn" data-tab="transactions"><span class="icon">ğŸ’¸</span>Transactions</button>
    <div class="section-title">Explorer</div>
    <button class="nav-btn" data-tab="explorer"><span class="icon">ğŸ”</span>Block Explorer</button>
    <button class="nav-btn" data-tab="nodes"><span class="icon">ğŸŒ</span>Network Nodes</button>
    <div class="section-title">Data</div>
    <button class="nav-btn" data-tab="backup"><span class="icon">ğŸ’¾</span>Import / Export</button>
  </div>
  <div class="main" id="main-content"></div>
</div>

<script>
(function() {
'use strict';

const STORAGE_KEY = 'cryptozoo-chain-state';
const COIN_NAME = 'ZooCoin';
const COIN_SYMBOL = 'ZOO';
const BLOCK_REWARD = 50;
const HALVING_INTERVAL = 100;
const TARGET_BLOCK_TIME = 10000;
const DIFFICULTY_ADJUST_INTERVAL = 10;
const MAX_SUPPLY = 21000000;

// â”€â”€â”€ Crypto Utilities â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

async function sha256(message) {
  const msgBuffer = new TextEncoder().encode(message);
  const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
  const hashArray = Array.from(new Uint8Array(hashBuffer));
  return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
}

function generateAddress() {
  const chars = '0123456789abcdef';
  let addr = 'zoo1';
  for (let i = 0; i < 32; i++) addr += chars[Math.floor(Math.random() * 16)];
  return addr;
}

function shortHash(h) { return h ? h.slice(0,8) + 'â€¦' + h.slice(-6) : 'â€”'; }
function shortAddr(a) { return a ? a.slice(0,8) + 'â€¦' + a.slice(-4) : 'â€”'; }
function formatZOO(n) { return (n || 0).toLocaleString(undefined, {maximumFractionDigits:4}); }
function timeAgo(ts) {
  const s = Math.floor((Date.now() - ts)/1000);
  if (s < 60) return s + 's ago';
  if (s < 3600) return Math.floor(s/60) + 'm ago';
  if (s < 86400) return Math.floor(s/3600) + 'h ago';
  return Math.floor(s/86400) + 'd ago';
}

// â”€â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

let state = {
  wallet: null,
  chain: [],
  mempool: [],
  nodes: [],
  miningActive: false,
  hashCount: 0,
  hashRate: 0,
  difficulty: 2,
  totalMined: 0,
  log: []
};

function getCurrentReward() {
  const halvings = Math.floor(state.chain.length / HALVING_INTERVAL);
  return Math.max(BLOCK_REWARD / Math.pow(2, halvings), 0.001);
}

function getTotalSupply() {
  let supply = 0;
  for (const block of state.chain) {
    for (const tx of block.transactions) {
      if (tx.from === 'COINBASE') supply += tx.amount;
    }
  }
  return supply;
}

function getBalance(address) {
  let bal = 0;
  for (const block of state.chain) {
    for (const tx of block.transactions) {
      if (tx.to === address) bal += tx.amount;
      if (tx.from === address) bal -= tx.amount;
    }
  }
  return bal;
}

function addLog(msg) {
  state.log.unshift({ ts: Date.now(), msg });
  if (state.log.length > 200) state.log.length = 200;
}

// â”€â”€â”€ Blockchain Core â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

async function createGenesisBlock() {
  const block = {
    index: 0,
    timestamp: Date.now(),
    previousHash: '0'.repeat(64),
    transactions: [{
      id: 'genesis-tx',
      from: 'COINBASE',
      to: state.wallet.address,
      amount: BLOCK_REWARD,
      timestamp: Date.now(),
      status: 'confirmed'
    }],
    nonce: 0,
    hash: '',
    miner: state.wallet.address,
    difficulty: state.difficulty
  };
  block.hash = await computeBlockHash(block);
  return block;
}

async function computeBlockHash(block) {
  const data = block.index + block.previousHash + block.timestamp + JSON.stringify(block.transactions) + block.nonce + block.difficulty;
  return sha256(data);
}

function isValidChain(chain) {
  for (let i = 1; i < chain.length; i++) {
    if (chain[i].previousHash !== chain[i-1].hash) return false;
    if (chain[i].index !== i) return false;
  }
  return true;
}

function adjustDifficulty() {
  if (state.chain.length % DIFFICULTY_ADJUST_INTERVAL !== 0 || state.chain.length < 2) return;
  const last = state.chain.slice(-DIFFICULTY_ADJUST_INTERVAL);
  const timeTaken = last[last.length-1].timestamp - last[0].timestamp;
  const expected = TARGET_BLOCK_TIME * DIFFICULTY_ADJUST_INTERVAL;
  if (timeTaken < expected / 2) state.difficulty = Math.min(state.difficulty + 1, 8);
  else if (timeTaken > expected * 2) state.difficulty = Math.max(state.difficulty - 1, 1);
}

// â”€â”€â”€ Mining â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

let miningAbort = null;
let hashStreamEl = null;
let miningStartTime = 0;

async function mineBlock() {
  if (state.miningActive) return;
  if (getTotalSupply() >= MAX_SUPPLY) { addLog('âš ï¸ Max supply reached. No more mining.'); return; }

  state.miningActive = true;
  miningStartTime = Date.now();
  state.hashCount = 0;
  const controller = new AbortController();
  miningAbort = controller;

  const reward = getCurrentReward();
  const coinbaseTx = {
    id: 'cb-' + Date.now(),
    from: 'COINBASE',
    to: state.wallet.address,
    amount: reward,
    timestamp: Date.now(),
    status: 'confirmed'
  };

  const txs = [coinbaseTx, ...state.mempool.splice(0, 10)];
  txs.forEach(tx => tx.status = 'confirmed');

  const prevBlock = state.chain[state.chain.length - 1];
  const block = {
    index: prevBlock.index + 1,
    timestamp: Date.now(),
    previousHash: prevBlock.hash,
    transactions: txs,
    nonce: 0,
    hash: '',
    miner: state.wallet.address,
    difficulty: state.difficulty
  };

  const target = '0'.repeat(state.difficulty);
  addLog('â›ï¸ Mining block #' + block.index + ' (difficulty ' + state.difficulty + ')â€¦');
  renderCurrentTab();

  while (!controller.signal.aborted) {
    block.nonce++;
    state.hashCount++;
    block.hash = await computeBlockHash(block);

    if (hashStreamEl && state.hashCount % 50 === 0) {
      hashStreamEl.textContent = block.hash + '\n' + hashStreamEl.textContent.split('\n').slice(0,4).join('\n');
    }

    if (block.hash.startsWith(target)) {
      state.chain.push(block);
      state.totalMined++;
      adjustDifficulty();
      addLog('âœ… Block #' + block.index + ' mined! Reward: ' + reward + ' ' + COIN_SYMBOL + ' | Hash: ' + shortHash(block.hash));
      break;
    }

    if (state.hashCount % 500 === 0) {
      const elapsed = (Date.now() - miningStartTime) / 1000;
      state.hashRate = Math.round(state.hashCount / elapsed);
      updateTopStats();
      await new Promise(r => setTimeout(r, 0));
    }
  }

  state.miningActive = false;
  miningAbort = null;
  saveState();
  updateTopStats();
  renderCurrentTab();
  simulateNetworkActivity();
}

function stopMining() {
  if (miningAbort) { miningAbort.abort(); addLog('ğŸ›‘ Mining stopped.'); }
  state.miningActive = false;
}

// â”€â”€â”€ Transactions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function createTransaction(to, amount) {
  if (!to || amount <= 0) return 'Invalid transaction';
  const bal = getBalance(state.wallet.address);
  if (amount > bal) return 'Insufficient balance (' + formatZOO(bal) + ' ' + COIN_SYMBOL + ')';
  const tx = {
    id: 'tx-' + Date.now() + '-' + Math.random().toString(36).slice(2,6),
    from: state.wallet.address,
    to: to,
    amount: amount,
    timestamp: Date.now(),
    status: 'pending'
  };
  state.mempool.push(tx);
  addLog('ğŸ“¤ Sent ' + formatZOO(amount) + ' ' + COIN_SYMBOL + ' â†’ ' + shortAddr(to));
  saveState();
  renderCurrentTab();
  return null;
}

// â”€â”€â”€ NPC Nodes â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const NPC_NAMES = ['AlphaNode','BetaMiner','GammaRelay','DeltaPool','EpsilonVault',
  'ZetaForge','EtaProxy','ThetaValidator','IotaWatcher','KappaStake',
  'LambdaSync','MuHash','NuRelay','XiPool','OmicronNode'];

function initNodes() {
  if (state.nodes.length > 0) return;
  const count = 6 + Math.floor(Math.random() * 6);
  for (let i = 0; i < count; i++) {
    state.nodes.push({
      name: NPC_NAMES[i] || 'Node-' + i,
      address: generateAddress(),
      status: Math.random() > 0.15 ? 'online' : 'mining',
      blocks: Math.floor(Math.random() * 20),
      lastSeen: Date.now() - Math.floor(Math.random() * 300000),
      hashRate: Math.floor(Math.random() * 500) + 50
    });
  }
}

function simulateNetworkActivity() {
  for (const node of state.nodes) {
    if (Math.random() < 0.3) {
      node.status = ['online','mining','online'][Math.floor(Math.random()*3)];
      node.lastSeen = Date.now();
    }
    if (Math.random() < 0.15 && state.mempool.length < 20) {
      const otherNode = state.nodes[Math.floor(Math.random() * state.nodes.length)];
      if (otherNode.address !== node.address) {
        state.mempool.push({
          id: 'npc-tx-' + Date.now() + '-' + Math.random().toString(36).slice(2,6),
          from: node.address,
          to: otherNode.address,
          amount: +(Math.random() * 5 + 0.01).toFixed(4),
          timestamp: Date.now(),
          status: 'pending'
        });
      }
    }
    if (node.status === 'mining') node.blocks++;
  }
}

// â”€â”€â”€ Persistence â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function saveState() {
  try {
    const data = {
      wallet: state.wallet,
      chain: state.chain,
      mempool: state.mempool,
      nodes: state.nodes,
      difficulty: state.difficulty,
      totalMined: state.totalMined,
      log: state.log.slice(0, 50)
    };
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  } catch(e) { console.warn('Save failed:', e); }
}

function loadState() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (raw) {
      const data = JSON.parse(raw);
      Object.assign(state, data);
      return true;
    }
  } catch(e) { console.warn('Load failed:', e); }
  return false;
}

function exportChain() {
  const data = JSON.stringify({
    version: 1,
    exported: new Date().toISOString(),
    wallet: state.wallet,
    chain: state.chain,
    mempool: state.mempool,
    nodes: state.nodes,
    difficulty: state.difficulty
  }, null, 2);
  const blob = new Blob([data], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'cryptozoo-blockchain-' + Date.now() + '.json';
  a.click(); URL.revokeObjectURL(url);
  addLog('ğŸ’¾ Blockchain exported.');
}

function importChain(jsonStr) {
  try {
    const data = JSON.parse(jsonStr);
    if (!data.chain || !data.wallet) throw new Error('Invalid format');
    if (!isValidChain(data.chain)) throw new Error('Invalid chain');
    state.wallet = data.wallet;
    state.chain = data.chain;
    state.mempool = data.mempool || [];
    state.nodes = data.nodes || [];
    state.difficulty = data.difficulty || 2;
    saveState();
    addLog('ğŸ“¥ Blockchain imported (' + data.chain.length + ' blocks).');
    updateTopStats();
    renderCurrentTab();
    return null;
  } catch(e) { return 'Import failed: ' + e.message; }
}

// â”€â”€â”€ Rendering â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

let currentTab = 'dashboard';

function updateTopStats() {
  document.getElementById('stat-blocks').textContent = state.chain.length;
  document.getElementById('stat-hashrate').textContent = state.hashRate.toLocaleString();
  document.getElementById('stat-nodes').textContent = state.nodes.filter(n => n.status !== 'offline').length;
  document.getElementById('stat-supply').textContent = formatZOO(getTotalSupply());
}

function renderCurrentTab() {
  const el = document.getElementById('main-content');
  switch(currentTab) {
    case 'dashboard': renderDashboard(el); break;
    case 'wallet': renderWallet(el); break;
    case 'mining': renderMining(el); break;
    case 'transactions': renderTransactions(el); break;
    case 'explorer': renderExplorer(el); break;
    case 'nodes': renderNodes(el); break;
    case 'backup': renderBackup(el); break;
  }
}

function renderDashboard(el) {
  const supply = getTotalSupply();
  const bal = getBalance(state.wallet.address);
  const reward = getCurrentReward();
  const halvingsLeft = HALVING_INTERVAL - (state.chain.length % HALVING_INTERVAL);
  el.innerHTML = `
    <div class="panel-title"><span class="icon">ğŸ“Š</span> Dashboard</div>
    <div class="stat-grid">
      <div class="stat-box"><div class="val">${formatZOO(bal)}</div><div class="label">Your Balance (${COIN_SYMBOL})</div></div>
      <div class="stat-box"><div class="val">${state.chain.length}</div><div class="label">Chain Height</div></div>
      <div class="stat-box"><div class="val">${state.difficulty}</div><div class="label">Difficulty</div></div>
      <div class="stat-box"><div class="val">${formatZOO(reward)}</div><div class="label">Block Reward</div></div>
      <div class="stat-box"><div class="val">${formatZOO(supply)}</div><div class="label">Total Supply</div></div>
      <div class="stat-box"><div class="val">${halvingsLeft}</div><div class="label">Blocks to Halving</div></div>
      <div class="stat-box"><div class="val">${state.mempool.length}</div><div class="label">Pending TX</div></div>
      <div class="stat-box"><div class="val">${state.nodes.filter(n=>n.status!=='offline').length}</div><div class="label">Active Nodes</div></div>
    </div>
    <div class="card">
      <h3>âš¡ Quick Actions</h3>
      <div class="toolbar" style="margin-top:8px">
        <button class="btn btn-gold" onclick="window._czMine()">â›ï¸ Mine Block</button>
        <button class="btn btn-secondary" onclick="window._czTab('wallet')">ğŸ‘› Open Wallet</button>
        <button class="btn btn-secondary" onclick="window._czTab('explorer')">ğŸ” Explorer</button>
      </div>
    </div>
    <div class="card">
      <h3>ğŸ“¡ Network Log</h3>
      <div style="max-height:200px;overflow-y:auto;margin-top:8px">
        ${state.log.slice(0,30).map(l => '<div class="log-line"><span class="ts">' + new Date(l.ts).toLocaleTimeString() + '</span>' + l.msg + '</div>').join('')}
        ${state.log.length === 0 ? '<div class="empty">No activity yet. Mine your first block!</div>' : ''}
      </div>
    </div>
    <div class="card">
      <h3>ğŸ“ˆ Recent Blocks</h3>
      <div class="table-wrap" style="margin-top:8px">
        <table>
          <tr><th>#</th><th>Hash</th><th>TXs</th><th>Miner</th><th>Reward</th><th>Time</th></tr>
          ${state.chain.slice(-10).reverse().map(b => `
            <tr>
              <td>${b.index}</td>
              <td><span class="hash hash-short">${shortHash(b.hash)}</span></td>
              <td>${b.transactions.length}</td>
              <td><span class="hash hash-short">${shortAddr(b.miner)}</span></td>
              <td>${formatZOO(b.transactions.find(t=>t.from==='COINBASE')?.amount || 0)} ${COIN_SYMBOL}</td>
              <td>${timeAgo(b.timestamp)}</td>
            </tr>
          `).join('')}
        </table>
      </div>
    </div>
  `;
}

function renderWallet(el) {
  const bal = getBalance(state.wallet.address);
  const txs = [];
  for (const block of state.chain) {
    for (const tx of block.transactions) {
      if (tx.to === state.wallet.address || tx.from === state.wallet.address) {
        txs.push({...tx, blockIndex: block.index});
      }
    }
  }
  txs.reverse();
  el.innerHTML = `
    <div class="panel-title"><span class="icon">ğŸ‘›</span> My Wallet</div>
    <div class="stat-grid">
      <div class="stat-box" style="grid-column:span 2"><div class="val">${formatZOO(bal)} <span style="font-size:14px;color:var(--gold)">${COIN_SYMBOL}</span></div><div class="label">Balance</div></div>
      <div class="stat-box"><div class="val">${txs.length}</div><div class="label">Transactions</div></div>
      <div class="stat-box"><div class="val">${state.totalMined}</div><div class="label">Blocks Mined</div></div>
    </div>
    <div class="card">
      <h3>ğŸ”‘ Wallet Address</h3>
      <div style="margin-top:8px;padding:10px;background:var(--bg);border-radius:var(--radius);font-family:monospace;font-size:12px;color:var(--accent);word-break:break-all">${state.wallet.address}</div>
    </div>
    <div class="card">
      <h3>ğŸ’¸ Send ${COIN_SYMBOL}</h3>
      <div class="tx-form" style="margin-top:8px">
        <div><label>Recipient Address</label><input id="send-to" placeholder="zoo1â€¦"></div>
        <div><label>Amount (${COIN_SYMBOL})</label><input id="send-amt" type="number" step="0.0001" min="0.0001" placeholder="0.00"></div>
        <button class="btn btn-primary" style="margin-top:14px" onclick="window._czSend()">Send</button>
      </div>
      <div id="send-error" style="color:var(--red);font-size:11px;margin-top:6px"></div>
    </div>
    <div class="card">
      <h3>ğŸ“œ Transaction History</h3>
      <div class="table-wrap" style="margin-top:8px">
        <table>
          <tr><th>Type</th><th>Amount</th><th>Counterparty</th><th>Block</th><th>Time</th></tr>
          ${txs.slice(0,50).map(tx => {
            const isIn = tx.to === state.wallet.address;
            return `<tr>
              <td><span class="badge ${isIn ? 'badge-green' : 'badge-red'}">${isIn ? 'â¬‡ IN' : 'â¬† OUT'}</span></td>
              <td style="color:${isIn ? 'var(--green)' : 'var(--red)'}"> ${isIn?'+':'-'}${formatZOO(tx.amount)}</td>
              <td><span class="hash hash-short">${shortAddr(isIn ? tx.from : tx.to)}</span></td>
              <td>#${tx.blockIndex || 'â€”'}</td>
              <td>${timeAgo(tx.timestamp)}</td>
            </tr>`;
          }).join('')}
        </table>
        ${txs.length === 0 ? '<div class="empty" style="padding:20px">No transactions yet</div>' : ''}
      </div>
    </div>
  `;
}

function renderMining(el) {
  const reward = getCurrentReward();
  el.innerHTML = `
    <div class="panel-title"><span class="icon">â›ï¸</span> Mining</div>
    <div class="stat-grid">
      <div class="stat-box"><div class="val">${state.hashRate.toLocaleString()}</div><div class="label">Hash Rate (H/s)</div></div>
      <div class="stat-box"><div class="val">${state.difficulty}</div><div class="label">Difficulty</div></div>
      <div class="stat-box"><div class="val">${formatZOO(reward)}</div><div class="label">Next Reward</div></div>
      <div class="stat-box"><div class="val">${state.totalMined}</div><div class="label">Blocks Mined</div></div>
    </div>
    <div class="card">
      <h3>ğŸ”¨ Mine a Block</h3>
      <p style="margin:8px 0">Compute proof-of-work to add the next block. Includes pending transactions + ${formatZOO(reward)} ${COIN_SYMBOL} reward.</p>
      <div class="toolbar" style="margin-top:12px">
        ${state.miningActive
          ? '<button class="btn btn-danger" onclick="window._czStopMine()">ğŸ›‘ Stop Mining</button><span class="badge badge-gold" style="padding:8px 12px">â›ï¸ Mining in progressâ€¦</span>'
          : '<button class="btn btn-gold" onclick="window._czMine()">â›ï¸ Start Mining</button>'
        }
      </div>
    </div>
    <div class="mining-viz">
      <div style="font-size:12px;color:var(--dim);margin-bottom:4px">Hash Stream</div>
      <div class="hash-stream" id="hash-stream">${state.miningActive ? 'Computing hashesâ€¦' : 'Idle â€” press Mine to start'}</div>
      <div class="progress"><div class="progress-fill" style="width:${state.miningActive ? '60%' : '0%'}"></div></div>
    </div>
    <div class="card">
      <h3>ğŸ“Š Mining Economics</h3>
      <table style="margin-top:8px">
        <tr><td style="color:var(--dim)">Current reward</td><td>${formatZOO(reward)} ${COIN_SYMBOL}</td></tr>
        <tr><td style="color:var(--dim)">Halving interval</td><td>Every ${HALVING_INTERVAL} blocks</td></tr>
        <tr><td style="color:var(--dim)">Blocks to next halving</td><td>${HALVING_INTERVAL - (state.chain.length % HALVING_INTERVAL)}</td></tr>
        <tr><td style="color:var(--dim)">Max supply</td><td>${MAX_SUPPLY.toLocaleString()} ${COIN_SYMBOL}</td></tr>
        <tr><td style="color:var(--dim)">Current supply</td><td>${formatZOO(getTotalSupply())} ${COIN_SYMBOL} (${(getTotalSupply()/MAX_SUPPLY*100).toFixed(4)}%)</td></tr>
        <tr><td style="color:var(--dim)">Difficulty target</td><td>${'0'.repeat(state.difficulty)}${'f'.repeat(64-state.difficulty)}</td></tr>
      </table>
    </div>
  `;
  hashStreamEl = document.getElementById('hash-stream');
}

function renderTransactions(el) {
  el.innerHTML = `
    <div class="panel-title"><span class="icon">ğŸ’¸</span> Transactions</div>
    <div class="card">
      <h3>â³ Mempool (${state.mempool.length} pending)</h3>
      <div class="table-wrap" style="margin-top:8px">
        <table>
          <tr><th>ID</th><th>From</th><th>To</th><th>Amount</th><th>Status</th></tr>
          ${state.mempool.map(tx => `
            <tr>
              <td><span class="hash hash-short">${tx.id.slice(0,12)}</span></td>
              <td><span class="hash hash-short">${shortAddr(tx.from)}</span></td>
              <td><span class="hash hash-short">${shortAddr(tx.to)}</span></td>
              <td>${formatZOO(tx.amount)} ${COIN_SYMBOL}</td>
              <td><span class="badge badge-gold">pending</span></td>
            </tr>
          `).join('')}
        </table>
        ${state.mempool.length === 0 ? '<div class="empty" style="padding:20px">Mempool empty â€” all transactions confirmed</div>' : ''}
      </div>
    </div>
    <div class="card">
      <h3>âœ… Confirmed Transactions</h3>
      <div class="table-wrap" style="margin-top:8px">
        <table>
          <tr><th>Block</th><th>From</th><th>To</th><th>Amount</th><th>Time</th></tr>
          ${state.chain.slice().reverse().flatMap(b => b.transactions.map(tx => ({...tx, blockIdx: b.index}))).slice(0,50).map(tx => `
            <tr>
              <td>#${tx.blockIdx}</td>
              <td><span class="hash hash-short">${tx.from === 'COINBASE' ? '<span class="badge badge-green">COINBASE</span>' : shortAddr(tx.from)}</span></td>
              <td><span class="hash hash-short">${shortAddr(tx.to)}</span></td>
              <td>${formatZOO(tx.amount)} ${COIN_SYMBOL}</td>
              <td>${timeAgo(tx.timestamp)}</td>
            </tr>
          `).join('')}
        </table>
      </div>
    </div>
  `;
}

function renderExplorer(el) {
  el.innerHTML = `
    <div class="panel-title"><span class="icon">ğŸ”</span> Block Explorer</div>
    <div class="toolbar">
      <input id="explorer-search" placeholder="Search by block # or hashâ€¦" style="max-width:400px" onkeyup="window._czSearch(this.value)">
    </div>
    <div id="explorer-results">
      <div class="table-wrap">
        <table>
          <tr><th>#</th><th>Hash</th><th>Prev Hash</th><th>TXs</th><th>Nonce</th><th>Difficulty</th><th>Miner</th><th>Time</th></tr>
          ${state.chain.slice().reverse().map(b => `
            <tr onclick="window._czBlockDetail(${b.index})" style="cursor:pointer">
              <td><b>${b.index}</b></td>
              <td><span class="hash hash-short">${shortHash(b.hash)}</span></td>
              <td><span class="hash hash-short">${shortHash(b.previousHash)}</span></td>
              <td>${b.transactions.length}</td>
              <td>${b.nonce.toLocaleString()}</td>
              <td>${b.difficulty}</td>
              <td><span class="hash hash-short">${shortAddr(b.miner)}</span></td>
              <td>${timeAgo(b.timestamp)}</td>
            </tr>
          `).join('')}
        </table>
      </div>
    </div>
  `;
}

function renderBlockDetail(block) {
  const el = document.getElementById('explorer-results');
  if (!el) return;
  el.innerHTML = `
    <div class="card" style="margin-bottom:12px">
      <button class="btn btn-secondary" onclick="window._czTab('explorer')" style="margin-bottom:12px">â† Back to Explorer</button>
      <h3>Block #${block.index}</h3>
      <table style="margin-top:8px">
        <tr><td style="color:var(--dim);width:140px">Hash</td><td class="hash" style="word-break:break-all">${block.hash}</td></tr>
        <tr><td style="color:var(--dim)">Previous Hash</td><td class="hash" style="word-break:break-all">${block.previousHash}</td></tr>
        <tr><td style="color:var(--dim)">Timestamp</td><td>${new Date(block.timestamp).toLocaleString()}</td></tr>
        <tr><td style="color:var(--dim)">Miner</td><td class="hash">${block.miner}</td></tr>
        <tr><td style="color:var(--dim)">Nonce</td><td>${block.nonce.toLocaleString()}</td></tr>
        <tr><td style="color:var(--dim)">Difficulty</td><td>${block.difficulty}</td></tr>
        <tr><td style="color:var(--dim)">Transactions</td><td>${block.transactions.length}</td></tr>
      </table>
    </div>
    <div class="card">
      <h3>Transactions in Block #${block.index}</h3>
      <div class="table-wrap" style="margin-top:8px">
        <table>
          <tr><th>From</th><th>To</th><th>Amount</th></tr>
          ${block.transactions.map(tx => `
            <tr>
              <td>${tx.from === 'COINBASE' ? '<span class="badge badge-green">COINBASE</span>' : '<span class="hash hash-short">' + shortAddr(tx.from) + '</span>'}</td>
              <td><span class="hash hash-short">${shortAddr(tx.to)}</span></td>
              <td>${formatZOO(tx.amount)} ${COIN_SYMBOL}</td>
            </tr>
          `).join('')}
        </table>
      </div>
    </div>
  `;
}

function renderNodes(el) {
  el.innerHTML = `
    <div class="panel-title"><span class="icon">ğŸŒ</span> Network Nodes</div>
    <div class="stat-grid">
      <div class="stat-box"><div class="val">${state.nodes.length}</div><div class="label">Total Nodes</div></div>
      <div class="stat-box"><div class="val">${state.nodes.filter(n=>n.status==='online').length}</div><div class="label">Online</div></div>
      <div class="stat-box"><div class="val">${state.nodes.filter(n=>n.status==='mining').length}</div><div class="label">Mining</div></div>
      <div class="stat-box"><div class="val">${state.nodes.reduce((s,n)=>s+n.hashRate,0).toLocaleString()}</div><div class="label">Net Hashrate (H/s)</div></div>
    </div>
    <div class="node-grid">
      ${state.nodes.map(n => `
        <div class="node-card">
          <div><span class="dot ${n.status==='mining'?'dot-mining':n.status==='online'?'dot-online':'dot-offline'}"></span><b>${n.name}</b></div>
          <div style="color:var(--dim);margin:4px 0">${shortAddr(n.address)}</div>
          <div><span class="badge ${n.status==='mining'?'badge-gold':n.status==='online'?'badge-green':'badge-red'}">${n.status}</span></div>
          <div style="margin-top:4px;color:var(--dim)">${n.hashRate} H/s Â· ${n.blocks} blocks</div>
        </div>
      `).join('')}
    </div>
    <div class="card" style="margin-top:12px">
      <h3>ğŸ¤ Your Node</h3>
      <table style="margin-top:8px">
        <tr><td style="color:var(--dim)">Address</td><td class="hash">${state.wallet.address}</td></tr>
        <tr><td style="color:var(--dim)">Status</td><td><span class="badge ${state.miningActive?'badge-gold':'badge-green'}">${state.miningActive?'mining':'online'}</span></td></tr>
        <tr><td style="color:var(--dim)">Blocks mined</td><td>${state.totalMined}</td></tr>
        <tr><td style="color:var(--dim)">Hash rate</td><td>${state.hashRate.toLocaleString()} H/s</td></tr>
      </table>
    </div>
  `;
}

function renderBackup(el) {
  el.innerHTML = `
    <div class="panel-title"><span class="icon">ğŸ’¾</span> Import / Export</div>
    <div class="card">
      <h3>ğŸ“¤ Export Blockchain</h3>
      <p style="margin:8px 0">Download your entire blockchain state as JSON. Includes wallet, chain, mempool, and node data.</p>
      <button class="btn btn-primary" onclick="window._czExport()" style="margin-top:8px">Download Blockchain JSON</button>
    </div>
    <div class="card">
      <h3>ğŸ“¥ Import Blockchain</h3>
      <p style="margin:8px 0">Load a previously exported blockchain. This will replace your current state.</p>
      <textarea id="import-data" style="width:100%;height:120px;background:var(--bg);border:1px solid #333;color:var(--text);font-family:monospace;font-size:11px;padding:8px;border-radius:var(--radius);margin-top:8px" placeholder="Paste blockchain JSON hereâ€¦"></textarea>
      <div class="toolbar" style="margin-top:8px">
        <button class="btn btn-primary" onclick="window._czImport()">Import</button>
        <button class="btn btn-danger" onclick="if(confirm('Reset entire blockchain? This cannot be undone.')){localStorage.removeItem('${STORAGE_KEY}');location.reload()}">ğŸ—‘ï¸ Reset Chain</button>
      </div>
      <div id="import-error" style="color:var(--red);font-size:11px;margin-top:6px"></div>
    </div>
    <div class="card">
      <h3>â„¹ï¸ Chain Info</h3>
      <table style="margin-top:8px">
        <tr><td style="color:var(--dim)">Chain height</td><td>${state.chain.length} blocks</td></tr>
        <tr><td style="color:var(--dim)">State size</td><td>${(JSON.stringify(state).length / 1024).toFixed(1)} KB</td></tr>
        <tr><td style="color:var(--dim)">Genesis time</td><td>${state.chain.length > 0 ? new Date(state.chain[0].timestamp).toLocaleString() : 'â€”'}</td></tr>
        <tr><td style="color:var(--dim)">Latest block</td><td>${state.chain.length > 0 ? new Date(state.chain[state.chain.length-1].timestamp).toLocaleString() : 'â€”'}</td></tr>
        <tr><td style="color:var(--dim)">Chain valid</td><td><span class="badge badge-green">${isValidChain(state.chain) ? 'âœ… Valid' : 'âŒ Invalid'}</span></td></tr>
      </table>
    </div>
  `;
}

// â”€â”€â”€ Global Handlers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

window._czMine = () => mineBlock();
window._czStopMine = () => { stopMining(); renderCurrentTab(); };
window._czTab = (tab) => {
  currentTab = tab;
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.toggle('active', b.dataset.tab === tab));
  renderCurrentTab();
};
window._czSend = () => {
  const to = document.getElementById('send-to')?.value?.trim();
  const amt = parseFloat(document.getElementById('send-amt')?.value);
  const err = createTransaction(to, amt);
  const errEl = document.getElementById('send-error');
  if (errEl) errEl.textContent = err || 'âœ… Transaction submitted to mempool';
};
window._czExport = () => exportChain();
window._czImport = () => {
  const data = document.getElementById('import-data')?.value?.trim();
  const err = importChain(data || '');
  const errEl = document.getElementById('import-error');
  if (errEl) errEl.textContent = err || 'âœ… Import successful';
};
window._czSearch = (q) => {
  if (!q) { renderExplorer(document.getElementById('main-content')); return; }
  const num = parseInt(q);
  if (!isNaN(num)) {
    const block = state.chain[num];
    if (block) { renderBlockDetail(block); return; }
  }
  const block = state.chain.find(b => b.hash.includes(q.toLowerCase()));
  if (block) renderBlockDetail(block);
};
window._czBlockDetail = (idx) => {
  const block = state.chain[idx];
  if (block) renderBlockDetail(block);
};

// â”€â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

async function init() {
  const loaded = loadState();
  if (!state.wallet) {
    state.wallet = { address: generateAddress(), created: Date.now() };
  }
  if (state.chain.length === 0) {
    const genesis = await createGenesisBlock();
    state.chain.push(genesis);
    addLog('ğŸŒŸ Genesis block created. Welcome to CryptoZoo!');
    addLog('ğŸ’° Received ' + BLOCK_REWARD + ' ' + COIN_SYMBOL + ' genesis reward.');
  }
  initNodes();
  if (!loaded) saveState();
  updateTopStats();
  renderCurrentTab();

  document.querySelectorAll('.nav-btn').forEach(btn => {
    btn.addEventListener('click', () => window._czTab(btn.dataset.tab));
  });

  setInterval(() => {
    simulateNetworkActivity();
    if (currentTab === 'nodes' || currentTab === 'dashboard') renderCurrentTab();
    updateTopStats();
    saveState();
  }, 15000);
}

init();
})();
</script>
</body>
</html>
