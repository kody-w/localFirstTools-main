<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stratified Echo</title>
    <meta name="description" content="Sculpt layers of frozen motion through geological time, revealing fossils of kinetic energy embedded in ancient stone strata">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #100a08; min-height: 100vh; font-family: 'Georgia', serif; color: #a08060; overflow: hidden; }
        #canvas { position: fixed; top: 0; left: 0; cursor: crosshair; }
        #controls {
            position: fixed; top: 20px; left: 20px; background: rgba(20,15,12,0.95);
            padding: 20px; border-radius: 10px; border: 1px solid rgba(160,120,80,0.3);
            z-index: 100;
        }
        h3 { margin-bottom: 15px; color: #d0a070; font-weight: normal; }
        .control-row { margin: 10px 0; }
        label { display: block; font-size: 11px; margin-bottom: 5px; opacity: 0.8; }
        input[type="range"] { width: 140px; }
        .value { float: right; color: #e0b080; font-size: 12px; }
        button {
            display: block; width: 100%; padding: 10px; margin: 6px 0;
            background: rgba(100,70,40,0.4); border: 1px solid rgba(160,120,80,0.4);
            color: #b08050; cursor: pointer; border-radius: 6px; font-family: inherit;
        }
        #era-display { position: fixed; bottom: 60px; left: 50%; transform: translateX(-50%); font-size: 14px; color: #806040; z-index: 100; }
        #info { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); font-size: 12px; opacity: 0.5; z-index: 100; }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div id="controls">
        <h3>Stratified Echo</h3>
        <div class="control-row">
            <label>Geological Era <span class="value" id="era-val">Present</span></label>
            <input type="range" id="era" min="0" max="6" value="0">
        </div>
        <div class="control-row">
            <label>Fossilization Rate <span class="value" id="fossil-val">50</span></label>
            <input type="range" id="fossil" min="20" max="100" value="50">
        </div>
        <button id="hammer-btn">Seismic Hammer</button>
        <button id="clear-btn">Erode All</button>
    </div>
    <div id="era-display">Era: Present Day</div>
    <div id="info">Draw gestures to fossilize motion | Hover over fossils to see them reawaken</div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let W, H;
        function resize() { W = canvas.width = innerWidth; H = canvas.height = innerHeight; }
        resize(); window.onresize = resize;
        
        const ERAS = [
            { name: 'Present Day', age: 0, hue: 40, lightness: 45 },
            { name: 'Industrial Age', age: 200, hue: 35, lightness: 40 },
            { name: 'Medieval', age: 1000, hue: 30, lightness: 35 },
            { name: 'Ancient Rome', age: 2000, hue: 25, lightness: 32 },
            { name: 'Bronze Age', age: 5000, hue: 35, lightness: 28 },
            { name: 'Neolithic', age: 10000, hue: 30, lightness: 25 },
            { name: 'Primordial', age: 100000, hue: 20, lightness: 20 }
        ];
        
        let currentEra = 0;
        let fossilizationRate = 0.5;
        let time = 0;
        
        const fossils = [];
        const particles = [];
        const shockwaves = [];
        
        let isDrawing = false;
        let currentPath = [];
        
        class Fossil {
            constructor(path, era) {
                this.path = path;
                this.era = era;
                this.eraData = ERAS[era];
                this.age = 0;
                this.fossilized = false;
                this.crystallization = 0;
                this.awakened = false;
                this.awakeProgress = 0;
                this.hue = this.eraData.hue + Math.random() * 20 - 10;
            }
            
            update() {
                this.age += 0.016;
                
                if (!this.fossilized) {
                    this.crystallization += 0.01 * fossilizationRate;
                    if (this.crystallization >= 1) {
                        this.fossilized = true;
                        for (let i = 0; i < 10; i++) {
                            const idx = Math.floor(Math.random() * this.path.length);
                            particles.push({
                                x: this.path[idx].x,
                                y: this.path[idx].y,
                                vx: (Math.random() - 0.5) * 2,
                                vy: -Math.random() * 3,
                                size: 2 + Math.random() * 3,
                                life: 1,
                                hue: this.hue
                            });
                        }
                    }
                }
                
                if (this.awakened) {
                    this.awakeProgress += 0.02;
                    if (this.awakeProgress >= 1) {
                        this.awakened = false;
                        this.awakeProgress = 0;
                    }
                }
            }
            
            containsPoint(x, y) {
                for (let i = 0; i < this.path.length; i++) {
                    if (Math.hypot(this.path[i].x - x, this.path[i].y - y) < 20) {
                        return true;
                    }
                }
                return false;
            }
            
            awaken() {
                if (this.fossilized && !this.awakened) {
                    this.awakened = true;
                    this.awakeProgress = 0;
                }
            }
            
            draw() {
                if (this.path.length < 2) return;
                
                const depth = this.era / ERAS.length;
                const baseAlpha = 0.3 + (1 - depth) * 0.4;
                
                ctx.beginPath();
                ctx.moveTo(this.path[0].x, this.path[0].y);
                
                for (let i = 1; i < this.path.length; i++) {
                    ctx.lineTo(this.path[i].x, this.path[i].y);
                }
                
                if (this.awakened) {
                    const ghostProgress = this.awakeProgress;
                    const ghostLength = Math.floor(this.path.length * ghostProgress);
                    
                    ctx.strokeStyle = "hsla(" + (this.hue + 40) + ", 70%, 70%, " + (0.5 * (1 - ghostProgress)) + ")";
                    ctx.lineWidth = 4;
                    ctx.lineCap = 'round';
                    ctx.stroke();
                    
                    if (ghostLength > 0 && ghostLength < this.path.length) {
                        const ghostPoint = this.path[ghostLength];
                        ctx.beginPath();
                        ctx.arc(ghostPoint.x, ghostPoint.y, 8, 0, Math.PI * 2);
                        ctx.fillStyle = "hsla(" + (this.hue + 60) + ", 80%, 80%, " + (0.7 * (1 - ghostProgress)) + ")";
                        ctx.fill();
                    }
                }
                
                ctx.beginPath();
                ctx.moveTo(this.path[0].x, this.path[0].y);
                for (let i = 1; i < this.path.length; i++) {
                    ctx.lineTo(this.path[i].x, this.path[i].y);
                }
                
                const crystalAlpha = this.fossilized ? baseAlpha : baseAlpha * this.crystallization;
                ctx.strokeStyle = "hsla(" + this.hue + ", " + (30 + this.crystallization * 30) + "%, " + this.eraData.lightness + "%, " + crystalAlpha + ")";
                ctx.lineWidth = 3 - depth;
                ctx.lineCap = 'round';
                ctx.stroke();
                
                if (this.fossilized) {
                    for (let i = 0; i < this.path.length; i += 8) {
                        ctx.beginPath();
                        ctx.arc(this.path[i].x, this.path[i].y, 2 + (1 - depth) * 2, 0, Math.PI * 2);
                        ctx.fillStyle = "hsla(" + (this.hue + 20) + ", 40%, " + (this.eraData.lightness + 10) + "%, " + (crystalAlpha * 0.7) + ")";
                        ctx.fill();
                    }
                }
            }
        }
        
        function drawStrata() {
            const strataCount = 12;
            for (let i = 0; i < strataCount; i++) {
                const y = (i / strataCount) * H;
                const height = H / strataCount + 2;
                const eraIndex = Math.floor((i / strataCount) * ERAS.length);
                const era = ERAS[Math.min(eraIndex, ERAS.length - 1)];
                
                ctx.fillStyle = "hsl(" + era.hue + ", 25%, " + (era.lightness - 5 + (i % 2) * 3) + "%)";
                ctx.fillRect(0, y, W, height);
            }
        }
        
        function drawParticles() {
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.05;
                p.life -= 0.015;
                
                if (p.life <= 0) {
                    particles.splice(i, 1);
                    continue;
                }
                
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size * p.life, 0, Math.PI * 2);
                ctx.fillStyle = "hsla(" + p.hue + ", 50%, 50%, " + p.life + ")";
                ctx.fill();
            }
        }
        
        function drawShockwaves() {
            for (let i = shockwaves.length - 1; i >= 0; i--) {
                const s = shockwaves[i];
                s.radius += 8;
                s.alpha *= 0.95;
                
                if (s.alpha < 0.01) {
                    shockwaves.splice(i, 1);
                    continue;
                }
                
                ctx.beginPath();
                ctx.arc(s.x, s.y, s.radius, 0, Math.PI * 2);
                ctx.strokeStyle = "hsla(30, 50%, 60%, " + s.alpha + ")";
                ctx.lineWidth = 3;
                ctx.stroke();
            }
        }
        
        function drawCurrentPath() {
            if (currentPath.length < 2) return;
            
            ctx.beginPath();
            ctx.moveTo(currentPath[0].x, currentPath[0].y);
            currentPath.forEach(p => ctx.lineTo(p.x, p.y));
            ctx.strokeStyle = 'rgba(200, 150, 100, 0.6)';
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            ctx.stroke();
        }
        
        function animate() {
            time += 0.016;
            
            ctx.fillStyle = '#100a08';
            ctx.fillRect(0, 0, W, H);
            
            drawStrata();
            
            fossils.forEach(f => f.update());
            fossils.forEach(f => f.draw());
            
            drawParticles();
            drawShockwaves();
            drawCurrentPath();
            
            requestAnimationFrame(animate);
        }
        
        canvas.onmousedown = e => {
            if (e.clientX < 200 && e.clientY < 280) return;
            isDrawing = true;
            currentPath = [{ x: e.clientX, y: e.clientY }];
        };
        
        canvas.onmousemove = e => {
            if (isDrawing) {
                const last = currentPath[currentPath.length - 1];
                if (Math.hypot(e.clientX - last.x, e.clientY - last.y) > 8) {
                    currentPath.push({ x: e.clientX, y: e.clientY });
                }
            } else {
                fossils.forEach(f => {
                    if (f.containsPoint(e.clientX, e.clientY)) {
                        f.awaken();
                    }
                });
            }
        };
        
        canvas.onmouseup = () => {
            if (currentPath.length > 5) {
                fossils.push(new Fossil([...currentPath], currentEra));
            }
            isDrawing = false;
            currentPath = [];
        };
        
        document.getElementById('era').oninput = e => {
            currentEra = parseInt(e.target.value);
            document.getElementById('era-val').textContent = ERAS[currentEra].name.split(' ')[0];
            document.getElementById('era-display').textContent = 'Era: ' + ERAS[currentEra].name + ' (' + ERAS[currentEra].age + ' years ago)';
        };
        
        document.getElementById('fossil').oninput = e => {
            fossilizationRate = e.target.value / 100;
            document.getElementById('fossil-val').textContent = e.target.value;
        };
        
        document.getElementById('hammer-btn').onclick = () => {
            shockwaves.push({
                x: W / 2,
                y: H / 2,
                radius: 0,
                alpha: 0.8
            });
            
            fossils.forEach(f => {
                if (f.fossilized) {
                    f.awaken();
                }
            });
        };
        
        document.getElementById('clear-btn').onclick = () => {
            fossils.forEach(f => {
                f.path.forEach(p => {
                    particles.push({
                        x: p.x,
                        y: p.y,
                        vx: (Math.random() - 0.5) * 3,
                        vy: (Math.random() - 0.5) * 3,
                        size: 2,
                        life: 1,
                        hue: f.hue
                    });
                });
            });
            fossils.length = 0;
        };
        
        animate();
    </script>
</body>
</html>