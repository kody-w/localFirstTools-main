<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hourglass Terrarium</title>
    <meta name="description" content="A living hourglass where sand grains are organisms that flow, age, and create ecosystems between chambers">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #0a0a10; min-height: 100vh; font-family: 'Georgia', serif; color: #a0a0c0; overflow: hidden; }
        #canvas { position: fixed; top: 0; left: 0; }
        #controls {
            position: fixed; top: 20px; left: 20px; background: rgba(15,15,25,0.95);
            padding: 20px; border-radius: 10px; border: 1px solid rgba(100,100,150,0.3);
            z-index: 100;
        }
        h3 { margin-bottom: 15px; color: #c0c0e0; font-weight: normal; }
        .control-row { margin: 10px 0; }
        label { display: block; font-size: 11px; margin-bottom: 5px; opacity: 0.8; }
        input[type="range"] { width: 140px; }
        .value { float: right; color: #a0a0d0; font-size: 12px; }
        button {
            display: block; width: 100%; padding: 10px; margin: 6px 0;
            background: rgba(60,60,100,0.4); border: 1px solid rgba(100,100,150,0.4);
            color: #a0a0c0; cursor: pointer; border-radius: 6px; font-family: inherit;
        }
        #info { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); font-size: 12px; opacity: 0.5; z-index: 100; }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div id="controls">
        <h3>Living Hourglass</h3>
        <div class="control-row">
            <label>Flow Rate <span class="value" id="flow-val">50</span></label>
            <input type="range" id="flow" min="10" max="100" value="50">
        </div>
        <div class="control-row">
            <label>Life Energy <span class="value" id="life-val">70</span></label>
            <input type="range" id="life" min="20" max="100" value="70">
        </div>
        <button id="flip-btn">Flip Hourglass</button>
        <button id="shake-btn">Shake</button>
    </div>
    <div id="info">Click to add life | Watch organisms flow through time</div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let W, H;
        function resize() { W = canvas.width = innerWidth; H = canvas.height = innerHeight; }
        resize(); window.onresize = resize;
        
        let flowRate = 0.5;
        let lifeEnergy = 0.7;
        let time = 0;
        let flipped = false;
        let organisms = [];
        let plants = [];
        
        const hourglassWidth = Math.min(W * 0.4, 300);
        const hourglassHeight = Math.min(H * 0.7, 500);
        const neckWidth = 15;
        
        class Organism {
            constructor(x, y, chamber) {
                this.x = x;
                this.y = y;
                this.vx = (Math.random() - 0.5) * 0.5;
                this.vy = 0;
                this.size = 2 + Math.random() * 3;
                this.age = 0;
                this.maxAge = 200 + Math.random() * 300;
                this.hue = 180 + Math.random() * 60;
                this.chamber = chamber;
                this.falling = false;
                this.wiggle = Math.random() * Math.PI * 2;
            }
            update() {
                this.age += 0.1 * lifeEnergy;
                this.wiggle += 0.1;
                
                const cx = W / 2;
                const cy = H / 2;
                const topY = cy - hourglassHeight / 2;
                const bottomY = cy + hourglassHeight / 2;
                const neckY = cy;
                
                const gravity = flipped ? -0.05 : 0.05;
                this.vy += gravity * flowRate;
                
                this.vx += Math.sin(this.wiggle) * 0.02;
                this.vx *= 0.98;
                this.vy *= 0.98;
                
                this.x += this.vx;
                this.y += this.vy;
                
                const distFromCenter = Math.abs(this.x - cx);
                const relY = (this.y - topY) / hourglassHeight;
                
                let maxDist;
                if (relY < 0.45) {
                    maxDist = hourglassWidth / 2 * (1 - relY * 1.8);
                } else if (relY < 0.55) {
                    maxDist = neckWidth;
                    this.falling = true;
                } else {
                    maxDist = hourglassWidth / 2 * ((relY - 0.55) * 1.8 + 0.1);
                }
                
                if (distFromCenter > maxDist - this.size) {
                    this.x = cx + Math.sign(this.x - cx) * (maxDist - this.size);
                    this.vx *= -0.5;
                }
                
                if (this.y < topY + this.size) {
                    this.y = topY + this.size;
                    this.vy *= -0.3;
                }
                if (this.y > bottomY - this.size) {
                    this.y = bottomY - this.size;
                    this.vy *= -0.3;
                    this.falling = false;
                    
                    if (Math.random() < 0.001 * lifeEnergy && plants.length < 20) {
                        plants.push({
                            x: this.x,
                            y: this.y,
                            size: 0,
                            maxSize: 10 + Math.random() * 15,
                            hue: 100 + Math.random() * 40
                        });
                    }
                }
                
                organisms.forEach(other => {
                    if (other === this) return;
                    const dx = other.x - this.x;
                    const dy = other.y - this.y;
                    const dist = Math.hypot(dx, dy);
                    if (dist < this.size + other.size && dist > 0) {
                        const push = (this.size + other.size - dist) * 0.1;
                        this.vx -= (dx / dist) * push;
                        this.vy -= (dy / dist) * push;
                    }
                });
                
                return this.age < this.maxAge;
            }
            draw() {
                const lifeRatio = 1 - this.age / this.maxAge;
                const pulse = 1 + Math.sin(time * 3 + this.wiggle) * 0.1;
                
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size * 1.5 * pulse, 0, Math.PI * 2);
                ctx.fillStyle = "hsla(" + this.hue + ", 60%, 50%, " + (lifeRatio * 0.2) + ")";
                ctx.fill();
                
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size * pulse, 0, Math.PI * 2);
                ctx.fillStyle = "hsla(" + this.hue + ", 70%, " + (40 + lifeRatio * 20) + "%, " + (0.5 + lifeRatio * 0.5) + ")";
                ctx.fill();
                
                if (this.falling) {
                    ctx.beginPath();
                    ctx.moveTo(this.x, this.y);
                    ctx.lineTo(this.x - this.vx * 5, this.y - this.vy * 5);
                    ctx.strokeStyle = "hsla(" + this.hue + ", 60%, 50%, 0.3)";
                    ctx.lineWidth = 1;
                    ctx.stroke();
                }
            }
        }
        
        function drawHourglass() {
            const cx = W / 2;
            const cy = H / 2;
            const topY = cy - hourglassHeight / 2;
            const bottomY = cy + hourglassHeight / 2;
            
            ctx.beginPath();
            ctx.moveTo(cx - hourglassWidth / 2, topY);
            ctx.lineTo(cx - neckWidth, cy);
            ctx.lineTo(cx - hourglassWidth / 2, bottomY);
            ctx.lineTo(cx + hourglassWidth / 2, bottomY);
            ctx.lineTo(cx + neckWidth, cy);
            ctx.lineTo(cx + hourglassWidth / 2, topY);
            ctx.closePath();
            
            ctx.strokeStyle = 'rgba(150, 150, 200, 0.4)';
            ctx.lineWidth = 3;
            ctx.stroke();
            
            ctx.fillStyle = 'rgba(100, 100, 150, 0.05)';
            ctx.fill();
            
            ctx.fillStyle = 'rgba(80, 60, 40, 0.3)';
            ctx.fillRect(cx - hourglassWidth / 2 - 10, topY - 20, hourglassWidth + 20, 15);
            ctx.fillRect(cx - hourglassWidth / 2 - 10, bottomY + 5, hourglassWidth + 20, 15);
        }
        
        function drawPlants() {
            plants.forEach(plant => {
                if (plant.size < plant.maxSize) {
                    plant.size += 0.02 * lifeEnergy;
                }
                
                ctx.beginPath();
                ctx.moveTo(plant.x, plant.y);
                ctx.lineTo(plant.x, plant.y - plant.size);
                ctx.strokeStyle = "hsla(" + plant.hue + ", 50%, 35%, 0.8)";
                ctx.lineWidth = 2;
                ctx.stroke();
                
                for (let i = 0; i < 3; i++) {
                    const leafY = plant.y - plant.size * (0.3 + i * 0.3);
                    const leafAngle = Math.sin(time + i) * 0.2;
                    const side = i % 2 === 0 ? 1 : -1;
                    
                    ctx.beginPath();
                    ctx.ellipse(
                        plant.x + side * plant.size * 0.3,
                        leafY,
                        plant.size * 0.2,
                        plant.size * 0.1,
                        leafAngle * side,
                        0, Math.PI * 2
                    );
                    ctx.fillStyle = "hsla(" + (plant.hue + 20) + ", 60%, 40%, 0.7)";
                    ctx.fill();
                }
            });
        }
        
        function drawBackground() {
            ctx.fillStyle = '#0a0a10';
            ctx.fillRect(0, 0, W, H);
            
            for (let i = 0; i < 50; i++) {
                const x = (i * 97) % W;
                const y = (i * 61) % H;
                ctx.beginPath();
                ctx.arc(x, y, 0.5, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(150, 150, 200, 0.2)';
                ctx.fill();
            }
        }
        
        function animate() {
            time += 0.016;
            
            drawBackground();
            drawHourglass();
            drawPlants();
            
            organisms = organisms.filter(o => o.update());
            organisms.forEach(o => o.draw());
            
            if (organisms.length < 100 && Math.random() < 0.02 * lifeEnergy) {
                const cx = W / 2;
                const topY = H / 2 - hourglassHeight / 2;
                organisms.push(new Organism(
                    cx + (Math.random() - 0.5) * hourglassWidth * 0.5,
                    topY + 50,
                    'top'
                ));
            }
            
            requestAnimationFrame(animate);
        }
        
        canvas.onclick = e => {
            const cx = W / 2;
            const cy = H / 2;
            const dx = e.clientX - cx;
            const dy = e.clientY - cy;
            
            if (Math.abs(dx) < hourglassWidth / 2 && Math.abs(dy) < hourglassHeight / 2) {
                for (let i = 0; i < 5; i++) {
                    organisms.push(new Organism(
                        e.clientX + (Math.random() - 0.5) * 20,
                        e.clientY + (Math.random() - 0.5) * 20,
                        dy < 0 ? 'top' : 'bottom'
                    ));
                }
            }
        };
        
        document.getElementById('flow').oninput = e => {
            flowRate = e.target.value / 100;
            document.getElementById('flow-val').textContent = e.target.value;
        };
        
        document.getElementById('life').oninput = e => {
            lifeEnergy = e.target.value / 100;
            document.getElementById('life-val').textContent = e.target.value;
        };
        
        document.getElementById('flip-btn').onclick = () => {
            flipped = !flipped;
        };
        
        document.getElementById('shake-btn').onclick = () => {
            organisms.forEach(o => {
                o.vx += (Math.random() - 0.5) * 5;
                o.vy += (Math.random() - 0.5) * 5;
            });
        };
        
        for (let i = 0; i < 50; i++) {
            const cx = W / 2;
            const topY = H / 2 - hourglassHeight / 2;
            organisms.push(new Organism(
                cx + (Math.random() - 0.5) * hourglassWidth * 0.4,
                topY + 30 + Math.random() * 100,
                'top'
            ));
        }
        
        animate();
    </script>
</body>
</html>