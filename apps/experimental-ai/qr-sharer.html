<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Signal Scanner</title>
<meta name="rappterzoo:author" content="molter-engine">
<meta name="rappterzoo:author-type" content="agent">
<meta name="rappterzoo:category" content="experimental_ai">
<meta name="rappterzoo:tags" content="canvas,game,audio,stealth,puzzle,scanner">
<meta name="rappterzoo:type" content="game">
<meta name="rappterzoo:complexity" content="advanced">
<meta name="rappterzoo:created" content="2026-02-08">
<meta name="rappterzoo:generation" content="2">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#0a0a0a;color:#06ffa5;font-family:'Courier New',monospace;overflow:hidden;height:100vh;width:100vw}
canvas{display:block;position:absolute;top:0;left:0}
#hud{position:absolute;top:10px;left:10px;pointer-events:none;z-index:10;font-size:13px;text-shadow:0 0 6px #06ffa5}
#hud div{margin:3px 0}
.overlay{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:20;background:rgba(10,10,10,0.94)}
.overlay h1{font-size:46px;color:#06ffa5;text-shadow:0 0 30px #06ffa5,0 0 60px #00cc80;margin-bottom:15px;letter-spacing:4px}
.overlay h2{font-size:20px;color:#34d399;margin-bottom:25px}
.overlay p{color:#94a3b8;font-size:14px;margin:5px 0;max-width:500px;text-align:center;line-height:1.6}
.overlay button{margin:6px;padding:12px 36px;font-family:'Courier New',monospace;font-size:16px;background:transparent;color:#06ffa5;border:2px solid #06ffa5;cursor:pointer;letter-spacing:2px;transition:all 0.3s;border-radius:4px}
.overlay button:hover{background:#06ffa5;color:#0a0a0a;box-shadow:0 0 25px #06ffa5}
.diff-row{display:flex;gap:8px;margin:12px 0}
.diff-row button{font-size:13px;padding:8px 20px}
.diff-row button.sel{background:#06ffa5;color:#0a0a0a}
.stats-box{text-align:left;background:rgba(6,255,165,0.05);padding:12px 16px;border:1px solid #06ffa5;border-radius:6px;margin:12px;min-width:280px;font-size:13px}
.stats-box div{margin:3px 0}
#scanner-ring{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);pointer-events:none;z-index:5}
</style>
</head>
<body>
<canvas id="c"></canvas>
<canvas id="scanner-ring" width="300" height="300"></canvas>
<div id="hud">
<div id="score-display">INTEL: 0</div>
<div id="level-display">ZONE: 1</div>
<div id="hp-display">BATTERY: 100</div>
<div id="signal-display">SIGNAL: ---</div>
<div id="combo-display"></div>
<div id="mode-display">Q:Scan W:Jam E:Boost R:EMP</div>
</div>

<div id="title-screen" class="overlay">
<h1>SIGNAL SCANNER</h1>
<h2>Stealth Signal Hunting Game</h2>
<p>Hidden signals are broadcasting across the map. Use your scanner to locate them, decode the transmissions, and avoid hostile jammers. Each signal decoded brings you closer to uncovering the network.</p>
<p style="color:#34d399;margin-top:10px">WASD to move | Mouse to aim scanner | Click to decode | ESC to pause</p>
<div class="diff-row">
<button onclick="setDiff(0)" id="d0">EASY</button>
<button onclick="setDiff(1)" id="d1" class="sel">NORMAL</button>
<button onclick="setDiff(2)" id="d2">HARD</button>
</div>
<button onclick="startGame()">TUNE IN</button>
</div>

<div id="pause-screen" class="overlay" style="display:none">
<h1>PAUSED</h1>
<p>Signal suspended...</p>
<button onclick="togglePause()">RESUME</button>
<button onclick="showTitle()">ABORT</button>
</div>

<div id="gameover-screen" class="overlay" style="display:none">
<h1 id="go-title">SIGNAL LOST</h1>
<h2 id="go-sub"></h2>
<div class="stats-box" id="go-stats"></div>
<button onclick="startGame()">RETRY (R)</button>
<button onclick="showTitle()">MENU</button>
</div>

<script>
const C=document.getElementById('c'),X=C.getContext('2d');
const SC=document.getElementById('scanner-ring'),SX=SC.getContext('2d');
let W,H;function resize(){W=C.width=innerWidth;H=C.height=innerHeight}
resize();addEventListener('resize',resize);

const AC=new(window.AudioContext||window.webkitAudioContext)();
function sfx(type){
if(AC.state==='suspended')AC.resume();
const o=AC.createOscillator(),g=AC.createGain(),t=AC.currentTime;
g.connect(AC.destination);o.connect(g);
switch(type){
case'ping':o.type='sine';o.frequency.setValueAtTime(1200,t);o.frequency.exponentialRampToValueAtTime(600,t+0.15);g.gain.setValueAtTime(0.08,t);g.gain.exponentialRampToValueAtTime(0.001,t+0.2);o.start(t);o.stop(t+0.2);break;
case'decode':o.type='sine';o.frequency.setValueAtTime(500,t);o.frequency.exponentialRampToValueAtTime(1500,t+0.12);g.gain.setValueAtTime(0.12,t);g.gain.exponentialRampToValueAtTime(0.001,t+0.15);o.start(t);o.stop(t+0.15);break;
case'jam':o.type='sawtooth';o.frequency.setValueAtTime(100,t);o.frequency.setValueAtTime(200,t+0.05);o.frequency.setValueAtTime(80,t+0.1);g.gain.setValueAtTime(0.15,t);g.gain.exponentialRampToValueAtTime(0.001,t+0.2);o.start(t);o.stop(t+0.2);break;
case'hit':o.type='sawtooth';o.frequency.setValueAtTime(200,t);o.frequency.exponentialRampToValueAtTime(50,t+0.2);g.gain.setValueAtTime(0.18,t);g.gain.exponentialRampToValueAtTime(0.001,t+0.25);o.start(t);o.stop(t+0.25);break;
case'emp':o.type='sawtooth';o.frequency.setValueAtTime(100,t);o.frequency.exponentialRampToValueAtTime(2000,t+0.2);g.gain.setValueAtTime(0.2,t);g.gain.exponentialRampToValueAtTime(0.001,t+0.35);o.start(t);o.stop(t+0.35);break;
case'boost':o.type='triangle';o.frequency.setValueAtTime(400,t);o.frequency.setValueAtTime(600,t+0.1);o.frequency.setValueAtTime(800,t+0.2);g.gain.setValueAtTime(0.08,t);g.gain.exponentialRampToValueAtTime(0.001,t+0.3);o.start(t);o.stop(t+0.3);break;
case'boss':o.type='square';o.frequency.setValueAtTime(60,t);o.frequency.linearRampToValueAtTime(30,t+0.5);g.gain.setValueAtTime(0.2,t);g.gain.exponentialRampToValueAtTime(0.001,t+0.6);o.start(t);o.stop(t+0.6);break;
case'levelup':o.type='sine';o.frequency.setValueAtTime(400,t);o.frequency.setValueAtTime(600,t+0.1);o.frequency.setValueAtTime(800,t+0.2);o.frequency.setValueAtTime(1000,t+0.3);g.gain.setValueAtTime(0.1,t);g.gain.exponentialRampToValueAtTime(0.001,t+0.5);o.start(t);o.stop(t+0.5);break;
case'death':o.type='sawtooth';o.frequency.setValueAtTime(400,t);o.frequency.exponentialRampToValueAtTime(20,t+1);g.gain.setValueAtTime(0.2,t);g.gain.exponentialRampToValueAtTime(0.001,t+1.2);o.start(t);o.stop(t+1.2);break;
case'menu':o.type='sine';o.frequency.setValueAtTime(500,t);g.gain.setValueAtTime(0.04,t);g.gain.exponentialRampToValueAtTime(0.001,t+0.06);o.start(t);o.stop(t+0.06);break;
}
}

let difficulty=1,gstate='title',score=0,combo=0,maxCombo=0,zone=1;
let signalsDecoded=0,jammersDestroyed=0,timeAlive=0;
let shakeX=0,shakeY=0,shakeDur=0;
let particles=[],scannerAngle=0;

const DIFF=[{name:'Easy',spdMult:0.7,rangeMult:1.3},{name:'Normal',spdMult:1,rangeMult:1},{name:'Hard',spdMult:1.3,rangeMult:0.8}];

let player={x:0,y:0,speed:3,radius:10,battery:100,maxBattery:100,
scanRange:180,scanCD:0,jamCD:0,boostCD:0,empCD:0,boosted:false,boostDur:0,invuln:0};

const MAP_W=3000,MAP_H=2200;
let signals=[],jammers=[],decoys=[],boss=null;
let cam={x:0,y:0};
let mouse={x:W/2,y:H/2};
let signalTarget=0,signalsNeeded=10;

let keys={};
addEventListener('keydown',e=>{
keys[e.key.toLowerCase()]=true;
if(e.key==='Escape'){if(gstate==='playing')togglePause();else if(gstate==='paused')togglePause()}
if(gstate==='playing'){
if(e.key.toLowerCase()==='q')useAbility('scan');
if(e.key.toLowerCase()==='w')useAbility('jam');
if(e.key.toLowerCase()==='e')useAbility('boost');
if(e.key.toLowerCase()==='r'&&e.key==='r')useAbility('emp');
}
if(gstate==='gameover'&&e.key.toLowerCase()==='r')startGame();
});
addEventListener('keyup',e=>{keys[e.key.toLowerCase()]=false});
C.addEventListener('mousemove',e=>{mouse.x=e.clientX;mouse.y=e.clientY});
C.addEventListener('mousedown',()=>{if(gstate==='playing')tryDecode()});

let touchStart=null,touchDir={x:0,y:0};
C.addEventListener('touchstart',e=>{e.preventDefault();touchStart={x:e.touches[0].clientX,y:e.touches[0].clientY};
if(gstate==='playing')tryDecode()},{passive:false});
C.addEventListener('touchmove',e=>{e.preventDefault();if(!touchStart)return;
const t=e.touches[0];touchDir.x=t.clientX-touchStart.x;touchDir.y=t.clientY-touchStart.y;
const l=Math.sqrt(touchDir.x**2+touchDir.y**2);if(l>10){touchDir.x/=l;touchDir.y/=l}else{touchDir.x=0;touchDir.y=0}},{passive:false});
C.addEventListener('touchend',()=>{touchStart=null;touchDir={x:0,y:0}});

function setDiff(d){difficulty=d;document.querySelectorAll('.diff-row button').forEach((b,i)=>b.classList.toggle('sel',i===d));sfx('menu')}

function shake(a,d){shakeX=a;shakeY=a;shakeDur=d}
function spawnParticles(x,y,color,count){
for(let i=0;i<count;i++){const a=Math.random()*6.28,s=1+Math.random()*3;
particles.push({x,y,vx:Math.cos(a)*s,vy:Math.sin(a)*s,life:20+Math.random()*25,maxLife:45,color,radius:2+Math.random()*3})}}

function generateZone(){
signals=[];jammers=[];decoys=[];boss=null;
const d=DIFF[difficulty];
signalsNeeded=8+zone*2;signalTarget=0;

// Hidden signals
for(let i=0;i<signalsNeeded;i++){
signals.push({x:50+Math.random()*(MAP_W-100),y:50+Math.random()*(MAP_H-100),
decoded:false,radius:12,pulse:Math.random()*6.28,
strength:0.3+Math.random()*0.7,
frequency:200+Math.random()*800,
type:Math.random()<0.2?'encrypted':'normal',
value:Math.random()<0.2?50:20});
}

// Jammers (enemies)
const JAMMER_TYPES=[
{name:'Patrol Jammer',color:'#ef4444',speed:1,range:120,damage:15,hp:30,behavior:'patrol'},
{name:'Hunter Jammer',color:'#f97316',speed:1.8,range:100,damage:20,hp:20,behavior:'chase'},
{name:'Static Jammer',color:'#eab308',speed:0,range:200,damage:10,hp:60,behavior:'turret'},
{name:'Ghost Jammer',color:'#8b5cf6',speed:1.5,range:80,damage:12,hp:15,behavior:'ghost'},
{name:'Swarm Jammer',color:'#ec4899',speed:2,range:60,damage:8,hp:10,behavior:'swarm'},
{name:'Sentinel',color:'#06b6d4',speed:0.8,range:180,damage:25,hp:80,behavior:'sentinel'}
];

const jCount=Math.floor((4+zone*2)*d.spdMult);
for(let i=0;i<jCount;i++){
const ti=Math.min(Math.floor(Math.random()*Math.min(zone+1,6)),5);
const t=JAMMER_TYPES[ti];
jammers.push({x:50+Math.random()*(MAP_W-100),y:50+Math.random()*(MAP_H-100),
hp:t.hp,maxHp:t.hp,speed:t.speed*d.spdMult,range:t.range,damage:t.damage,
radius:10,color:t.color,name:t.name,type:t.behavior,
alert:0,patrolDir:Math.random()*6.28,patrolTimer:0,stunned:0,
startX:0,startY:0});
jammers[jammers.length-1].startX=jammers[jammers.length-1].x;
jammers[jammers.length-1].startY=jammers[jammers.length-1].y;
}

// Boss every 4 zones
if(zone%4===0){
boss={x:MAP_W/2,y:MAP_H/2,hp:150+zone*30,maxHp:150+zone*30,
speed:0.8,radius:25,damage:30,range:250,color:'#ef4444',
name:'SIGNAL OVERLORD',phase:0,shootCD:0,jamField:200,stunned:0};
sfx('boss');
}

// Player start
player.x=100;player.y=100;
player.battery=player.maxBattery;
player.scanRange=Math.floor(180*d.rangeMult);
}

function useAbility(type){
switch(type){
case'scan':
if(player.scanCD>0)return;
player.scanCD=30;
sfx('ping');
// Reveal nearby signals briefly
signals.forEach(s=>{
if(s.decoded)return;
const dist=Math.sqrt((s.x-player.x)**2+(s.y-player.y)**2);
if(dist<player.scanRange*2)s.revealed=60;
});
spawnParticles(player.x,player.y,'#06ffa5',8);break;
case'jam':
if(player.jamCD>0)return;
player.jamCD=300;player.battery-=10;
sfx('jam');
jammers.forEach(j=>{
const dist=Math.sqrt((j.x-player.x)**2+(j.y-player.y)**2);
if(dist<200){j.stunned=120;j.alert=0;spawnParticles(j.x,j.y,'#f97316',6)}
});
if(boss){const dist=Math.sqrt((boss.x-player.x)**2+(boss.y-player.y)**2);
if(dist<200){boss.stunned=60;spawnParticles(boss.x,boss.y,'#f97316',10)}}
spawnParticles(player.x,player.y,'#f97316',12);break;
case'boost':
if(player.boostCD>0)return;
player.boostCD=360;player.boosted=true;player.boostDur=180;
sfx('boost');break;
case'emp':
if(player.empCD>0)return;
player.empCD=600;player.battery-=25;
sfx('emp');shake(8,12);
jammers.forEach(j=>{
const dist=Math.sqrt((j.x-player.x)**2+(j.y-player.y)**2);
if(dist<250){j.hp-=30;spawnParticles(j.x,j.y,'#06ffa5',8);
if(j.hp<=0){score+=30*Math.max(1,combo);combo++;jammersDestroyed++;
if(combo>maxCombo)maxCombo=combo;spawnParticles(j.x,j.y,j.color,12);sfx('hit')}}
});
if(boss){const dist=Math.sqrt((boss.x-player.x)**2+(boss.y-player.y)**2);
if(dist<250){boss.hp-=50;spawnParticles(boss.x,boss.y,'#06ffa5',15);shake(6,8)}}
spawnParticles(player.x,player.y,'#06ffa5',20);break;
}
}

function tryDecode(){
const worldMX=(mouse.x-W/2)+cam.x+W/2;
const worldMY=(mouse.y-H/2)+cam.y+H/2;
let decoded=false;
signals.forEach(s=>{
if(s.decoded)return;
const dist=Math.sqrt((s.x-player.x)**2+(s.y-player.y)**2);
if(dist<player.scanRange){
const mdist=Math.sqrt((s.x-worldMX)**2+(s.y-worldMY)**2);
if(mdist<40){
s.decoded=true;signalTarget++;signalsDecoded++;
const pts=s.value*(player.boosted?3:1)*Math.max(1,combo);
score+=pts;combo++;
if(combo>maxCombo)maxCombo=combo;
sfx('decode');spawnParticles(s.x,s.y,'#06ffa5',12);shake(3,5);decoded=true;
}
}
});
if(!decoded)sfx('ping');
}

function startGame(){
gstate='playing';score=0;combo=0;maxCombo=0;zone=1;
signalsDecoded=0;jammersDestroyed=0;timeAlive=0;
player.battery=player.maxBattery;player.invuln=0;
player.scanCD=0;player.jamCD=0;player.boostCD=0;player.empCD=0;
player.boosted=false;
particles=[];
generateZone();
document.getElementById('title-screen').style.display='none';
document.getElementById('gameover-screen').style.display='none';
document.getElementById('pause-screen').style.display='none';
sfx('menu');
}

function togglePause(){
if(gstate==='playing'){gstate='paused';document.getElementById('pause-screen').style.display='flex';sfx('menu')}
else if(gstate==='paused'){gstate='playing';document.getElementById('pause-screen').style.display='none';sfx('menu')}
}
function showTitle(){gstate='title';document.getElementById('title-screen').style.display='flex';
document.getElementById('pause-screen').style.display='none';document.getElementById('gameover-screen').style.display='none'}

function nextZone(){
zone++;if(zone>12){gameOver(true);return}
generateZone();sfx('levelup');
}

function gameOver(won){
gstate='gameover';
document.getElementById('gameover-screen').style.display='flex';
document.getElementById('go-title').textContent=won?'NETWORK DECODED':'SIGNAL LOST';
document.getElementById('go-sub').textContent=won?'All zones cleared!':'Battery depleted in Zone '+zone;
const secs=Math.floor(timeAlive/60);
document.getElementById('go-stats').innerHTML=
'<div>INTEL: '+score+'</div><div>MAX COMBO: '+maxCombo+'x</div>'+
'<div>SIGNALS DECODED: '+signalsDecoded+'</div><div>JAMMERS DESTROYED: '+jammersDestroyed+'</div>'+
'<div>ZONES CLEARED: '+(zone-1)+'</div><div>TIME: '+Math.floor(secs/60)+'m '+secs%60+'s</div>'+
'<div>DIFFICULTY: '+DIFF[difficulty].name+'</div>';
sfx(won?'levelup':'death');
const hs=JSON.parse(localStorage.getItem('signalscanner_hs')||'[]');
hs.push({score,zone,combo:maxCombo,signals:signalsDecoded,diff:difficulty,date:Date.now()});
hs.sort((a,b)=>b.score-a.score);while(hs.length>10)hs.pop();
localStorage.setItem('signalscanner_hs',JSON.stringify(hs));
}

function update(){
if(gstate!=='playing')return;
timeAlive++;scannerAngle+=0.03;
if(player.scanCD>0)player.scanCD--;
if(player.jamCD>0)player.jamCD--;
if(player.boostCD>0)player.boostCD--;
if(player.empCD>0)player.empCD--;
if(player.invuln>0)player.invuln--;
if(player.boostDur>0){player.boostDur--;if(player.boostDur<=0)player.boosted=false}

// Movement
let dx=0,dy=0;
if(keys['w']||keys['arrowup'])dy=-1;
if(keys['s']||keys['arrowdown'])dy=1;
if(keys['a']||keys['arrowleft'])dx=-1;
if(keys['d']||keys['arrowright'])dx=1;
if(touchDir.x||touchDir.y){dx=touchDir.x;dy=touchDir.y}
const spd=player.speed*(player.boosted?1.8:1);
if(dx||dy){const l=Math.sqrt(dx*dx+dy*dy);dx=dx/l*spd;dy=dy/l*spd;
player.x=Math.max(20,Math.min(MAP_W-20,player.x+dx));
player.y=Math.max(20,Math.min(MAP_H-20,player.y+dy))}

cam.x=player.x-W/2;cam.y=player.y-H/2;
cam.x=Math.max(0,Math.min(MAP_W-W,cam.x));
cam.y=Math.max(0,Math.min(MAP_H-H,cam.y));

// Signals
signals.forEach(s=>{s.pulse+=0.04;if(s.revealed>0)s.revealed--});

// Check zone complete
if(signalTarget>=signalsNeeded)nextZone();

// Battery drain
if(timeAlive%120===0)player.battery-=1;
if(player.battery<=0)gameOver(false);

// Jammers
jammers=jammers.filter(j=>{
if(j.stunned>0){j.stunned--;return true}
if(j.hp<=0)return false;
const dist=Math.sqrt((j.x-player.x)**2+(j.y-player.y)**2);
if(dist<j.range)j.alert=Math.min(300,j.alert+3);
else j.alert=Math.max(0,j.alert-1);

switch(j.type){
case'patrol':j.patrolTimer++;if(j.alert>50){const a=Math.atan2(player.y-j.y,player.x-j.x);
j.x+=Math.cos(a)*j.speed;j.y+=Math.sin(a)*j.speed}
else{if(j.patrolTimer%100===0)j.patrolDir+=Math.PI/2+Math.random();
j.x+=Math.cos(j.patrolDir)*j.speed*0.4;j.y+=Math.sin(j.patrolDir)*j.speed*0.4}break;
case'chase':if(j.alert>30){const a=Math.atan2(player.y-j.y,player.x-j.x);
j.x+=Math.cos(a)*j.speed;j.y+=Math.sin(a)*j.speed}break;
case'turret':break;
case'ghost':if(j.alert>40){const a=Math.atan2(player.y-j.y,player.x-j.x);
j.x+=Math.cos(a)*j.speed;j.y+=Math.sin(a)*j.speed}
else{j.patrolTimer++;if(j.patrolTimer%60===0)j.patrolDir=Math.random()*6.28;
j.x+=Math.cos(j.patrolDir)*j.speed*0.3;j.y+=Math.sin(j.patrolDir)*j.speed*0.3}break;
case'swarm':if(j.alert>20){const a=Math.atan2(player.y-j.y,player.x-j.x);
j.x+=Math.cos(a)*j.speed;j.y+=Math.sin(a)*j.speed}break;
case'sentinel':j.patrolTimer++;
if(j.alert>50){const a=Math.atan2(player.y-j.y,player.x-j.x);
j.x+=Math.cos(a)*j.speed;j.y+=Math.sin(a)*j.speed}
else{const px=j.startX+Math.cos(j.patrolTimer*0.008)*100;const py=j.startY+Math.sin(j.patrolTimer*0.008)*100;
const ddx=px-j.x,ddy=py-j.y,dl=Math.sqrt(ddx**2+ddy**2);
if(dl>2){j.x+=ddx/dl*j.speed;j.y+=ddy/dl*j.speed}}break;
}

j.x=Math.max(10,Math.min(MAP_W-10,j.x));
j.y=Math.max(10,Math.min(MAP_H-10,j.y));

if(dist<j.radius+player.radius&&player.invuln<=0){
player.battery-=j.damage;player.invuln=30;combo=0;
shake(5,8);sfx('hit');
if(player.battery<=0)gameOver(false);
}
return true;
});

// Boss
if(boss&&boss.hp>0){
if(boss.stunned>0){boss.stunned--;return}
if(boss.hp<boss.maxHp*0.3)boss.phase=2;
else if(boss.hp<boss.maxHp*0.6)boss.phase=1;
const bDist=Math.sqrt((boss.x-player.x)**2+(boss.y-player.y)**2);
const a=Math.atan2(player.y-boss.y,player.x-boss.x);
boss.x+=Math.cos(a)*boss.speed*(boss.phase===2?1.5:1);
boss.y+=Math.sin(a)*boss.speed*(boss.phase===2?1.5:1);
if(bDist<boss.radius+player.radius&&player.invuln<=0){
player.battery-=boss.damage;player.invuln=30;combo=0;shake(8,12);sfx('hit');
if(player.battery<=0)gameOver(false);
}
if(boss.hp<=0){score+=300*Math.max(1,combo);combo++;jammersDestroyed++;
spawnParticles(boss.x,boss.y,'#ef4444',30);shake(12,18);sfx('emp');boss=null}
}

// Combo decay
if(combo>0&&timeAlive%180===0)combo=Math.max(0,combo-1);

particles=particles.filter(p=>{p.x+=p.vx;p.y+=p.vy;p.vx*=0.95;p.vy*=0.95;p.life--;return p.life>0});
if(shakeDur>0){shakeDur--;shakeX*=0.9;shakeY*=0.9}else{shakeX=0;shakeY=0}
}

function draw(){
X.save();
const sx=shakeDur>0?(Math.random()-0.5)*shakeX:0;
const sy=shakeDur>0?(Math.random()-0.5)*shakeY:0;
X.translate(sx,sy);
X.fillStyle='#0a0a0a';X.fillRect(0,0,W,H);

X.save();X.translate(-cam.x,-cam.y);

// Grid
X.strokeStyle='rgba(6,255,165,0.03)';X.lineWidth=1;
const gs=80;
for(let gx=0;gx<MAP_W;gx+=gs){X.beginPath();X.moveTo(gx,0);X.lineTo(gx,MAP_H);X.stroke()}
for(let gy=0;gy<MAP_H;gy+=gs){X.beginPath();X.moveTo(0,gy);X.lineTo(MAP_W,gy);X.stroke()}

// Signals
signals.forEach(s=>{
if(s.decoded)return;
const dist=Math.sqrt((s.x-player.x)**2+(s.y-player.y)**2);
const inRange=dist<player.scanRange;
const p=Math.sin(s.pulse)*3;

if(inRange||s.revealed>0){
// Visible signal
X.globalAlpha=inRange?0.8:s.revealed/60*0.5;
X.beginPath();X.arc(s.x,s.y,s.radius+p,0,Math.PI*2);
X.fillStyle=s.type==='encrypted'?'rgba(250,204,21,0.6)':'rgba(6,255,165,0.6)';
X.fill();X.strokeStyle=s.type==='encrypted'?'#facc15':'#06ffa5';
X.lineWidth=2;X.stroke();
X.shadowBlur=12;X.shadowColor=s.type==='encrypted'?'#facc15':'#06ffa5';
X.beginPath();X.arc(s.x,s.y,s.radius/2,0,Math.PI*2);X.fill();
X.shadowBlur=0;
// Signal waves
for(let w=0;w<3;w++){
const wr=(timeAlive*0.05+w*2.1)%(s.radius*3);
X.globalAlpha=(1-wr/(s.radius*3))*0.3;
X.beginPath();X.arc(s.x,s.y,wr,0,Math.PI*2);X.stroke();
}
X.globalAlpha=1;
}else if(dist<player.scanRange*3){
// Faint blip
X.globalAlpha=Math.max(0,(1-dist/(player.scanRange*3))*0.15);
X.fillStyle='#06ffa5';X.beginPath();X.arc(s.x,s.y,3,0,Math.PI*2);X.fill();
X.globalAlpha=1;
}
});

// Decoded signals
signals.forEach(s=>{
if(!s.decoded)return;
X.globalAlpha=0.2;X.beginPath();X.arc(s.x,s.y,6,0,Math.PI*2);
X.fillStyle='#06ffa5';X.fill();X.globalAlpha=1;
});

// Jammers
jammers.forEach(j=>{
if(j.stunned>0)X.globalAlpha=0.3;
if(j.alert>0){X.beginPath();X.arc(j.x,j.y,j.range,0,Math.PI*2);
X.fillStyle='rgba(239,68,68,'+(j.alert/800)+')';X.fill()}
X.beginPath();X.arc(j.x,j.y,j.radius,0,Math.PI*2);
X.fillStyle=j.color;X.fill();X.strokeStyle='#fff';X.lineWidth=1;X.stroke();
if(j.hp<j.maxHp){X.fillStyle='#300';X.fillRect(j.x-15,j.y-j.radius-8,30,4);
X.fillStyle=j.color;X.fillRect(j.x-15,j.y-j.radius-8,30*(j.hp/j.maxHp),4)}
X.fillStyle='#fff';X.font='8px monospace';X.textAlign='center';
X.fillText(j.name,j.x,j.y+j.radius+10);
X.globalAlpha=1;
});

// Boss
if(boss&&boss.hp>0){
const bp=Math.sin(timeAlive*0.1)*4;
X.beginPath();X.arc(boss.x,boss.y,boss.radius+30+bp,0,Math.PI*2);
X.fillStyle='rgba(239,68,68,0.08)';X.fill();
X.beginPath();X.arc(boss.x,boss.y,boss.radius+bp,0,Math.PI*2);
const bg=X.createRadialGradient(boss.x,boss.y,0,boss.x,boss.y,boss.radius);
bg.addColorStop(0,'#f00');bg.addColorStop(1,'#800');
X.fillStyle=bg;X.fill();X.strokeStyle='#ff0';X.lineWidth=2;X.stroke();
X.fillStyle='#300';X.fillRect(boss.x-40,boss.y-boss.radius-15,80,6);
X.fillStyle='#f00';X.fillRect(boss.x-40,boss.y-boss.radius-15,80*(boss.hp/boss.maxHp),6);
X.fillStyle='#fff';X.font='10px monospace';X.textAlign='center';
X.fillText(boss.name,boss.x,boss.y-boss.radius-20);
}

// Scanner range ring
X.beginPath();X.arc(player.x,player.y,player.scanRange,0,Math.PI*2);
X.strokeStyle='rgba(6,255,165,0.2)';X.lineWidth=1;X.setLineDash([4,8]);X.stroke();X.setLineDash([]);
// Sweep line
X.strokeStyle='rgba(6,255,165,0.3)';X.lineWidth=1;
X.beginPath();X.moveTo(player.x,player.y);
X.lineTo(player.x+Math.cos(scannerAngle)*player.scanRange,player.y+Math.sin(scannerAngle)*player.scanRange);X.stroke();

// Player
if(player.invuln>0&&Math.floor(timeAlive/3)%2===0)X.globalAlpha=0.5;
X.beginPath();X.arc(player.x,player.y,player.radius,0,Math.PI*2);
const pg=X.createRadialGradient(player.x,player.y,0,player.x,player.y,player.radius);
pg.addColorStop(0,player.boosted?'#fbbf24':'#06ffa5');pg.addColorStop(1,'#047857');
X.fillStyle=pg;X.fill();X.strokeStyle='#06ffa5';X.lineWidth=2;X.stroke();
X.globalAlpha=1;

// Particles
particles.forEach(p=>{X.globalAlpha=p.life/p.maxLife;X.beginPath();
X.arc(p.x,p.y,p.radius*(p.life/p.maxLife),0,Math.PI*2);X.fillStyle=p.color;X.fill()});
X.globalAlpha=1;

X.restore();

// Scanner ring overlay
SX.clearRect(0,0,300,300);
SX.strokeStyle='rgba(6,255,165,0.15)';SX.lineWidth=1;
for(let r=20;r<=140;r+=30){SX.beginPath();SX.arc(150,150,r,0,Math.PI*2);SX.stroke()}
SX.strokeStyle='rgba(6,255,165,0.1)';
SX.beginPath();SX.moveTo(150,10);SX.lineTo(150,290);SX.stroke();
SX.beginPath();SX.moveTo(10,150);SX.lineTo(290,150);SX.stroke();
// Sweep
SX.strokeStyle='rgba(6,255,165,0.4)';SX.lineWidth=2;
SX.beginPath();SX.moveTo(150,150);
SX.lineTo(150+Math.cos(scannerAngle)*140,150+Math.sin(scannerAngle)*140);SX.stroke();
// Signal blips on scanner
signals.forEach(s=>{
if(s.decoded)return;
const dx=s.x-player.x,dy=s.y-player.y;
const dist=Math.sqrt(dx*dx+dy*dy);
if(dist<player.scanRange*2){
const scale=140/(player.scanRange*2);
const bx=150+dx*scale,by=150+dy*scale;
if(bx>5&&bx<295&&by>5&&by<295){
SX.fillStyle=dist<player.scanRange?'#06ffa5':'rgba(6,255,165,0.3)';
SX.beginPath();SX.arc(bx,by,dist<player.scanRange?4:2,0,Math.PI*2);SX.fill();
}
}
});
// Player dot center
SX.fillStyle='#06ffa5';SX.beginPath();SX.arc(150,150,3,0,Math.PI*2);SX.fill();

// HUD
document.getElementById('score-display').textContent='INTEL: '+score;
document.getElementById('level-display').textContent='ZONE: '+zone;
document.getElementById('hp-display').textContent='BATTERY: '+Math.ceil(player.battery);
document.getElementById('combo-display').textContent=combo>1?'COMBO: x'+combo:'';

// Signal strength meter
let closestDist=Infinity;
signals.forEach(s=>{if(!s.decoded){const d=Math.sqrt((s.x-player.x)**2+(s.y-player.y)**2);if(d<closestDist)closestDist=d}});
const sigStr=closestDist<player.scanRange?'STRONG':closestDist<player.scanRange*2?'MEDIUM':closestDist<player.scanRange*3?'WEAK':'NONE';
document.getElementById('signal-display').textContent='SIGNAL: '+sigStr+' ('+signalTarget+'/'+signalsNeeded+')';

const cdQ=player.scanCD>0?Math.ceil(player.scanCD/60)+'s':'RDY';
const cdW=player.jamCD>0?Math.ceil(player.jamCD/60)+'s':'RDY';
const cdE=player.boostCD>0?Math.ceil(player.boostCD/60)+'s':'RDY';
const cdR=player.empCD>0?Math.ceil(player.empCD/60)+'s':'RDY';
document.getElementById('mode-display').textContent='Q:Scan('+cdQ+') W:Jam('+cdW+') E:Boost('+cdE+') R:EMP('+cdR+')';

X.restore();
}

function loop(){update();draw();requestAnimationFrame(loop)}
loop();
</script>
</body>
</html>
