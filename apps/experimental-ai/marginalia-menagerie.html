<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marginalia Menagerie</title>
    <meta name="description" content="Interactive illuminated manuscript where marginal creatures come alive, escape their frames, and comment on self-writing medieval text">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #2a1810;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            padding: 20px;
            font-family: "Palatino Linotype", "Book Antiqua", Palatino, serif;
        }
        .manuscript {
            width: 100%;
            max-width: 900px;
            background: linear-gradient(135deg, #f4e4bc 0%, #e8d5a3 50%, #dcc68c 100%);
            border: 20px solid #8b4513;
            border-image: linear-gradient(45deg, #654321, #8b4513, #a0522d, #8b4513, #654321) 1;
            padding: 40px;
            position: relative;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5), inset 0 0 100px rgba(139,69,19,0.1);
            min-height: 90vh;
        }
        .manuscript::before {
            content: "";
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: url("data:image/svg+xml,%3Csvg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' /%3E%3C/filter%3E%3Crect width='100' height='100' filter='url(%23noise)' opacity='0.05'/%3E%3C/svg%3E");
            pointer-events: none;
        }
        .margin-left, .margin-right {
            position: absolute;
            top: 40px;
            width: 100px;
            height: calc(100% - 80px);
            overflow: visible;
        }
        .margin-left { left: -80px; }
        .margin-right { right: -80px; }
        .text-area {
            position: relative;
            padding: 20px 60px;
            line-height: 2.2;
            color: #2a1810;
            font-size: 18px;
        }
        .drop-cap {
            float: left;
            font-size: 72px;
            line-height: 0.8;
            padding: 0 10px 0 0;
            color: #8b0000;
            font-family: "Times New Roman", serif;
            text-shadow: 2px 2px 0 #ffd700;
        }
        .text-line {
            opacity: 0;
            animation: fadeIn 0.5s forwards;
        }
        @keyframes fadeIn { to { opacity: 1; } }
        .creature {
            position: absolute;
            cursor: pointer;
            transition: transform 0.3s;
            filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.3));
        }
        .creature:hover { transform: scale(1.2); }
        .creature.escaped {
            animation: wander 8s infinite ease-in-out;
        }
        @keyframes wander {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(50px, -30px) rotate(10deg); }
            50% { transform: translate(100px, 20px) rotate(-5deg); }
            75% { transform: translate(30px, 50px) rotate(15deg); }
        }
        .palimpsest {
            position: absolute;
            opacity: 0;
            color: #8b4513;
            font-style: italic;
            font-size: 14px;
            pointer-events: none;
            transition: opacity 0.5s;
        }
        .commentary {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #f4e4bc;
            border: 3px solid #8b4513;
            padding: 15px 25px;
            font-style: italic;
            color: #2a1810;
            max-width: 400px;
            text-align: center;
            opacity: 0;
            transition: opacity 0.5s;
            z-index: 100;
        }
        .commentary.visible { opacity: 1; }
        .gilded-border {
            position: absolute;
            top: 10px; left: 10px; right: 10px; bottom: 10px;
            border: 4px double #c5a028;
            pointer-events: none;
        }
        .instructions {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(42,24,16,0.9);
            color: #f4e4bc;
            padding: 10px 15px;
            font-size: 12px;
            border-radius: 5px;
            z-index: 100;
        }
        svg { overflow: visible; }
    </style>
</head>
<body>
    <div class="manuscript">
        <div class="gilded-border"></div>
        <div class="margin-left" id="marginLeft"></div>
        <div class="margin-right" id="marginRight"></div>
        <div class="text-area" id="textArea"></div>
    </div>
    <div class="commentary" id="commentary"></div>
    <div class="instructions">Click creatures to hear their commentary<br>Hold on text to reveal palimpsest beneath</div>

    <script>
        const medievalText = [
            { dropcap: "I", text: "n the beginning of all things there was naught but the void and the word, and the word was written upon parchment most sacred." },
            { text: "The scribes of old did labour mightily, their quills scratching wisdom into the margins of eternity." },
            { text: "And lo, the creatures of fancy did dwell in the borders, watching and waiting, ever mischievous." },
            { dropcap: "T", text: "hus spake the ancients: that knowledge guarded by grotesques shall endure beyond the ages of men." },
            { text: "The rabbits with spears did stand vigilant, the snails bore knights upon their shells, and dragons coiled about the letters most illuminated." },
            { text: "In this manner was the wisdom preserved, though the wise know that the margins tell truths the center dare not speak." },
            { dropcap: "B", text: "ehold the palimpsest beneath, where older secrets lie buried under newer proclamations." },
            { text: "For every page hath its ghost, and every letter its ancestor, and the patient reader may yet discern what was scraped away." }
        ];
        
        const palimpsestTexts = [
            "...the forbidden recipe for transforming lead into gold...",
            "...here lies the truth about the Bishop and the goose...",
            "...the map to the treasure buried beneath the abbey...",
            "...never trust a monk who smiles too often...",
            "...the dragon was real, whatever they tell you now..."
        ];
        
        const creatureTypes = [
            { name: "snail-knight", svg: createSnailKnight, comments: ["This text is most tedious. I shall joust it!", "Onwards! To the next paragraph!", "Mine armor is my shell, mine patience infinite."] },
            { name: "rabbit-warrior", svg: createRabbitWarrior, comments: ["The monks think themselves wise, but we rabbits know better.", "This margin grows cramped. I shall venture forth!", "Fear not the wolf who howls, but the hare who plans."] },
            { name: "dragon-letter", svg: createDragonLetter, comments: ["These words taste of old cheese and older lies.", "I have coiled about greater letters than this.", "Fire cleanses all, even bad grammar."] },
            { name: "grotesque", svg: createGrotesque, comments: ["Bah! In my day, manuscripts had proper illumination!", "These margins are perfectly adequate for napping.", "I have witnessed twelve centuries of footnotes."] },
            { name: "hybrid-beast", svg: createHybridBeast, comments: ["Am I fish or fowl? Even I know not!", "The scribe who drew me was clearly in his cups.", "Half of me wishes to swim, half to fly, and neither succeeds."] }
        ];
        
        function createSnailKnight() {
            return `<svg width="60" height="50" viewBox="0 0 60 50">
                <ellipse cx="25" cy="35" rx="20" ry="12" fill="#c9a959"/>
                <path d="M25 25 Q35 15 25 8 Q15 15 25 25" fill="#8b7355"/>
                <circle cx="40" cy="30" r="8" fill="#d4a574"/>
                <rect x="38" y="15" width="4" height="15" fill="#666"/>
                <polygon points="40,10 35,18 45,18" fill="#c41e3a"/>
                <circle cx="42" cy="28" r="2" fill="#333"/>
            </svg>`;
        }
        
        function createRabbitWarrior() {
            return `<svg width="50" height="60" viewBox="0 0 50 60">
                <ellipse cx="25" cy="45" rx="15" ry="12" fill="#e8dcc8"/>
                <ellipse cx="25" cy="30" rx="12" ry="10" fill="#e8dcc8"/>
                <ellipse cx="18" cy="12" rx="5" ry="15" fill="#e8dcc8"/>
                <ellipse cx="32" cy="12" rx="5" ry="15" fill="#e8dcc8"/>
                <circle cx="20" cy="28" r="2" fill="#8b0000"/>
                <circle cx="30" cy="28" r="2" fill="#8b0000"/>
                <line x1="40" y1="20" x2="48" y2="5" stroke="#654321" stroke-width="2"/>
                <polygon points="48,5 45,12 51,10" fill="#666"/>
            </svg>`;
        }
        
        function createDragonLetter() {
            return `<svg width="70" height="50" viewBox="0 0 70 50">
                <path d="M10 40 Q5 30 15 25 Q25 20 35 25 Q45 20 55 25 Q65 30 60 40" fill="#2e8b57" stroke="#1a5c38" stroke-width="2"/>
                <path d="M55 25 Q60 15 65 20" fill="none" stroke="#2e8b57" stroke-width="3"/>
                <circle cx="58" cy="22" r="3" fill="#ffd700"/>
                <circle cx="58" cy="22" r="1.5" fill="#333"/>
                <path d="M62 25 L68 23 L65 28 Z" fill="#c41e3a"/>
                <path d="M20 22 L18 15 M30 20 L28 12 M40 20 L42 12" stroke="#2e8b57" stroke-width="2"/>
            </svg>`;
        }
        
        function createGrotesque() {
            return `<svg width="50" height="55" viewBox="0 0 50 55">
                <circle cx="25" cy="25" r="20" fill="#9b8b7a"/>
                <circle cx="18" cy="20" r="6" fill="#fff"/>
                <circle cx="32" cy="20" r="6" fill="#fff"/>
                <circle cx="18" cy="20" r="3" fill="#333"/>
                <circle cx="32" cy="20" r="3" fill="#333"/>
                <ellipse cx="25" cy="32" rx="8" ry="5" fill="#654321"/>
                <path d="M15 40 Q25 50 35 40" fill="none" stroke="#654321" stroke-width="2"/>
                <path d="M8 15 Q5 5 15 10" fill="#9b8b7a"/>
                <path d="M42 15 Q45 5 35 10" fill="#9b8b7a"/>
            </svg>`;
        }
        
        function createHybridBeast() {
            return `<svg width="60" height="50" viewBox="0 0 60 50">
                <ellipse cx="30" cy="30" rx="20" ry="15" fill="#6b8e9f"/>
                <path d="M45 25 Q55 20 50 30 Q55 35 45 35" fill="#6b8e9f"/>
                <circle cx="20" cy="25" r="8" fill="#e8dcc8"/>
                <circle cx="18" cy="23" r="2" fill="#333"/>
                <path d="M15 28 L12 30 L15 32" fill="#ffa500"/>
                <path d="M25 15 Q30 5 35 15" fill="#4a7c8c"/>
                <path d="M20 15 Q25 3 30 15" fill="#4a7c8c"/>
                <ellipse cx="35" cy="40" rx="6" ry="8" fill="#6b8e9f"/>
            </svg>`;
        }
        
        const textArea = document.getElementById("textArea");
        const marginLeft = document.getElementById("marginLeft");
        const marginRight = document.getElementById("marginRight");
        const commentaryEl = document.getElementById("commentary");
        
        let creatures = [];
        let textIndex = 0;
        let charIndex = 0;
        let currentLine = null;
        
        function spawnCreature(margin, yPos) {
            const type = creatureTypes[Math.floor(Math.random() * creatureTypes.length)];
            const creature = document.createElement("div");
            creature.className = "creature";
            creature.innerHTML = type.svg();
            creature.style.top = yPos + "px";
            creature.dataset.comments = JSON.stringify(type.comments);
            
            if (margin === "left") {
                creature.style.left = Math.random() * 40 + "px";
                marginLeft.appendChild(creature);
            } else {
                creature.style.right = Math.random() * 40 + "px";
                marginRight.appendChild(creature);
            }
            
            creature.addEventListener("click", () => showCommentary(creature));
            
            // Random chance to escape
            if (Math.random() < 0.2) {
                setTimeout(() => {
                    creature.classList.add("escaped");
                    creature.style.position = "fixed";
                    creature.style.left = Math.random() * (window.innerWidth - 100) + "px";
                    creature.style.top = Math.random() * (window.innerHeight - 100) + "px";
                    creature.style.zIndex = "50";
                }, Math.random() * 10000 + 5000);
            }
            
            creatures.push(creature);
        }
        
        function showCommentary(creature) {
            const comments = JSON.parse(creature.dataset.comments);
            const comment = comments[Math.floor(Math.random() * comments.length)];
            commentaryEl.textContent = `"${comment}"`;
            commentaryEl.classList.add("visible");
            setTimeout(() => commentaryEl.classList.remove("visible"), 3000);
        }
        
        function addPalimpsest(line, delay) {
            const palimpsest = document.createElement("div");
            palimpsest.className = "palimpsest";
            palimpsest.textContent = palimpsestTexts[Math.floor(Math.random() * palimpsestTexts.length)];
            palimpsest.style.top = "-15px";
            palimpsest.style.left = Math.random() * 100 + "px";
            line.style.position = "relative";
            line.appendChild(palimpsest);
            
            let holdTimer;
            line.addEventListener("mousedown", () => {
                holdTimer = setTimeout(() => {
                    palimpsest.style.opacity = "0.6";
                }, 500);
            });
            line.addEventListener("mouseup", () => {
                clearTimeout(holdTimer);
                palimpsest.style.opacity = "0";
            });
            line.addEventListener("mouseleave", () => {
                clearTimeout(holdTimer);
                palimpsest.style.opacity = "0";
            });
        }
        
        function typeText() {
            if (textIndex >= medievalText.length) {
                textIndex = 0;
                textArea.innerHTML = "";
                creatures.forEach(c => c.remove());
                creatures = [];
            }
            
            const para = medievalText[textIndex];
            
            if (charIndex === 0) {
                currentLine = document.createElement("p");
                currentLine.className = "text-line";
                currentLine.style.animationDelay = "0s";
                
                if (para.dropcap) {
                    const dropCap = document.createElement("span");
                    dropCap.className = "drop-cap";
                    dropCap.textContent = para.dropcap;
                    currentLine.appendChild(dropCap);
                }
                
                textArea.appendChild(currentLine);
                addPalimpsest(currentLine, textIndex * 1000);
                
                // Spawn creatures periodically
                if (textIndex % 2 === 0) {
                    spawnCreature("left", textIndex * 80 + 50);
                } else {
                    spawnCreature("right", textIndex * 80 + 50);
                }
            }
            
            const textContent = para.dropcap ? para.text : para.text;
            const startIndex = para.dropcap && charIndex === 0 ? 0 : charIndex;
            
            if (charIndex < textContent.length) {
                const textNode = document.createTextNode(textContent[charIndex]);
                currentLine.appendChild(textNode);
                charIndex++;
                setTimeout(typeText, 30 + Math.random() * 40);
            } else {
                charIndex = 0;
                textIndex++;
                setTimeout(typeText, 500);
            }
        }
        
        // Animate existing creatures
        function animateCreatures() {
            creatures.forEach(creature => {
                if (!creature.classList.contains("escaped")) {
                    const wobble = Math.sin(Date.now() / 1000 + Math.random() * 10) * 3;
                    creature.style.transform = `translateY(${wobble}px)`;
                }
            });
            requestAnimationFrame(animateCreatures);
        }
        
        // Start the experience
        setTimeout(typeText, 1000);
        animateCreatures();
        
        // Initial creatures
        spawnCreature("left", 100);
        spawnCreature("right", 200);
        spawnCreature("left", 350);
    </script>
</body>
</html>