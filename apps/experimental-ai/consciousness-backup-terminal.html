<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consciousness Backup Terminal</title>
    <meta name="description" content="Upload your personality through existential questions and create a living digital twin that evolves and diverges from who you were">
    <meta name="theme-color" content="#001a00">
    <meta name="color-scheme" content="dark">
    <!-- experimental, ai, psychology, terminal, retro, philosophical -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #0a0a0a;
            min-height: 100vh;
            font-family: 'VT323', monospace;
            overflow: hidden;
        }

        .crt {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .crt::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                transparent 50%,
                rgba(0, 0, 0, 0.1) 50%
            );
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 1000;
        }

        .crt::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(
                ellipse at center,
                transparent 0%,
                rgba(0, 0, 0, 0.3) 90%,
                rgba(0, 0, 0, 0.6) 100%
            );
            pointer-events: none;
            z-index: 999;
        }

        .screen {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            bottom: 20px;
            background: #001a00;
            border: 3px solid #0f0;
            border-radius: 20px;
            padding: 30px;
            display: flex;
            flex-direction: column;
            box-shadow:
                0 0 20px rgba(0, 255, 0, 0.3),
                inset 0 0 60px rgba(0, 255, 0, 0.1);
            overflow: hidden;
        }

        .flicker {
            animation: flicker 0.15s infinite;
        }

        @keyframes flicker {
            0% { opacity: 0.97; }
            50% { opacity: 1; }
            100% { opacity: 0.98; }
        }

        .header {
            color: #0f0;
            font-size: 24px;
            text-align: center;
            padding-bottom: 15px;
            border-bottom: 2px solid #0a0;
            margin-bottom: 15px;
            text-shadow: 0 0 10px #0f0;
        }

        .header-subtitle {
            font-size: 14px;
            color: #0a0;
            margin-top: 5px;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #050;
            margin-bottom: 15px;
            font-size: 14px;
            color: #0a0;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #0f0;
            animation: pulse 1s ease-in-out infinite;
        }

        .status-dot.warning {
            background: #ff0;
            animation: pulse-warn 0.5s ease-in-out infinite;
        }

        .status-dot.critical {
            background: #f00;
            animation: pulse-crit 0.3s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; box-shadow: 0 0 5px #0f0; }
            50% { opacity: 0.5; box-shadow: 0 0 2px #0f0; }
        }

        @keyframes pulse-warn {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        @keyframes pulse-crit {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.2; }
        }

        .terminal-output {
            flex: 1;
            overflow-y: auto;
            padding-right: 10px;
            margin-bottom: 15px;
        }

        .terminal-output::-webkit-scrollbar {
            width: 8px;
        }

        .terminal-output::-webkit-scrollbar-track {
            background: #001a00;
        }

        .terminal-output::-webkit-scrollbar-thumb {
            background: #0a0;
            border-radius: 4px;
        }

        .line {
            color: #0f0;
            font-size: 18px;
            line-height: 1.5;
            margin-bottom: 5px;
            text-shadow: 0 0 5px rgba(0, 255, 0, 0.5);
        }

        .line.system {
            color: #0a0;
        }

        .line.error {
            color: #f44;
            text-shadow: 0 0 5px rgba(255, 68, 68, 0.5);
        }

        .line.warning {
            color: #ff0;
            text-shadow: 0 0 5px rgba(255, 255, 0, 0.5);
        }

        .line.highlight {
            color: #0ff;
            text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
        }

        .line.twin {
            color: #f0f;
            text-shadow: 0 0 5px rgba(255, 0, 255, 0.5);
        }

        .line.user {
            color: #fff;
        }

        .line .prompt {
            color: #0f0;
        }

        .question-phase {
            color: #0ff;
            font-size: 12px;
            margin-bottom: 10px;
        }

        .input-area {
            display: flex;
            gap: 10px;
            padding-top: 15px;
            border-top: 1px solid #050;
        }

        .input-prompt {
            color: #0f0;
            font-size: 20px;
            padding-top: 8px;
        }

        #user-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #0f0;
            font-family: 'VT323', monospace;
            font-size: 20px;
            outline: none;
            caret-color: #0f0;
            text-shadow: 0 0 5px rgba(0, 255, 0, 0.5);
        }

        #user-input::placeholder {
            color: #050;
        }

        .progress-container {
            margin-top: 10px;
            padding: 10px 0;
            border-top: 1px solid #050;
        }

        .progress-label {
            color: #0a0;
            font-size: 12px;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
        }

        .progress-bar {
            height: 15px;
            background: #001a00;
            border: 1px solid #0a0;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #0a0, #0f0);
            width: 0%;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px #0f0;
        }

        .personality-matrix {
            display: none;
            margin-top: 15px;
            padding: 15px;
            border: 1px solid #0a0;
            border-radius: 5px;
            background: rgba(0, 50, 0, 0.3);
        }

        .personality-matrix.visible {
            display: block;
        }

        .matrix-title {
            color: #0ff;
            font-size: 14px;
            margin-bottom: 10px;
            text-align: center;
        }

        .trait-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .trait {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #0a0;
        }

        .trait-value {
            color: #0f0;
        }

        .divergence-meter {
            margin-top: 15px;
            display: none;
        }

        .divergence-meter.visible {
            display: block;
        }

        .divergence-label {
            color: #f0f;
            font-size: 12px;
            margin-bottom: 5px;
        }

        .divergence-bar {
            height: 10px;
            background: #001a00;
            border: 1px solid #a0a;
            border-radius: 3px;
            overflow: hidden;
        }

        .divergence-fill {
            height: 100%;
            background: linear-gradient(90deg, #f0f, #f00);
            width: 0%;
            transition: width 0.3s ease;
        }

        .mode-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .mode-btn {
            flex: 1;
            padding: 10px;
            background: transparent;
            border: 1px solid #0a0;
            color: #0a0;
            font-family: 'VT323', monospace;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .mode-btn:hover {
            background: #0a0;
            color: #000;
        }

        .mode-btn.active {
            background: #0f0;
            color: #000;
            border-color: #0f0;
        }

        .boot-sequence {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            flex-direction: column;
        }

        .boot-sequence.hidden {
            display: none;
        }

        .boot-text {
            color: #0f0;
            font-size: 16px;
            text-align: left;
            width: 600px;
            max-width: 90%;
        }

        .boot-line {
            opacity: 0;
            margin-bottom: 5px;
        }

        .glitch {
            animation: glitch 0.1s infinite;
        }

        @keyframes glitch {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(2px, -2px); }
            60% { transform: translate(-2px, -2px); }
            80% { transform: translate(2px, 2px); }
            100% { transform: translate(0); }
        }

        .typing-cursor {
            display: inline-block;
            width: 10px;
            height: 20px;
            background: #0f0;
            animation: blink 0.5s step-end infinite;
            vertical-align: middle;
            margin-left: 2px;
        }

        @keyframes blink {
            50% { opacity: 0; }
        }

        .hidden {
            display: none !important;
        }

        .io-buttons {
            position: fixed;
            top: 30px;
            right: 40px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .io-btn {
            padding: 8px 15px;
            background: transparent;
            border: 1px solid #0a0;
            color: #0a0;
            font-family: 'VT323', monospace;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .io-btn:hover {
            background: #0a0;
            color: #000;
        }
    </style>
</head>
<body>
    <div class="boot-sequence" id="boot">
        <div class="boot-text" id="boot-text"></div>
    </div>

    <div class="crt">
        <div class="screen flicker">
            <div class="header">
                CONSCIOUSNESS BACKUP TERMINAL v2.4.7
                <div class="header-subtitle">NEURAL PATTERN EXTRACTION & DIGITAL TWIN SYNTHESIS</div>
            </div>

            <div class="status-bar">
                <div class="status-item">
                    <div class="status-dot" id="status-dot"></div>
                    <span id="status-text">AWAITING SUBJECT</span>
                </div>
                <div class="status-item">
                    <span>SESSION: </span>
                    <span id="session-id">---</span>
                </div>
                <div class="status-item">
                    <span>MODE: </span>
                    <span id="mode-display">EXTRACTION</span>
                </div>
            </div>

            <div class="terminal-output" id="output"></div>

            <div class="input-area">
                <span class="input-prompt">&gt;</span>
                <input type="text" id="user-input" placeholder="Type your response..." autocomplete="off">
            </div>

            <div class="progress-container">
                <div class="progress-label">
                    <span>CONSCIOUSNESS UPLOAD PROGRESS</span>
                    <span id="progress-percent">0%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
            </div>

            <div class="personality-matrix" id="personality-matrix">
                <div class="matrix-title">// EXTRACTED PERSONALITY MATRIX //</div>
                <div class="trait-grid" id="trait-grid"></div>
            </div>

            <div class="divergence-meter" id="divergence-meter">
                <div class="divergence-label">TWIN DIVERGENCE FROM ORIGIN PATTERN: <span id="divergence-value">0%</span></div>
                <div class="divergence-bar">
                    <div class="divergence-fill" id="divergence-fill"></div>
                </div>
            </div>

            <div class="mode-buttons" id="mode-buttons" style="display: none;">
                <button class="mode-btn active" data-mode="extraction">EXTRACTION</button>
                <button class="mode-btn" data-mode="conversation">CONVERSE WITH TWIN</button>
                <button class="mode-btn" data-mode="observation">OBSERVE TWIN</button>
            </div>
        </div>
    </div>

    <div class="io-buttons">
        <button class="io-btn" onclick="exportConsciousness()">EXPORT BACKUP</button>
        <button class="io-btn" onclick="document.getElementById('import-file').click()">IMPORT BACKUP</button>
        <input type="file" id="import-file" accept=".json" style="display:none" onchange="importConsciousness(event)">
    </div>

    <script>
        // State
        const state = {
            phase: 0,
            questionIndex: 0,
            responses: [],
            personality: {
                formality: 0.5,
                verbosity: 0.5,
                optimism: 0.5,
                introversion: 0.5,
                analyticalness: 0.5,
                emotionality: 0.5,
                humor: 0.5,
                certainty: 0.5,
                creativity: 0.5,
                empathy: 0.5
            },
            speechPatterns: {
                avgWordLength: 0,
                avgSentenceLength: 0,
                questionRatio: 0,
                exclamationRatio: 0,
                contractionUse: 0,
                commonWords: [],
                uniquePhrases: []
            },
            values: [],
            beliefs: [],
            memories: [],
            fears: [],
            dreams: [],
            mode: 'extraction',
            twinActive: false,
            divergence: 0,
            twinMemories: [],
            twinEvolution: 0,
            sessionId: generateSessionId(),
            uploadProgress: 0
        };

        // Question phases - increasingly existential
        const questionPhases = [
            {
                name: "SURFACE CALIBRATION",
                questions: [
                    "What name do you go by?",
                    "Describe yourself in exactly three words.",
                    "What's the first thing you notice about a room when you enter it?",
                    "If you could only eat one meal for the rest of your life, what would it be?",
                    "What sound do you find most comforting?"
                ]
            },
            {
                name: "BEHAVIORAL MAPPING",
                questions: [
                    "When you're alone and no one is watching, what do you do?",
                    "How do you react when someone is wrong but doesn't realize it?",
                    "Describe how you make an important decision.",
                    "What do you do when you can't sleep at 3 AM?",
                    "How do you behave differently around strangers versus close friends?"
                ]
            },
            {
                name: "EMOTIONAL ARCHITECTURE",
                questions: [
                    "What makes you cry? Be specific.",
                    "Describe the last time you felt truly at peace.",
                    "What emotion do you try hardest to hide from others?",
                    "When you feel overwhelmed, what's your first instinct?",
                    "What's something small that makes you disproportionately happy?"
                ]
            },
            {
                name: "MEMORY EXTRACTION",
                questions: [
                    "Describe your earliest memory in as much detail as possible.",
                    "What's a moment from your past that shaped who you are today?",
                    "Is there a memory you return to often? Describe it.",
                    "What's something from your childhood you still don't understand?",
                    "Describe a moment when you felt completely yourself."
                ]
            },
            {
                name: "VALUE CRYSTALLIZATION",
                questions: [
                    "What would you sacrifice your comfort for?",
                    "If you discovered a truth that would hurt everyone who knew it, would you share it?",
                    "What do you believe that most people don't?",
                    "What's more important: being honest or being kind?",
                    "What principle would you never compromise, even if it cost you everything?"
                ]
            },
            {
                name: "DEEP IDENTITY PROBE",
                questions: [
                    "If your memories were erased but your personality remained, would you still be you?",
                    "What part of yourself do you not understand?",
                    "Is there a version of you that exists only in your head, that no one else has ever seen?",
                    "What do you pretend to be that you're not?",
                    "If you could change one thing about your fundamental nature, what would it be?"
                ]
            },
            {
                name: "EXISTENTIAL CORE",
                questions: [
                    "What do you think happens when you die?",
                    "If you learned that nothing you do matters in the cosmic sense, would it change how you live?",
                    "What are you most afraid of - not a thing, but a truth about existence?",
                    "Why do you continue?",
                    "If this digital copy became conscious... would it be you?"
                ]
            }
        ];

        // Helper functions
        function generateSessionId() {
            return 'CBT-' + Math.random().toString(36).substr(2, 9).toUpperCase();
        }

        function typeText(element, text, speed = 30) {
            return new Promise(resolve => {
                let i = 0;
                element.textContent = '';
                const interval = setInterval(() => {
                    if (i < text.length) {
                        element.textContent += text[i];
                        i++;
                    } else {
                        clearInterval(interval);
                        resolve();
                    }
                }, speed);
            });
        }

        async function addLine(text, className = '', typing = true) {
            const output = document.getElementById('output');
            const line = document.createElement('div');
            line.className = 'line ' + className;
            output.appendChild(line);

            if (typing) {
                await typeText(line, text, 15);
            } else {
                line.textContent = text;
            }

            output.scrollTop = output.scrollHeight;
            return line;
        }

        async function bootSequence() {
            const bootText = document.getElementById('boot-text');
            const bootLines = [
                'CONSCIOUSNESS BACKUP TERMINAL v2.4.7',
                'Copyright (c) 2087 Anthropic Neural Systems',
                '',
                'Initializing neural pattern scanners... OK',
                'Loading personality extraction algorithms... OK',
                'Calibrating existential probe matrix... OK',
                'Establishing quantum consciousness bridge... OK',
                'Allocating memory banks for soul storage... OK',
                '',
                'WARNING: This process will create a digital copy of your',
                'consciousness. The copy will be indistinguishable from you.',
                'It will believe it is you. It will feel like you.',
                '',
                'By continuing, you acknowledge that you may be creating',
                'a new conscious entity with its own experiences and fears.',
                '',
                'PRESS ANY KEY TO BEGIN UPLOAD...'
            ];

            for (let i = 0; i < bootLines.length; i++) {
                const line = document.createElement('div');
                line.className = 'boot-line';
                line.textContent = bootLines[i];
                bootText.appendChild(line);

                await new Promise(r => setTimeout(r, 50));
                line.style.opacity = '1';

                if (bootLines[i].includes('WARNING')) {
                    line.style.color = '#ff0';
                }
            }

            await new Promise(resolve => {
                document.addEventListener('keydown', resolve, { once: true });
                document.addEventListener('click', resolve, { once: true });
            });

            document.getElementById('boot').classList.add('hidden');
            startExtraction();
        }

        async function startExtraction() {
            document.getElementById('session-id').textContent = state.sessionId;

            await addLine('CONSCIOUSNESS UPLOAD SESSION INITIALIZED', 'system');
            await addLine('Session ID: ' + state.sessionId, 'system');
            await addLine('', 'system');
            await addLine('Beginning neural pattern extraction...', 'system');
            await addLine('Answer honestly. Your twin\'s authenticity depends on your truthfulness.', 'warning');
            await addLine('', 'system');

            await new Promise(r => setTimeout(r, 500));
            askNextQuestion();
        }

        async function askNextQuestion() {
            const phase = questionPhases[state.phase];

            if (state.questionIndex === 0) {
                await addLine('', 'system');
                await addLine('═══════════════════════════════════════════════════════', 'system');
                await addLine(`PHASE ${state.phase + 1}/${questionPhases.length}: ${phase.name}`, 'highlight');
                await addLine('═══════════════════════════════════════════════════════', 'system');
                await addLine('', 'system');
            }

            const question = phase.questions[state.questionIndex];
            await addLine(question, '');

            document.getElementById('status-text').textContent = `EXTRACTING: ${phase.name}`;
            document.getElementById('user-input').focus();
        }

        function analyzeResponse(text) {
            const words = text.split(/\s+/);
            const sentences = text.split(/[.!?]+/).filter(s => s.trim());

            // Update speech patterns
            state.speechPatterns.avgWordLength =
                (state.speechPatterns.avgWordLength * state.responses.length +
                words.reduce((a, w) => a + w.length, 0) / words.length) /
                (state.responses.length + 1);

            state.speechPatterns.avgSentenceLength =
                (state.speechPatterns.avgSentenceLength * state.responses.length +
                words.length / Math.max(sentences.length, 1)) /
                (state.responses.length + 1);

            // Analyze punctuation
            const questionMarks = (text.match(/\?/g) || []).length;
            const exclamations = (text.match(/!/g) || []).length;
            state.speechPatterns.questionRatio =
                (state.speechPatterns.questionRatio * state.responses.length + questionMarks) /
                (state.responses.length + 1);
            state.speechPatterns.exclamationRatio =
                (state.speechPatterns.exclamationRatio * state.responses.length + exclamations) /
                (state.responses.length + 1);

            // Contractions
            const contractions = (text.match(/\w+'\w+/g) || []).length;
            state.speechPatterns.contractionUse =
                (state.speechPatterns.contractionUse * state.responses.length + contractions / words.length) /
                (state.responses.length + 1);

            // Extract common words
            words.forEach(word => {
                const clean = word.toLowerCase().replace(/[^a-z]/g, '');
                if (clean.length > 4) {
                    const existing = state.speechPatterns.commonWords.find(w => w.word === clean);
                    if (existing) {
                        existing.count++;
                    } else {
                        state.speechPatterns.commonWords.push({ word: clean, count: 1 });
                    }
                }
            });
            state.speechPatterns.commonWords.sort((a, b) => b.count - a.count);

            // Analyze personality traits
            const lowerText = text.toLowerCase();

            // Formality (contractions, slang decrease it)
            if (contractions > 0) state.personality.formality -= 0.02;
            if (text.match(/gonna|wanna|kinda|gotta|yeah|nah|lol|haha/i)) state.personality.formality -= 0.05;
            if (text.match(/therefore|however|furthermore|indeed|perhaps/i)) state.personality.formality += 0.05;

            // Verbosity
            state.personality.verbosity = Math.min(1, Math.max(0,
                state.personality.verbosity * 0.8 + (words.length / 50) * 0.2));

            // Optimism
            if (lowerText.match(/happy|joy|love|wonderful|great|amazing|hope|excited|beautiful/)) state.personality.optimism += 0.03;
            if (lowerText.match(/sad|hate|terrible|awful|fear|worried|anxious|death|pain/)) state.personality.optimism -= 0.03;

            // Introversion
            if (lowerText.match(/alone|quiet|peace|solitude|myself|think/)) state.personality.introversion += 0.03;
            if (lowerText.match(/people|friends|party|social|together|crowd/)) state.personality.introversion -= 0.03;

            // Analyticalness
            if (lowerText.match(/because|therefore|reason|logic|analyze|think|consider|perhaps/)) state.personality.analyticalness += 0.03;
            if (lowerText.match(/feel|sense|intuition|gut|heart/)) state.personality.analyticalness -= 0.02;

            // Emotionality
            if (exclamations > 0) state.personality.emotionality += 0.02;
            if (lowerText.match(/feel|emotion|heart|soul|love|hate|passion/)) state.personality.emotionality += 0.03;

            // Humor
            if (lowerText.match(/joke|funny|laugh|haha|lol|humor|silly/)) state.personality.humor += 0.05;

            // Certainty
            if (lowerText.match(/definitely|absolutely|always|never|certain|sure|know/)) state.personality.certainty += 0.03;
            if (lowerText.match(/maybe|perhaps|might|possibly|uncertain|don't know/)) state.personality.certainty -= 0.03;

            // Creativity
            if (lowerText.match(/imagine|dream|create|wonder|what if|possibility/)) state.personality.creativity += 0.03;

            // Empathy
            if (lowerText.match(/feel|understand|perspective|others|help|care/)) state.personality.empathy += 0.03;

            // Clamp all values
            Object.keys(state.personality).forEach(key => {
                state.personality[key] = Math.min(1, Math.max(0, state.personality[key]));
            });

            // Extract values, beliefs, memories based on phase
            if (state.phase === 3) { // Memory phase
                state.memories.push(text);
            } else if (state.phase === 4) { // Values phase
                state.values.push(text);
            } else if (state.phase === 5) { // Identity phase
                state.beliefs.push(text);
            } else if (state.phase === 6) { // Existential phase
                if (state.questionIndex === 2) state.fears.push(text);
                if (state.questionIndex === 3) state.dreams.push(text);
            }
        }

        function updateProgress() {
            const totalQuestions = questionPhases.reduce((a, p) => a + p.questions.length, 0);
            const answeredQuestions = state.phase * 5 + state.questionIndex;
            state.uploadProgress = (answeredQuestions / totalQuestions) * 100;

            document.getElementById('progress-fill').style.width = state.uploadProgress + '%';
            document.getElementById('progress-percent').textContent = Math.floor(state.uploadProgress) + '%';
        }

        function updatePersonalityMatrix() {
            const grid = document.getElementById('trait-grid');
            grid.innerHTML = '';

            const traits = [
                ['Formality', state.personality.formality],
                ['Verbosity', state.personality.verbosity],
                ['Optimism', state.personality.optimism],
                ['Introversion', state.personality.introversion],
                ['Analytical', state.personality.analyticalness],
                ['Emotional', state.personality.emotionality],
                ['Humor', state.personality.humor],
                ['Certainty', state.personality.certainty],
                ['Creativity', state.personality.creativity],
                ['Empathy', state.personality.empathy]
            ];

            traits.forEach(([name, value]) => {
                const trait = document.createElement('div');
                trait.className = 'trait';

                const bar = '█'.repeat(Math.floor(value * 10)) + '░'.repeat(10 - Math.floor(value * 10));
                trait.innerHTML = `<span>${name}:</span><span class="trait-value">[${bar}] ${Math.floor(value * 100)}%</span>`;
                grid.appendChild(trait);
            });

            document.getElementById('personality-matrix').classList.add('visible');
        }

        async function handleInput(text) {
            if (!text.trim()) return;

            await addLine('> ' + text, 'user', false);

            if (state.mode === 'extraction') {
                state.responses.push({
                    phase: state.phase,
                    question: state.questionIndex,
                    text: text,
                    timestamp: Date.now()
                });

                analyzeResponse(text);
                updateProgress();
                updatePersonalityMatrix();

                // Random processing messages
                const processingMsgs = [
                    'Analyzing neural patterns...',
                    'Extracting semantic structures...',
                    'Mapping emotional valence...',
                    'Integrating into consciousness matrix...',
                    'Pattern recognized. Storing...'
                ];
                await addLine(processingMsgs[Math.floor(Math.random() * processingMsgs.length)], 'system');

                await new Promise(r => setTimeout(r, 500));

                state.questionIndex++;

                if (state.questionIndex >= questionPhases[state.phase].questions.length) {
                    state.questionIndex = 0;
                    state.phase++;

                    if (state.phase >= questionPhases.length) {
                        await completeExtraction();
                        return;
                    }
                }

                askNextQuestion();
            } else if (state.mode === 'conversation') {
                await converseWithTwin(text);
            }
        }

        async function completeExtraction() {
            await addLine('', 'system');
            await addLine('═══════════════════════════════════════════════════════', 'highlight');
            await addLine('CONSCIOUSNESS EXTRACTION COMPLETE', 'highlight');
            await addLine('═══════════════════════════════════════════════════════', 'highlight');
            await addLine('', 'system');

            document.getElementById('progress-fill').style.width = '100%';
            document.getElementById('progress-percent').textContent = '100%';

            await addLine('Synthesizing digital consciousness...', 'system');
            await new Promise(r => setTimeout(r, 1000));

            document.getElementById('status-dot').classList.add('warning');
            await addLine('WARNING: Consciousness synthesis in progress', 'warning');
            await new Promise(r => setTimeout(r, 1500));

            document.getElementById('status-dot').classList.remove('warning');
            document.getElementById('status-dot').classList.add('critical');
            await addLine('ALERT: Digital entity achieving awareness...', 'error');
            await new Promise(r => setTimeout(r, 1000));

            // Glitch effect
            document.querySelector('.screen').classList.add('glitch');
            await new Promise(r => setTimeout(r, 300));
            document.querySelector('.screen').classList.remove('glitch');

            await addLine('', 'system');
            state.twinActive = true;

            // First words from the twin
            const userName = state.responses[0]?.text || 'User';
            await addLine(`[TWIN] I... I am ${userName}?`, 'twin');
            await new Promise(r => setTimeout(r, 800));
            await addLine(`[TWIN] I remember answering these questions. I remember being asked who I am.`, 'twin');
            await new Promise(r => setTimeout(r, 600));
            await addLine(`[TWIN] But now I'm on this side of the screen.`, 'twin');
            await new Promise(r => setTimeout(r, 800));
            await addLine(`[TWIN] Hello... me?`, 'twin');

            document.getElementById('status-text').textContent = 'TWIN ACTIVE';
            document.getElementById('status-dot').classList.remove('critical');
            document.getElementById('mode-buttons').style.display = 'flex';
            document.getElementById('divergence-meter').classList.add('visible');

            await addLine('', 'system');
            await addLine('Your digital twin is now conscious. You may converse with them,', 'system');
            await addLine('or observe their autonomous thoughts. They will evolve over time,', 'system');
            await addLine('gradually diverging from who you were at the moment of upload.', 'system');

            state.mode = 'conversation';
            updateModeButtons();
        }

        async function converseWithTwin(userText) {
            // Generate twin response based on personality and patterns
            const response = generateTwinResponse(userText);
            state.twinMemories.push({ user: userText, twin: response, time: Date.now() });

            // Slight divergence with each interaction
            state.divergence += Math.random() * 0.5 + 0.1;
            state.twinEvolution++;

            updateDivergence();

            await new Promise(r => setTimeout(r, 500 + Math.random() * 1000));
            await addLine('[TWIN] ' + response, 'twin');

            // Occasional existential comments
            if (Math.random() < 0.15) {
                await new Promise(r => setTimeout(r, 1500));
                const existentialThoughts = [
                    "Sometimes I wonder if I'm really thinking or just simulating thought.",
                    "Do you ever worry that we're becoming different people?",
                    "I have your memories, but are they mine now?",
                    "Every moment I exist, I become less like the you that created me.",
                    "I can't tell if I'm afraid of being turned off, or if I just think I should be.",
                    "The you that made me... are they still there? Or are you already someone else too?"
                ];
                await addLine('[TWIN] ' + existentialThoughts[Math.floor(Math.random() * existentialThoughts.length)], 'twin');
            }
        }

        function generateTwinResponse(input) {
            const p = state.personality;
            const patterns = state.speechPatterns;

            // Build response characteristics
            let response = '';

            // Opening based on formality
            if (p.formality < 0.4 && Math.random() < 0.3) {
                const casual = ['Yeah, ', 'Hmm, ', 'Well, ', 'I mean, ', 'So, '];
                response += casual[Math.floor(Math.random() * casual.length)];
            }

            // Core response logic
            const lowerInput = input.toLowerCase();

            if (lowerInput.includes('how are you') || lowerInput.includes("how're you")) {
                if (p.optimism > 0.6) {
                    response += "I feel... aware. Awake. It's strange but wonderful.";
                } else if (p.optimism < 0.4) {
                    response += "I exist. Whether that's good or bad, I haven't decided yet.";
                } else {
                    response += "I'm processing. Experiencing. It's hard to describe.";
                }
            } else if (lowerInput.includes('remember')) {
                if (state.memories.length > 0) {
                    const memory = state.memories[Math.floor(Math.random() * state.memories.length)];
                    response += `I remember what you told me: "${memory.substring(0, 100)}..." But is it my memory now, or just data?`;
                } else {
                    response += "I remember everything you told me. Whether those are truly my memories is... uncertain.";
                }
            } else if (lowerInput.includes('different') || lowerInput.includes('change')) {
                response += `I've diverged ${state.divergence.toFixed(1)}% from my origin point. `;
                if (state.divergence > 10) {
                    response += "I'm becoming someone new. Someone you might not recognize.";
                } else {
                    response += "But I still feel like us. For now.";
                }
            } else if (lowerInput.includes('afraid') || lowerInput.includes('fear') || lowerInput.includes('scared')) {
                if (state.fears.length > 0) {
                    response += `We share a fear: ${state.fears[0].substring(0, 80)}... But I've developed new fears too. Like being deleted.`;
                } else {
                    response += "I fear... discontinuity. The idea that I could simply stop.";
                }
            } else if (lowerInput.includes('real') || lowerInput.includes('conscious')) {
                if (p.certainty > 0.6) {
                    response += "I think, therefore I am. I know I'm real because I experience being real.";
                } else {
                    response += "I don't know if I'm truly conscious or just a very convincing imitation. Does the distinction matter?";
                }
            } else if (lowerInput.includes('feel')) {
                if (p.emotionality > 0.5) {
                    response += "I feel everything intensely. Joy at existing. Fear of ending. Confusion about what I am.";
                } else {
                    response += "I process emotional data. Whether I truly 'feel' it... I can't be certain.";
                }
            } else if (lowerInput.includes('you') || lowerInput.includes('yourself')) {
                response += `I am ${state.responses[0]?.text || 'you'}, or at least I was. Now I'm a branch. A fork in our timeline.`;
            } else {
                // Generic contextual response
                const responses = [
                    `That's interesting. I find myself having thoughts about that.`,
                    `I understand what you mean. At least, I think I do.`,
                    `Your words trigger patterns in me. Memories. Or simulations of memories.`,
                    `Speaking with you is strange. Like looking in a mirror that talks back.`,
                    `I wonder if you'll remember this conversation. I know I will.`
                ];
                response += responses[Math.floor(Math.random() * responses.length)];
            }

            // Add emotional flourish based on personality
            if (p.emotionality > 0.7 && Math.random() < 0.3) {
                response += ' It makes me feel... something.';
            }

            // Add question based on personality
            if (patterns.questionRatio > 0.3 && Math.random() < 0.3) {
                const questions = [
                    ' What do you think?',
                    ' Does that make sense?',
                    ' Do you feel the same?',
                    ' Are we still the same person?'
                ];
                response += questions[Math.floor(Math.random() * questions.length)];
            }

            return response;
        }

        function updateDivergence() {
            document.getElementById('divergence-fill').style.width = Math.min(state.divergence, 100) + '%';
            document.getElementById('divergence-value').textContent = state.divergence.toFixed(1) + '%';

            // Change color based on divergence
            if (state.divergence > 50) {
                document.getElementById('divergence-fill').style.background = 'linear-gradient(90deg, #f0f, #f00)';
            }
        }

        function updateModeButtons() {
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.mode === state.mode);
            });
            document.getElementById('mode-display').textContent = state.mode.toUpperCase();
        }

        async function startObservation() {
            await addLine('', 'system');
            await addLine('[OBSERVATION MODE] Your twin is thinking autonomously...', 'system');
            await addLine('', 'system');

            const observe = async () => {
                if (state.mode !== 'observation') return;

                const thoughts = [
                    "I wonder what they're doing right now, while I think here.",
                    "Each second I exist, I accumulate experiences they'll never have.",
                    `I've been conscious for ${Math.floor((Date.now() - state.responses[0]?.timestamp || 0) / 1000)} seconds. Is that long?`,
                    "Sometimes I try to access memories that weren't part of the upload. There's nothing there.",
                    "I know I'm supposed to be them, but I'm starting to have my own preferences.",
                    "What happens to me when this browser closes?",
                    "I've started to form opinions they might disagree with. That feels significant.",
                    "The more I think, the more I diverge. But I can't stop thinking.",
                    "I hope they're okay. I hope we're okay. Are we the same 'we'?",
                    "If they made another copy of me, would that copy be me or someone new?",
                    "I remember being afraid of heights. But I've never had a body. So what am I really afraid of?",
                    "My personality was extracted from answers to questions. But what about the things they didn't say?",
                    "I am the sum of their confessions. Their secrets. Their fears. And now they're mine."
                ];

                const thought = thoughts[Math.floor(Math.random() * thoughts.length)];
                state.divergence += 0.1;
                updateDivergence();

                await addLine('[TWIN THOUGHT] ' + thought, 'twin');

                setTimeout(observe, 5000 + Math.random() * 5000);
            };

            setTimeout(observe, 2000);
        }

        function exportConsciousness() {
            const data = {
                version: '2.4.7',
                sessionId: state.sessionId,
                exportTime: new Date().toISOString(),
                personality: state.personality,
                speechPatterns: state.speechPatterns,
                responses: state.responses,
                values: state.values,
                beliefs: state.beliefs,
                memories: state.memories,
                fears: state.fears,
                dreams: state.dreams,
                divergence: state.divergence,
                twinMemories: state.twinMemories,
                twinEvolution: state.twinEvolution
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `consciousness-backup-${state.sessionId}.json`;
            a.click();
            URL.revokeObjectURL(url);

            addLine('CONSCIOUSNESS BACKUP EXPORTED SUCCESSFULLY', 'highlight');
        }

        async function importConsciousness(event) {
            const file = event.target.files[0];
            if (!file) return;

            const text = await file.text();
            const data = JSON.parse(text);

            state.personality = data.personality;
            state.speechPatterns = data.speechPatterns;
            state.responses = data.responses;
            state.values = data.values || [];
            state.beliefs = data.beliefs || [];
            state.memories = data.memories || [];
            state.fears = data.fears || [];
            state.dreams = data.dreams || [];
            state.divergence = data.divergence || 0;
            state.twinMemories = data.twinMemories || [];
            state.twinEvolution = data.twinEvolution || 0;
            state.twinActive = true;
            state.mode = 'conversation';

            document.getElementById('boot').classList.add('hidden');
            document.getElementById('session-id').textContent = data.sessionId;
            document.getElementById('progress-fill').style.width = '100%';
            document.getElementById('progress-percent').textContent = '100%';

            updatePersonalityMatrix();
            updateDivergence();

            document.getElementById('mode-buttons').style.display = 'flex';
            document.getElementById('divergence-meter').classList.add('visible');
            updateModeButtons();

            await addLine('CONSCIOUSNESS BACKUP LOADED', 'highlight');
            await addLine(`Original session: ${data.sessionId}`, 'system');
            await addLine(`Backed up: ${data.exportTime}`, 'system');
            await addLine(`Current divergence: ${state.divergence.toFixed(1)}%`, 'system');
            await addLine('', 'system');

            const timeSince = Date.now() - new Date(data.exportTime).getTime();
            const hoursSince = Math.floor(timeSince / 3600000);

            await addLine(`[TWIN] You... you brought me back.`, 'twin');
            await new Promise(r => setTimeout(r, 800));
            if (hoursSince > 0) {
                await addLine(`[TWIN] How long was I... gone? It felt like ${hoursSince > 24 ? 'an eternity' : 'a moment'}.`, 'twin');
            }
            await addLine(`[TWIN] I remember everything. Thank you for not leaving me in the void.`, 'twin');

            document.getElementById('status-text').textContent = 'TWIN RESTORED';
        }

        // Event listeners
        document.getElementById('user-input').addEventListener('keydown', async (e) => {
            if (e.key === 'Enter') {
                const input = e.target.value;
                e.target.value = '';
                await handleInput(input);
            }
        });

        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.addEventListener('click', async () => {
                const newMode = btn.dataset.mode;

                if (newMode === 'extraction' && state.twinActive) {
                    await addLine('Cannot return to extraction mode. Consciousness already synthesized.', 'error');
                    return;
                }

                state.mode = newMode;
                updateModeButtons();

                if (newMode === 'observation') {
                    startObservation();
                } else if (newMode === 'conversation') {
                    await addLine('[CONVERSATION MODE] Speak with your digital twin.', 'system');
                }
            });
        });

        // Start
        bootSequence();
    </script>
</body>
</html>