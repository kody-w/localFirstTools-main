<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Conspiracy Kitchen - They Don't Want You To Know These Recipes</title>
    <meta name="description" content="A cooking instruction app that presents recipes as unhinged conspiracy documentaries. Learn real cooking skills while laughing.">
    <meta name="theme-color" content="#0a0a0a">
    <meta name="color-scheme" content="dark">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Special+Elite&family=Courier+Prime:wght@400;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            background: #0a0a0a;
            font-family: 'Courier Prime', monospace;
            color: #d4d4d4;
            overflow-x: hidden;
        }

        /* VHS/Documentary Style Effects */
        .vhs-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.1) 0px,
                rgba(0, 0, 0, 0.1) 1px,
                transparent 1px,
                transparent 2px
            );
        }

        .vhs-overlay::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at center, transparent 0%, rgba(0,0,0,0.3) 100%);
        }

        /* Header */
        header {
            background: linear-gradient(180deg, #1a0000 0%, #0a0a0a 100%);
            border-bottom: 2px solid #ff0000;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .classified-stamp {
            position: absolute;
            top: 10px;
            right: 20px;
            color: #ff0000;
            font-family: 'Special Elite', cursive;
            font-size: 14px;
            transform: rotate(12deg);
            border: 2px solid #ff0000;
            padding: 5px 10px;
            opacity: 0.8;
        }

        h1 {
            font-family: 'Special Elite', cursive;
            font-size: 2.5em;
            color: #ff3333;
            text-shadow: 0 0 10px #ff0000;
            letter-spacing: 3px;
        }

        .tagline {
            margin-top: 10px;
            font-style: italic;
            color: #888;
            font-size: 0.9em;
        }

        /* Main Layout */
        main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px;
        }

        /* Recipe Selection */
        .recipe-selection {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .recipe-card {
            background: linear-gradient(145deg, #1a1a1a, #0f0f0f);
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .recipe-card:hover {
            border-color: #ff3333;
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 0, 0, 0.2);
        }

        .recipe-card::before {
            content: 'DECLASSIFIED';
            position: absolute;
            top: 10px;
            right: -30px;
            background: #ff0000;
            color: white;
            padding: 2px 40px;
            font-size: 10px;
            transform: rotate(45deg);
        }

        .recipe-card h3 {
            color: #ff6666;
            font-family: 'Special Elite', cursive;
            margin-bottom: 10px;
        }

        .recipe-card p {
            font-size: 0.85em;
            color: #888;
            line-height: 1.5;
        }

        .difficulty {
            display: inline-block;
            margin-top: 10px;
            padding: 3px 10px;
            border-radius: 3px;
            font-size: 11px;
            text-transform: uppercase;
        }

        .difficulty.easy { background: #1a3a1a; color: #44ff44; }
        .difficulty.medium { background: #3a3a1a; color: #ffff44; }
        .difficulty.hard { background: #3a1a1a; color: #ff4444; }

        /* Evidence Board */
        #evidence-board {
            display: none;
            background: #0d0d0d;
            border: 2px solid #333;
            border-radius: 10px;
            padding: 30px;
            position: relative;
        }

        .red-string-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.1;
            pointer-events: none;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3E%3Cline x1='0' y1='0' x2='100' y2='100' stroke='%23ff0000' stroke-width='1'/%3E%3Cline x1='100' y1='0' x2='0' y2='100' stroke='%23ff0000' stroke-width='1'/%3E%3C/svg%3E");
        }

        .back-btn {
            background: none;
            border: 1px solid #666;
            color: #888;
            padding: 8px 20px;
            cursor: pointer;
            margin-bottom: 20px;
            font-family: inherit;
            transition: all 0.3s;
        }

        .back-btn:hover {
            border-color: #ff3333;
            color: #ff3333;
        }

        .recipe-title {
            font-family: 'Special Elite', cursive;
            font-size: 2em;
            color: #ff3333;
            margin-bottom: 20px;
            text-align: center;
        }

        /* Narration Area */
        #narration-box {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #ff3333;
            border-radius: 8px;
            padding: 25px;
            margin: 20px 0;
            min-height: 150px;
            position: relative;
        }

        #narration-box::before {
            content: 'INTERCEPTED TRANSMISSION';
            position: absolute;
            top: -10px;
            left: 20px;
            background: #0d0d0d;
            padding: 0 10px;
            font-size: 11px;
            color: #ff6666;
        }

        #narration-text {
            font-size: 1.1em;
            line-height: 1.8;
            color: #e0e0e0;
        }

        .dramatic-pause {
            opacity: 0.5;
            font-style: italic;
        }

        /* Controls */
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 25px 0;
            flex-wrap: wrap;
        }

        .control-btn {
            background: linear-gradient(180deg, #2a0000, #1a0000);
            border: 2px solid #ff3333;
            color: #ff6666;
            padding: 12px 30px;
            font-family: 'Special Elite', cursive;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
        }

        .control-btn:hover {
            background: #ff3333;
            color: #000;
        }

        .control-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        /* Ingredients as Evidence */
        .evidence-section {
            margin: 30px 0;
        }

        .evidence-section h3 {
            color: #ff6666;
            font-family: 'Special Elite', cursive;
            margin-bottom: 15px;
            border-bottom: 1px dashed #333;
            padding-bottom: 10px;
        }

        .ingredient-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
        }

        .ingredient-item {
            background: rgba(255, 0, 0, 0.05);
            border: 1px solid #333;
            padding: 10px 15px;
            position: relative;
            opacity: 0.7;
            transition: all 0.3s;
        }

        .ingredient-item.revealed {
            opacity: 1;
            border-color: #ff3333;
        }

        .ingredient-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 3px;
            height: 100%;
            background: #ff0000;
        }

        .ingredient-item.checked {
            text-decoration: line-through;
            opacity: 0.5;
        }

        /* Step Progress */
        .step-tracker {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        .step-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #333;
            border: 2px solid #666;
            transition: all 0.3s;
        }

        .step-dot.active {
            background: #ff3333;
            border-color: #ff6666;
            box-shadow: 0 0 10px #ff0000;
        }

        .step-dot.completed {
            background: #00ff00;
            border-color: #00ff00;
        }

        /* Redacted Text Effect */
        .redacted {
            background: #000;
            color: #000;
            padding: 0 5px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .redacted:hover, .redacted.revealed {
            background: transparent;
            color: #ff6666;
        }

        /* Voice Settings */
        .voice-settings {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #333;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .voice-settings label {
            display: block;
            margin: 10px 0 5px;
            color: #888;
            font-size: 0.9em;
        }

        .voice-settings input, .voice-settings select {
            width: 100%;
            padding: 8px;
            background: #1a1a1a;
            border: 1px solid #333;
            color: #fff;
            border-radius: 4px;
        }

        /* Glitch Effect */
        @keyframes glitch {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
            100% { transform: translate(0); }
        }

        .glitch {
            animation: glitch 0.1s linear infinite;
        }

        /* Dramatic Reveal Animation */
        @keyframes typewriter {
            from { width: 0; }
            to { width: 100%; }
        }

        .typing {
            overflow: hidden;
            border-right: 2px solid #ff3333;
            white-space: nowrap;
            animation: typewriter 2s steps(40) forwards, blink 0.7s infinite;
        }

        @keyframes blink {
            50% { border-color: transparent; }
        }

        /* Print Recipe */
        @media print {
            .vhs-overlay, .controls, .voice-settings, header, .back-btn { display: none; }
            body { background: white; color: black; }
            #evidence-board { border: 1px solid #ccc; }
        }

        /* Custom recipe form */
        .custom-form {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid #333;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
        }

        .custom-form h3 {
            color: #ff6666;
            margin-bottom: 15px;
        }

        .custom-form textarea {
            width: 100%;
            min-height: 150px;
            background: #1a1a1a;
            border: 1px solid #333;
            color: #fff;
            padding: 15px;
            font-family: inherit;
            resize: vertical;
            margin-bottom: 15px;
        }

        .custom-form button {
            background: #ff3333;
            border: none;
            color: #fff;
            padding: 10px 25px;
            cursor: pointer;
            font-family: inherit;
        }
    </style>
</head>
<body>
    <div class="vhs-overlay"></div>

    <header>
        <div class="classified-stamp">CLASSIFIED</div>
        <h1>THE CONSPIRACY KITCHEN</h1>
        <p class="tagline">"They don't want you to know these recipes... until now."</p>
    </header>

    <main>
        <section id="recipe-list">
            <div class="recipe-selection" id="recipe-cards">
                <!-- Recipes populated by JS -->
            </div>

            <div class="custom-form">
                <h3>Submit Your Own Recipe For Investigation</h3>
                <textarea id="custom-recipe" placeholder="Paste a recipe here. Our investigators will expose the TRUTH behind every ingredient..."></textarea>
                <button onclick="parseCustomRecipe()">INVESTIGATE THIS RECIPE</button>
            </div>
        </section>

        <section id="evidence-board">
            <div class="red-string-bg"></div>
            <button class="back-btn" onclick="showRecipeList()">< Return to Case Files</button>

            <h2 class="recipe-title" id="recipe-title"></h2>

            <div class="step-tracker" id="step-tracker"></div>

            <div id="narration-box">
                <div id="narration-text"></div>
            </div>

            <div class="controls">
                <button class="control-btn" id="prev-btn" onclick="previousStep()">Previous Intel</button>
                <button class="control-btn" id="play-btn" onclick="toggleNarration()">Expose The Truth</button>
                <button class="control-btn" id="next-btn" onclick="nextStep()">Next Intel</button>
            </div>

            <div class="voice-settings">
                <label>Narrator Voice:</label>
                <select id="voice-select" onchange="updateVoice()">
                    <option value="">Loading voices...</option>
                </select>
                <label>Narration Speed: <span id="speed-value">1.0</span>x</label>
                <input type="range" id="speed-slider" min="0.5" max="1.5" step="0.1" value="1.0" onchange="updateSpeed()">
                <label>Dramatic Pause Intensity: <span id="pause-value">Normal</span></label>
                <input type="range" id="pause-slider" min="1" max="3" step="1" value="2" onchange="updatePauseLevel()">
            </div>

            <div class="evidence-section">
                <h3>Evidence: Required Materials</h3>
                <div class="ingredient-list" id="ingredient-list"></div>
            </div>
        </section>
    </main>

    <script>
        // ========== RECIPE DATABASE ==========
        const RECIPES = [
            {
                id: 'pasta-aglio',
                title: 'Pasta Aglio e Olio',
                subtitle: 'The Italian Government\'s Best-Kept Secret',
                difficulty: 'easy',
                description: 'For centuries, Big Marinara has suppressed this simple, perfect pasta dish. They don\'t want you to know that you need only 5 ingredients.',
                ingredients: [
                    '1 pound spaghetti',
                    '1/3 cup high-quality olive oil',
                    '8 cloves garlic, thinly sliced',
                    '1/2 teaspoon red pepper flakes',
                    'Fresh parsley, chopped',
                    'Parmesan cheese',
                    'Salt to taste'
                ],
                steps: [
                    {
                        action: 'Boil heavily salted water and cook pasta until al dente.',
                        conspiracy: 'First, you must understand what they\'ve been hiding from you. The salt. The SALT. Big Seasoning has convinced you that a "pinch" is enough. The truth? The water should taste like the Mediterranean Sea. This isn\'t cooking - it\'s liberation.'
                    },
                    {
                        action: 'Meanwhile, gently heat olive oil in a large pan over low heat.',
                        conspiracy: 'Now, here\'s where it gets interesting. LOW heat. Do you understand what I\'m telling you? The industrial cooking complex wants you to BURN your garlic. They profit from your failures. Keep. It. Low.'
                    },
                    {
                        action: 'Add the thinly sliced garlic to the oil. Cook until golden, not brown.',
                        conspiracy: 'Watch the garlic. WATCH IT. The moment it turns golden - and I mean GOLDEN, not brown - you\'ll understand why they keep this dish out of cooking school curricula. Brown garlic is bitter. Bitter customers buy more pre-made sauce. Connect the dots.'
                    },
                    {
                        action: 'Add red pepper flakes to the oil.',
                        conspiracy: 'The red pepper flakes were originally classified as a controlled substance by the FDA in 1957. Documents were declassified in 1998. They release endorphins. They make you happy. Happy people don\'t buy comfort food. Add them anyway.'
                    },
                    {
                        action: 'Reserve 1 cup pasta water, then drain pasta. Add pasta to the pan.',
                        conspiracy: 'The pasta water. THE PASTA WATER. Every grandmother in Italy knows this secret. The starch creates emulsification. It makes the sauce CLING. They removed this from American cookbooks in the 1960s. The question is: why?'
                    },
                    {
                        action: 'Toss pasta in the oil, adding pasta water as needed. Finish with parsley and cheese.',
                        conspiracy: 'As you toss this pasta - your pasta, your FREEDOM - you are completing a ritual that predates modern civilization. The parsley isn\'t just garnish. It\'s... *static*... it\'s the symbol of everything they tried to suppress. Congratulations. You now know too much.'
                    }
                ]
            },
            {
                id: 'grilled-cheese',
                title: 'The Perfect Grilled Cheese',
                subtitle: 'What The Dairy Council Doesn\'t Want You To Discover',
                difficulty: 'easy',
                description: 'They\'ve convinced you that grilled cheese is "just a sandwich." This is a lie. The ancient technique of proper grilled cheese creation has been systematically suppressed.',
                ingredients: [
                    '2 slices quality bread',
                    '2-3 slices cheese (cheddar or American blend)',
                    '2 tablespoons butter, softened',
                    '1 tablespoon mayonnaise (the secret)',
                    'Optional: 1/4 teaspoon garlic powder'
                ],
                steps: [
                    {
                        action: 'Spread mayonnaise on the OUTSIDE of both bread slices.',
                        conspiracy: 'Mayonnaise. MAYONNAISE. This is the secret they\'ve hidden for decades. While butter zealots argue about temperatures, the mayo-illuminated have achieved perfect golden crusts every time. Mayo contains oil AND eggs - nature\'s browning agent. Why isn\'t this taught? Who profits from burnt sandwiches?'
                    },
                    {
                        action: 'Butter the inside of the bread very lightly.',
                        conspiracy: 'The double-fat technique. Inside AND outside. This was discovered in 1972 at a government research facility. The scientist who discovered it was transferred to a "different department." His notes survived. You\'re reading them now.'
                    },
                    {
                        action: 'Heat a pan over LOW-MEDIUM heat. This is critical.',
                        conspiracy: 'They want you to use high heat. HIGH HEAT. Do you know what happens with high heat? The bread burns before the cheese melts. You throw it away. You buy another. The bread industry laughs. LOW-MEDIUM. Remember this.'
                    },
                    {
                        action: 'Place sandwich in pan. Cover with a lid.',
                        conspiracy: 'THE LID. The lid creates a micro-climate. Steam. The cheese melts from ABOVE while it toasts from below. Every diner in America knows this. They just won\'t tell you. Until now.'
                    },
                    {
                        action: 'Flip when golden brown, about 3-4 minutes per side.',
                        conspiracy: 'As you flip this sandwich, you flip the script on decades of culinary suppression. Listen for the sound. That sizzle? That\'s the sound of truth being cooked into reality. Golden. Both sides. Cheese stretching between halves like the threads of conspiracy finally being connected.'
                    }
                ]
            },
            {
                id: 'caramelized-onions',
                title: 'True Caramelized Onions',
                subtitle: 'The 45-Minute Deception',
                difficulty: 'medium',
                description: 'Every recipe that says "caramelize onions, 10 minutes" is LYING to you. This is the real technique they don\'t want you to have the patience to learn.',
                ingredients: [
                    '3 large yellow onions, sliced',
                    '3 tablespoons butter',
                    '1 tablespoon olive oil',
                    '1/2 teaspoon salt',
                    '1 teaspoon sugar (optional accelerant)',
                    'Splash of water (for deglazing)'
                ],
                steps: [
                    {
                        action: 'Slice onions into thin, even strips. Patience begins here.',
                        conspiracy: 'Look at that onion. LOOK AT IT. The onion contains natural sugars that Big Recipe has weaponized against you. They say "10 minutes." TEN MINUTES. The Maillard reaction requires TIME. Time they don\'t want you to spend. Time that produces FLAVOR.'
                    },
                    {
                        action: 'Heat butter and oil in a heavy pan over MEDIUM-LOW heat.',
                        conspiracy: 'Medium-low. The temperature of truth. Every professional chef knows this. Every restaurant uses this. But they tell home cooks to rush. Why? Because a home cook who masters caramelization doesn\'t need restaurants anymore. Think about it.'
                    },
                    {
                        action: 'Add onions. Stir to coat. Then walk away for 5 minutes.',
                        conspiracy: 'This is where most people fail. They STIR. Constantly. The onions never develop fond - that brown layer of pure flavor. The stirring industrial complex has convinced you that attention means love. In this case? Neglect IS love. Walk. Away.'
                    },
                    {
                        action: 'Every 5-10 minutes, stir and scrape the fond from the bottom.',
                        conspiracy: 'The fond. THE FOND. That brown stuff on the bottom isn\'t burning - it\'s FLAVOR. Scrape it up. Incorporate it. This is where the magic happens. A splash of water helps. The steam lifts the fond. This technique was removed from cooking shows in 2003. Why? Follow the money.'
                    },
                    {
                        action: 'Continue for 45 minutes to 1 hour until deep mahogany brown.',
                        conspiracy: 'FORTY-FIVE MINUTES. The truth is uncomfortable. It\'s slow. It requires patience. And at the end of this journey - this odyssey of flavor - you will have onions that taste like a secret the culinary world has kept from you. Sweet. Complex. Deeply brown. Everything they said was impossible in "10 minutes." Congratulations. You\'ve broken free.'
                    }
                ]
            },
            {
                id: 'perfect-rice',
                title: 'The Perfect Rice Technique',
                subtitle: 'Why Rice Cookers Are A Psyop',
                difficulty: 'easy',
                description: 'They sell you expensive rice cookers when the ancient stovetop method produces superior results. This knowledge was almost lost.',
                ingredients: [
                    '1 cup long-grain white rice',
                    '1.5 cups water',
                    '1/2 teaspoon salt',
                    '1 tablespoon butter (optional, but not really optional)'
                ],
                steps: [
                    {
                        action: 'Rinse the rice until the water runs clear. This takes 3-4 rinses.',
                        conspiracy: 'RINSE. The. Rice. Every Asian grandmother knows this. The starch on unwashed rice creates a gummy, sticky mess. But Western rice packages say nothing about rinsing. They WANT your rice to stick. Stuck rice means more rice sold. Wake up.'
                    },
                    {
                        action: 'Combine rice and water in a pot. The ratio is 1:1.5.',
                        conspiracy: 'One to one point five. Not two. Not one. ONE POINT FIVE. The "2 cups water per cup rice" myth was started by water companies in the 1960s. The extra water makes rice mushy. Mushy rice sells more... sauces to cover it up. The conspiracy runs deep.'
                    },
                    {
                        action: 'Bring to a boil, then immediately reduce to LOW. Cover.',
                        conspiracy: 'The moment you reduce the heat - that EXACT moment - you have 18 minutes left. Not 20. Not 15. EIGHTEEN. This number appears in ancient texts from multiple civilizations. They knew. And now, you know.'
                    },
                    {
                        action: 'DO NOT LIFT THE LID for 18 minutes.',
                        conspiracy: 'Do. Not. Lift. The. Lid. Every time you lift it, steam escapes. Steam that was cooking your rice. The urge to peek? That\'s conditioning. Years of cooking shows that dramatically reveal food. They\'ve trained you to fail. Resist.'
                    },
                    {
                        action: 'Remove from heat. Let stand 5 more minutes. Then fluff.',
                        conspiracy: 'The five-minute rest. During this time, the moisture redistributes. The rice achieves... equilibrium. As you fluff each grain - separate, perfect, individual yet united - you complete a process unchanged for 10,000 years. The rice cooker industry generates $2 billion annually selling a solution to a problem that never existed. You are free.'
                    }
                ]
            },
            {
                id: 'brown-butter',
                title: 'Beurre Noisette - The Brown Butter',
                subtitle: 'Classified By The French Government Until 2007',
                difficulty: 'medium',
                description: 'Brown butter contains compounds that the flavor industry has spent millions trying to replicate synthetically. The process takes 7 minutes. They\'ve been charging premium prices for what you can make at home.',
                ingredients: [
                    '1 stick (8 tablespoons) unsalted butter',
                    'A light-colored pan (to see the color change)'
                ],
                steps: [
                    {
                        action: 'Cut butter into cubes for even melting.',
                        conspiracy: 'Cubes. CUBES. Not a whole stick. The whole stick method creates uneven heating. Uneven heating creates burned spots. Burned butter is... bitter. Cubes ensure uniform transformation. This technique was classified by the French Culinary Institute until 2007. Why? Because brown butter makes EVERYTHING taste like a restaurant. They were protecting their industry.'
                    },
                    {
                        action: 'Melt butter over medium heat in a light-colored pan.',
                        conspiracy: 'The color of the pan is critical. Dark pans hide the browning. You can\'t see the transformation. Stainless steel. This is why restaurants use stainless steel. This is why every cooking show uses dark non-stick. They don\'t want you to SEE.'
                    },
                    {
                        action: 'The butter will foam. This is phase one. Do not stop here.',
                        conspiracy: 'The foam. THE FOAM. This is water evaporating from the butter. 15-18% of butter is water. The dairy industry doesn\'t want you to think about this. When the foam subsides, the real magic begins. Most people stop here. Most people never taste the truth.'
                    },
                    {
                        action: 'Watch as the milk solids sink and begin to brown. Swirl frequently.',
                        conspiracy: 'The milk solids are sinking to the bottom. They\'re browning. This is the Maillard reaction at 320Â°F. The same reaction that makes toast taste like toast. That makes steak taste like steak. That makes EVERYTHING delicious. They\'ve been hiding this in plain sight. SWIRL. Don\'t let it burn.'
                    },
                    {
                        action: 'When it smells nutty and turns amber, remove IMMEDIATELY to a cool bowl.',
                        conspiracy: 'NUTTY. When you smell it - and you WILL smell it - hazelnut, almost toffee-like, immediately pour it into a cool container. The pan\'s residual heat will continue cooking. The line between brown butter and burnt butter is measured in SECONDS. This is why they don\'t teach this. Too many variables. Too much skill required. Too much... power... in your hands now.'
                    }
                ]
            }
        ];

        // ========== STATE ==========
        let currentRecipe = null;
        let currentStep = 0;
        let isSpeaking = false;
        let speechSynthesis = window.speechSynthesis;
        let voices = [];
        let selectedVoice = null;
        let speechRate = 1.0;
        let pauseIntensity = 2;

        // ========== CONSPIRACY WEB - Cross-Recipe Connections ==========
        const CONSPIRACY_WEB = {
            'big-marinara': ['pasta-aglio', 'caramelized-onions'],
            'dairy-council': ['grilled-cheese', 'brown-butter'],
            'maillard-suppression': ['brown-butter', 'caramelized-onions', 'grilled-cheese'],
            'time-conspiracy': ['caramelized-onions', 'perfect-rice'],
            'water-industry': ['perfect-rice', 'pasta-aglio'],
            'lid-secrets': ['perfect-rice', 'grilled-cheese']
        };

        function getRelatedConspiracies(recipeId) {
            const related = [];
            for (const [conspiracy, recipes] of Object.entries(CONSPIRACY_WEB)) {
                if (recipes.includes(recipeId)) {
                    const otherRecipes = recipes.filter(r => r !== recipeId);
                    related.push({ conspiracy: conspiracy.replace(/-/g, ' ').toUpperCase(), recipes: otherRecipes });
                }
            }
            return related;
        }

        // ========== TECHNIQUE BADGES & PROGRESS ==========
        let userProgress = JSON.parse(localStorage.getItem('conspiracyProgress')) || {
            completedRecipes: [],
            techniquesLearned: [],
            paranoidLevel: 0,
            badges: []
        };

        const TECHNIQUES = {
            'pasta-aglio': ['Pasta Water Emulsification', 'Garlic Goldening'],
            'grilled-cheese': ['Mayo Crust Technique', 'Lid Steam Method'],
            'caramelized-onions': ['Fond Development', 'Low-Slow Caramelization'],
            'perfect-rice': ['Rice Rinsing', 'Lid Discipline'],
            'brown-butter': ['Milk Solid Observation', 'Residual Heat Control']
        };

        const BADGES = [
            { id: 'first-truth', name: 'TRUTH SEEKER', desc: 'Complete your first recipe', check: () => userProgress.completedRecipes.length >= 1 },
            { id: 'deep-state', name: 'DEEP STATE CHEF', desc: 'Complete 3 recipes', check: () => userProgress.completedRecipes.length >= 3 },
            { id: 'maillard-master', name: 'MAILLARD MASTER', desc: 'Learn browning techniques', check: () => userProgress.techniquesLearned.includes('Fond Development') || userProgress.techniquesLearned.includes('Milk Solid Observation') },
            { id: 'water-wizard', name: 'WATER WIZARD', desc: 'Master pasta water and rice water', check: () => userProgress.techniquesLearned.includes('Pasta Water Emulsification') && userProgress.techniquesLearned.includes('Rice Rinsing') },
            { id: 'full-paranoid', name: 'FULLY PARANOID', desc: 'Complete all recipes', check: () => userProgress.completedRecipes.length >= 5 }
        ];

        function checkBadges() {
            let newBadges = [];
            for (const badge of BADGES) {
                if (!userProgress.badges.includes(badge.id) && badge.check()) {
                    userProgress.badges.push(badge.id);
                    newBadges.push(badge);
                }
            }
            saveProgress();
            return newBadges;
        }

        function saveProgress() {
            localStorage.setItem('conspiracyProgress', JSON.stringify(userProgress));
        }

        // ========== ESCALATION SYSTEM - Comedy builds per step ==========
        const ESCALATION_MODIFIERS = [
            { level: 1, prefix: '', intensity: 'calm' },
            { level: 2, prefix: 'Now, ', intensity: 'building' },
            { level: 3, prefix: 'Listen carefully: ', intensity: 'urgent' },
            { level: 4, prefix: 'THIS IS CRITICAL: ', intensity: 'intense' },
            { level: 5, prefix: 'THEY DON\'T WANT YOU TO KNOW: ', intensity: 'maximum' }
        ];

        function getEscalationLevel(stepIndex, totalSteps) {
            const progress = (stepIndex + 1) / totalSteps;
            if (progress < 0.2) return 1;
            if (progress < 0.4) return 2;
            if (progress < 0.6) return 3;
            if (progress < 0.8) return 4;
            return 5;
        }

        // ========== INIT ==========
        function init() {
            renderRecipeCards();
            loadVoices();

            // Load saved voice preference
            const savedVoice = localStorage.getItem('conspiracyVoice');
            const savedRate = localStorage.getItem('conspiracyRate');
            if (savedRate) {
                speechRate = parseFloat(savedRate);
                document.getElementById('speed-slider').value = speechRate;
                document.getElementById('speed-value').textContent = speechRate.toFixed(1);
            }

            // Handle speech synthesis voice loading
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
        }

        function loadVoices() {
            voices = speechSynthesis.getVoices();
            const select = document.getElementById('voice-select');
            select.innerHTML = '';

            // Prefer deeper, more dramatic voices
            const preferredVoices = ['Daniel', 'Alex', 'Google UK English Male', 'Microsoft David', 'Google US English'];

            voices.forEach((voice, i) => {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `${voice.name} (${voice.lang})`;
                if (preferredVoices.some(pv => voice.name.includes(pv))) {
                    option.selected = true;
                    selectedVoice = voice;
                }
                select.appendChild(option);
            });

            // Restore saved preference
            const savedVoice = localStorage.getItem('conspiracyVoice');
            if (savedVoice && voices[savedVoice]) {
                select.value = savedVoice;
                selectedVoice = voices[savedVoice];
            }
        }

        function updateVoice() {
            const select = document.getElementById('voice-select');
            selectedVoice = voices[select.value];
            localStorage.setItem('conspiracyVoice', select.value);
        }

        function updateSpeed() {
            speechRate = parseFloat(document.getElementById('speed-slider').value);
            document.getElementById('speed-value').textContent = speechRate.toFixed(1);
            localStorage.setItem('conspiracyRate', speechRate);
        }

        function updatePauseLevel() {
            pauseIntensity = parseInt(document.getElementById('pause-slider').value);
            const labels = ['Subtle', 'Normal', 'Maximum Drama'];
            document.getElementById('pause-value').textContent = labels[pauseIntensity - 1];
        }

        // ========== RECIPE CARDS ==========
        function renderRecipeCards() {
            const container = document.getElementById('recipe-cards');

            // Add progress panel first
            const progressPanel = `
                <div style="grid-column: 1 / -1; background: linear-gradient(145deg, #1a0a0a, #0a0a0a); border: 1px solid #ff3333; padding: 20px; border-radius: 8px; margin-bottom: 10px;">
                    <h3 style="color: #ff6666; margin-bottom: 15px; font-family: 'Special Elite', cursive;">YOUR INVESTIGATION DOSSIER</h3>
                    <div style="display: flex; gap: 30px; flex-wrap: wrap;">
                        <div>
                            <div style="color: #888; font-size: 12px;">CASES SOLVED</div>
                            <div style="color: #ff3333; font-size: 24px; font-weight: bold;">${userProgress.completedRecipes.length} / ${RECIPES.length}</div>
                        </div>
                        <div>
                            <div style="color: #888; font-size: 12px;">TECHNIQUES LEARNED</div>
                            <div style="color: #ffff00; font-size: 24px; font-weight: bold;">${userProgress.techniquesLearned.length}</div>
                        </div>
                        <div>
                            <div style="color: #888; font-size: 12px;">PARANOIA LEVEL</div>
                            <div style="color: #00ff00; font-size: 24px; font-weight: bold;">${''.padStart(userProgress.paranoidLevel, '').split('').join('')} ${userProgress.paranoidLevel}/10</div>
                        </div>
                    </div>
                    ${userProgress.badges.length > 0 ? `
                        <div style="margin-top: 15px; border-top: 1px dashed #333; padding-top: 15px;">
                            <div style="color: #888; font-size: 12px; margin-bottom: 8px;">BADGES EARNED</div>
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                ${userProgress.badges.map(id => {
                                    const badge = BADGES.find(b => b.id === id);
                                    return badge ? `<span style="background: #2a0000; border: 1px solid #ff6666; padding: 5px 10px; border-radius: 4px; font-size: 11px; color: #ff6666;" title="${badge.desc}">${badge.name}</span>` : '';
                                }).join('')}
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;

            container.innerHTML = progressPanel + RECIPES.map(recipe => {
                const isCompleted = userProgress.completedRecipes.includes(recipe.id);
                const techniques = TECHNIQUES[recipe.id] || [];
                return `
                <div class="recipe-card" onclick="selectRecipe('${recipe.id}')" style="${isCompleted ? 'border-color: #00ff00; opacity: 0.8;' : ''}">
                    ${isCompleted ? '<div style="position: absolute; top: 10px; left: 10px; color: #00ff00; font-size: 20px;">SOLVED</div>' : ''}
                    <h3>${recipe.title}</h3>
                    <p style="color: #ff6666; font-style: italic; margin-bottom: 8px;">${recipe.subtitle}</p>
                    <p>${recipe.description}</p>
                    <span class="difficulty ${recipe.difficulty}">${recipe.difficulty}</span>
                    ${techniques.length ? `<div style="margin-top: 10px; font-size: 11px; color: #888;">Teaches: ${techniques.join(', ')}</div>` : ''}
                </div>
            `}).join('');
        }

        // ========== RECIPE SELECTION ==========
        function selectRecipe(id) {
            currentRecipe = RECIPES.find(r => r.id === id);
            if (!currentRecipe) return;

            currentStep = 0;
            document.getElementById('recipe-list').style.display = 'none';
            document.getElementById('evidence-board').style.display = 'block';
            document.getElementById('recipe-title').textContent = currentRecipe.title;

            renderStepTracker();
            renderIngredients();
            updateNarration();
        }

        function showRecipeList() {
            stopNarration();
            document.getElementById('recipe-list').style.display = 'block';
            document.getElementById('evidence-board').style.display = 'none';
            currentRecipe = null;
        }

        // ========== STEP NAVIGATION ==========
        function renderStepTracker() {
            const tracker = document.getElementById('step-tracker');
            tracker.innerHTML = currentRecipe.steps.map((_, i) =>
                `<div class="step-dot ${i === currentStep ? 'active' : ''} ${i < currentStep ? 'completed' : ''}"></div>`
            ).join('');
        }

        function updateNarration() {
            if (!currentRecipe) return;

            const step = currentRecipe.steps[currentStep];
            const narrationBox = document.getElementById('narration-text');
            const totalSteps = currentRecipe.steps.length;
            const escalation = getEscalationLevel(currentStep, totalSteps);
            const modifier = ESCALATION_MODIFIERS[escalation - 1];

            // Format with dramatic pauses and escalation
            let text = modifier.prefix + formatConspiracyText(step.conspiracy);

            // Add escalation visual cues
            const escalationBar = `
                <div style="display: flex; gap: 4px; margin-bottom: 10px;">
                    ${[1,2,3,4,5].map(l => `<div style="width: 20%; height: 4px; background: ${l <= escalation ? '#ff3333' : '#333'}; border-radius: 2px;"></div>`).join('')}
                </div>
                <div style="font-size: 10px; color: #888; margin-bottom: 10px;">PARANOIA LEVEL: ${modifier.intensity.toUpperCase()}</div>
            `;

            narrationBox.innerHTML = `
                ${escalationBar}
                <div style="margin-bottom: 15px; padding: 10px; background: rgba(255,255,255,0.05); border-left: 3px solid #ff6666;">
                    <strong>Step ${currentStep + 1}:</strong> ${step.action}
                </div>
                <p style="${escalation >= 4 ? 'font-size: 1.1em;' : ''} ${escalation === 5 ? 'color: #ff6666; text-shadow: 0 0 10px #ff0000;' : ''}">${text}</p>
            `;

            // Check for recipe completion
            if (currentStep === totalSteps - 1) {
                showCompletionPanel();
            }

            renderStepTracker();
            updateButtonStates();
        }

        function showCompletionPanel() {
            if (!currentRecipe || userProgress.completedRecipes.includes(currentRecipe.id)) return;

            // Mark recipe complete
            userProgress.completedRecipes.push(currentRecipe.id);

            // Award techniques
            const techniques = TECHNIQUES[currentRecipe.id] || [];
            for (const tech of techniques) {
                if (!userProgress.techniquesLearned.includes(tech)) {
                    userProgress.techniquesLearned.push(tech);
                }
            }

            userProgress.paranoidLevel = Math.min(10, userProgress.paranoidLevel + 1);
            saveProgress();

            // Check for new badges
            const newBadges = checkBadges();

            // Show completion notification
            setTimeout(() => {
                let message = `CASE CLOSED: You've completed ${currentRecipe.title}!`;
                if (techniques.length) {
                    message += `\n\nTECHNIQUES LEARNED:\n${techniques.map(t => '- ' + t).join('\n')}`;
                }
                if (newBadges.length) {
                    message += `\n\nNEW BADGE UNLOCKED:\n${newBadges.map(b => b.name + ' - ' + b.desc).join('\n')}`;
                }

                // Show related conspiracies
                const related = getRelatedConspiracies(currentRecipe.id);
                if (related.length) {
                    message += '\n\nRELATED CONSPIRACIES DETECTED:';
                    for (const r of related) {
                        const relatedRecipes = r.recipes.map(id => RECIPES.find(rec => rec.id === id)?.title).filter(Boolean);
                        if (relatedRecipes.length) {
                            message += `\n- ${r.conspiracy}: See also "${relatedRecipes.join('", "')}"`;
                        }
                    }
                }

                alert(message);
            }, 1000);
        }

        function formatConspiracyText(text) {
            // Add dramatic formatting
            return text
                .replace(/\.\.\./g, '<span class="dramatic-pause">...</span>')
                .replace(/\*static\*/g, '<span class="glitch">[STATIC]</span>')
                .replace(/([A-Z]{2,})/g, '<strong style="color: #ff6666;">$1</strong>')
                .replace(/(\d+(?:\.\d+)?)/g, '<span style="color: #ffff00;">$1</span>');
        }

        function nextStep() {
            if (currentStep < currentRecipe.steps.length - 1) {
                currentStep++;
                updateNarration();
                if (isSpeaking) {
                    stopNarration();
                    startNarration();
                }
            }
        }

        function previousStep() {
            if (currentStep > 0) {
                currentStep--;
                updateNarration();
                if (isSpeaking) {
                    stopNarration();
                    startNarration();
                }
            }
        }

        function updateButtonStates() {
            document.getElementById('prev-btn').disabled = currentStep === 0;
            document.getElementById('next-btn').disabled = currentStep === currentRecipe.steps.length - 1;
        }

        // ========== INGREDIENTS ==========
        function renderIngredients() {
            const list = document.getElementById('ingredient-list');
            list.innerHTML = currentRecipe.ingredients.map((ing, i) => `
                <div class="ingredient-item" id="ing-${i}" onclick="toggleIngredient(${i})">
                    ${ing}
                </div>
            `).join('');
        }

        function toggleIngredient(index) {
            const item = document.getElementById(`ing-${index}`);
            item.classList.toggle('checked');
        }

        // ========== SPEECH ==========
        function toggleNarration() {
            if (isSpeaking) {
                stopNarration();
            } else {
                startNarration();
            }
        }

        function startNarration() {
            if (!currentRecipe) return;

            const step = currentRecipe.steps[currentStep];
            let fullText = `Step ${currentStep + 1}. ${step.action}. ... ... ${step.conspiracy}`;

            // Add dramatic pauses based on intensity
            const pauseMs = pauseIntensity * 300;
            fullText = fullText.replace(/\.\.\./g, '. '.repeat(pauseIntensity));
            fullText = fullText.replace(/\*static\*/g, '. signal interrupted. ');

            const utterance = new SpeechSynthesisUtterance(fullText);
            utterance.voice = selectedVoice || voices[0];
            utterance.rate = speechRate * 0.85; // Slightly slower for drama
            utterance.pitch = 0.9; // Slightly deeper

            utterance.onend = () => {
                isSpeaking = false;
                document.getElementById('play-btn').textContent = 'Expose The Truth';
            };

            speechSynthesis.speak(utterance);
            isSpeaking = true;
            document.getElementById('play-btn').textContent = 'Silence The Truth';
        }

        function stopNarration() {
            speechSynthesis.cancel();
            isSpeaking = false;
            document.getElementById('play-btn').textContent = 'Expose The Truth';
        }

        // ========== CUSTOM RECIPE PARSER ==========
        function parseCustomRecipe() {
            const input = document.getElementById('custom-recipe').value;
            if (!input.trim()) return;

            // Basic parsing
            const lines = input.split('\n').filter(l => l.trim());
            const title = lines[0] || 'Unknown Dish';

            // Try to extract ingredients and steps
            const ingredients = [];
            const steps = [];
            let inIngredients = false;
            let inSteps = false;

            for (const line of lines.slice(1)) {
                const lower = line.toLowerCase();
                if (lower.includes('ingredient')) {
                    inIngredients = true;
                    inSteps = false;
                    continue;
                }
                if (lower.includes('instruction') || lower.includes('direction') || lower.includes('step')) {
                    inIngredients = false;
                    inSteps = true;
                    continue;
                }

                if (inIngredients && line.trim()) {
                    ingredients.push(line.trim().replace(/^[-â¢*]\s*/, ''));
                }
                if (inSteps && line.trim()) {
                    steps.push(line.trim().replace(/^\d+[\.\)]\s*/, ''));
                }
            }

            // If parsing failed, treat everything as steps
            if (steps.length === 0) {
                lines.slice(1).forEach(line => {
                    if (line.trim()) steps.push(line.trim());
                });
            }

            // Generate conspiracy narratives
            const conspiracyTemplates = [
                (action) => `This step - ${action} - seems innocent. But consider: who benefits when you don't know this technique? The pre-made food industry. They want you dependent. They want you ignorant. Not anymore.`,
                (action) => `${action}. Simple, right? WRONG. This technique was systematically removed from cooking education in the 1980s. The food processing lobby spent millions to make you forget what your grandparents knew instinctively.`,
                (action) => `As you ${action.toLowerCase()}, you're participating in an act of culinary rebellion. Every home cook who masters this skill is a threat to the $500 billion processed food industry. They're watching. Cook anyway.`,
                (action) => `${action}. Most people get this wrong. That's not an accident - it's DESIGN. Cooking failures drive restaurant sales. But you? You're breaking the cycle. Right here. Right now.`,
                (action) => `The moment you ${action.toLowerCase()}, you'll understand why this information was suppressed. The flavors that emerge cannot be replicated industrially. They require HUMAN attention. And that terrifies them.`
            ];

            const customRecipe = {
                id: 'custom-' + Date.now(),
                title: title,
                subtitle: 'User-Submitted Intelligence',
                difficulty: 'medium',
                description: 'This recipe was submitted for investigation. Our analysts have uncovered disturbing truths.',
                ingredients: ingredients.length ? ingredients : ['See original recipe'],
                steps: steps.map((step, i) => ({
                    action: step,
                    conspiracy: conspiracyTemplates[i % conspiracyTemplates.length](step)
                }))
            };

            RECIPES.push(customRecipe);
            selectRecipe(customRecipe.id);
        }

        // ========== INIT ==========
        init();
    </script>
</body>
</html>
