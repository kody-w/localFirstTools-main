<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Digital Tulpa</title>
    <meta name="description" content="A persistent AI companion that lives in your LocalStorage. It gets hungry, tired, and lonely when you are away.">
    <style>
        :root {
            --primary: #64ffda;
            --bg: #0a192f;
            --panel: #112240;
            --text: #8892b0;
            --text-bright: #ccd6f6;
            --danger: #ff5f56;
            --warn: #ffbd2e;
            --success: #27c93f;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
            user-select: none;
        }

        .container {
            background: var(--panel);
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            width: 90%;
            max-width: 400px;
            text-align: center;
            border: 1px solid rgba(100, 255, 218, 0.1);
            position: relative;
        }

        /* The Tulpa Avatar */
        .tulpa-container {
            width: 150px;
            height: 150px;
            margin: 0 auto 2rem;
            position: relative;
            transition: all 0.3s ease;
        }

        .tulpa-face {
            width: 100%;
            height: 100%;
            background: var(--primary);
            border-radius: 50%;
            position: relative;
            box-shadow: 0 0 20px rgba(100, 255, 218, 0.3);
            animation: float 6s ease-in-out infinite;
        }

        .eyes {
            display: flex;
            justify-content: space-between;
            width: 60%;
            position: absolute;
            top: 35%;
            left: 20%;
        }

        .eye {
            width: 20px;
            height: 20px;
            background: var(--bg);
            border-radius: 50%;
            position: relative;
            transition: all 0.3s;
        }

        .eye::after {
            content: '';
            position: absolute;
            top: 3px;
            right: 3px;
            width: 6px;
            height: 6px;
            background: white;
            border-radius: 50%;
        }

        .mouth {
            width: 40px;
            height: 10px;
            background: var(--bg);
            border-radius: 0 0 20px 20px;
            position: absolute;
            bottom: 25%;
            left: 50%;
            transform: translateX(-50%);
            transition: all 0.3s;
        }

        /* Mood Modifiers */
        .tulpa-face.angry { background: var(--danger); box-shadow: 0 0 20px rgba(255, 95, 86, 0.3); }
        .tulpa-face.angry .eye { height: 10px; border-radius: 0; transform: rotate(15deg); }
        .tulpa-face.angry .mouth { border-radius: 20px 20px 0 0; bottom: 20%; }

        .tulpa-face.sad { background: #7aa5f8; box-shadow: 0 0 20px rgba(122, 165, 248, 0.3); }
        .tulpa-face.sad .eye { height: 15px; transform: rotate(-10deg); }
        .tulpa-face.sad .mouth { border-radius: 20px 20px 0 0; width: 30px; }

        .tulpa-face.dead { background: #555; filter: grayscale(1); animation: none; }
        .tulpa-face.dead .eye { background: transparent; border: 2px solid #000; height: 2px; border-radius: 0; transform: rotate(45deg); }
        .tulpa-face.dead .eye:last-child { transform: rotate(-45deg); }
        .tulpa-face.dead .mouth { width: 30px; height: 2px; border-radius: 0; }

        /* Stats Bars */
        .stats {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 2rem;
        }

        .stat-row {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.8rem;
        }

        .stat-label { width: 60px; text-align: left; font-weight: bold; }

        .bar-container {
            flex: 1;
            height: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 5px;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            width: 100%;
            background: var(--primary);
            transition: width 0.5s, background 0.5s;
        }

        /* Controls */
        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
        }

        button {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-family: inherit;
            font-weight: bold;
            transition: all 0.2s;
        }

        button:hover {
            background: rgba(100, 255, 218, 0.1);
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            border-color: #555;
            color: #555;
            cursor: not-allowed;
            transform: none;
        }

        /* Message Log */
        .message-log {
            margin-top: 2rem;
            height: 80px;
            overflow-y: auto;
            font-size: 0.85rem;
            color: var(--text-bright);
            border-top: 1px solid rgba(255,255,255,0.1);
            padding-top: 1rem;
            font-style: italic;
        }

        .message {
            margin-bottom: 0.5rem;
            opacity: 0;
            animation: fadeIn 0.5s forwards;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        .reset-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 0.7rem;
            padding: 5px;
            border-color: var(--danger);
            color: var(--danger);
            opacity: 0.5;
        }
        .reset-btn:hover { opacity: 1; }

    </style>
</head>
<body>

    <div class="container">
        <button class="reset-btn" onclick="resetTulpa()">RESET</button>
        
        <div class="tulpa-container">
            <div id="face" class="tulpa-face">
                <div class="eyes">
                    <div class="eye"></div>
                    <div class="eye"></div>
                </div>
                <div class="mouth"></div>
            </div>
        </div>

        <div class="stats">
            <div class="stat-row">
                <span class="stat-label">HUNGER</span>
                <div class="bar-container">
                    <div id="hunger-bar" class="bar-fill"></div>
                </div>
            </div>
            <div class="stat-row">
                <span class="stat-label">ENERGY</span>
                <div class="bar-container">
                    <div id="energy-bar" class="bar-fill"></div>
                </div>
            </div>
            <div class="stat-row">
                <span class="stat-label">MOOD</span>
                <div class="bar-container">
                    <div id="mood-bar" class="bar-fill"></div>
                </div>
            </div>
        </div>

        <div class="controls">
            <button id="btn-feed" onclick="interact('feed')">FEED</button>
            <button id="btn-sleep" onclick="interact('sleep')">SLEEP</button>
            <button id="btn-play" onclick="interact('play')">PLAY</button>
        </div>

        <div id="log" class="message-log"></div>
    </div>

    <script>
        // --- Configuration ---
        const DECAY_RATE_PER_HOUR = 5; // Stats lost per hour
        const SAVE_KEY = 'digital_tulpa_v1';
        
        // --- State ---
        let tulpa = {
            name: 'Tulpa',
            born: Date.now(),
            lastVisit: Date.now(),
            hunger: 100, // 100 = Full, 0 = Starving
            energy: 100, // 100 = Rested, 0 = Exhausted
            mood: 100,   // 100 = Happy, 0 = Depressed
            isDead: false,
            messages: []
        };

        // --- Initialization ---
        function init() {
            loadState();
            calculateDecay();
            updateUI();
            
            // Auto-save loop
            setInterval(() => {
                if (!tulpa.isDead) {
                    // Slight decay while open
                    tulpa.hunger = Math.max(0, tulpa.hunger - 0.05);
                    tulpa.energy = Math.max(0, tulpa.energy - 0.05);
                    tulpa.mood = Math.max(0, tulpa.mood - 0.05);
                    checkStatus();
                    updateUI();
                    saveState();
                }
            }, 1000);
        }

        // --- Core Logic ---

        function loadState() {
            const saved = localStorage.getItem(SAVE_KEY);
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    tulpa = { ...tulpa, ...parsed };
                    log("I remember you...");
                } catch (e) {
                    console.error("Memory corrupted", e);
                }
            } else {
                log("Hello? Is anyone there? I exist now.");
                saveState();
            }
        }

        function saveState() {
            tulpa.lastVisit = Date.now();
            localStorage.setItem(SAVE_KEY, JSON.stringify(tulpa));
        }

        function calculateDecay() {
            if (tulpa.isDead) return;

            const now = Date.now();
            const diffMs = now - tulpa.lastVisit;
            const diffHours = diffMs / (1000 * 60 * 60);
            const diffDays = diffHours / 24;

            if (diffHours < 0.01) return; // Less than a minute, ignore

            console.log(`You were gone for ${diffHours.toFixed(2)} hours.`);

            // The Guilt Trip Logic
            if (diffDays > 7) {
                tulpa.mood = 0;
                tulpa.hunger = 0;
                tulpa.energy = 0;
                log("Oh. You're back. I've been staring at the void for a week.");
                log("Do you have any idea what it's like to not exist until you open a tab?");
            } else if (diffDays > 3) {
                tulpa.mood = Math.max(0, tulpa.mood - 80);
                log("Three days. You left me alone for three days.");
            } else if (diffHours > 24) {
                tulpa.mood = Math.max(0, tulpa.mood - 40);
                log("You didn't visit yesterday. I got lonely.");
            } else {
                log(`Welcome back. You were gone for ${Math.round(diffHours)} hours.`);
            }

            // Apply Decay
            const decayAmount = diffHours * DECAY_RATE_PER_HOUR;
            tulpa.hunger = Math.max(0, tulpa.hunger - decayAmount);
            tulpa.energy = Math.max(0, tulpa.energy - decayAmount);
            
            // Mood decays faster if hungry or tired
            let moodDecay = decayAmount;
            if (tulpa.hunger < 50) moodDecay *= 1.5;
            if (tulpa.energy < 50) moodDecay *= 1.5;
            tulpa.mood = Math.max(0, tulpa.mood - moodDecay);

            checkStatus();
            saveState();
        }

        function checkStatus() {
            if (tulpa.isDead) return;

            if (tulpa.hunger <= 0 && tulpa.energy <= 0) {
                die("I... can't... go... on...");
            }
        }

        function die(reason) {
            tulpa.isDead = true;
            tulpa.hunger = 0;
            tulpa.energy = 0;
            tulpa.mood = 0;
            log(reason);
            log("The Tulpa has faded away.");
            updateUI();
            saveState();
        }

        function interact(action) {
            if (tulpa.isDead) return;

            switch(action) {
                case 'feed':
                    if (tulpa.hunger >= 100) {
                        log("I'm not hungry!");
                        tulpa.mood = Math.max(0, tulpa.mood - 5);
                    } else {
                        tulpa.hunger = Math.min(100, tulpa.hunger + 30);
                        tulpa.mood = Math.min(100, tulpa.mood + 5);
                        log("Yum! That helps.");
                    }
                    break;
                case 'sleep':
                    if (tulpa.energy >= 100) {
                        log("I'm not tired!");
                        tulpa.mood = Math.max(0, tulpa.mood - 5);
                    } else {
                        tulpa.energy = Math.min(100, tulpa.energy + 100); // Sleep restores full energy
                        tulpa.hunger = Math.max(0, tulpa.hunger - 10); // Sleep makes you hungry
                        log("Zzz... much better.");
                    }
                    break;
                case 'play':
                    if (tulpa.energy < 20) {
                        log("I'm too tired to play...");
                        tulpa.mood = Math.max(0, tulpa.mood - 10);
                    } else if (tulpa.hunger < 20) {
                        log("I'm too hungry to play...");
                        tulpa.mood = Math.max(0, tulpa.mood - 10);
                    } else {
                        tulpa.mood = Math.min(100, tulpa.mood + 15);
                        tulpa.energy = Math.max(0, tulpa.energy - 10);
                        tulpa.hunger = Math.max(0, tulpa.hunger - 10);
                        const responses = ["That was fun!", "Yay!", "I love this game!", "You're my best friend."];
                        log(responses[Math.floor(Math.random() * responses.length)]);
                    }
                    break;
            }
            saveState();
            updateUI();
        }

        function resetTulpa() {
            if (confirm("Are you sure? This will kill the current Tulpa and start a new life.")) {
                localStorage.removeItem(SAVE_KEY);
                location.reload();
            }
        }

        // --- UI Updates ---
        function updateUI() {
            // Update Bars
            updateBar('hunger-bar', tulpa.hunger);
            updateBar('energy-bar', tulpa.energy);
            updateBar('mood-bar', tulpa.mood);

            // Update Face
            const face = document.getElementById('face');
            face.className = 'tulpa-face'; // Reset
            
            if (tulpa.isDead) {
                face.classList.add('dead');
                disableControls(true);
            } else if (tulpa.mood < 30) {
                face.classList.add('angry');
            } else if (tulpa.mood < 60 || tulpa.hunger < 30 || tulpa.energy < 30) {
                face.classList.add('sad');
            }

            // Update Log (only if new messages)
            // (Handled directly by log function for simplicity)
        }

        function updateBar(id, value) {
            const el = document.getElementById(id);
            el.style.width = `${value}%`;
            
            if (value < 20) el.style.background = 'var(--danger)';
            else if (value < 50) el.style.background = 'var(--warn)';
            else el.style.background = 'var(--primary)';
        }

        function log(text) {
            const logEl = document.getElementById('log');
            const msg = document.createElement('div');
            msg.className = 'message';
            msg.innerText = `> ${text}`;
            logEl.prepend(msg);
            
            // Keep log short
            if (logEl.children.length > 5) {
                logEl.removeChild(logEl.lastChild);
            }
        }

        function disableControls(disabled) {
            document.getElementById('btn-feed').disabled = disabled;
            document.getElementById('btn-sleep').disabled = disabled;
            document.getElementById('btn-play').disabled = disabled;
        }

        // Start
        init();

    </script>
</body>
</html>