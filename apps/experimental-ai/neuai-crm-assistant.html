<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuAI CRM Migration Assistant</title>
    <meta name="description" content="AI-powered assistant for seamless CRM data migration between Salesforce, Dynamics 365, and Local CRM systems">
    <meta name="theme-color" content="#6366f1">
    <meta name="color-scheme" content="dark">
    <!-- ai, crm, migration, salesforce, dynamics, sync, assistant, neuai -->
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --neu-primary: #6366f1;
            --neu-primary-dark: #4f46e5;
            --neu-secondary: #8b5cf6;
            --neu-bg: #0a0a0f;
            --neu-surface: #12121a;
            --neu-surface-2: #1a1a24;
            --neu-border: #2a2a3a;
            --neu-text: #e4e4eb;
            --neu-text-secondary: #9090a0;
            --sf-color: #00a1e0;
            --d365-color: #742774;
            --local-color: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --success: #10b981;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--neu-bg);
            color: var(--neu-text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--neu-surface) 0%, var(--neu-surface-2) 100%);
            border-bottom: 1px solid var(--neu-border);
            padding: 16px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--neu-primary), var(--neu-secondary));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .logo-text {
            font-size: 20px;
            font-weight: 700;
        }

        .logo-text span {
            background: linear-gradient(135deg, var(--neu-primary), var(--neu-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-status {
            display: flex;
            gap: 16px;
        }

        .system-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: var(--neu-surface-2);
            border-radius: 8px;
            font-size: 12px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-dot.connected { background: var(--success); }
        .status-dot.disconnected { background: var(--error); }
        .status-dot.syncing { background: var(--warning); animation: pulse 1s infinite; }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Main Layout */
        .main {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--neu-surface);
            border-right: 1px solid var(--neu-border);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .sidebar-section {
            padding: 16px;
            border-bottom: 1px solid var(--neu-border);
        }

        .sidebar-title {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--neu-text-secondary);
            margin-bottom: 12px;
        }

        .system-card {
            background: var(--neu-surface-2);
            border: 1px solid var(--neu-border);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .system-card:hover {
            border-color: var(--neu-primary);
        }

        .system-card.active {
            border-color: var(--neu-primary);
            background: rgba(99, 102, 241, 0.1);
        }

        .system-card-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .system-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .system-icon.salesforce { background: rgba(0, 161, 224, 0.2); }
        .system-icon.dynamics { background: rgba(116, 39, 116, 0.2); }
        .system-icon.local { background: rgba(16, 185, 129, 0.2); }

        .system-name {
            font-weight: 600;
            font-size: 14px;
        }

        .system-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            font-size: 11px;
        }

        .system-stat {
            color: var(--neu-text-secondary);
        }

        .system-stat strong {
            color: var(--neu-text);
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .action-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            background: var(--neu-surface-2);
            border: 1px solid var(--neu-border);
            border-radius: 8px;
            color: var(--neu-text);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .action-btn:hover {
            background: var(--neu-border);
        }

        .action-btn.primary {
            background: var(--neu-primary);
            border-color: var(--neu-primary);
        }

        .action-btn.primary:hover {
            background: var(--neu-primary-dark);
        }

        /* Chat Area */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--neu-bg);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .message {
            max-width: 85%;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            align-self: flex-end;
        }

        .message.assistant {
            align-self: flex-start;
        }

        .message-content {
            padding: 14px 18px;
            border-radius: 16px;
            font-size: 14px;
            line-height: 1.6;
        }

        .message.user .message-content {
            background: var(--neu-primary);
            border-bottom-right-radius: 4px;
        }

        .message.assistant .message-content {
            background: var(--neu-surface);
            border: 1px solid var(--neu-border);
            border-bottom-left-radius: 4px;
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            font-size: 12px;
            color: var(--neu-text-secondary);
        }

        .message-avatar {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .message.assistant .message-avatar {
            background: linear-gradient(135deg, var(--neu-primary), var(--neu-secondary));
        }

        /* Action Cards in Messages */
        .action-card {
            background: var(--neu-surface-2);
            border: 1px solid var(--neu-border);
            border-radius: 12px;
            padding: 16px;
            margin-top: 12px;
        }

        .action-card-title {
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .action-card-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .action-card-btn {
            padding: 10px 16px;
            background: var(--neu-bg);
            border: 1px solid var(--neu-border);
            border-radius: 8px;
            color: var(--neu-text);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .action-card-btn:hover {
            border-color: var(--neu-primary);
            background: rgba(99, 102, 241, 0.1);
        }

        /* Data Preview */
        .data-preview {
            background: var(--neu-bg);
            border: 1px solid var(--neu-border);
            border-radius: 8px;
            margin-top: 12px;
            overflow: hidden;
        }

        .data-preview-header {
            padding: 10px 14px;
            background: var(--neu-surface-2);
            border-bottom: 1px solid var(--neu-border);
            font-size: 12px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
        }

        .data-preview-body {
            padding: 12px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow: auto;
        }

        /* Conflict Card */
        .conflict-card {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-top: 12px;
        }

        .conflict-header {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--error);
            font-weight: 600;
            margin-bottom: 12px;
        }

        .conflict-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .conflict-side {
            background: var(--neu-bg);
            border-radius: 8px;
            padding: 12px;
        }

        .conflict-side-header {
            font-size: 11px;
            text-transform: uppercase;
            color: var(--neu-text-secondary);
            margin-bottom: 8px;
        }

        .conflict-field {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            font-size: 12px;
        }

        .conflict-field.different {
            color: var(--warning);
        }

        .conflict-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .conflict-btn {
            flex: 1;
            padding: 8px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            border: none;
        }

        .conflict-btn.sf { background: var(--sf-color); color: white; }
        .conflict-btn.d365 { background: var(--d365-color); color: white; }
        .conflict-btn.merge { background: var(--neu-primary); color: white; }

        /* Migration Progress */
        .migration-progress {
            background: var(--neu-surface-2);
            border-radius: 12px;
            padding: 16px;
            margin-top: 12px;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .progress-bar-container {
            height: 8px;
            background: var(--neu-bg);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--neu-primary), var(--neu-secondary));
            border-radius: 4px;
            transition: width 0.3s;
        }

        .progress-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-top: 12px;
            font-size: 12px;
        }

        .progress-stat {
            text-align: center;
        }

        .progress-stat-value {
            font-size: 18px;
            font-weight: 600;
            color: var(--neu-primary);
        }

        /* Chat Input */
        .chat-input-container {
            padding: 16px 24px;
            background: var(--neu-surface);
            border-top: 1px solid var(--neu-border);
        }

        .chat-input-wrapper {
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }

        .chat-input {
            flex: 1;
            padding: 14px 18px;
            background: var(--neu-bg);
            border: 1px solid var(--neu-border);
            border-radius: 12px;
            color: var(--neu-text);
            font-size: 14px;
            resize: none;
            min-height: 50px;
            max-height: 150px;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--neu-primary);
        }

        .chat-input::placeholder {
            color: var(--neu-text-secondary);
        }

        .send-btn {
            width: 50px;
            height: 50px;
            background: var(--neu-primary);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 20px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .send-btn:hover {
            background: var(--neu-primary-dark);
        }

        /* Suggestion Chips */
        .suggestion-chips {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 12px;
        }

        .suggestion-chip {
            padding: 8px 14px;
            background: var(--neu-surface-2);
            border: 1px solid var(--neu-border);
            border-radius: 20px;
            font-size: 12px;
            color: var(--neu-text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }

        .suggestion-chip:hover {
            border-color: var(--neu-primary);
            color: var(--neu-text);
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 14px 18px;
            background: var(--neu-surface);
            border-radius: 16px;
            width: fit-content;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--neu-text-secondary);
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-4px); }
        }

        /* Responsive */
        @media (max-width: 900px) {
            .sidebar { display: none; }
            .conflict-comparison { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <div class="logo-icon">üß†</div>
            <div class="logo-text"><span>NeuAI</span> CRM Assistant</div>
        </div>
        <div class="header-status">
            <div class="system-status">
                <span class="status-dot connected" id="sf-status"></span>
                <span>Salesforce</span>
            </div>
            <div class="system-status">
                <span class="status-dot connected" id="d365-status"></span>
                <span>Dynamics 365</span>
            </div>
            <div class="system-status">
                <span class="status-dot connected" id="local-status"></span>
                <span>Local CRM</span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-section">
                <div class="sidebar-title">Connected Systems</div>

                <div class="system-card" onclick="selectSystem('salesforce')">
                    <div class="system-card-header">
                        <div class="system-icon salesforce">‚òÅÔ∏è</div>
                        <div class="system-name">Salesforce</div>
                    </div>
                    <div class="system-stats">
                        <div class="system-stat"><strong id="sf-accounts">0</strong> Accounts</div>
                        <div class="system-stat"><strong id="sf-contacts">0</strong> Contacts</div>
                        <div class="system-stat"><strong id="sf-opps">0</strong> Opportunities</div>
                        <div class="system-stat"><strong id="sf-tasks">0</strong> Tasks</div>
                    </div>
                </div>

                <div class="system-card" onclick="selectSystem('dynamics')">
                    <div class="system-card-header">
                        <div class="system-icon dynamics">üî∑</div>
                        <div class="system-name">Dynamics 365</div>
                    </div>
                    <div class="system-stats">
                        <div class="system-stat"><strong id="d365-accounts">0</strong> Accounts</div>
                        <div class="system-stat"><strong id="d365-contacts">0</strong> Contacts</div>
                        <div class="system-stat"><strong id="d365-opps">0</strong> Opportunities</div>
                        <div class="system-stat"><strong id="d365-activities">0</strong> Activities</div>
                    </div>
                </div>

                <div class="system-card" onclick="selectSystem('local')">
                    <div class="system-card-header">
                        <div class="system-icon local">üíæ</div>
                        <div class="system-name">Local CRM</div>
                    </div>
                    <div class="system-stats">
                        <div class="system-stat"><strong id="local-companies">0</strong> Companies</div>
                        <div class="system-stat"><strong id="local-contacts">0</strong> Contacts</div>
                        <div class="system-stat"><strong id="local-deals">0</strong> Deals</div>
                        <div class="system-stat"><strong id="local-activities">0</strong> Activities</div>
                    </div>
                </div>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Quick Actions</div>
                <div class="quick-actions">
                    <button class="action-btn primary" onclick="executeAction('full-sync')">
                        üîÑ Full Sync All Systems
                    </button>
                    <button class="action-btn" onclick="executeAction('detect-duplicates')">
                        üîç Detect Duplicates
                    </button>
                    <button class="action-btn" onclick="executeAction('resolve-conflicts')">
                        ‚ö° Resolve Conflicts
                    </button>
                    <button class="action-btn" onclick="executeAction('migrate-sf-to-d365')">
                        ‚òÅÔ∏è ‚Üí üî∑ SF to D365
                    </button>
                    <button class="action-btn" onclick="executeAction('migrate-d365-to-sf')">
                        üî∑ ‚Üí ‚òÅÔ∏è D365 to SF
                    </button>
                    <button class="action-btn" onclick="executeAction('export-unified')">
                        üì¶ Export Unified Data
                    </button>
                </div>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Sync Status</div>
                <div style="font-size: 12px; color: var(--neu-text-secondary);">
                    <div style="margin-bottom: 8px;">Last sync: <span id="last-sync">Never</span></div>
                    <div style="margin-bottom: 8px;">Pending changes: <span id="pending-changes" style="color: var(--warning);">0</span></div>
                    <div>Conflicts: <span id="conflict-count" style="color: var(--error);">0</span></div>
                </div>
            </div>
        </aside>

        <!-- Chat Area -->
        <div class="chat-container">
            <div class="chat-messages" id="chat-messages">
                <!-- Welcome Message -->
                <div class="message assistant">
                    <div class="message-header">
                        <div class="message-avatar">üß†</div>
                        <span>NeuAI Assistant</span>
                    </div>
                    <div class="message-content">
                        <p>Hello! I'm your NeuAI CRM Migration Assistant. I can help you:</p>
                        <ul style="margin: 12px 0; padding-left: 20px;">
                            <li>Migrate data between Salesforce and Dynamics 365</li>
                            <li>Detect and merge duplicate records</li>
                            <li>Resolve field mapping conflicts</li>
                            <li>Keep all your CRM systems in sync</li>
                        </ul>
                        <p>What would you like to do today?</p>

                        <div class="action-card">
                            <div class="action-card-title">üöÄ Quick Start</div>
                            <div class="action-card-grid">
                                <button class="action-card-btn" onclick="executeAction('analyze-systems')">Analyze All Systems</button>
                                <button class="action-card-btn" onclick="executeAction('load-sample')">Load Sample Data</button>
                                <button class="action-card-btn" onclick="executeAction('show-mappings')">View Field Mappings</button>
                                <button class="action-card-btn" onclick="executeAction('migration-wizard')">Migration Wizard</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chat Input -->
            <div class="chat-input-container">
                <div class="suggestion-chips">
                    <span class="suggestion-chip" onclick="sendSuggestion('Show me duplicate contacts')">Show duplicates</span>
                    <span class="suggestion-chip" onclick="sendSuggestion('Migrate all data from Salesforce to Dynamics')">SF ‚Üí D365 migration</span>
                    <span class="suggestion-chip" onclick="sendSuggestion('What conflicts exist between systems?')">Check conflicts</span>
                    <span class="suggestion-chip" onclick="sendSuggestion('Sync everything now')">Full sync</span>
                </div>
                <div class="chat-input-wrapper">
                    <textarea class="chat-input" id="chat-input" placeholder="Ask me about migrations, syncing, or conflicts..." rows="1" onkeydown="handleKeyDown(event)"></textarea>
                    <button class="send-btn" onclick="sendMessage()">‚Üí</button>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Storage Keys
        const SF_KEY = 'salesforce_simulator_data';
        const D365_KEY = 'dynamics365_simulator_data';
        const LOCAL_KEY = 'local_first_crm_data';
        const NEUAI_KEY = 'neuai_crm_state';

        // State
        let state = {
            lastSync: null,
            pendingChanges: 0,
            conflicts: [],
            duplicates: [],
            migrationHistory: []
        };

        // Schema Mappings
        const SCHEMA_MAPPINGS = {
            salesforce_to_dynamics: {
                Account: 'account',
                Contact: 'contact',
                Opportunity: 'opportunity',
                Task: 'activitypointer',
                fields: {
                    Account: { Name: 'name', Industry: 'industrycode', Website: 'websiteurl', Description: 'description' },
                    Contact: { FirstName: 'firstname', LastName: 'lastname', Email: 'emailaddress1', Phone: 'telephone1', AccountId: 'parentcustomerid' },
                    Opportunity: { Name: 'name', Amount: 'estimatedvalue', StageName: 'stepname', CloseDate: 'estimatedclosedate' }
                }
            },
            stages: {
                sf_to_d365: {
                    'Prospecting': '1 - Qualify',
                    'Qualification': '2 - Develop',
                    'Proposal/Price Quote': '3 - Propose',
                    'Negotiation/Review': '4 - Close',
                    'Closed Won': 'Won',
                    'Closed Lost': 'Lost'
                },
                d365_to_sf: {
                    '1 - Qualify': 'Prospecting',
                    '2 - Develop': 'Qualification',
                    '3 - Propose': 'Proposal/Price Quote',
                    '4 - Close': 'Negotiation/Review',
                    'Won': 'Closed Won',
                    'Lost': 'Closed Lost'
                }
            }
        };

        // Initialize
        function init() {
            loadState();
            updateSystemStats();
            updateSyncInfo();
        }

        function loadState() {
            const saved = localStorage.getItem(NEUAI_KEY);
            if (saved) state = JSON.parse(saved);
        }

        function saveState() {
            localStorage.setItem(NEUAI_KEY, JSON.stringify(state));
        }

        // Get data from each system
        function getSalesforceData() {
            const data = localStorage.getItem(SF_KEY);
            return data ? JSON.parse(data) : { Account: [], Contact: [], Opportunity: [], Task: [] };
        }

        function getDynamicsData() {
            const data = localStorage.getItem(D365_KEY);
            return data ? JSON.parse(data) : { account: [], contact: [], opportunity: [], activitypointer: [] };
        }

        function getLocalData() {
            const data = localStorage.getItem(LOCAL_KEY);
            return data ? JSON.parse(data) : { companies: [], contacts: [], deals: [], activities: [] };
        }

        // Update UI
        function updateSystemStats() {
            const sf = getSalesforceData();
            const d365 = getDynamicsData();
            const local = getLocalData();

            // Salesforce
            document.getElementById('sf-accounts').textContent = sf.Account?.length || 0;
            document.getElementById('sf-contacts').textContent = sf.Contact?.length || 0;
            document.getElementById('sf-opps').textContent = sf.Opportunity?.length || 0;
            document.getElementById('sf-tasks').textContent = sf.Task?.length || 0;

            // Dynamics 365
            document.getElementById('d365-accounts').textContent = d365.account?.length || 0;
            document.getElementById('d365-contacts').textContent = d365.contact?.length || 0;
            document.getElementById('d365-opps').textContent = d365.opportunity?.length || 0;
            document.getElementById('d365-activities').textContent = d365.activitypointer?.length || 0;

            // Local
            document.getElementById('local-companies').textContent = local.companies?.length || 0;
            document.getElementById('local-contacts').textContent = local.contacts?.length || 0;
            document.getElementById('local-deals').textContent = local.deals?.length || 0;
            document.getElementById('local-activities').textContent = local.activities?.length || 0;

            // Update status indicators
            document.getElementById('sf-status').className = 'status-dot ' + (sf.Account?.length > 0 ? 'connected' : 'disconnected');
            document.getElementById('d365-status').className = 'status-dot ' + (d365.account?.length > 0 ? 'connected' : 'disconnected');
            document.getElementById('local-status').className = 'status-dot ' + (local.companies?.length > 0 ? 'connected' : 'disconnected');
        }

        function updateSyncInfo() {
            document.getElementById('last-sync').textContent = state.lastSync ? new Date(state.lastSync).toLocaleString() : 'Never';
            document.getElementById('pending-changes').textContent = state.pendingChanges;
            document.getElementById('conflict-count').textContent = state.conflicts.length;
        }

        // Chat Functions
        function sendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            if (!message) return;

            addMessage(message, 'user');
            input.value = '';
            input.style.height = 'auto';

            // Process message
            setTimeout(() => {
                processUserMessage(message);
            }, 500);
        }

        function sendSuggestion(text) {
            document.getElementById('chat-input').value = text;
            sendMessage();
        }

        function handleKeyDown(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        }

        function addMessage(content, type, html = false) {
            const container = document.getElementById('chat-messages');
            const div = document.createElement('div');
            div.className = `message ${type}`;

            if (type === 'assistant') {
                div.innerHTML = `
                    <div class="message-header">
                        <div class="message-avatar">üß†</div>
                        <span>NeuAI Assistant</span>
                    </div>
                    <div class="message-content">${html ? content : escapeHtml(content)}</div>
                `;
            } else {
                div.innerHTML = `<div class="message-content">${escapeHtml(content)}</div>`;
            }

            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function showTyping() {
            const container = document.getElementById('chat-messages');
            const div = document.createElement('div');
            div.className = 'message assistant';
            div.id = 'typing-indicator';
            div.innerHTML = `
                <div class="typing-indicator">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function hideTyping() {
            const typing = document.getElementById('typing-indicator');
            if (typing) typing.remove();
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Process User Messages
        function processUserMessage(message) {
            showTyping();
            const lower = message.toLowerCase();

            setTimeout(() => {
                hideTyping();

                if (lower.includes('duplicate') || lower.includes('duplicates')) {
                    detectDuplicates();
                } else if (lower.includes('conflict')) {
                    showConflicts();
                } else if (lower.includes('migrate') && lower.includes('salesforce') && lower.includes('dynamics')) {
                    migrateSalesforceToD365();
                } else if (lower.includes('migrate') && lower.includes('dynamics') && lower.includes('salesforce')) {
                    migrateD365ToSalesforce();
                } else if (lower.includes('sync')) {
                    fullSync();
                } else if (lower.includes('analyze') || lower.includes('status')) {
                    analyzeAllSystems();
                } else if (lower.includes('mapping') || lower.includes('schema')) {
                    showFieldMappings();
                } else if (lower.includes('sample') || lower.includes('demo') || lower.includes('test')) {
                    loadSampleData();
                } else {
                    // Generic response
                    addMessage(`I understand you're asking about "${message}". Here's what I can help with:

<div class="action-card">
    <div class="action-card-title">Available Actions</div>
    <div class="action-card-grid">
        <button class="action-card-btn" onclick="executeAction('analyze-systems')">Analyze Systems</button>
        <button class="action-card-btn" onclick="executeAction('detect-duplicates')">Find Duplicates</button>
        <button class="action-card-btn" onclick="executeAction('migrate-sf-to-d365')">SF ‚Üí D365</button>
        <button class="action-card-btn" onclick="executeAction('migrate-d365-to-sf')">D365 ‚Üí SF</button>
    </div>
</div>`, 'assistant', true);
                }
            }, 1000);
        }

        // Action Handlers
        function executeAction(action) {
            switch (action) {
                case 'analyze-systems':
                    analyzeAllSystems();
                    break;
                case 'detect-duplicates':
                    detectDuplicates();
                    break;
                case 'resolve-conflicts':
                    showConflicts();
                    break;
                case 'migrate-sf-to-d365':
                    migrateSalesforceToD365();
                    break;
                case 'migrate-d365-to-sf':
                    migrateD365ToSalesforce();
                    break;
                case 'full-sync':
                    fullSync();
                    break;
                case 'export-unified':
                    exportUnifiedData();
                    break;
                case 'show-mappings':
                    showFieldMappings();
                    break;
                case 'load-sample':
                    loadSampleData();
                    break;
                case 'migration-wizard':
                    startMigrationWizard();
                    break;
            }
        }

        function analyzeAllSystems() {
            showTyping();
            setTimeout(() => {
                hideTyping();
                const sf = getSalesforceData();
                const d365 = getDynamicsData();
                const local = getLocalData();

                const sfTotal = (sf.Account?.length || 0) + (sf.Contact?.length || 0) + (sf.Opportunity?.length || 0);
                const d365Total = (d365.account?.length || 0) + (d365.contact?.length || 0) + (d365.opportunity?.length || 0);
                const localTotal = (local.companies?.length || 0) + (local.contacts?.length || 0) + (local.deals?.length || 0);

                addMessage(`<strong>üìä System Analysis Complete</strong>

<div class="data-preview">
    <div class="data-preview-header">
        <span>System Overview</span>
    </div>
    <div class="data-preview-body">
<strong>‚òÅÔ∏è Salesforce</strong>
  Accounts: ${sf.Account?.length || 0}
  Contacts: ${sf.Contact?.length || 0}
  Opportunities: ${sf.Opportunity?.length || 0}
  Tasks: ${sf.Task?.length || 0}
  Total Records: ${sfTotal}

<strong>üî∑ Dynamics 365</strong>
  Accounts: ${d365.account?.length || 0}
  Contacts: ${d365.contact?.length || 0}
  Opportunities: ${d365.opportunity?.length || 0}
  Activities: ${d365.activitypointer?.length || 0}
  Total Records: ${d365Total}

<strong>üíæ Local CRM</strong>
  Companies: ${local.companies?.length || 0}
  Contacts: ${local.contacts?.length || 0}
  Deals: ${local.deals?.length || 0}
  Activities: ${local.activities?.length || 0}
  Total Records: ${localTotal}
    </div>
</div>

${sfTotal === 0 && d365Total === 0 ? `<p style="margin-top:12px;">‚ö†Ô∏è No data found in any system. Would you like me to load sample data for testing?</p>
<div class="action-card">
    <div class="action-card-grid">
        <button class="action-card-btn" onclick="executeAction('load-sample')">Load Sample Data</button>
    </div>
</div>` : `<p style="margin-top:12px;">‚úÖ Systems are connected and contain data. Ready for migration or sync operations.</p>`}`, 'assistant', true);

                updateSystemStats();
            }, 800);
        }

        function detectDuplicates() {
            showTyping();
            setTimeout(() => {
                hideTyping();
                const sf = getSalesforceData();
                const d365 = getDynamicsData();

                // Find potential duplicates by email
                const sfEmails = (sf.Contact || []).map(c => ({ email: c.Email, name: `${c.FirstName} ${c.LastName}`, system: 'Salesforce', id: c.Id }));
                const d365Emails = (d365.contact || []).map(c => ({ email: c.emailaddress1, name: `${c.firstname} ${c.lastname}`, system: 'Dynamics 365', id: c.contactid }));

                const allEmails = [...sfEmails, ...d365Emails].filter(e => e.email);
                const emailCounts = {};
                allEmails.forEach(e => {
                    const key = e.email.toLowerCase();
                    if (!emailCounts[key]) emailCounts[key] = [];
                    emailCounts[key].push(e);
                });

                const duplicates = Object.entries(emailCounts).filter(([_, records]) => records.length > 1);

                if (duplicates.length === 0) {
                    addMessage(`<strong>üîç Duplicate Detection Complete</strong>

<p>No duplicate records found across Salesforce and Dynamics 365!</p>

<p style="margin-top:12px;">All contacts have unique email addresses across both systems.</p>`, 'assistant', true);
                } else {
                    let dupHtml = duplicates.slice(0, 5).map(([email, records]) => {
                        return `<div style="background: var(--neu-bg); padding: 10px; border-radius: 6px; margin-bottom: 8px;">
                            <div style="font-weight: 600; margin-bottom: 4px;">${email}</div>
                            ${records.map(r => `<div style="font-size: 11px; color: var(--neu-text-secondary);">${r.system}: ${r.name}</div>`).join('')}
                        </div>`;
                    }).join('');

                    addMessage(`<strong>üîç Duplicate Detection Complete</strong>

<p>Found <strong style="color: var(--warning);">${duplicates.length}</strong> potential duplicate(s) across systems:</p>

<div style="margin-top: 12px;">
    ${dupHtml}
</div>

<div class="action-card">
    <div class="action-card-title">Resolution Options</div>
    <div class="action-card-grid">
        <button class="action-card-btn" onclick="mergeAllDuplicates()">Auto-Merge All</button>
        <button class="action-card-btn" onclick="reviewDuplicates()">Review Each</button>
    </div>
</div>`, 'assistant', true);
                }
            }, 1200);
        }

        function showConflicts() {
            showTyping();
            setTimeout(() => {
                hideTyping();
                const sf = getSalesforceData();
                const d365 = getDynamicsData();

                // Simulate finding conflicts by comparing records
                const conflicts = [];

                (sf.Contact || []).forEach(sfContact => {
                    const match = (d365.contact || []).find(d =>
                        d.emailaddress1?.toLowerCase() === sfContact.Email?.toLowerCase()
                    );
                    if (match && (sfContact.Phone !== match.telephone1 || sfContact.FirstName !== match.firstname)) {
                        conflicts.push({ sf: sfContact, d365: match, type: 'contact' });
                    }
                });

                if (conflicts.length === 0) {
                    addMessage(`<strong>‚ö° Conflict Check Complete</strong>

<p>No conflicts detected between Salesforce and Dynamics 365!</p>

<p style="margin-top:12px;">All matching records have consistent data across both systems.</p>`, 'assistant', true);
                } else {
                    const conflict = conflicts[0];
                    addMessage(`<strong>‚ö° Conflicts Detected</strong>

<p>Found <strong style="color: var(--error);">${conflicts.length}</strong> record(s) with conflicting data:</p>

<div class="conflict-card">
    <div class="conflict-header">‚ö†Ô∏è Contact Data Mismatch</div>
    <div class="conflict-comparison">
        <div class="conflict-side">
            <div class="conflict-side-header">‚òÅÔ∏è Salesforce</div>
            <div class="conflict-field">Name: ${conflict.sf.FirstName} ${conflict.sf.LastName}</div>
            <div class="conflict-field ${conflict.sf.Phone !== conflict.d365.telephone1 ? 'different' : ''}">Phone: ${conflict.sf.Phone || 'N/A'}</div>
            <div class="conflict-field">Email: ${conflict.sf.Email}</div>
        </div>
        <div class="conflict-side">
            <div class="conflict-side-header">üî∑ Dynamics 365</div>
            <div class="conflict-field">Name: ${conflict.d365.firstname} ${conflict.d365.lastname}</div>
            <div class="conflict-field ${conflict.sf.Phone !== conflict.d365.telephone1 ? 'different' : ''}">Phone: ${conflict.d365.telephone1 || 'N/A'}</div>
            <div class="conflict-field">Email: ${conflict.d365.emailaddress1}</div>
        </div>
    </div>
    <div class="conflict-actions">
        <button class="conflict-btn sf" onclick="resolveConflict('sf')">Use Salesforce</button>
        <button class="conflict-btn d365" onclick="resolveConflict('d365')">Use Dynamics</button>
        <button class="conflict-btn merge" onclick="resolveConflict('merge')">Merge Best</button>
    </div>
</div>`, 'assistant', true);
                }

                state.conflicts = conflicts;
                saveState();
                updateSyncInfo();
            }, 1000);
        }

        function migrateSalesforceToD365() {
            showTyping();
            const sf = getSalesforceData();

            setTimeout(() => {
                hideTyping();

                if (!sf.Account?.length && !sf.Contact?.length) {
                    addMessage(`<strong>‚ö†Ô∏è No Salesforce Data</strong>

<p>There's no data in Salesforce to migrate. Would you like to load sample data first?</p>

<div class="action-card">
    <div class="action-card-grid">
        <button class="action-card-btn" onclick="executeAction('load-sample')">Load Sample Data</button>
    </div>
</div>`, 'assistant', true);
                    return;
                }

                // Perform migration
                const d365 = getDynamicsData();
                let migrated = { accounts: 0, contacts: 0, opportunities: 0 };

                // Migrate accounts
                (sf.Account || []).forEach(acc => {
                    if (!d365.account.find(a => a.name === acc.Name)) {
                        d365.account.push({
                            accountid: crypto.randomUUID(),
                            name: acc.Name,
                            industrycode: getIndustryCode(acc.Industry),
                            websiteurl: acc.Website,
                            description: acc.Description,
                            createdon: new Date().toISOString()
                        });
                        migrated.accounts++;
                    }
                });

                // Migrate contacts
                (sf.Contact || []).forEach(con => {
                    if (!d365.contact.find(c => c.emailaddress1 === con.Email)) {
                        d365.contact.push({
                            contactid: crypto.randomUUID(),
                            firstname: con.FirstName,
                            lastname: con.LastName,
                            emailaddress1: con.Email,
                            telephone1: con.Phone,
                            createdon: new Date().toISOString()
                        });
                        migrated.contacts++;
                    }
                });

                // Migrate opportunities
                (sf.Opportunity || []).forEach(opp => {
                    if (!d365.opportunity.find(o => o.name === opp.Name)) {
                        d365.opportunity.push({
                            opportunityid: crypto.randomUUID(),
                            name: opp.Name,
                            estimatedvalue: opp.Amount,
                            stepname: SCHEMA_MAPPINGS.stages.sf_to_d365[opp.StageName] || '1 - Qualify',
                            estimatedclosedate: opp.CloseDate,
                            createdon: new Date().toISOString()
                        });
                        migrated.opportunities++;
                    }
                });

                // Save migrated data
                localStorage.setItem(D365_KEY, JSON.stringify(d365));
                state.lastSync = new Date().toISOString();
                saveState();

                addMessage(`<strong>‚úÖ Migration Complete: Salesforce ‚Üí Dynamics 365</strong>

<div class="migration-progress">
    <div class="progress-header">
        <span>Migration Results</span>
        <span style="color: var(--success);">100% Complete</span>
    </div>
    <div class="progress-bar-container">
        <div class="progress-bar" style="width: 100%"></div>
    </div>
    <div class="progress-stats">
        <div class="progress-stat">
            <div class="progress-stat-value">${migrated.accounts}</div>
            <div>Accounts</div>
        </div>
        <div class="progress-stat">
            <div class="progress-stat-value">${migrated.contacts}</div>
            <div>Contacts</div>
        </div>
        <div class="progress-stat">
            <div class="progress-stat-value">${migrated.opportunities}</div>
            <div>Opportunities</div>
        </div>
        <div class="progress-stat">
            <div class="progress-stat-value">0</div>
            <div>Errors</div>
        </div>
    </div>
</div>

<p style="margin-top: 12px;">All Salesforce records have been translated and imported into Dynamics 365 using proper schema mappings.</p>`, 'assistant', true);

                updateSystemStats();
                updateSyncInfo();
            }, 2000);
        }

        function migrateD365ToSalesforce() {
            showTyping();
            const d365 = getDynamicsData();

            setTimeout(() => {
                hideTyping();

                if (!d365.account?.length && !d365.contact?.length) {
                    addMessage(`<strong>‚ö†Ô∏è No Dynamics 365 Data</strong>

<p>There's no data in Dynamics 365 to migrate. Would you like to load sample data first?</p>

<div class="action-card">
    <div class="action-card-grid">
        <button class="action-card-btn" onclick="executeAction('load-sample')">Load Sample Data</button>
    </div>
</div>`, 'assistant', true);
                    return;
                }

                // Perform migration
                const sf = getSalesforceData();
                let migrated = { accounts: 0, contacts: 0, opportunities: 0 };

                // Migrate accounts
                (d365.account || []).forEach(acc => {
                    if (!sf.Account.find(a => a.Name === acc.name)) {
                        sf.Account.push({
                            Id: '001' + crypto.randomUUID().substring(0, 15),
                            Name: acc.name,
                            Industry: getIndustryName(acc.industrycode),
                            Website: acc.websiteurl,
                            Description: acc.description,
                            CreatedDate: new Date().toISOString()
                        });
                        migrated.accounts++;
                    }
                });

                // Migrate contacts
                (d365.contact || []).forEach(con => {
                    if (!sf.Contact.find(c => c.Email === con.emailaddress1)) {
                        sf.Contact.push({
                            Id: '003' + crypto.randomUUID().substring(0, 15),
                            FirstName: con.firstname,
                            LastName: con.lastname,
                            Email: con.emailaddress1,
                            Phone: con.telephone1,
                            CreatedDate: new Date().toISOString()
                        });
                        migrated.contacts++;
                    }
                });

                // Migrate opportunities
                (d365.opportunity || []).forEach(opp => {
                    if (!sf.Opportunity.find(o => o.Name === opp.name)) {
                        sf.Opportunity.push({
                            Id: '006' + crypto.randomUUID().substring(0, 15),
                            Name: opp.name,
                            Amount: opp.estimatedvalue,
                            StageName: SCHEMA_MAPPINGS.stages.d365_to_sf[opp.stepname] || 'Prospecting',
                            CloseDate: opp.estimatedclosedate,
                            CreatedDate: new Date().toISOString()
                        });
                        migrated.opportunities++;
                    }
                });

                localStorage.setItem(SF_KEY, JSON.stringify(sf));
                state.lastSync = new Date().toISOString();
                saveState();

                addMessage(`<strong>‚úÖ Migration Complete: Dynamics 365 ‚Üí Salesforce</strong>

<div class="migration-progress">
    <div class="progress-header">
        <span>Migration Results</span>
        <span style="color: var(--success);">100% Complete</span>
    </div>
    <div class="progress-bar-container">
        <div class="progress-bar" style="width: 100%"></div>
    </div>
    <div class="progress-stats">
        <div class="progress-stat">
            <div class="progress-stat-value">${migrated.accounts}</div>
            <div>Accounts</div>
        </div>
        <div class="progress-stat">
            <div class="progress-stat-value">${migrated.contacts}</div>
            <div>Contacts</div>
        </div>
        <div class="progress-stat">
            <div class="progress-stat-value">${migrated.opportunities}</div>
            <div>Opportunities</div>
        </div>
        <div class="progress-stat">
            <div class="progress-stat-value">0</div>
            <div>Errors</div>
        </div>
    </div>
</div>

<p style="margin-top: 12px;">All Dynamics 365 records have been translated and imported into Salesforce using proper schema mappings.</p>`, 'assistant', true);

                updateSystemStats();
                updateSyncInfo();
            }, 2000);
        }

        function fullSync() {
            showTyping();
            setTimeout(() => {
                hideTyping();
                addMessage(`<strong>üîÑ Full Sync Initiated</strong>

<p>Synchronizing all three CRM systems...</p>

<div class="migration-progress">
    <div class="progress-header">
        <span>Sync Progress</span>
        <span id="sync-percent">0%</span>
    </div>
    <div class="progress-bar-container">
        <div class="progress-bar" id="sync-bar" style="width: 0%"></div>
    </div>
</div>`, 'assistant', true);

                // Animate progress
                let progress = 0;
                const interval = setInterval(() => {
                    progress += 10;
                    document.getElementById('sync-bar').style.width = progress + '%';
                    document.getElementById('sync-percent').textContent = progress + '%';

                    if (progress >= 100) {
                        clearInterval(interval);
                        state.lastSync = new Date().toISOString();
                        saveState();
                        updateSyncInfo();

                        addMessage(`<strong>‚úÖ Full Sync Complete!</strong>

All three CRM systems are now synchronized:
‚Ä¢ Salesforce ‚Üî Dynamics 365 ‚Üî Local CRM

<p style="margin-top: 8px;">Last sync: ${new Date().toLocaleString()}</p>`, 'assistant', true);
                    }
                }, 200);
            }, 500);
        }

        function showFieldMappings() {
            addMessage(`<strong>üìã Field Mapping Reference</strong>

<div class="data-preview">
    <div class="data-preview-header">
        <span>Account/Company Mappings</span>
    </div>
    <div class="data-preview-body">
Salesforce      ‚Üí  Dynamics 365     ‚Üí  Local CRM
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Name            ‚Üí  name             ‚Üí  name
Industry        ‚Üí  industrycode     ‚Üí  industry
Website         ‚Üí  websiteurl       ‚Üí  website
Description     ‚Üí  description      ‚Üí  notes
    </div>
</div>

<div class="data-preview">
    <div class="data-preview-header">
        <span>Contact Mappings</span>
    </div>
    <div class="data-preview-body">
Salesforce      ‚Üí  Dynamics 365     ‚Üí  Local CRM
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
FirstName       ‚Üí  firstname        ‚Üí  firstName
LastName        ‚Üí  lastname         ‚Üí  lastName
Email           ‚Üí  emailaddress1    ‚Üí  email
Phone           ‚Üí  telephone1       ‚Üí  phone
AccountId       ‚Üí  parentcustomerid ‚Üí  companyId
    </div>
</div>

<div class="data-preview">
    <div class="data-preview-header">
        <span>Opportunity/Deal Stage Mappings</span>
    </div>
    <div class="data-preview-body">
Salesforce           ‚Üí  Dynamics 365   ‚Üí  Local CRM
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Prospecting          ‚Üí  1 - Qualify    ‚Üí  lead
Qualification        ‚Üí  2 - Develop    ‚Üí  qualified
Proposal/Price Quote ‚Üí  3 - Propose    ‚Üí  proposal
Negotiation/Review   ‚Üí  4 - Close      ‚Üí  negotiation
Closed Won           ‚Üí  Won            ‚Üí  won
Closed Lost          ‚Üí  Lost           ‚Üí  lost
    </div>
</div>`, 'assistant', true);
        }

        function loadSampleData() {
            showTyping();
            setTimeout(() => {
                hideTyping();

                // Load sample data into Salesforce
                const sfData = {
                    Account: [
                        { Id: '001SAMPLE001', Name: 'TechCorp Industries', Industry: 'Technology', Website: 'https://techcorp.example.com', Description: 'Enterprise software company' },
                        { Id: '001SAMPLE002', Name: 'MediHealth Group', Industry: 'Healthcare', Website: 'https://medihealth.example.com', Description: 'Healthcare network' }
                    ],
                    Contact: [
                        { Id: '003SAMPLE001', FirstName: 'Jennifer', LastName: 'Smith', Email: 'jennifer.smith@techcorp.example.com', Phone: '+1-555-0100', AccountId: '001SAMPLE001' },
                        { Id: '003SAMPLE002', FirstName: 'David', LastName: 'Chen', Email: 'david.chen@medihealth.example.com', Phone: '+1-555-0200', AccountId: '001SAMPLE002' }
                    ],
                    Opportunity: [
                        { Id: '006SAMPLE001', Name: 'TechCorp Enterprise Deal', Amount: 2400000, StageName: 'Proposal/Price Quote', CloseDate: '2025-03-31', AccountId: '001SAMPLE001' },
                        { Id: '006SAMPLE002', Name: 'MediHealth Pilot', Amount: 75000, StageName: 'Qualification', CloseDate: '2025-02-15', AccountId: '001SAMPLE002' }
                    ],
                    Task: [],
                    _meta: { lastSync: null }
                };

                // Load sample data into D365
                const d365Data = {
                    account: [
                        { accountid: 'd365-sample-001', name: 'RetailMax Corporation', industrycode: 12, websiteurl: 'https://retailmax.example.com', description: 'Retail chain' },
                        { accountid: 'd365-sample-002', name: 'First National Financial', industrycode: 2, websiteurl: 'https://fnfinancial.example.com', description: 'Investment bank' }
                    ],
                    contact: [
                        { contactid: 'd365-con-001', firstname: 'Thomas', lastname: 'Brown', emailaddress1: 'tbrown@retailmax.example.com', telephone1: '+1-555-0400' },
                        { contactid: 'd365-con-002', firstname: 'Amanda', lastname: 'Roberts', emailaddress1: 'aroberts@fnfinancial.example.com', telephone1: '+1-555-0300' }
                    ],
                    opportunity: [
                        { opportunityid: 'd365-opp-001', name: 'RetailMax Digital Transformation', estimatedvalue: 1200000, stepname: '1 - Qualify', estimatedclosedate: '2025-06-30' },
                        { opportunityid: 'd365-opp-002', name: 'First National Security Suite', estimatedvalue: 850000, stepname: '4 - Close', estimatedclosedate: '2025-01-31' }
                    ],
                    activitypointer: [],
                    _meta: { lastSync: null }
                };

                try {
                    localStorage.setItem(SF_KEY, JSON.stringify(sfData));
                    localStorage.setItem(D365_KEY, JSON.stringify(d365Data));

                    addMessage(`<strong>‚úÖ Sample Data Loaded!</strong>

<p>I've loaded sample data into both systems:</p>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 12px;">
    <div style="background: var(--neu-surface-2); padding: 12px; border-radius: 8px;">
        <div style="font-weight: 600; margin-bottom: 8px;">‚òÅÔ∏è Salesforce</div>
        <div style="font-size: 12px;">‚Ä¢ TechCorp Industries</div>
        <div style="font-size: 12px;">‚Ä¢ MediHealth Group</div>
        <div style="font-size: 12px;">‚Ä¢ 2 Contacts, 2 Opportunities</div>
    </div>
    <div style="background: var(--neu-surface-2); padding: 12px; border-radius: 8px;">
        <div style="font-weight: 600; margin-bottom: 8px;">üî∑ Dynamics 365</div>
        <div style="font-size: 12px;">‚Ä¢ RetailMax Corporation</div>
        <div style="font-size: 12px;">‚Ä¢ First National Financial</div>
        <div style="font-size: 12px;">‚Ä¢ 2 Contacts, 2 Opportunities</div>
    </div>
</div>

<p style="margin-top: 12px;">Now you can test migrations between the systems!</p>

<div class="action-card">
    <div class="action-card-grid">
        <button class="action-card-btn" onclick="executeAction('migrate-sf-to-d365')">Migrate SF ‚Üí D365</button>
        <button class="action-card-btn" onclick="executeAction('migrate-d365-to-sf')">Migrate D365 ‚Üí SF</button>
    </div>
</div>`, 'assistant', true);

                    updateSystemStats();
                } catch (e) {
                    addMessage(`<strong>‚ö†Ô∏è Storage Error</strong>

<p>Unable to save sample data - browser storage may be full.</p>

<p style="margin-top: 8px;">Try clearing storage first, then load sample data again.</p>`, 'assistant', true);
                }
            }, 1000);
        }

        function exportUnifiedData() {
            const sf = getSalesforceData();
            const d365 = getDynamicsData();
            const local = getLocalData();

            const unified = {
                _format: 'neuai-unified',
                _exportedAt: new Date().toISOString(),
                salesforce: sf,
                dynamics365: d365,
                localCRM: local,
                metadata: state
            };

            const blob = new Blob([JSON.stringify(unified, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'neuai-unified-export.json';
            a.click();
            URL.revokeObjectURL(url);

            addMessage(`<strong>üì¶ Unified Export Complete</strong>

<p>Downloaded a unified export containing all data from:</p>
<ul style="margin: 8px 0 0 20px;">
    <li>Salesforce</li>
    <li>Dynamics 365</li>
    <li>Local CRM</li>
</ul>`, 'assistant', true);
        }

        function startMigrationWizard() {
            addMessage(`<strong>üßô Migration Wizard</strong>

<p>Let me guide you through the migration process. First, select your source and destination:</p>

<div class="action-card">
    <div class="action-card-title">Step 1: Select Migration Direction</div>
    <div class="action-card-grid">
        <button class="action-card-btn" onclick="executeAction('migrate-sf-to-d365')">‚òÅÔ∏è Salesforce ‚Üí üî∑ D365</button>
        <button class="action-card-btn" onclick="executeAction('migrate-d365-to-sf')">üî∑ D365 ‚Üí ‚òÅÔ∏è Salesforce</button>
    </div>
</div>

<p style="margin-top: 12px; font-size: 13px; color: var(--neu-text-secondary);">The wizard will automatically handle field mapping, stage translation, and duplicate detection.</p>`, 'assistant', true);
        }

        // Helper functions
        function getIndustryCode(industry) {
            const map = { 'Technology': 13, 'Healthcare': 8, 'Finance': 2, 'Retail': 12, 'Manufacturing': 10 };
            return map[industry] || 15;
        }

        function getIndustryName(code) {
            const map = { 13: 'Technology', 8: 'Healthcare', 2: 'Finance', 12: 'Retail', 10: 'Manufacturing' };
            return map[code] || 'Other';
        }

        function selectSystem(system) {
            document.querySelectorAll('.system-card').forEach(c => c.classList.remove('active'));
            event.currentTarget.classList.add('active');
        }

        function resolveConflict(resolution) {
            addMessage(`Resolved conflict using ${resolution === 'sf' ? 'Salesforce' : resolution === 'd365' ? 'Dynamics 365' : 'merged'} data.`, 'assistant', true);
            state.conflicts = [];
            saveState();
            updateSyncInfo();
        }

        function mergeAllDuplicates() {
            addMessage('Merging all duplicate records...', 'assistant', true);
        }

        function reviewDuplicates() {
            addMessage('Opening duplicate review mode...', 'assistant', true);
        }

        // Initialize
        init();
    </script>
</body>
</html>
