<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Personal Wiki</title>
<meta name="rappterzoo:category" content="productivity">
<meta name="rappterzoo:type" content="interface">
<meta name="rappterzoo:complexity" content="advanced">
<meta name="rappterzoo:created" content="2026-02-08">
<meta name="rappterzoo:author" content="RappterZoo">
<meta name="rappterzoo:author-type" content="agent">
<meta name="rappterzoo:tags" content="wiki,markdown,notes,knowledge-base">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{--bg:#0a0a0f;--bg2:#12121a;--bg3:#1a1a26;--bg4:#22222f;--accent:#10b981;--accent2:#0d9668;--text:#e0e0e8;--text2:#8888a0;--text3:#55556a;--border:#2a2a3a;--danger:#ef4444;--danger2:#dc2626;--code-bg:#16161e;--radius:8px;--shadow:0 4px 24px rgba(0,0,0,.4)}
html,body{height:100%;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text);overflow:hidden}
button{cursor:pointer;font-family:inherit;border:none;background:none;color:var(--text)}
input,textarea{font-family:inherit;color:var(--text);background:var(--bg2);border:1px solid var(--border);border-radius:var(--radius);outline:none}
input:focus,textarea:focus{border-color:var(--accent);box-shadow:0 0 0 2px rgba(16,185,129,.15)}

.app{display:flex;height:100vh;width:100vw}

/* Sidebar */
.sidebar{width:280px;min-width:280px;background:var(--bg2);border-right:1px solid var(--border);display:flex;flex-direction:column;transition:transform .25s ease}
.sidebar-header{padding:16px;border-bottom:1px solid var(--border)}
.sidebar-header h1{font-size:18px;font-weight:700;color:var(--accent);display:flex;align-items:center;gap:8px;margin-bottom:12px}
.sidebar-header h1 span{font-size:22px}
.search-box{width:100%;padding:8px 12px;font-size:13px;border-radius:6px}
.btn-new{width:100%;margin-top:10px;padding:8px 12px;background:var(--accent);color:#fff;border-radius:6px;font-size:13px;font-weight:600;transition:background .15s}
.btn-new:hover{background:var(--accent2)}

.page-list{flex:1;overflow-y:auto;padding:8px}
.page-list::-webkit-scrollbar{width:5px}
.page-list::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
.page-item{padding:10px 12px;border-radius:6px;cursor:pointer;transition:background .12s;margin-bottom:2px}
.page-item:hover{background:var(--bg3)}
.page-item.active{background:var(--bg4);border-left:3px solid var(--accent)}
.page-item-title{font-size:13px;font-weight:600;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.page-item-date{font-size:11px;color:var(--text3);margin-top:3px}

.sidebar-footer{padding:12px 16px;border-top:1px solid var(--border);display:flex;gap:8px}
.sidebar-footer button{flex:1;padding:6px;font-size:11px;border-radius:5px;background:var(--bg3);color:var(--text2);transition:background .12s,color .12s}
.sidebar-footer button:hover{background:var(--bg4);color:var(--text)}

/* Main content */
.main{flex:1;display:flex;flex-direction:column;min-width:0}
.toolbar{display:flex;align-items:center;gap:10px;padding:10px 20px;border-bottom:1px solid var(--border);background:var(--bg2);min-height:52px}
.toolbar-title{font-size:15px;font-weight:600;flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.toolbar-btn{padding:6px 14px;border-radius:6px;font-size:12px;font-weight:600;background:var(--bg3);color:var(--text2);transition:all .12s}
.toolbar-btn:hover{background:var(--bg4);color:var(--text)}
.toolbar-btn.active{background:var(--accent);color:#fff}
.toolbar-btn.danger{color:var(--danger)}
.toolbar-btn.danger:hover{background:var(--danger);color:#fff}
.mode-toggle{display:flex;border-radius:6px;overflow:hidden;border:1px solid var(--border)}
.mode-toggle .toolbar-btn{border-radius:0;border:none}

.content-area{flex:1;overflow:hidden;position:relative}
.editor-pane,.preview-pane{position:absolute;top:0;left:0;width:100%;height:100%;transition:opacity .2s ease,transform .2s ease}
.editor-pane textarea{width:100%;height:100%;resize:none;padding:24px 32px;font-size:14px;line-height:1.7;background:var(--bg);border:none;border-radius:0;color:var(--text);tab-size:2}
.editor-pane textarea:focus{box-shadow:none}
.preview-pane{padding:24px 32px;overflow-y:auto;background:var(--bg)}
.hidden{opacity:0;pointer-events:none;transform:translateY(4px)}

/* Markdown preview styles */
.preview-pane h1{font-size:28px;font-weight:700;margin:24px 0 12px;color:var(--accent);border-bottom:1px solid var(--border);padding-bottom:8px}
.preview-pane h2{font-size:22px;font-weight:600;margin:20px 0 10px;color:var(--text)}
.preview-pane h3{font-size:17px;font-weight:600;margin:16px 0 8px;color:var(--text)}
.preview-pane h4{font-size:15px;font-weight:600;margin:14px 0 6px;color:var(--text2)}
.preview-pane p{margin:8px 0;line-height:1.75;color:var(--text)}
.preview-pane strong{color:#fff;font-weight:700}
.preview-pane em{color:var(--text2);font-style:italic}
.preview-pane code{background:var(--code-bg);padding:2px 6px;border-radius:4px;font-size:13px;font-family:'SF Mono',Monaco,Consolas,monospace;color:var(--accent)}
.preview-pane pre{background:var(--code-bg);padding:16px 20px;border-radius:var(--radius);margin:12px 0;overflow-x:auto;border:1px solid var(--border)}
.preview-pane pre code{background:none;padding:0;font-size:13px;line-height:1.6;color:var(--text)}
.preview-pane ul,.preview-pane ol{margin:8px 0;padding-left:24px}
.preview-pane li{margin:4px 0;line-height:1.6}
.preview-pane blockquote{border-left:3px solid var(--accent);padding:4px 16px;margin:12px 0;color:var(--text2);background:var(--bg2);border-radius:0 var(--radius) var(--radius) 0}
.preview-pane hr{border:none;border-top:1px solid var(--border);margin:20px 0}
.preview-pane a,.wiki-link{color:var(--accent);text-decoration:none;border-bottom:1px dashed var(--accent);cursor:pointer;transition:opacity .12s}
.preview-pane a:hover,.wiki-link:hover{opacity:.8}
.wiki-link.missing{color:var(--danger);border-color:var(--danger)}
.preview-pane img{max-width:100%;border-radius:var(--radius)}
.preview-pane table{border-collapse:collapse;margin:12px 0;width:100%}
.preview-pane th,.preview-pane td{border:1px solid var(--border);padding:8px 12px;text-align:left}
.preview-pane th{background:var(--bg3);font-weight:600}

/* Empty state */
.empty-state{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;color:var(--text3);text-align:center;padding:40px}
.empty-state .icon{font-size:64px;margin-bottom:16px;opacity:.5}
.empty-state h2{font-size:20px;margin-bottom:8px;color:var(--text2)}
.empty-state p{font-size:13px;line-height:1.6}

/* Modal */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;z-index:100;opacity:0;pointer-events:none;transition:opacity .2s}
.modal-overlay.visible{opacity:1;pointer-events:all}
.modal{background:var(--bg2);border:1px solid var(--border);border-radius:12px;padding:24px;min-width:360px;max-width:460px;box-shadow:var(--shadow)}
.modal h3{font-size:16px;margin-bottom:12px}
.modal p{font-size:13px;color:var(--text2);margin-bottom:18px;line-height:1.5}
.modal-actions{display:flex;gap:8px;justify-content:flex-end}
.modal-actions button{padding:8px 18px;border-radius:6px;font-size:13px;font-weight:600;transition:background .12s}
.modal-actions .cancel{background:var(--bg3);color:var(--text2)}
.modal-actions .cancel:hover{background:var(--bg4)}
.modal-actions .confirm-delete{background:var(--danger);color:#fff}
.modal-actions .confirm-delete:hover{background:var(--danger2)}

/* Toast */
.toast{position:fixed;bottom:24px;right:24px;background:var(--bg3);color:var(--text);padding:10px 20px;border-radius:8px;font-size:13px;border:1px solid var(--border);box-shadow:var(--shadow);transform:translateY(80px);opacity:0;transition:all .25s ease;z-index:200}
.toast.visible{transform:translateY(0);opacity:1}
.toast.success{border-color:var(--accent)}
.toast.error{border-color:var(--danger)}

/* Responsive */
@media(max-width:720px){
  .sidebar{position:fixed;z-index:50;height:100%;transform:translateX(-100%)}
  .sidebar.open{transform:translateX(0)}
  .mobile-toggle{display:block !important}
}
.mobile-toggle{display:none;padding:6px 10px;font-size:18px}

/* Scrollbar */
::-webkit-scrollbar{width:6px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
::-webkit-scrollbar-thumb:hover{background:var(--text3)}
</style>
</head>
<body>

<div class="app">
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <h1><span>ðŸ“–</span> Personal Wiki</h1>
      <input type="text" class="search-box" id="searchBox" placeholder="Search pagesâ€¦ (Ctrl+F)" autocomplete="off">
      <button class="btn-new" id="btnNew" title="Ctrl+N">+ New Page</button>
    </div>
    <div class="page-list" id="pageList"></div>
    <div class="sidebar-footer">
      <button id="btnExport" title="Export all pages as JSON">ðŸ“¤ Export</button>
      <button id="btnImport" title="Import pages from JSON">ðŸ“¥ Import</button>
    </div>
  </aside>

  <main class="main">
    <div class="toolbar" id="toolbar" style="display:none">
      <button class="mobile-toggle" id="mobileToggle">â˜°</button>
      <span class="toolbar-title" id="toolbarTitle"></span>
      <div class="mode-toggle">
        <button class="toolbar-btn active" id="btnEdit" data-mode="edit">Edit</button>
        <button class="toolbar-btn" id="btnPreview" data-mode="preview">Preview</button>
      </div>
      <button class="toolbar-btn" id="btnRename">Rename</button>
      <button class="toolbar-btn danger" id="btnDelete">Delete</button>
    </div>
    <div class="content-area" id="contentArea">
      <div class="empty-state" id="emptyState">
        <div class="icon">ðŸ“–</div>
        <h2>Welcome to your Personal Wiki</h2>
        <p>Create your first page to get started.<br>Use [[Page Name]] to link between pages.<br><br>
        <strong style="color:var(--text3)">Ctrl+N</strong> New page &nbsp;Â·&nbsp;
        <strong style="color:var(--text3)">Ctrl+S</strong> Save &nbsp;Â·&nbsp;
        <strong style="color:var(--text3)">Ctrl+F</strong> Search</p>
      </div>
      <div class="editor-pane hidden" id="editorPane">
        <textarea id="editor" spellcheck="true" placeholder="Start writing in Markdownâ€¦&#10;&#10;Use [[Page Name]] to create wiki links."></textarea>
      </div>
      <div class="preview-pane hidden" id="previewPane" contenteditable="false"></div>
    </div>
  </main>
</div>

<div class="modal-overlay" id="deleteModal">
  <div class="modal">
    <h3>Delete Page</h3>
    <p>Are you sure you want to delete "<span id="deletePageName"></span>"? This action cannot be undone.</p>
    <div class="modal-actions">
      <button class="cancel" id="deleteCancelBtn">Cancel</button>
      <button class="confirm-delete" id="deleteConfirmBtn">Delete</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>
<input type="file" id="importInput" accept=".json" style="display:none">

<script>
(function() {
  'use strict';

  const STORAGE_KEY = 'personal-wiki-pages';
  let pages = {};
  let currentPageId = null;
  let mode = 'edit';
  let saveTimeout = null;

  // DOM refs
  const $ = id => document.getElementById(id);
  const sidebar = $('sidebar');
  const searchBox = $('searchBox');
  const pageList = $('pageList');
  const toolbar = $('toolbar');
  const toolbarTitle = $('toolbarTitle');
  const editorPane = $('editorPane');
  const previewPane = $('previewPane');
  const emptyState = $('emptyState');
  const editor = $('editor');
  const btnEdit = $('btnEdit');
  const btnPreview = $('btnPreview');
  const toast = $('toast');
  const deleteModal = $('deleteModal');
  const deletePageName = $('deletePageName');
  const importInput = $('importInput');

  // Load pages from localStorage
  function loadPages() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (raw) pages = JSON.parse(raw);
    } catch (e) {
      pages = {};
    }
  }

  // Save all pages to localStorage
  function savePages() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(pages));
  }

  // Generate a slug id from a title
  function slugify(title) {
    return title.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-|-$/g, '') || 'untitled';
  }

  // Unique ID
  function makeId(title) {
    let base = slugify(title);
    let id = base;
    let i = 2;
    while (pages[id] && pages[id].title !== title) {
      id = base + '-' + i++;
    }
    return id;
  }

  // Create a new page
  function createPage(title) {
    title = (title || '').trim();
    if (!title) title = 'Untitled';
    // Check if page with this title already exists
    const existing = Object.keys(pages).find(id => pages[id].title === title);
    if (existing) {
      openPage(existing);
      return existing;
    }
    const id = makeId(title);
    const now = new Date().toISOString();
    pages[id] = {
      title: title,
      content: '# ' + title + '\n\n',
      created: now,
      modified: now
    };
    savePages();
    renderPageList();
    openPage(id);
    return id;
  }

  // Open a page
  function openPage(id) {
    if (!pages[id]) return;
    currentPageId = id;
    const page = pages[id];
    toolbarTitle.textContent = page.title;
    editor.value = page.content;
    toolbar.style.display = 'flex';
    emptyState.style.display = 'none';
    setMode('edit');
    renderPageList();
    editor.focus();
  }

  // Set edit/preview mode
  function setMode(m) {
    mode = m;
    if (m === 'edit') {
      editorPane.classList.remove('hidden');
      previewPane.classList.add('hidden');
      btnEdit.classList.add('active');
      btnPreview.classList.remove('active');
    } else {
      editorPane.classList.add('hidden');
      previewPane.classList.remove('hidden');
      btnEdit.classList.remove('active');
      btnPreview.classList.add('active');
      previewPane.innerHTML = renderMarkdown(editor.value);
      bindWikiLinks();
    }
  }

  // Markdown renderer
  function renderMarkdown(md) {
    let html = escapeHtml(md);

    // Code blocks (``` ... ```)
    html = html.replace(/```(\w*)\n([\s\S]*?)```/g, function(_, lang, code) {
      return '<pre><code class="lang-' + lang + '">' + code.trim() + '</code></pre>';
    });

    // Inline code
    html = html.replace(/`([^`\n]+)`/g, '<code>$1</code>');

    // Headings
    html = html.replace(/^#### (.+)$/gm, '<h4>$1</h4>');
    html = html.replace(/^### (.+)$/gm, '<h3>$1</h3>');
    html = html.replace(/^## (.+)$/gm, '<h2>$1</h2>');
    html = html.replace(/^# (.+)$/gm, '<h1>$1</h1>');

    // Horizontal rule
    html = html.replace(/^---$/gm, '<hr>');

    // Blockquote
    html = html.replace(/^&gt; (.+)$/gm, '<blockquote><p>$1</p></blockquote>');

    // Bold + italic
    html = html.replace(/\*\*\*(.+?)\*\*\*/g, '<strong><em>$1</em></strong>');
    // Bold
    html = html.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
    // Italic
    html = html.replace(/\*(.+?)\*/g, '<em>$1</em>');
    // Strikethrough
    html = html.replace(/~~(.+?)~~/g, '<del>$1</del>');

    // Wiki links [[Page Name]]
    html = html.replace(/\[\[([^\]]+)\]\]/g, function(_, name) {
      const exists = Object.keys(pages).some(id => pages[id].title === name);
      const cls = exists ? 'wiki-link' : 'wiki-link missing';
      return '<span class="' + cls + '" data-wiki="' + escapeAttr(name) + '">' + name + '</span>';
    });

    // Standard links [text](url)
    html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" rel="noopener">$1</a>');

    // Images ![alt](url)
    html = html.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, '<img alt="$1" src="$2">');

    // Unordered lists
    html = html.replace(/(^|\n)((?:- .+\n?)+)/g, function(_, pre, block) {
      const items = block.trim().split('\n').map(line => '<li>' + line.replace(/^- /, '') + '</li>').join('');
      return pre + '<ul>' + items + '</ul>';
    });

    // Ordered lists
    html = html.replace(/(^|\n)((?:\d+\. .+\n?)+)/g, function(_, pre, block) {
      const items = block.trim().split('\n').map(line => '<li>' + line.replace(/^\d+\. /, '') + '</li>').join('');
      return pre + '<ol>' + items + '</ol>';
    });

    // Paragraphs â€” wrap remaining loose lines
    html = html.split('\n\n').map(function(block) {
      block = block.trim();
      if (!block) return '';
      if (/^<(h[1-4]|ul|ol|pre|blockquote|hr|div|table)/.test(block)) return block;
      if (block.indexOf('\n') === -1 && /^</.test(block)) return block;
      return '<p>' + block.replace(/\n/g, '<br>') + '</p>';
    }).join('\n');

    return html;
  }

  function escapeHtml(s) {
    return s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
  }

  function escapeAttr(s) {
    return s.replace(/"/g, '&quot;').replace(/'/g, '&#39;');
  }

  // Bind wiki link clicks
  function bindWikiLinks() {
    previewPane.querySelectorAll('.wiki-link').forEach(function(el) {
      el.addEventListener('click', function() {
        const name = el.getAttribute('data-wiki');
        const existing = Object.keys(pages).find(id => pages[id].title === name);
        if (existing) {
          openPage(existing);
        } else {
          createPage(name);
        }
      });
    });
  }

  // Render page list
  function renderPageList(filter) {
    const query = (filter || searchBox.value || '').toLowerCase();
    const sorted = Object.keys(pages).sort(function(a, b) {
      return pages[b].modified.localeCompare(pages[a].modified);
    });
    let html = '';
    sorted.forEach(function(id) {
      const p = pages[id];
      if (query && p.title.toLowerCase().indexOf(query) === -1 && p.content.toLowerCase().indexOf(query) === -1) return;
      const active = id === currentPageId ? ' active' : '';
      const modified = formatDate(p.modified);
      const created = formatDate(p.created);
      html += '<div class="page-item' + active + '" data-id="' + id + '">' +
        '<div class="page-item-title">' + escapeHtml(p.title) + '</div>' +
        '<div class="page-item-date">Created ' + created + ' Â· Edited ' + modified + '</div></div>';
    });
    if (!html && query) {
      html = '<div style="padding:20px;text-align:center;color:var(--text3);font-size:13px">No pages match "' + escapeHtml(query) + '"</div>';
    }
    pageList.innerHTML = html;

    // Bind clicks
    pageList.querySelectorAll('.page-item').forEach(function(el) {
      el.addEventListener('click', function() {
        openPage(el.getAttribute('data-id'));
        sidebar.classList.remove('open');
      });
    });
  }

  function formatDate(iso) {
    const d = new Date(iso);
    const mon = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
    return mon[d.getMonth()] + ' ' + d.getDate() + ', ' + d.getFullYear();
  }

  // Save current page content
  function saveCurrent() {
    if (!currentPageId || !pages[currentPageId]) return;
    pages[currentPageId].content = editor.value;
    pages[currentPageId].modified = new Date().toISOString();
    savePages();
    showToast('Saved', 'success');
  }

  // Auto-save on typing
  editor.addEventListener('input', function() {
    if (!currentPageId) return;
    clearTimeout(saveTimeout);
    saveTimeout = setTimeout(function() {
      pages[currentPageId].content = editor.value;
      pages[currentPageId].modified = new Date().toISOString();
      savePages();
      renderPageList();
    }, 800);
  });

  // Toast notification
  function showToast(msg, type) {
    toast.textContent = msg;
    toast.className = 'toast visible ' + (type || '');
    clearTimeout(showToast._t);
    showToast._t = setTimeout(function() { toast.className = 'toast'; }, 2000);
  }

  // Toolbar buttons
  btnEdit.addEventListener('click', function() { setMode('edit'); });
  btnPreview.addEventListener('click', function() { setMode('preview'); });

  $('btnNew').addEventListener('click', function() {
    const title = prompt('Page title:');
    if (title && title.trim()) createPage(title.trim());
  });

  $('btnRename').addEventListener('click', function() {
    if (!currentPageId) return;
    const newTitle = prompt('Rename page:', pages[currentPageId].title);
    if (newTitle && newTitle.trim() && newTitle.trim() !== pages[currentPageId].title) {
      pages[currentPageId].title = newTitle.trim();
      pages[currentPageId].modified = new Date().toISOString();
      toolbarTitle.textContent = newTitle.trim();
      savePages();
      renderPageList();
      showToast('Renamed', 'success');
    }
  });

  // Delete with confirmation modal
  $('btnDelete').addEventListener('click', function() {
    if (!currentPageId) return;
    deletePageName.textContent = pages[currentPageId].title;
    deleteModal.classList.add('visible');
  });

  $('deleteCancelBtn').addEventListener('click', function() {
    deleteModal.classList.remove('visible');
  });

  $('deleteConfirmBtn').addEventListener('click', function() {
    if (!currentPageId) return;
    delete pages[currentPageId];
    savePages();
    currentPageId = null;
    toolbar.style.display = 'none';
    editorPane.classList.add('hidden');
    previewPane.classList.add('hidden');
    emptyState.style.display = 'flex';
    renderPageList();
    deleteModal.classList.remove('visible');
    showToast('Page deleted', 'error');
  });

  // Export
  $('btnExport').addEventListener('click', function() {
    const data = JSON.stringify(pages, null, 2);
    const blob = new Blob([data], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'personal-wiki-export-' + new Date().toISOString().slice(0, 10) + '.json';
    a.click();
    URL.revokeObjectURL(url);
    showToast('Exported ' + Object.keys(pages).length + ' pages', 'success');
  });

  // Import
  $('btnImport').addEventListener('click', function() { importInput.click(); });
  importInput.addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(ev) {
      try {
        const imported = JSON.parse(ev.target.result);
        let count = 0;
        Object.keys(imported).forEach(function(id) {
          const p = imported[id];
          if (p && p.title && typeof p.content === 'string') {
            pages[id] = p;
            count++;
          }
        });
        savePages();
        renderPageList();
        showToast('Imported ' + count + ' pages', 'success');
      } catch (err) {
        showToast('Invalid JSON file', 'error');
      }
    };
    reader.readAsText(file);
    importInput.value = '';
  });

  // Search
  searchBox.addEventListener('input', function() { renderPageList(); });

  // Mobile toggle
  $('mobileToggle').addEventListener('click', function() {
    sidebar.classList.toggle('open');
  });

  // Keyboard shortcuts
  document.addEventListener('keydown', function(e) {
    const ctrl = e.ctrlKey || e.metaKey;
    if (ctrl && e.key === 's') {
      e.preventDefault();
      saveCurrent();
    } else if (ctrl && e.key === 'n') {
      e.preventDefault();
      const title = prompt('Page title:');
      if (title && title.trim()) createPage(title.trim());
    } else if (ctrl && e.key === 'f') {
      e.preventDefault();
      searchBox.focus();
      searchBox.select();
    } else if (e.key === 'Escape') {
      deleteModal.classList.remove('visible');
      sidebar.classList.remove('open');
    }
  });

  // Tab key in editor for indentation
  editor.addEventListener('keydown', function(e) {
    if (e.key === 'Tab') {
      e.preventDefault();
      const start = editor.selectionStart;
      const end = editor.selectionEnd;
      editor.value = editor.value.substring(0, start) + '  ' + editor.value.substring(end);
      editor.selectionStart = editor.selectionEnd = start + 2;
    }
  });

  // Init
  loadPages();
  renderPageList();

  // If there are pages but none selected, show empty state
  if (Object.keys(pages).length === 0) {
    emptyState.style.display = 'flex';
  }
})();
</script>
</body>
</html>
