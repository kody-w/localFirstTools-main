<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RetroPlay-8 Fantasy Console</title>
    <meta name="description" content="A complete 8-bit fantasy console with built-in code, sprite, and sound editors. Create and share games as JSON cartridges.">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

        :root {
            --bg-color: #1a1a1a;
            --console-bg: #2d2d2d;
            --screen-bg: #000000;
            --text-color: #c7f0d8;
            --accent-color: #43523d;
            --highlight: #ff004d;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Press Start 2P', monospace;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        #console-container {
            width: 800px;
            height: 600px;
            background-color: var(--console-bg);
            border-radius: 10px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 4px solid #444;
        }

        #toolbar {
            background-color: #333;
            padding: 10px;
            display: flex;
            gap: 10px;
            border-bottom: 2px solid #111;
        }

        .tool-btn {
            background: #555;
            border: 2px solid #222;
            color: #fff;
            padding: 8px 12px;
            font-family: inherit;
            font-size: 10px;
            cursor: pointer;
            box-shadow: inset 2px 2px 0 rgba(255,255,255,0.1), inset -2px -2px 0 rgba(0,0,0,0.3);
        }

        .tool-btn:active, .tool-btn.active {
            background: #444;
            box-shadow: inset 2px 2px 0 rgba(0,0,0,0.3);
            color: var(--highlight);
        }

        .tool-btn.action {
            background: #4a6;
        }
        
        .tool-btn.danger {
            background: #d44;
        }

        #workspace {
            flex: 1;
            position: relative;
            display: flex;
        }

        .view {
            display: none;
            width: 100%;
            height: 100%;
            padding: 10px;
            box-sizing: border-box;
        }

        .view.active {
            display: flex;
        }

        /* RUN VIEW */
        #run-view {
            justify-content: center;
            align-items: center;
            background-color: #111;
            flex-direction: column;
        }

        canvas#game-screen {
            background-color: var(--screen-bg);
            image-rendering: pixelated;
            border: 10px solid #555;
            border-radius: 4px;
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
        }

        /* CODE VIEW */
        #code-view {
            flex-direction: column;
        }

        textarea#code-editor {
            width: 100%;
            height: 100%;
            background-color: #1e1e1e;
            color: #a9b7c6;
            font-family: 'Courier New', monospace; /* Better for coding than pixel font */
            font-size: 14px;
            border: none;
            padding: 10px;
            resize: none;
            outline: none;
            line-height: 1.4;
        }

        /* SPRITE VIEW */
        #sprite-view {
            gap: 20px;
        }

        #sprite-editor-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        #sprite-canvas {
            border: 1px solid #555;
            background-image: linear-gradient(45deg, #222 25%, transparent 25%), linear-gradient(-45deg, #222 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #222 75%), linear-gradient(-45deg, transparent 75%, #222 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            cursor: crosshair;
        }

        #palette {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 2px;
            background: #000;
            padding: 4px;
            border: 2px solid #555;
        }

        .color-swatch {
            width: 24px;
            height: 24px;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .color-swatch.active {
            border-color: #fff;
            z-index: 1;
        }

        #sprite-sheet-container {
            flex: 1;
            border: 1px solid #444;
            overflow-y: auto;
            background: #000;
            padding: 5px;
        }

        #sprite-sheet {
            image-rendering: pixelated;
            cursor: pointer;
        }

        /* SOUND VIEW */
        #sound-view {
            flex-direction: column;
            gap: 10px;
        }

        .tracker-row {
            display: flex;
            gap: 5px;
            margin-bottom: 2px;
        }
        
        .tracker-cell {
            width: 40px;
            background: #333;
            border: 1px solid #444;
            text-align: center;
            cursor: pointer;
            font-size: 10px;
            padding: 5px 0;
        }
        
        .tracker-cell.active {
            background: #ff004d;
            color: white;
        }

        /* STATUS BAR */
        #status-bar {
            background: #222;
            padding: 5px 10px;
            font-size: 10px;
            color: #888;
            border-top: 1px solid #111;
            display: flex;
            justify-content: space-between;
        }

        /* MODAL */
        #modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        
        #modal {
            background: var(--console-bg);
            padding: 20px;
            border: 4px solid #fff;
            max-width: 500px;
            width: 90%;
        }
        
        textarea#cart-data {
            width: 100%;
            height: 150px;
            background: #111;
            color: #0f0;
            font-family: monospace;
            margin: 10px 0;
        }

        .help-text {
            font-size: 10px;
            line-height: 1.6;
            color: #aaa;
            margin-top: 10px;
        }
    </style>
</head>
<body>

    <div id="console-container">
        <div id="toolbar">
            <button class="tool-btn active" onclick="switchView('run')">RUN</button>
            <button class="tool-btn" onclick="switchView('code')">CODE</button>
            <button class="tool-btn" onclick="switchView('sprite')">SPRITE</button>
            <button class="tool-btn" onclick="switchView('sound')">SOUND</button>
            <div style="flex:1"></div>
            <button class="tool-btn action" onclick="saveCart()">SAVE</button>
            <button class="tool-btn action" onclick="loadCart()">LOAD</button>
            <button class="tool-btn danger" onclick="resetCart()">NEW</button>
        </div>

        <div id="workspace">
            <!-- RUN VIEW -->
            <div id="run-view" class="view active">
                <canvas id="game-screen" width="128" height="128" style="width: 512px; height: 512px;"></canvas>
                <div style="margin-top: 10px; font-size: 10px; color: #666;">CONTROLS: ARROWS + Z / X</div>
            </div>

            <!-- CODE VIEW -->
            <div id="code-view" class="view">
                <textarea id="code-editor" spellcheck="false"></textarea>
                <div class="help-text">
                    API: cls(c), pset(x,y,c), line(x0,y0,x1,y1,c), rect(x,y,w,h,c), circ(x,y,r,c), 
                    spr(id,x,y), print(str,x,y,c), btn(id), sfx(id)
                    <br>
                    Lifecycle: _init(), _update(), _draw()
                </div>
            </div>

            <!-- SPRITE VIEW -->
            <div id="sprite-view" class="view">
                <div id="sprite-sheet-container">
                    <canvas id="sprite-sheet" width="128" height="128" style="width: 256px; height: 256px;"></canvas>
                </div>
                <div id="sprite-editor-container">
                    <canvas id="sprite-canvas" width="8" height="8" style="width: 256px; height: 256px;"></canvas>
                    <div id="palette"></div>
                    <div style="display:flex; gap:5px; margin-top:5px;">
                        <button class="tool-btn" onclick="clearSprite()">CLR</button>
                        <button class="tool-btn" onclick="fillSprite()">FILL</button>
                    </div>
                    <div style="font-size: 10px; margin-top: 5px;">ID: <span id="sprite-id">0</span></div>
                </div>
            </div>

            <!-- SOUND VIEW -->
            <div id="sound-view" class="view">
                <div style="text-align: center; margin-bottom: 10px;">SFX EDITOR (Simple Waveforms)</div>
                <div style="display: flex; gap: 10px; align-items: center; justify-content: center;">
                    <button class="tool-btn" onclick="prevSfx()">&lt;</button>
                    <span>SFX <span id="sfx-id">0</span></span>
                    <button class="tool-btn" onclick="nextSfx()">&gt;</button>
                    <button class="tool-btn action" onclick="playSfx(currentSfxId)">PLAY</button>
                </div>
                
                <div id="tracker-editor" style="margin-top: 20px; height: 300px; overflow-y: auto; border: 1px solid #444; padding: 10px;">
                    <!-- Generated by JS -->
                </div>
                
                <div class="help-text" style="text-align: center;">
                    Pitch (0-32) | Waveform (Square, Saw, Tri, Noise) | Volume
                </div>
            </div>
        </div>

        <div id="status-bar">
            <span id="status-msg">READY.</span>
            <span>MEM: <span id="mem-usage">0</span>%</span>
        </div>
    </div>

    <div id="modal-overlay">
        <div id="modal">
            <h3 id="modal-title">CARTRIDGE DATA</h3>
            <p>Copy/Paste this JSON to share your game:</p>
            <textarea id="cart-data"></textarea>
            <div style="text-align: right;">
                <button class="tool-btn" onclick="closeModal()">CLOSE</button>
                <button class="tool-btn action" id="modal-action-btn" onclick="importCart()">LOAD</button>
            </div>
        </div>
    </div>

<script>
/**
 * RETROPLAY-8 ENGINE
 */

// --- CONSTANTS & CONFIG ---
const SCREEN_W = 128;
const SCREEN_H = 128;
const PALETTE = [
    '#000000', '#1D2B53', '#7E2553', '#008751',
    '#AB5236', '#5F574F', '#C2C3C7', '#FFF1E8',
    '#FF004D', '#FFA300', '#FFEC27', '#00E436',
    '#29ADFF', '#83769C', '#FF77A8', '#FFCCAA'
]; // PICO-8 Palette

// --- STATE ---
let cart = {
    code: '',
    sprites: new Array(256).fill(null).map(() => new Array(64).fill(0)), // 256 sprites, 8x8 pixels (64 ints)
    sfx: new Array(64).fill(null).map(() => ({ speed: 10, notes: new Array(32).fill(null).map(() => ({pitch: 0, vol: 0, wave: 0})) }))
};

let isRunning = false;
let animationFrameId;
let currentView = 'run';
let currentSpriteId = 0;
let currentColor = 7;
let currentSfxId = 0;
let keys = {};

// --- DOM ELEMENTS ---
const canvas = document.getElementById('game-screen');
const ctx = canvas.getContext('2d', { alpha: false });
const codeEditor = document.getElementById('code-editor');
const spriteCanvas = document.getElementById('sprite-canvas');
const spriteCtx = spriteCanvas.getContext('2d');
const spriteSheet = document.getElementById('sprite-sheet');
const spriteSheetCtx = spriteSheet.getContext('2d');
const paletteDiv = document.getElementById('palette');

// --- INITIALIZATION ---
function init() {
    // Setup Palette UI
    PALETTE.forEach((color, idx) => {
        const div = document.createElement('div');
        div.className = `color-swatch ${idx === currentColor ? 'active' : ''}`;
        div.style.backgroundColor = color;
        div.onclick = () => selectColor(idx);
        paletteDiv.appendChild(div);
    });

    // Setup Sprite Editor Interactions
    let isDrawing = false;
    spriteCanvas.addEventListener('mousedown', (e) => { isDrawing = true; drawPixel(e); });
    spriteCanvas.addEventListener('mousemove', (e) => { if(isDrawing) drawPixel(e); });
    spriteCanvas.addEventListener('mouseup', () => { isDrawing = false; updateSpriteSheet(); });
    spriteCanvas.addEventListener('mouseleave', () => { isDrawing = false; });

    // Setup Sprite Sheet Selection
    spriteSheet.addEventListener('click', (e) => {
        const rect = spriteSheet.getBoundingClientRect();
        const x = Math.floor((e.clientX - rect.left) / (rect.width / 16)); // 16 sprites per row
        const y = Math.floor((e.clientY - rect.top) / (rect.height / 16));
        currentSpriteId = y * 16 + x;
        document.getElementById('sprite-id').textContent = currentSpriteId;
        renderSpriteEditor();
    });

    // Setup Keyboard
    window.addEventListener('keydown', (e) => {
        keys[e.code] = true;
        if (isRunning) e.preventDefault(); // Prevent scrolling when playing
    });
    window.addEventListener('keyup', (e) => {
        keys[e.code] = false;
    });

    // Setup Sound Editor
    renderSoundTracker();

    // Load Default Cart
    loadDefaultCart();
    
    // Start Loop
    requestAnimationFrame(sysLoop);
}

// --- SYSTEM LOOP ---
function sysLoop(time) {
    if (isRunning && userGame.update && userGame.draw) {
        try {
            userGame.update();
            userGame.draw();
        } catch (e) {
            console.error(e);
            stopGame();
            alert("Runtime Error: " + e.message);
        }
    }
    requestAnimationFrame(sysLoop);
}

// --- GAME API (Exposed to User) ---
const api = {
    cls: (c = 0) => {
        ctx.fillStyle = PALETTE[c % 16];
        ctx.fillRect(0, 0, SCREEN_W, SCREEN_H);
    },
    pset: (x, y, c = 7) => {
        ctx.fillStyle = PALETTE[c % 16];
        ctx.fillRect(Math.floor(x), Math.floor(y), 1, 1);
    },
    rect: (x, y, w, h, c = 7) => {
        ctx.fillStyle = PALETTE[c % 16];
        ctx.fillRect(Math.floor(x), Math.floor(y), Math.floor(w), Math.floor(h));
    },
    circ: (x, y, r, c = 7) => {
        ctx.beginPath();
        ctx.arc(Math.floor(x), Math.floor(y), Math.floor(r), 0, Math.PI * 2);
        ctx.fillStyle = PALETTE[c % 16];
        ctx.fill();
    },
    print: (str, x, y, c = 7) => {
        ctx.fillStyle = PALETTE[c % 16];
        ctx.font = '10px "Press Start 2P"'; // Fallback
        ctx.fillText(str, x, y + 8);
    },
    spr: (id, x, y) => {
        if (id < 0 || id > 255) return;
        const sx = (id % 16) * 8;
        const sy = Math.floor(id / 16) * 8;
        // Draw from sprite sheet canvas to game canvas
        // We need to disable smoothing on the context for this draw
        ctx.imageSmoothingEnabled = false;
        ctx.drawImage(spriteSheet, sx, sy, 8, 8, Math.floor(x), Math.floor(y), 8, 8);
    },
    btn: (i) => {
        // 0: Left, 1: Right, 2: Up, 3: Down, 4: Z, 5: X
        switch(i) {
            case 0: return keys['ArrowLeft'];
            case 1: return keys['ArrowRight'];
            case 2: return keys['ArrowUp'];
            case 3: return keys['ArrowDown'];
            case 4: return keys['KeyZ'] || keys['Space'];
            case 5: return keys['KeyX'];
            default: return false;
        }
    },
    sfx: (id) => {
        playSfx(id);
    },
    rnd: (n) => Math.random() * n,
    flr: (n) => Math.floor(n)
};

let userGame = {};

function runGame() {
    // Save current code
    cart.code = codeEditor.value;
    
    // Create Sandbox
    const code = cart.code;
    
    // Wrap code to extract lifecycle functions
    const wrappedCode = `
        const _api = args;
        // Expose API globally for the script
        const cls = _api.cls;
        const pset = _api.pset;
        const rect = _api.rect;
        const circ = _api.circ;
        const spr = _api.spr;
        const print = _api.print;
        const btn = _api.btn;
        const sfx = _api.sfx;
        const rnd = _api.rnd;
        const flr = _api.flr;
        
        ${code}
        
        return {
            _init: typeof _init !== 'undefined' ? _init : () => {},
            _update: typeof _update !== 'undefined' ? _update : () => {},
            _draw: typeof _draw !== 'undefined' ? _draw : () => {}
        };
    `;

    try {
        const createGame = new Function('args', wrappedCode);
        userGame = createGame(api);
        
        // Reset State
        ctx.fillStyle = '#000';
        ctx.fillRect(0, 0, SCREEN_W, SCREEN_H);
        
        if (userGame._init) userGame._init();
        isRunning = true;
        document.getElementById('status-msg').textContent = "RUNNING...";
    } catch (e) {
        alert("Compilation Error: " + e.message);
        stopGame();
    }
}

function stopGame() {
    isRunning = false;
    document.getElementById('status-msg').textContent = "STOPPED.";
}

// --- EDITOR FUNCTIONS ---

function switchView(viewName) {
    // Hide all
    document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
    document.querySelectorAll('.tool-btn').forEach(el => el.classList.remove('active'));
    
    // Show target
    document.getElementById(viewName + '-view').classList.add('active');
    
    // Update buttons (simple logic)
    const btns = document.getElementById('toolbar').children;
    if(viewName === 'run') btns[0].classList.add('active');
    if(viewName === 'code') btns[1].classList.add('active');
    if(viewName === 'sprite') btns[2].classList.add('active');
    if(viewName === 'sound') btns[3].classList.add('active');

    currentView = viewName;

    if (viewName === 'run') {
        runGame();
    } else {
        stopGame();
        if (viewName === 'sprite') {
            renderSpriteEditor();
            updateSpriteSheet();
        }
    }
}

// Sprite Editor
function selectColor(idx) {
    currentColor = idx;
    document.querySelectorAll('.color-swatch').forEach((el, i) => {
        el.classList.toggle('active', i === idx);
    });
}

function drawPixel(e) {
    const rect = spriteCanvas.getBoundingClientRect();
    const x = Math.floor((e.clientX - rect.left) / (rect.width / 8));
    const y = Math.floor((e.clientY - rect.top) / (rect.height / 8));
    
    if (x >= 0 && x < 8 && y >= 0 && y < 8) {
        cart.sprites[currentSpriteId][y * 8 + x] = currentColor;
        renderSpriteEditor();
    }
}

function renderSpriteEditor() {
    // Clear
    spriteCtx.clearRect(0, 0, 8, 8);
    
    // Draw pixels
    const pixels = cart.sprites[currentSpriteId];
    for (let y = 0; y < 8; y++) {
        for (let x = 0; x < 8; x++) {
            const colorIdx = pixels[y * 8 + x];
            if (colorIdx !== 0) { // 0 is transparent in editor view usually, but let's draw black for 0
                spriteCtx.fillStyle = PALETTE[colorIdx];
                spriteCtx.fillRect(x, y, 1, 1);
            }
        }
    }
}

function updateSpriteSheet() {
    // Redraw entire sheet
    spriteSheetCtx.clearRect(0, 0, 128, 128);
    
    for (let id = 0; id < 256; id++) {
        const sx = (id % 16) * 8;
        const sy = Math.floor(id / 16) * 8;
        const pixels = cart.sprites[id];
        
        for (let y = 0; y < 8; y++) {
            for (let x = 0; x < 8; x++) {
                const colorIdx = pixels[y * 8 + x];
                spriteSheetCtx.fillStyle = PALETTE[colorIdx];
                spriteSheetCtx.fillRect(sx + x, sy + y, 1, 1);
            }
        }
    }
}

function clearSprite() {
    cart.sprites[currentSpriteId].fill(0);
    renderSpriteEditor();
    updateSpriteSheet();
}

function fillSprite() {
    cart.sprites[currentSpriteId].fill(currentColor);
    renderSpriteEditor();
    updateSpriteSheet();
}

// Sound Editor (Mockup/Simple)
function renderSoundTracker() {
    const container = document.getElementById('tracker-editor');
    container.innerHTML = '';
    
    const sfx = cart.sfx[currentSfxId];
    
    for (let i = 0; i < 32; i++) {
        const row = document.createElement('div');
        row.className = 'tracker-row';
        
        const note = sfx.notes[i];
        
        // Note Index
        const idx = document.createElement('div');
        idx.style.width = '20px';
        idx.style.color = '#666';
        idx.textContent = i;
        row.appendChild(idx);
        
        // Pitch
        const pitch = document.createElement('input');
        pitch.type = 'number';
        pitch.min = 0; pitch.max = 64;
        pitch.value = note.pitch;
        pitch.style.width = '40px';
        pitch.onchange = (e) => { note.pitch = parseInt(e.target.value); };
        row.appendChild(pitch);
        
        // Vol
        const vol = document.createElement('input');
        vol.type = 'range';
        vol.min = 0; vol.max = 7;
        vol.value = note.vol;
        vol.style.width = '60px';
        vol.onchange = (e) => { note.vol = parseInt(e.target.value); };
        row.appendChild(vol);
        
        container.appendChild(row);
    }
}

// Audio Context
let audioCtx;
function initAudio() {
    if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    }
    if (audioCtx.state === 'suspended') {
        audioCtx.resume();
    }
}

function playSfx(id) {
    initAudio();
    const sfx = cart.sfx[id];
    const now = audioCtx.currentTime;
    const speed = 0.1; // seconds per note
    
    sfx.notes.forEach((note, i) => {
        if (note.vol > 0) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            
            osc.type = ['square', 'sawtooth', 'triangle', 'sine'][note.wave || 0];
            // Simple frequency calc
            const freq = 440 * Math.pow(2, (note.pitch - 32) / 12);
            osc.frequency.setValueAtTime(freq, now + i * speed);
            
            gain.gain.setValueAtTime(note.vol / 10, now + i * speed);
            gain.gain.exponentialRampToValueAtTime(0.01, now + i * speed + speed - 0.01);
            
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            osc.start(now + i * speed);
            osc.stop(now + i * speed + speed);
        }
    });
}

// --- CARTRIDGE MANAGEMENT ---

function saveCart() {
    cart.code = codeEditor.value;
    const json = JSON.stringify(cart);
    document.getElementById('cart-data').value = json;
    document.getElementById('modal-title').textContent = "SAVE CARTRIDGE";
    document.getElementById('modal-action-btn').style.display = 'none';
    document.getElementById('modal-overlay').style.display = 'flex';
}

function loadCart() {
    document.getElementById('cart-data').value = "";
    document.getElementById('modal-title').textContent = "LOAD CARTRIDGE";
    document.getElementById('modal-action-btn').style.display = 'inline-block';
    document.getElementById('modal-overlay').style.display = 'flex';
}

function importCart() {
    try {
        const json = document.getElementById('cart-data').value;
        const data = JSON.parse(json);
        
        // Validate basic structure
        if (data.code !== undefined && data.sprites && data.sfx) {
            cart = data;
            codeEditor.value = cart.code;
            updateSpriteSheet();
            renderSoundTracker();
            closeModal();
            alert("Cartridge Loaded!");
            switchView('run');
        } else {
            throw new Error("Invalid Cartridge Format");
        }
    } catch (e) {
        alert("Error loading cartridge: " + e.message);
    }
}

function resetCart() {
    if(confirm("Clear everything?")) {
        loadDefaultCart();
        updateSpriteSheet();
        switchView('code');
    }
}

function closeModal() {
    document.getElementById('modal-overlay').style.display = 'none';
}

function loadDefaultCart() {
    // Simple Demo Game
    const defaultCode = `
// RETRO BOUNCE DEMO

let x = 64;
let y = 64;
let dx = 1;
let dy = 1;
let r = 4;
let col = 8;

function _init() {
  cls(0);
  print("HELLO WORLD", 40, 60, 7);
}

function _update() {
  // Move
  x += dx;
  y += dy;
  
  // Bounce
  if (x < r || x > 128-r) {
    dx = -dx;
    sfx(0);
    col = flr(rnd(16));
  }
  if (y < r || y > 128-r) {
    dy = -dy;
    sfx(0);
    col = flr(rnd(16));
  }
  
  // Controls
  if (btn(0)) x -= 1;
  if (btn(1)) x += 1;
  if (btn(2)) y -= 1;
  if (btn(3)) y += 1;
}

function _draw() {
  cls(0);
  
  // Draw Ball
  circ(x, y, r, col);
  
  // Draw Text
  print("ARROWS TO MOVE", 10, 110, 6);
  
  // Draw Sprite 0 at center
  spr(0, 64-4, 64-4);
}
`;
    cart.code = defaultCode;
    codeEditor.value = defaultCode;
    
    // Create a smiley face sprite at 0
    const smiley = [
        0,0,7,7,7,7,0,0,
        0,7,7,7,7,7,7,0,
        7,7,0,7,7,0,7,7,
        7,7,0,7,7,0,7,7,
        7,7,7,7,7,7,7,7,
        7,7,0,0,0,0,7,7,
        0,7,7,7,7,7,7,0,
        0,0,7,7,7,7,0,0
    ];
    cart.sprites[0] = smiley.concat(new Array(64-smiley.length).fill(0));
    
    // Create a simple beep sfx at 0
    cart.sfx[0].notes[0] = {pitch: 40, vol: 5, wave: 1};
    cart.sfx[0].notes[1] = {pitch: 30, vol: 3, wave: 1};
}

// Start
init();

</script>
</body>
</html>
